{"file_contents":{"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/components/examples/Dashboard.tsx":{"content":"import { Dashboard } from \"../Dashboard\";\n\nexport default function DashboardExample() {\n  return <Dashboard />;\n}\n","path":null,"size_bytes":114,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/components/examples/ChartOfAccounts.tsx":{"content":"import { ChartOfAccounts } from \"../financials/ChartOfAccounts\";\n\nexport default function ChartOfAccountsExample() {\n  return <ChartOfAccounts />;\n}\n","path":null,"size_bytes":149,"size_tokens":null},"client/src/components/layout/PageHeader.tsx":{"content":"import { cn } from \"@/lib/utils\";\n\ninterface PageHeaderProps {\n  title: string;\n  description?: string;\n  actions?: React.ReactNode;\n  className?: string;\n}\n\nexport function PageHeader({ title, description, actions, className }: PageHeaderProps) {\n  return (\n    <div className={cn(\"flex flex-wrap items-start justify-between gap-4 mb-6\", className)}>\n      <div>\n        <h1 className=\"text-2xl font-semibold\" data-testid=\"text-page-title\">{title}</h1>\n        {description && (\n          <p className=\"text-sm text-muted-foreground mt-1\" data-testid=\"text-page-description\">\n            {description}\n          </p>\n        )}\n      </div>\n      {actions && (\n        <div className=\"flex flex-wrap items-center gap-2\">\n          {actions}\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":784,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport cookieParser from \"cookie-parser\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\n\nconst app = express();\nconst httpServer = createServer(app);\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\napp.use(\n  express.json({\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false }));\napp.use(cookieParser());\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  await registerRoutes(httpServer, app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":2627,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/components/system/InterCompanyTransactions.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { format } from \"date-fns\";\nimport {\n  ArrowLeftRight,\n  Plus,\n  Eye,\n  FileCheck,\n  XCircle,\n  Building2,\n  Package,\n  DollarSign,\n  Truck,\n  Search,\n  Filter,\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Tabs,\n  TabsContent,\n  TabsList,\n  TabsTrigger,\n} from \"@/components/ui/tabs\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useCompany } from \"@/contexts/CompanyContext\";\nimport type { Company, Warehouse, Product } from \"@shared/schema\";\n\ninterface IntercoTransaction {\n  id: string;\n  transactionNumber: string;\n  transactionType: string;\n  sourceCompanyId: string;\n  targetCompanyId: string;\n  amount: string;\n  currency: string;\n  status: string;\n  transactionDate: Date | null;\n  description: string | null;\n  referenceNumber: string | null;\n  createdAt: Date | null;\n}\n\ninterface IntercoStockTransfer {\n  id: string;\n  transferNumber: string;\n  sourceCompanyId: string;\n  targetCompanyId: string;\n  sourceWarehouseId: string;\n  targetWarehouseId: string;\n  status: string;\n  transferDate: Date | null;\n  totalValue: string;\n  sourceSalesOrderId: string | null;\n  targetPurchaseOrderId: string | null;\n  createdAt: Date | null;\n}\nimport { cn } from \"@/lib/utils\";\n\nconst transactionFormSchema = z.object({\n  transactionType: z.enum([\"sale\", \"purchase\", \"service\", \"dividend\", \"loan\"]),\n  sourceCompanyId: z.string().min(1, \"Source company required\"),\n  targetCompanyId: z.string().min(1, \"Target company required\"),\n  amount: z.string().min(1, \"Amount required\"),\n  currency: z.string().default(\"USD\"),\n  description: z.string().optional(),\n  referenceNumber: z.string().optional(),\n});\n\ntype TransactionFormValues = z.infer<typeof transactionFormSchema>;\n\nconst stockTransferFormSchema = z.object({\n  sourceCompanyId: z.string().min(1, \"Source company required\"),\n  targetCompanyId: z.string().min(1, \"Target company required\"),\n  sourceWarehouseId: z.string().min(1, \"Source warehouse required\"),\n  targetWarehouseId: z.string().min(1, \"Target warehouse required\"),\n  productId: z.string().min(1, \"Product required\"),\n  quantity: z.string().min(1, \"Quantity required\"),\n  unitCost: z.string().min(1, \"Unit cost required\"),\n  notes: z.string().optional(),\n});\n\ntype StockTransferFormValues = z.infer<typeof stockTransferFormSchema>;\n\nconst transactionTypeColors: Record<string, string> = {\n  sale: \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\",\n  purchase: \"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200\",\n  service: \"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200\",\n  dividend: \"bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200\",\n  loan: \"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200\",\n};\n\nconst statusColors: Record<string, string> = {\n  draft: \"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200\",\n  pending: \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200\",\n  approved: \"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200\",\n  completed: \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\",\n  cancelled: \"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200\",\n  in_transit: \"bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200\",\n  received: \"bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-200\",\n};\n\nexport function InterCompanyTransactions() {\n  const { toast } = useToast();\n  const { activeCompanyId } = useCompany();\n  const [isTransactionDialogOpen, setIsTransactionDialogOpen] = useState(false);\n  const [isTransferDialogOpen, setIsTransferDialogOpen] = useState(false);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [selectedTransaction, setSelectedTransaction] = useState<IntercoTransaction | null>(null);\n  const [selectedTransfer, setSelectedTransfer] = useState<IntercoStockTransfer | null>(null);\n\n  // Fetch companies\n  const { data: companies = [] } = useQuery<Company[]>({\n    queryKey: [\"/api/companies\"],\n  });\n\n  // Fetch warehouses\n  const { data: warehouses = [] } = useQuery<Warehouse[]>({\n    queryKey: [\"/api/warehouses\"],\n  });\n\n  // Fetch products\n  const { data: products = [] } = useQuery<Product[]>({\n    queryKey: [\"/api/products\"],\n  });\n\n  // Fetch inter-company transactions\n  const { data: transactions = [], isLoading: transactionsLoading } = useQuery<IntercoTransaction[]>({\n    queryKey: [\"/api/interco-transactions\"],\n  });\n\n  // Fetch inter-company stock transfers\n  const { data: stockTransfers = [], isLoading: transfersLoading } = useQuery<IntercoStockTransfer[]>({\n    queryKey: [\"/api/interco-stock-transfers\"],\n  });\n\n  const transactionForm = useForm<TransactionFormValues>({\n    resolver: zodResolver(transactionFormSchema),\n    defaultValues: {\n      transactionType: \"sale\",\n      sourceCompanyId: activeCompanyId || \"\",\n      targetCompanyId: \"\",\n      amount: \"\",\n      currency: \"USD\",\n      description: \"\",\n      referenceNumber: \"\",\n    },\n  });\n\n  const stockTransferForm = useForm<StockTransferFormValues>({\n    resolver: zodResolver(stockTransferFormSchema),\n    defaultValues: {\n      sourceCompanyId: activeCompanyId || \"\",\n      targetCompanyId: \"\",\n      sourceWarehouseId: \"\",\n      targetWarehouseId: \"\",\n      productId: \"\",\n      quantity: \"\",\n      unitCost: \"\",\n      notes: \"\",\n    },\n  });\n\n  // Create transaction mutation\n  const createTransactionMutation = useMutation({\n    mutationFn: async (data: TransactionFormValues) => {\n      const response = await apiRequest(\"POST\", \"/api/interco-transactions\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/interco-transactions\"] });\n      toast({ title: \"Inter-company transaction created\" });\n      setIsTransactionDialogOpen(false);\n      transactionForm.reset();\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  // Create stock transfer mutation\n  const createTransferMutation = useMutation({\n    mutationFn: async (data: StockTransferFormValues) => {\n      const response = await apiRequest(\"POST\", \"/api/interco-stock-transfers\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/interco-stock-transfers\"] });\n      toast({ title: \"Stock transfer created\" });\n      setIsTransferDialogOpen(false);\n      stockTransferForm.reset();\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  // Approve transaction mutation\n  const approveTransactionMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const response = await apiRequest(\"PATCH\", `/api/interco-transactions/${id}`, {\n        status: \"approved\",\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/interco-transactions\"] });\n      toast({ title: \"Transaction approved\" });\n      setSelectedTransaction(null);\n    },\n  });\n\n  // Complete transfer mutation\n  const completeTransferMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const response = await apiRequest(\"PATCH\", `/api/interco-stock-transfers/${id}`, {\n        status: \"received\",\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/interco-stock-transfers\"] });\n      toast({ title: \"Transfer marked as received\" });\n      setSelectedTransfer(null);\n    },\n  });\n\n  const handleSubmitTransaction = (values: TransactionFormValues) => {\n    createTransactionMutation.mutate(values);\n  };\n\n  const handleSubmitTransfer = (values: StockTransferFormValues) => {\n    createTransferMutation.mutate(values);\n  };\n\n  const getCompanyName = (id: string) => {\n    return companies.find((c) => c.id === id)?.name || id;\n  };\n\n  const getWarehouseName = (id: string) => {\n    return warehouses.find((w) => w.id === id)?.name || id;\n  };\n\n  const getProductName = (id: string) => {\n    return products.find((p) => p.id === id)?.name || id;\n  };\n\n  const filteredTransactions = transactions.filter((t) => {\n    if (!searchTerm) return true;\n    const searchLower = searchTerm.toLowerCase();\n    return (\n      t.transactionNumber?.toLowerCase().includes(searchLower) ||\n      getCompanyName(t.sourceCompanyId).toLowerCase().includes(searchLower) ||\n      getCompanyName(t.targetCompanyId).toLowerCase().includes(searchLower)\n    );\n  });\n\n  const filteredTransfers = stockTransfers.filter((t) => {\n    if (!searchTerm) return true;\n    const searchLower = searchTerm.toLowerCase();\n    return (\n      t.transferNumber?.toLowerCase().includes(searchLower) ||\n      getCompanyName(t.sourceCompanyId).toLowerCase().includes(searchLower) ||\n      getCompanyName(t.targetCompanyId).toLowerCase().includes(searchLower)\n    );\n  });\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\" data-testid=\"text-page-title\">\n            Inter-Company Transactions\n          </h1>\n          <p className=\"text-muted-foreground\">\n            Manage transactions and stock transfers between companies\n          </p>\n        </div>\n        <div className=\"flex items-center gap-2 flex-wrap\">\n          <Button \n            variant=\"outline\" \n            onClick={() => setIsTransferDialogOpen(true)}\n            data-testid=\"button-new-transfer\"\n          >\n            <Truck className=\"h-4 w-4 mr-2\" />\n            Stock Transfer\n          </Button>\n          <Button \n            onClick={() => setIsTransactionDialogOpen(true)}\n            data-testid=\"button-new-transaction\"\n          >\n            <Plus className=\"h-4 w-4 mr-2\" />\n            New Transaction\n          </Button>\n        </div>\n      </div>\n\n      <Tabs defaultValue=\"transactions\" className=\"space-y-4\">\n        <TabsList data-testid=\"tabs-view-selector\">\n          <TabsTrigger value=\"transactions\" data-testid=\"tab-transactions\">\n            <DollarSign className=\"h-4 w-4 mr-2\" />\n            Financial Transactions\n          </TabsTrigger>\n          <TabsTrigger value=\"transfers\" data-testid=\"tab-transfers\">\n            <Package className=\"h-4 w-4 mr-2\" />\n            Stock Transfers\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"transactions\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between gap-4 flex-wrap\">\n              <div>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <ArrowLeftRight className=\"h-5 w-5\" />\n                  Inter-Company Financial Transactions\n                </CardTitle>\n                <CardDescription>\n                  Sales, purchases, services, and other financial flows between entities\n                </CardDescription>\n              </div>\n              <div className=\"relative\">\n                <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  placeholder=\"Search transactions...\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"pl-8 w-[200px]\"\n                  data-testid=\"input-search-transactions\"\n                />\n              </div>\n            </CardHeader>\n            <CardContent>\n              <Table data-testid=\"table-transactions\">\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Transaction #</TableHead>\n                    <TableHead>Type</TableHead>\n                    <TableHead>Source Company</TableHead>\n                    <TableHead>Target Company</TableHead>\n                    <TableHead className=\"text-right\">Amount</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Date</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredTransactions.map((transaction) => (\n                    <TableRow key={transaction.id} data-testid={`row-transaction-${transaction.id}`}>\n                      <TableCell className=\"font-medium\">\n                        {transaction.transactionNumber}\n                      </TableCell>\n                      <TableCell>\n                        <Badge \n                          variant=\"secondary\"\n                          className={transactionTypeColors[transaction.transactionType]}\n                        >\n                          {transaction.transactionType}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-2\">\n                          <Building2 className=\"h-4 w-4 text-muted-foreground\" />\n                          {getCompanyName(transaction.sourceCompanyId)}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-2\">\n                          <Building2 className=\"h-4 w-4 text-muted-foreground\" />\n                          {getCompanyName(transaction.targetCompanyId)}\n                        </div>\n                      </TableCell>\n                      <TableCell className=\"text-right font-mono\">\n                        {transaction.currency} {parseFloat(transaction.amount).toLocaleString(\"en-US\", {\n                          minimumFractionDigits: 2,\n                          maximumFractionDigits: 2,\n                        })}\n                      </TableCell>\n                      <TableCell>\n                        <Badge \n                          variant=\"secondary\"\n                          className={statusColors[transaction.status]}\n                        >\n                          {transaction.status}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        {transaction.transactionDate \n                          ? format(new Date(transaction.transactionDate), \"MMM d, yyyy\")\n                          : \"-\"}\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <div className=\"flex items-center justify-end gap-1\">\n                          <Button\n                            size=\"icon\"\n                            variant=\"ghost\"\n                            onClick={() => setSelectedTransaction(transaction)}\n                            data-testid={`button-view-${transaction.id}`}\n                          >\n                            <Eye className=\"h-4 w-4\" />\n                          </Button>\n                          {transaction.status === \"pending\" && (\n                            <Button\n                              size=\"icon\"\n                              variant=\"ghost\"\n                              onClick={() => approveTransactionMutation.mutate(transaction.id)}\n                              data-testid={`button-approve-${transaction.id}`}\n                            >\n                              <FileCheck className=\"h-4 w-4\" />\n                            </Button>\n                          )}\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                  {filteredTransactions.length === 0 && !transactionsLoading && (\n                    <TableRow>\n                      <TableCell colSpan={8} className=\"text-center py-8 text-muted-foreground\">\n                        No inter-company transactions found\n                      </TableCell>\n                    </TableRow>\n                  )}\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"transfers\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between gap-4 flex-wrap\">\n              <div>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Truck className=\"h-5 w-5\" />\n                  Inter-Company Stock Transfers\n                </CardTitle>\n                <CardDescription>\n                  Inventory movements between company warehouses\n                </CardDescription>\n              </div>\n              <div className=\"relative\">\n                <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  placeholder=\"Search transfers...\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"pl-8 w-[200px]\"\n                  data-testid=\"input-search-transfers\"\n                />\n              </div>\n            </CardHeader>\n            <CardContent>\n              <Table data-testid=\"table-transfers\">\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Transfer #</TableHead>\n                    <TableHead>From</TableHead>\n                    <TableHead>To</TableHead>\n                    <TableHead className=\"text-right\">Value</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Date</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredTransfers.map((transfer) => (\n                    <TableRow key={transfer.id} data-testid={`row-transfer-${transfer.id}`}>\n                      <TableCell className=\"font-medium\">\n                        {transfer.transferNumber}\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex flex-col\">\n                          <span className=\"font-medium\">\n                            {getCompanyName(transfer.sourceCompanyId)}\n                          </span>\n                          <span className=\"text-xs text-muted-foreground\">\n                            {getWarehouseName(transfer.sourceWarehouseId)}\n                          </span>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex flex-col\">\n                          <span className=\"font-medium\">\n                            {getCompanyName(transfer.targetCompanyId)}\n                          </span>\n                          <span className=\"text-xs text-muted-foreground\">\n                            {getWarehouseName(transfer.targetWarehouseId)}\n                          </span>\n                        </div>\n                      </TableCell>\n                      <TableCell className=\"text-right font-mono\">\n                        ${parseFloat(transfer.totalValue).toLocaleString(\"en-US\", {\n                          minimumFractionDigits: 2,\n                          maximumFractionDigits: 2,\n                        })}\n                      </TableCell>\n                      <TableCell>\n                        <Badge \n                          variant=\"secondary\"\n                          className={statusColors[transfer.status]}\n                        >\n                          {transfer.status}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        {transfer.transferDate \n                          ? format(new Date(transfer.transferDate), \"MMM d, yyyy\")\n                          : \"-\"}\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <div className=\"flex items-center justify-end gap-1\">\n                          <Button\n                            size=\"icon\"\n                            variant=\"ghost\"\n                            onClick={() => setSelectedTransfer(transfer)}\n                            data-testid={`button-view-transfer-${transfer.id}`}\n                          >\n                            <Eye className=\"h-4 w-4\" />\n                          </Button>\n                          {transfer.status === \"in_transit\" && (\n                            <Button\n                              size=\"icon\"\n                              variant=\"ghost\"\n                              onClick={() => completeTransferMutation.mutate(transfer.id)}\n                              data-testid={`button-receive-${transfer.id}`}\n                            >\n                              <FileCheck className=\"h-4 w-4\" />\n                            </Button>\n                          )}\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                  {filteredTransfers.length === 0 && !transfersLoading && (\n                    <TableRow>\n                      <TableCell colSpan={7} className=\"text-center py-8 text-muted-foreground\">\n                        No stock transfers found\n                      </TableCell>\n                    </TableRow>\n                  )}\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n\n      {/* New Transaction Dialog */}\n      <Dialog open={isTransactionDialogOpen} onOpenChange={setIsTransactionDialogOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>Create Inter-Company Transaction</DialogTitle>\n            <DialogDescription>\n              Record a financial transaction between two companies\n            </DialogDescription>\n          </DialogHeader>\n\n          <Form {...transactionForm}>\n            <form onSubmit={transactionForm.handleSubmit(handleSubmitTransaction)} className=\"space-y-4\">\n              <FormField\n                control={transactionForm.control}\n                name=\"transactionType\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Transaction Type</FormLabel>\n                    <Select onValueChange={field.onChange} defaultValue={field.value}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-transaction-type\">\n                          <SelectValue placeholder=\"Select type\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"sale\">Sale</SelectItem>\n                        <SelectItem value=\"purchase\">Purchase</SelectItem>\n                        <SelectItem value=\"service\">Service</SelectItem>\n                        <SelectItem value=\"dividend\">Dividend</SelectItem>\n                        <SelectItem value=\"loan\">Loan</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={transactionForm.control}\n                  name=\"sourceCompanyId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Source Company</FormLabel>\n                      <Select onValueChange={field.onChange} defaultValue={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-source-company\">\n                            <SelectValue placeholder=\"Select source\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {companies.map((company) => (\n                            <SelectItem key={company.id} value={company.id}>\n                              {company.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={transactionForm.control}\n                  name=\"targetCompanyId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Target Company</FormLabel>\n                      <Select onValueChange={field.onChange} defaultValue={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-target-company\">\n                            <SelectValue placeholder=\"Select target\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {companies\n                            .filter((c) => c.id !== transactionForm.watch(\"sourceCompanyId\"))\n                            .map((company) => (\n                              <SelectItem key={company.id} value={company.id}>\n                                {company.name}\n                              </SelectItem>\n                            ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={transactionForm.control}\n                  name=\"amount\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Amount</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"number\"\n                          step=\"0.01\"\n                          placeholder=\"0.00\"\n                          {...field}\n                          data-testid=\"input-amount\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={transactionForm.control}\n                  name=\"currency\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Currency</FormLabel>\n                      <Select onValueChange={field.onChange} defaultValue={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-currency\">\n                            <SelectValue placeholder=\"USD\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"USD\">USD</SelectItem>\n                          <SelectItem value=\"EUR\">EUR</SelectItem>\n                          <SelectItem value=\"GBP\">GBP</SelectItem>\n                          <SelectItem value=\"JPY\">JPY</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <FormField\n                control={transactionForm.control}\n                name=\"description\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Description</FormLabel>\n                    <FormControl>\n                      <Textarea\n                        placeholder=\"Transaction details...\"\n                        className=\"resize-none\"\n                        {...field}\n                        data-testid=\"input-description\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <DialogFooter>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setIsTransactionDialogOpen(false)}\n                  data-testid=\"button-cancel-transaction\"\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={createTransactionMutation.isPending}\n                  data-testid=\"button-submit-transaction\"\n                >\n                  Create Transaction\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Stock Transfer Dialog */}\n      <Dialog open={isTransferDialogOpen} onOpenChange={setIsTransferDialogOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>Create Inter-Company Stock Transfer</DialogTitle>\n            <DialogDescription>\n              Transfer inventory between company warehouses\n            </DialogDescription>\n          </DialogHeader>\n\n          <Form {...stockTransferForm}>\n            <form onSubmit={stockTransferForm.handleSubmit(handleSubmitTransfer)} className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={stockTransferForm.control}\n                  name=\"sourceCompanyId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Source Company</FormLabel>\n                      <Select onValueChange={field.onChange} defaultValue={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-transfer-source-company\">\n                            <SelectValue placeholder=\"Select source\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {companies.map((company) => (\n                            <SelectItem key={company.id} value={company.id}>\n                              {company.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={stockTransferForm.control}\n                  name=\"targetCompanyId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Target Company</FormLabel>\n                      <Select onValueChange={field.onChange} defaultValue={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-transfer-target-company\">\n                            <SelectValue placeholder=\"Select target\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {companies\n                            .filter((c) => c.id !== stockTransferForm.watch(\"sourceCompanyId\"))\n                            .map((company) => (\n                              <SelectItem key={company.id} value={company.id}>\n                                {company.name}\n                              </SelectItem>\n                            ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={stockTransferForm.control}\n                  name=\"sourceWarehouseId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Source Warehouse</FormLabel>\n                      <Select onValueChange={field.onChange} defaultValue={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-source-warehouse\">\n                            <SelectValue placeholder=\"Select warehouse\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {warehouses.map((warehouse) => (\n                            <SelectItem key={warehouse.id} value={warehouse.id}>\n                              {warehouse.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={stockTransferForm.control}\n                  name=\"targetWarehouseId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Target Warehouse</FormLabel>\n                      <Select onValueChange={field.onChange} defaultValue={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-target-warehouse\">\n                            <SelectValue placeholder=\"Select warehouse\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {warehouses.map((warehouse) => (\n                            <SelectItem key={warehouse.id} value={warehouse.id}>\n                              {warehouse.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <FormField\n                control={stockTransferForm.control}\n                name=\"productId\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Product</FormLabel>\n                    <Select onValueChange={field.onChange} defaultValue={field.value}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-product\">\n                          <SelectValue placeholder=\"Select product\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {products.map((product) => (\n                          <SelectItem key={product.id} value={product.id}>\n                            {product.name} ({product.sku})\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={stockTransferForm.control}\n                  name=\"quantity\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Quantity</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"number\"\n                          placeholder=\"0\"\n                          {...field}\n                          data-testid=\"input-quantity\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={stockTransferForm.control}\n                  name=\"unitCost\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Unit Cost</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"number\"\n                          step=\"0.01\"\n                          placeholder=\"0.00\"\n                          {...field}\n                          data-testid=\"input-unit-cost\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <FormField\n                control={stockTransferForm.control}\n                name=\"notes\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Notes</FormLabel>\n                    <FormControl>\n                      <Textarea\n                        placeholder=\"Transfer notes...\"\n                        className=\"resize-none\"\n                        {...field}\n                        data-testid=\"input-notes\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <DialogFooter>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setIsTransferDialogOpen(false)}\n                  data-testid=\"button-cancel-transfer\"\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={createTransferMutation.isPending}\n                  data-testid=\"button-submit-transfer\"\n                >\n                  Create Transfer\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Transaction Detail Dialog */}\n      <Dialog open={!!selectedTransaction} onOpenChange={() => setSelectedTransaction(null)}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Transaction Details</DialogTitle>\n          </DialogHeader>\n          {selectedTransaction && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Transaction Number</p>\n                  <p className=\"font-medium\">{selectedTransaction.transactionNumber}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Type</p>\n                  <Badge className={transactionTypeColors[selectedTransaction.transactionType]}>\n                    {selectedTransaction.transactionType}\n                  </Badge>\n                </div>\n              </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Source Company</p>\n                  <p className=\"font-medium\">{getCompanyName(selectedTransaction.sourceCompanyId)}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Target Company</p>\n                  <p className=\"font-medium\">{getCompanyName(selectedTransaction.targetCompanyId)}</p>\n                </div>\n              </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Amount</p>\n                  <p className=\"font-medium font-mono\">\n                    {selectedTransaction.currency} {parseFloat(selectedTransaction.amount).toLocaleString()}\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Status</p>\n                  <Badge className={statusColors[selectedTransaction.status]}>\n                    {selectedTransaction.status}\n                  </Badge>\n                </div>\n              </div>\n              {selectedTransaction.description && (\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Description</p>\n                  <p>{selectedTransaction.description}</p>\n                </div>\n              )}\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* Transfer Detail Dialog */}\n      <Dialog open={!!selectedTransfer} onOpenChange={() => setSelectedTransfer(null)}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Transfer Details</DialogTitle>\n          </DialogHeader>\n          {selectedTransfer && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Transfer Number</p>\n                  <p className=\"font-medium\">{selectedTransfer.transferNumber}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Status</p>\n                  <Badge className={statusColors[selectedTransfer.status]}>\n                    {selectedTransfer.status}\n                  </Badge>\n                </div>\n              </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">From</p>\n                  <p className=\"font-medium\">{getCompanyName(selectedTransfer.sourceCompanyId)}</p>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {getWarehouseName(selectedTransfer.sourceWarehouseId)}\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">To</p>\n                  <p className=\"font-medium\">{getCompanyName(selectedTransfer.targetCompanyId)}</p>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {getWarehouseName(selectedTransfer.targetWarehouseId)}\n                  </p>\n                </div>\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Total Value</p>\n                <p className=\"font-medium font-mono\">\n                  ${parseFloat(selectedTransfer.totalValue).toLocaleString()}\n                </p>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":43387,"size_tokens":null},"client/src/components/warehouse/MovementList.tsx":{"content":"import { useState } from \"react\";\nimport { DataTable, type Column } from \"@/components/layout/DataTable\";\nimport { StatusBadge } from \"@/components/layout/StatusBadge\";\nimport { PageHeader } from \"@/components/layout/PageHeader\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Plus, Download } from \"lucide-react\";\nimport { mockMovements, mockProducts, mockLocations } from \"@/lib/mockData\";\n\ntype Movement = typeof mockMovements[0];\n\nexport function MovementList() {\n  const [movements, setMovements] = useState(mockMovements);\n  const [isFormOpen, setIsFormOpen] = useState(false);\n\n  const [formData, setFormData] = useState({\n    type: \"IN\",\n    productId: \"\",\n    quantity: 1,\n    fromLocation: \"\",\n    toLocation: \"\",\n    reference: \"\",\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    // todo: remove mock functionality\n    const product = mockProducts.find(p => p.id === formData.productId);\n    const newMovement: Movement = {\n      id: `MOV-${String(movements.length + 1).padStart(3, \"0\")}`,\n      type: formData.type as \"IN\" | \"OUT\" | \"TRANSFER\",\n      productId: formData.productId,\n      productName: product?.name || \"\",\n      quantity: formData.quantity,\n      fromLocation: formData.type === \"IN\" ? null : formData.fromLocation,\n      toLocation: formData.type === \"OUT\" ? null : formData.toLocation,\n      date: new Date().toISOString().split(\"T\")[0],\n      reference: formData.reference || \"MANUAL\",\n    };\n    setMovements([newMovement, ...movements]);\n    console.log(\"Created movement:\", newMovement);\n    setIsFormOpen(false);\n    setFormData({\n      type: \"IN\",\n      productId: \"\",\n      quantity: 1,\n      fromLocation: \"\",\n      toLocation: \"\",\n      reference: \"\",\n    });\n  };\n\n  const columns: Column<Movement>[] = [\n    { key: \"id\", header: \"Movement ID\", sortable: true },\n    { \n      key: \"type\", \n      header: \"Type\",\n      render: (item) => <StatusBadge status={item.type} />\n    },\n    { key: \"productName\", header: \"Product\", sortable: true },\n    { key: \"quantity\", header: \"Qty\", sortable: true, className: \"text-right\" },\n    { \n      key: \"fromLocation\", \n      header: \"From\", \n      render: (item) => item.fromLocation || \"-\"\n    },\n    { \n      key: \"toLocation\", \n      header: \"To\", \n      render: (item) => item.toLocation || \"-\"\n    },\n    { key: \"date\", header: \"Date\", sortable: true },\n    { key: \"reference\", header: \"Reference\" },\n  ];\n\n  return (\n    <div>\n      <PageHeader\n        title=\"Stock Movements\"\n        description=\"Track all inventory movements\"\n        actions={\n          <>\n            <Button variant=\"outline\" data-testid=\"button-export\">\n              <Download className=\"h-4 w-4 mr-2\" />\n              Export\n            </Button>\n            <Button onClick={() => setIsFormOpen(true)} data-testid=\"button-new-movement\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Movement\n            </Button>\n          </>\n        }\n      />\n\n      <DataTable\n        data={movements}\n        columns={columns}\n        searchKey=\"productName\"\n        searchPlaceholder=\"Search movements...\"\n      />\n\n      <Dialog open={isFormOpen} onOpenChange={setIsFormOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>New Stock Movement</DialogTitle>\n          </DialogHeader>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"type\">Movement Type *</Label>\n              <Select\n                value={formData.type}\n                onValueChange={(value) => setFormData({ ...formData, type: value })}\n              >\n                <SelectTrigger data-testid=\"select-type\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"IN\">Stock In</SelectItem>\n                  <SelectItem value=\"OUT\">Stock Out</SelectItem>\n                  <SelectItem value=\"TRANSFER\">Transfer</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"product\">Product *</Label>\n              <Select\n                value={formData.productId}\n                onValueChange={(value) => setFormData({ ...formData, productId: value })}\n              >\n                <SelectTrigger data-testid=\"select-product\">\n                  <SelectValue placeholder=\"Select product\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {mockProducts.map((product) => (\n                    <SelectItem key={product.id} value={product.id}>\n                      {product.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"quantity\">Quantity *</Label>\n              <Input\n                id=\"quantity\"\n                type=\"number\"\n                min=\"1\"\n                value={formData.quantity}\n                onChange={(e) => setFormData({ ...formData, quantity: parseInt(e.target.value) || 1 })}\n                required\n                data-testid=\"input-quantity\"\n              />\n            </div>\n            {formData.type !== \"IN\" && (\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"fromLocation\">From Location *</Label>\n                <Select\n                  value={formData.fromLocation}\n                  onValueChange={(value) => setFormData({ ...formData, fromLocation: value })}\n                >\n                  <SelectTrigger data-testid=\"select-from\">\n                    <SelectValue placeholder=\"Select location\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {mockLocations.map((loc) => (\n                      <SelectItem key={loc.id} value={loc.code}>\n                        {loc.code} - {loc.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            )}\n            {formData.type !== \"OUT\" && (\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"toLocation\">To Location *</Label>\n                <Select\n                  value={formData.toLocation}\n                  onValueChange={(value) => setFormData({ ...formData, toLocation: value })}\n                >\n                  <SelectTrigger data-testid=\"select-to\">\n                    <SelectValue placeholder=\"Select location\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {mockLocations.map((loc) => (\n                      <SelectItem key={loc.id} value={loc.code}>\n                        {loc.code} - {loc.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            )}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"reference\">Reference</Label>\n              <Input\n                id=\"reference\"\n                value={formData.reference}\n                onChange={(e) => setFormData({ ...formData, reference: e.target.value })}\n                placeholder=\"e.g., PO-001\"\n                data-testid=\"input-reference\"\n              />\n            </div>\n            <div className=\"flex justify-end gap-2 pt-4\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => setIsFormOpen(false)} data-testid=\"button-cancel\">\n                Cancel\n              </Button>\n              <Button type=\"submit\" disabled={!formData.productId} data-testid=\"button-save\">\n                Create Movement\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":8191,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/components/examples/AttendanceList.tsx":{"content":"import { AttendanceList } from \"../hr/AttendanceList\";\n\nexport default function AttendanceListExample() {\n  return <AttendanceList />;\n}\n","path":null,"size_bytes":137,"size_tokens":null},"client/src/contexts/ThemeContext.tsx":{"content":"import { createContext, useContext, useState, useEffect, type ReactNode } from \"react\";\n\ntype Theme = \"light\" | \"dark\";\n\ninterface ThemeContextType {\n  theme: Theme;\n  toggleTheme: () => void;\n}\n\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\n\nexport function ThemeProvider({ children }: { children: ReactNode }) {\n  const [theme, setTheme] = useState<Theme>(() => {\n    if (typeof window !== \"undefined\") {\n      const stored = localStorage.getItem(\"theme\") as Theme;\n      if (stored) return stored;\n      return window.matchMedia(\"(prefers-color-scheme: dark)\").matches ? \"dark\" : \"light\";\n    }\n    return \"light\";\n  });\n\n  useEffect(() => {\n    const root = document.documentElement;\n    if (theme === \"dark\") {\n      root.classList.add(\"dark\");\n    } else {\n      root.classList.remove(\"dark\");\n    }\n    localStorage.setItem(\"theme\", theme);\n  }, [theme]);\n\n  const toggleTheme = () => {\n    setTheme((prev) => (prev === \"light\" ? \"dark\" : \"light\"));\n  };\n\n  return (\n    <ThemeContext.Provider value={{ theme, toggleTheme }}>\n      {children}\n    </ThemeContext.Provider>\n  );\n}\n\nexport function useTheme() {\n  const context = useContext(ThemeContext);\n  if (!context) {\n    throw new Error(\"useTheme must be used within a ThemeProvider\");\n  }\n  return context;\n}\n","path":null,"size_bytes":1302,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"pg\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1417,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"server/storage.ts":{"content":"import { \n  type User, type InsertUser,\n  type Company, type InsertCompany,\n  type CompanySettings, type InsertCompanySettings,\n  type FiscalPeriod, type InsertFiscalPeriod,\n  type Role, type InsertRole,\n  type UserCompanyRole, type InsertUserCompanyRole,\n  type Account, type InsertAccount,\n  type Warehouse, type InsertWarehouse,\n  type Product, type InsertProduct,\n  type Customer, type InsertCustomer,\n  type Vendor, type InsertVendor,\n  type Tax, type InsertTax,\n  type Employee, type InsertEmployee,\n  type SalesOrder, type InsertSalesOrder,\n  type SalesOrderLine,\n  type PurchaseOrder, type InsertPurchaseOrder,\n  type PurchaseOrderLine,\n  type IntercompanyTransfer, type InsertIntercompanyTransfer,\n  type JournalEntry, type InsertJournalEntry,\n  type SharedAccess, type InsertSharedAccess,\n  type RefreshToken, type InsertRefreshToken,\n  type AuthAuditLog, type InsertAuthAuditLog,\n  type CompanyContext, type CompanyHierarchyNode,\n  type StockLevel, type StockMovement,\n  type Delivery, type GoodsReceipt,\n  type Invoice, type Payment, type ArApLedger\n} from \"@shared/schema\";\nimport { randomUUID } from \"crypto\";\nimport bcrypt from \"bcryptjs\";\n\n// ============================================================================\n// STORAGE INTERFACE - MULTI-COMPANY SUPPORT\n// ============================================================================\n\nexport interface IStorage {\n  // Users\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  updateUser(id: string, updates: Partial<User>): Promise<User | undefined>;\n  \n  // Companies\n  getCompany(id: string): Promise<Company | undefined>;\n  getCompanyByCode(code: string): Promise<Company | undefined>;\n  getCompanies(): Promise<Company[]>;\n  getChildCompanies(parentId: string): Promise<Company[]>;\n  getCompanyHierarchy(rootId?: string): Promise<CompanyHierarchyNode[]>;\n  createCompany(company: InsertCompany): Promise<Company>;\n  updateCompany(id: string, updates: Partial<Company>): Promise<Company | undefined>;\n  \n  // Company Settings\n  getCompanySettings(companyId: string): Promise<CompanySettings | undefined>;\n  createCompanySettings(settings: InsertCompanySettings): Promise<CompanySettings>;\n  updateCompanySettings(companyId: string, updates: Partial<CompanySettings>): Promise<CompanySettings | undefined>;\n  \n  // Fiscal Periods\n  getFiscalPeriods(companyId: string): Promise<FiscalPeriod[]>;\n  getFiscalPeriod(id: string): Promise<FiscalPeriod | undefined>;\n  getCurrentFiscalPeriod(companyId: string): Promise<FiscalPeriod | undefined>;\n  createFiscalPeriod(period: InsertFiscalPeriod): Promise<FiscalPeriod>;\n  closeFiscalPeriod(id: string, closedBy: string): Promise<FiscalPeriod | undefined>;\n  \n  // Roles\n  getRole(id: string): Promise<Role | undefined>;\n  getRoleByCode(code: string): Promise<Role | undefined>;\n  getRoles(): Promise<Role[]>;\n  createRole(role: InsertRole): Promise<Role>;\n  \n  // User Company Roles\n  getUserCompanyRoles(userId: string): Promise<UserCompanyRole[]>;\n  getUserCompanies(userId: string): Promise<Company[]>;\n  getUserRole(userId: string, companyId: string): Promise<Role | undefined>;\n  assignUserToCompany(assignment: InsertUserCompanyRole): Promise<UserCompanyRole>;\n  removeUserFromCompany(userId: string, companyId: string): Promise<void>;\n  \n  // Company Context\n  getCompanyContext(userId: string, companyId: string): Promise<CompanyContext | undefined>;\n  \n  // Chart of Accounts (company-scoped)\n  getAccounts(companyId: string): Promise<Account[]>;\n  getAccount(id: string): Promise<Account | undefined>;\n  getAccountByCode(companyId: string, accountCode: string): Promise<Account | undefined>;\n  createAccount(account: InsertAccount): Promise<Account>;\n  updateAccount(id: string, updates: Partial<Account>): Promise<Account | undefined>;\n  deleteAccount(id: string): Promise<boolean>;\n  \n  // Warehouses (company-scoped)\n  getWarehouses(companyId: string): Promise<Warehouse[]>;\n  getWarehouse(id: string): Promise<Warehouse | undefined>;\n  createWarehouse(warehouse: InsertWarehouse): Promise<Warehouse>;\n  updateWarehouse(id: string, updates: Partial<Warehouse>): Promise<Warehouse | undefined>;\n  deleteWarehouse(id: string): Promise<boolean>;\n  \n  // Products (company-scoped)\n  getProducts(companyId: string): Promise<Product[]>;\n  getProduct(id: string): Promise<Product | undefined>;\n  getProductBySku(companyId: string, sku: string): Promise<Product | undefined>;\n  createProduct(product: InsertProduct): Promise<Product>;\n  updateProduct(id: string, updates: Partial<Product>): Promise<Product | undefined>;\n  deleteProduct(id: string): Promise<boolean>;\n  \n  // Customers (company-scoped)\n  getCustomers(companyId: string): Promise<Customer[]>;\n  getCustomer(id: string): Promise<Customer | undefined>;\n  createCustomer(customer: InsertCustomer): Promise<Customer>;\n  updateCustomer(id: string, updates: Partial<Customer>): Promise<Customer | undefined>;\n  deleteCustomer(id: string): Promise<boolean>;\n  \n  // Vendors (company-scoped)\n  getVendors(companyId: string): Promise<Vendor[]>;\n  getVendor(id: string): Promise<Vendor | undefined>;\n  createVendor(vendor: InsertVendor): Promise<Vendor>;\n  updateVendor(id: string, updates: Partial<Vendor>): Promise<Vendor | undefined>;\n  deleteVendor(id: string): Promise<boolean>;\n  \n  // Taxes (company-scoped)\n  getTaxes(companyId: string): Promise<Tax[]>;\n  getTax(id: string): Promise<Tax | undefined>;\n  createTax(tax: InsertTax): Promise<Tax>;\n  updateTax(id: string, updates: Partial<Tax>): Promise<Tax | undefined>;\n  deleteTax(id: string): Promise<boolean>;\n  \n  // Employees (company-scoped)\n  getEmployees(companyId: string): Promise<Employee[]>;\n  getEmployee(id: string): Promise<Employee | undefined>;\n  createEmployee(employee: InsertEmployee): Promise<Employee>;\n  updateEmployee(id: string, updates: Partial<Employee>): Promise<Employee | undefined>;\n  deleteEmployee(id: string): Promise<boolean>;\n  \n  // Journal Entries (company-scoped)\n  getJournalEntries(companyId: string): Promise<JournalEntry[]>;\n  getJournalEntry(id: string): Promise<JournalEntry | undefined>;\n  createJournalEntry(entry: InsertJournalEntry): Promise<JournalEntry>;\n  updateJournalEntry(id: string, updates: Partial<JournalEntry>): Promise<JournalEntry | undefined>;\n  deleteJournalEntry(id: string): Promise<boolean>;\n  \n  // Sales Orders (company-scoped)\n  getSalesOrders(companyId: string): Promise<SalesOrder[]>;\n  getSalesOrder(id: string): Promise<SalesOrder | undefined>;\n  createSalesOrder(order: InsertSalesOrder): Promise<SalesOrder>;\n  updateSalesOrder(id: string, updates: Partial<SalesOrder>): Promise<SalesOrder | undefined>;\n  deleteSalesOrder(id: string): Promise<boolean>;\n  getSalesOrderLines(salesOrderId: string): Promise<SalesOrderLine[]>;\n  \n  // Purchase Orders (company-scoped)\n  getPurchaseOrders(companyId: string): Promise<PurchaseOrder[]>;\n  getPurchaseOrder(id: string): Promise<PurchaseOrder | undefined>;\n  createPurchaseOrder(order: InsertPurchaseOrder): Promise<PurchaseOrder>;\n  updatePurchaseOrder(id: string, updates: Partial<PurchaseOrder>): Promise<PurchaseOrder | undefined>;\n  deletePurchaseOrder(id: string): Promise<boolean>;\n  getPurchaseOrderLines(purchaseOrderId: string): Promise<PurchaseOrderLine[]>;\n  \n  // Intercompany Transfers\n  getIntercompanyTransfers(companyId: string): Promise<IntercompanyTransfer[]>;\n  getIntercompanyTransfer(id: string): Promise<IntercompanyTransfer | undefined>;\n  createIntercompanyTransfer(transfer: InsertIntercompanyTransfer): Promise<IntercompanyTransfer>;\n  updateIntercompanyTransfer(id: string, updates: Partial<IntercompanyTransfer>): Promise<IntercompanyTransfer | undefined>;\n  \n  // Shared Access\n  getSharedAccess(granteeCompanyId: string, entityType: string): Promise<SharedAccess[]>;\n  grantSharedAccess(access: InsertSharedAccess): Promise<SharedAccess>;\n  revokeSharedAccess(id: string): Promise<void>;\n  \n  // Refresh Tokens (for JWT auth)\n  createRefreshToken(token: InsertRefreshToken): Promise<RefreshToken>;\n  getRefreshTokenByHash(tokenHash: string): Promise<RefreshToken | undefined>;\n  revokeRefreshToken(id: string, reason: string): Promise<void>;\n  revokeAllUserRefreshTokens(userId: string, reason: string): Promise<void>;\n  \n  // Auth Audit Log\n  createAuthAuditLog(log: InsertAuthAuditLog): Promise<AuthAuditLog>;\n  getAuthAuditLogs(userId: string, limit?: number): Promise<AuthAuditLog[]>;\n  \n  // Additional methods for auth\n  getAllCompanies(): Promise<Company[]>;\n  getUserCompanyRole(userId: string, companyId: string): Promise<UserCompanyRole | undefined>;\n  \n  // System initialization\n  isSystemInitialized(): Promise<boolean>;\n  getSystemStats(): Promise<{ companyCount: number; userCount: number }>;\n  \n  // Stock Levels\n  getStockLevels(companyId: string): Promise<StockLevel[]>;\n  getStockLevel(companyId: string, productId: string, warehouseId: string): Promise<StockLevel | undefined>;\n  \n  // Stock Movements\n  getStockMovements(companyId: string): Promise<StockMovement[]>;\n  \n  // Deliveries\n  getDeliveries(companyId: string): Promise<Delivery[]>;\n  getDelivery(id: string): Promise<Delivery | undefined>;\n  \n  // Goods Receipts\n  getGoodsReceipts(companyId: string): Promise<GoodsReceipt[]>;\n  getGoodsReceipt(id: string): Promise<GoodsReceipt | undefined>;\n  \n  // Invoices\n  getInvoices(companyId: string): Promise<Invoice[]>;\n  getInvoice(id: string): Promise<Invoice | undefined>;\n  \n  // Payments\n  getPayments(companyId: string): Promise<Payment[]>;\n  getPayment(id: string): Promise<Payment | undefined>;\n  \n  // AR/AP Ledger\n  getArApLedger(companyId: string, ledgerType: string): Promise<ArApLedger[]>;\n}\n\n// ============================================================================\n// IN-MEMORY STORAGE IMPLEMENTATION\n// ============================================================================\n\nexport class MemStorage implements IStorage {\n  private users: Map<string, User>;\n  private companies: Map<string, Company>;\n  private companySettings: Map<string, CompanySettings>;\n  private fiscalPeriods: Map<string, FiscalPeriod>;\n  private roles: Map<string, Role>;\n  private userCompanyRoles: Map<string, UserCompanyRole>;\n  private accounts: Map<string, Account>;\n  private warehouses: Map<string, Warehouse>;\n  private products: Map<string, Product>;\n  private customers: Map<string, Customer>;\n  private vendors: Map<string, Vendor>;\n  private taxes: Map<string, Tax>;\n  private employees: Map<string, Employee>;\n  private journalEntries: Map<string, JournalEntry>;\n  private salesOrders: Map<string, SalesOrder>;\n  private purchaseOrders: Map<string, PurchaseOrder>;\n  private intercompanyTransfers: Map<string, IntercompanyTransfer>;\n  private sharedAccess: Map<string, SharedAccess>;\n  private refreshTokens: Map<string, RefreshToken>;\n  private authAuditLogs: Map<string, AuthAuditLog>;\n\n  constructor() {\n    this.users = new Map();\n    this.companies = new Map();\n    this.companySettings = new Map();\n    this.fiscalPeriods = new Map();\n    this.roles = new Map();\n    this.userCompanyRoles = new Map();\n    this.accounts = new Map();\n    this.warehouses = new Map();\n    this.products = new Map();\n    this.customers = new Map();\n    this.vendors = new Map();\n    this.taxes = new Map();\n    this.employees = new Map();\n    this.journalEntries = new Map();\n    this.salesOrders = new Map();\n    this.purchaseOrders = new Map();\n    this.intercompanyTransfers = new Map();\n    this.sharedAccess = new Map();\n    this.refreshTokens = new Map();\n    this.authAuditLogs = new Map();\n    \n    // Initialize with default data\n    this.initializeDefaultData();\n  }\n\n  private initializeDefaultData() {\n    // Create ONLY system roles - no dummy data\n    // All companies, users, and master data must be created by users through the first-time setup flow\n    const adminRole: Role = {\n      id: \"role-admin\",\n      code: \"ADMIN\",\n      name: \"Administrator\",\n      description: \"Full system access\",\n      isSystemRole: true,\n      permissions: [\"*\"],\n      createdAt: new Date(),\n    };\n    \n    const managerRole: Role = {\n      id: \"role-manager\",\n      code: \"MANAGER\",\n      name: \"Manager\",\n      description: \"Department manager access\",\n      isSystemRole: true,\n      permissions: [\"read:*\", \"write:*\", \"delete:own\"],\n      createdAt: new Date(),\n    };\n    \n    const userRole: Role = {\n      id: \"role-user\",\n      code: \"USER\",\n      name: \"User\",\n      description: \"Standard user access\",\n      isSystemRole: true,\n      permissions: [\"read:*\", \"write:own\"],\n      createdAt: new Date(),\n    };\n    \n    this.roles.set(adminRole.id, adminRole);\n    this.roles.set(managerRole.id, managerRole);\n    this.roles.set(userRole.id, userRole);\n    \n    // No dummy companies, users, accounts, or warehouses are created\n    // Users must complete the first-time setup flow to create their company and admin account\n    // All master data (customers, products, vendors, warehouses, COA) must be created organically\n  }\n\n  // ===================== USERS =====================\n  async getUser(id: string): Promise<User | undefined> {\n    return this.users.get(id);\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    return Array.from(this.users.values()).find(\n      (user) => user.username === username,\n    );\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const id = randomUUID();\n    const hashedPassword = bcrypt.hashSync(insertUser.password, 10);\n    const user: User = { \n      id,\n      username: insertUser.username,\n      password: hashedPassword,\n      email: insertUser.email ?? null,\n      fullName: insertUser.fullName ?? null,\n      avatarUrl: null,\n      defaultCompanyId: null,\n      isActive: true,\n      lastLoginAt: null,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    };\n    this.users.set(id, user);\n    return user;\n  }\n\n  async updateUser(id: string, updates: Partial<User>): Promise<User | undefined> {\n    const user = this.users.get(id);\n    if (!user) return undefined;\n    const updated = { ...user, ...updates, updatedAt: new Date() };\n    this.users.set(id, updated);\n    return updated;\n  }\n\n  // ===================== COMPANIES =====================\n  async getCompany(id: string): Promise<Company | undefined> {\n    return this.companies.get(id);\n  }\n\n  async getCompanyByCode(code: string): Promise<Company | undefined> {\n    return Array.from(this.companies.values()).find(c => c.code === code);\n  }\n\n  async getCompanies(): Promise<Company[]> {\n    return Array.from(this.companies.values()).filter(c => c.isActive);\n  }\n\n  async getChildCompanies(parentId: string): Promise<Company[]> {\n    return Array.from(this.companies.values()).filter(\n      c => c.parentId === parentId && c.isActive\n    );\n  }\n\n  async getCompanyHierarchy(rootId?: string): Promise<CompanyHierarchyNode[]> {\n    const buildTree = (parentId: string | null, level: number): CompanyHierarchyNode[] => {\n      const children = Array.from(this.companies.values())\n        .filter(c => c.parentId === parentId && c.isActive)\n        .map(company => ({\n          company,\n          children: buildTree(company.id, level + 1),\n          level,\n        }));\n      return children;\n    };\n\n    if (rootId) {\n      const root = this.companies.get(rootId);\n      if (!root) return [];\n      return [{\n        company: root,\n        children: buildTree(rootId, 2),\n        level: 1,\n      }];\n    }\n\n    // Return all root companies (no parent)\n    return Array.from(this.companies.values())\n      .filter(c => !c.parentId && c.isActive)\n      .map(company => ({\n        company,\n        children: buildTree(company.id, 2),\n        level: 1,\n      }));\n  }\n\n  // Validate 3-level hierarchy rules:\n  // - Holding (level 1): No parent, companyType must be 'holding'\n  // - Subsidiary (level 2): Parent must be Holding, companyType must be 'subsidiary'\n  // - Branch (level 3): Parent must be Subsidiary, companyType must be 'branch'\n  private async validateCompanyHierarchy(\n    companyType: string,\n    parentId: string | null,\n    excludeCompanyId?: string\n  ): Promise<{ valid: boolean; error?: string; level: number; path: string }> {\n    const validTypes = [\"holding\", \"subsidiary\", \"branch\"];\n    if (!validTypes.includes(companyType)) {\n      return { \n        valid: false, \n        error: `Invalid company type: ${companyType}. Must be holding, subsidiary, or branch.`,\n        level: 0,\n        path: \"\"\n      };\n    }\n\n    // Holding must have no parent\n    if (companyType === \"holding\") {\n      if (parentId) {\n        return { \n          valid: false, \n          error: \"Holding companies cannot have a parent.\",\n          level: 0,\n          path: \"\"\n        };\n      }\n      return { valid: true, level: 1, path: \"\" }; // Path will be set to company code\n    }\n\n    // Subsidiary and Branch must have a parent\n    if (!parentId) {\n      return { \n        valid: false, \n        error: `${companyType} companies must have a parent.`,\n        level: 0,\n        path: \"\"\n      };\n    }\n\n    const parent = await this.getCompany(parentId);\n    if (!parent) {\n      return { \n        valid: false, \n        error: \"Parent company not found.\",\n        level: 0,\n        path: \"\"\n      };\n    }\n\n    // Subsidiary must have Holding parent\n    if (companyType === \"subsidiary\") {\n      if (parent.companyType !== \"holding\") {\n        return { \n          valid: false, \n          error: \"Subsidiaries must belong to a Holding company.\",\n          level: 0,\n          path: \"\"\n        };\n      }\n      return { valid: true, level: 2, path: parent.path };\n    }\n\n    // Branch must have Subsidiary parent\n    if (companyType === \"branch\") {\n      if (parent.companyType !== \"subsidiary\") {\n        return { \n          valid: false, \n          error: \"Branches must belong to a Subsidiary company.\",\n          level: 0,\n          path: \"\"\n        };\n      }\n      return { valid: true, level: 3, path: parent.path };\n    }\n\n    return { valid: false, error: \"Unknown validation error.\", level: 0, path: \"\" };\n  }\n\n  async createCompany(insertCompany: InsertCompany): Promise<Company> {\n    // Validate 3-level hierarchy\n    const companyType = insertCompany.companyType ?? \"subsidiary\";\n    const validation = await this.validateCompanyHierarchy(\n      companyType,\n      insertCompany.parentId ?? null\n    );\n\n    if (!validation.valid) {\n      throw new Error(validation.error);\n    }\n\n    const id = randomUUID();\n    \n    // Auto-calculate path and level based on hierarchy\n    const path = validation.level === 1 \n      ? insertCompany.code \n      : `${validation.path}/${insertCompany.code}`;\n\n    const company: Company = {\n      id,\n      code: insertCompany.code,\n      name: insertCompany.name,\n      legalName: insertCompany.legalName ?? null,\n      taxId: insertCompany.taxId ?? null,\n      parentId: insertCompany.parentId ?? null,\n      path: path, // Always use calculated path based on hierarchy\n      level: validation.level, // Always use calculated level\n      companyType: companyType,\n      currency: insertCompany.currency ?? \"IDR\",\n      locale: insertCompany.locale ?? \"id-ID\",\n      timezone: insertCompany.timezone ?? \"Asia/Jakarta\",\n      address: insertCompany.address ?? null,\n      city: insertCompany.city ?? null,\n      state: insertCompany.state ?? null,\n      country: insertCompany.country ?? null,\n      postalCode: insertCompany.postalCode ?? null,\n      phone: insertCompany.phone ?? null,\n      email: insertCompany.email ?? null,\n      website: insertCompany.website ?? null,\n      logoUrl: insertCompany.logoUrl ?? null,\n      consolidationEnabled: insertCompany.consolidationEnabled ?? false,\n      isActive: insertCompany.isActive ?? true,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    };\n    this.companies.set(id, company);\n    return company;\n  }\n\n  async updateCompany(id: string, updates: Partial<Company>): Promise<Company | undefined> {\n    const company = this.companies.get(id);\n    if (!company) return undefined;\n    \n    // SECURITY: Always ignore client-supplied path and level - they must be calculated\n    // This prevents path/level tampering even when parent/type aren't changed\n    delete updates.path;\n    delete updates.level;\n\n    // Determine the effective type and parent (use updates if provided, else existing)\n    const effectiveType = updates.companyType || company.companyType;\n    const effectiveParentId = updates.parentId !== undefined ? updates.parentId : company.parentId;\n    const effectiveCode = updates.code || company.code;\n    \n    // Always validate and recalculate hierarchy for any update (in case code changed, which affects path)\n    const validation = await this.validateCompanyHierarchy(\n      effectiveType,\n      effectiveParentId,\n      id // Exclude self when validating\n    );\n\n    if (!validation.valid) {\n      throw new Error(validation.error);\n    }\n\n    // Always calculate path and level from hierarchy, not from client input\n    const calculatedPath = validation.level === 1 \n      ? effectiveCode \n      : `${validation.path}/${effectiveCode}`;\n\n    const updated = { \n      ...company, \n      ...updates, \n      path: calculatedPath,\n      level: validation.level,\n      updatedAt: new Date() \n    };\n    this.companies.set(id, updated);\n    return updated;\n  }\n\n  // ===================== COMPANY SETTINGS =====================\n  async getCompanySettings(companyId: string): Promise<CompanySettings | undefined> {\n    return Array.from(this.companySettings.values()).find(s => s.companyId === companyId);\n  }\n\n  async createCompanySettings(settings: InsertCompanySettings): Promise<CompanySettings> {\n    const id = randomUUID();\n    const newSettings: CompanySettings = {\n      id,\n      companyId: settings.companyId,\n      fiscalYearStart: settings.fiscalYearStart ?? 1,\n      fiscalYearEnd: settings.fiscalYearEnd ?? 12,\n      taxRegime: settings.taxRegime ?? null,\n      defaultPaymentTerms: settings.defaultPaymentTerms ?? 30,\n      inventoryCostingMethod: settings.inventoryCostingMethod ?? \"fifo\",\n      defaultWarehouseId: settings.defaultWarehouseId ?? null,\n      multiCurrencyEnabled: settings.multiCurrencyEnabled ?? false,\n      intercompanyEnabled: settings.intercompanyEnabled ?? true,\n      autoPostIntercompany: settings.autoPostIntercompany ?? false,\n      consolidationRules: settings.consolidationRules ?? null,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    };\n    this.companySettings.set(id, newSettings);\n    return newSettings;\n  }\n\n  async updateCompanySettings(companyId: string, updates: Partial<CompanySettings>): Promise<CompanySettings | undefined> {\n    const settings = await this.getCompanySettings(companyId);\n    if (!settings) return undefined;\n    const updated = { ...settings, ...updates, updatedAt: new Date() };\n    this.companySettings.set(settings.id, updated);\n    return updated;\n  }\n\n  // ===================== FISCAL PERIODS =====================\n  async getFiscalPeriods(companyId: string): Promise<FiscalPeriod[]> {\n    return Array.from(this.fiscalPeriods.values()).filter(p => p.companyId === companyId);\n  }\n\n  async getFiscalPeriod(id: string): Promise<FiscalPeriod | undefined> {\n    return this.fiscalPeriods.get(id);\n  }\n\n  async getCurrentFiscalPeriod(companyId: string): Promise<FiscalPeriod | undefined> {\n    const now = new Date();\n    return Array.from(this.fiscalPeriods.values()).find(\n      p => p.companyId === companyId && \n           p.startDate <= now && \n           p.endDate >= now && \n           p.status === \"open\"\n    );\n  }\n\n  async createFiscalPeriod(period: InsertFiscalPeriod): Promise<FiscalPeriod> {\n    const id = randomUUID();\n    const newPeriod: FiscalPeriod = {\n      id,\n      companyId: period.companyId,\n      periodCode: period.periodCode,\n      periodName: period.periodName,\n      periodType: period.periodType ?? \"month\",\n      startDate: period.startDate,\n      endDate: period.endDate,\n      status: period.status ?? \"open\",\n      isClosed: period.isClosed ?? false,\n      closedAt: period.closedAt ?? null,\n      closedBy: period.closedBy ?? null,\n      createdAt: new Date(),\n    };\n    this.fiscalPeriods.set(id, newPeriod);\n    return newPeriod;\n  }\n\n  async closeFiscalPeriod(id: string, closedBy: string): Promise<FiscalPeriod | undefined> {\n    const period = this.fiscalPeriods.get(id);\n    if (!period) return undefined;\n    const updated = { \n      ...period, \n      status: \"closed\" as const, \n      isClosed: true, \n      closedAt: new Date(), \n      closedBy \n    };\n    this.fiscalPeriods.set(id, updated);\n    return updated;\n  }\n\n  // ===================== ROLES =====================\n  async getRole(id: string): Promise<Role | undefined> {\n    return this.roles.get(id);\n  }\n\n  async getRoleByCode(code: string): Promise<Role | undefined> {\n    return Array.from(this.roles.values()).find(r => r.code === code);\n  }\n\n  async getRoles(): Promise<Role[]> {\n    return Array.from(this.roles.values());\n  }\n\n  async createRole(role: InsertRole): Promise<Role> {\n    const id = randomUUID();\n    const newRole: Role = {\n      id,\n      code: role.code,\n      name: role.name,\n      description: role.description ?? null,\n      isSystemRole: role.isSystemRole ?? false,\n      permissions: role.permissions ?? [],\n      createdAt: new Date(),\n    };\n    this.roles.set(id, newRole);\n    return newRole;\n  }\n\n  // ===================== USER COMPANY ROLES =====================\n  async getUserCompanyRoles(userId: string): Promise<UserCompanyRole[]> {\n    return Array.from(this.userCompanyRoles.values()).filter(\n      ucr => ucr.userId === userId && ucr.isActive\n    );\n  }\n\n  async getUserCompanies(userId: string): Promise<Company[]> {\n    const roles = await this.getUserCompanyRoles(userId);\n    const companyIds = roles.map(r => r.companyId);\n    return Array.from(this.companies.values()).filter(\n      c => companyIds.includes(c.id) && c.isActive\n    );\n  }\n\n  async getUserRole(userId: string, companyId: string): Promise<Role | undefined> {\n    const assignment = Array.from(this.userCompanyRoles.values()).find(\n      ucr => ucr.userId === userId && ucr.companyId === companyId && ucr.isActive\n    );\n    if (!assignment) return undefined;\n    return this.roles.get(assignment.roleId);\n  }\n\n  async assignUserToCompany(assignment: InsertUserCompanyRole): Promise<UserCompanyRole> {\n    const id = randomUUID();\n    const newAssignment: UserCompanyRole = {\n      id,\n      userId: assignment.userId,\n      companyId: assignment.companyId,\n      roleId: assignment.roleId,\n      isDefault: assignment.isDefault ?? false,\n      grantedAt: new Date(),\n      grantedBy: assignment.grantedBy ?? null,\n      expiresAt: assignment.expiresAt ?? null,\n      isActive: assignment.isActive ?? true,\n    };\n    this.userCompanyRoles.set(id, newAssignment);\n    return newAssignment;\n  }\n\n  async removeUserFromCompany(userId: string, companyId: string): Promise<void> {\n    const entries = Array.from(this.userCompanyRoles.entries());\n    for (const [id, ucr] of entries) {\n      if (ucr.userId === userId && ucr.companyId === companyId) {\n        this.userCompanyRoles.delete(id);\n      }\n    }\n  }\n\n  // ===================== COMPANY CONTEXT =====================\n  \n  // Get accessible company IDs based on hierarchy level\n  // - Holding: Can see all subsidiaries and their branches\n  // - Subsidiary: Can see itself and all its branches\n  // - Branch: Can only see itself\n  private getAccessibleCompanyIds(company: Company, allCompanies: Company[]): string[] {\n    const accessibleIds: string[] = [company.id];\n    \n    if (company.level === 1) { // Holding - can see all descendants\n      const descendants = allCompanies.filter(c => \n        c.path.startsWith(company.path + \"/\") && c.id !== company.id\n      );\n      accessibleIds.push(...descendants.map(c => c.id));\n    } else if (company.level === 2) { // Subsidiary - can see its branches\n      const branches = allCompanies.filter(c => \n        c.parentId === company.id && c.level === 3\n      );\n      accessibleIds.push(...branches.map(c => c.id));\n    }\n    // Branch (level 3) can only see itself - already added\n    \n    return accessibleIds;\n  }\n\n  async getCompanyContext(userId: string, companyId: string): Promise<CompanyContext | undefined> {\n    const user = await this.getUser(userId);\n    if (!user) return undefined;\n\n    const company = await this.getCompany(companyId);\n    if (!company) return undefined;\n\n    const userCompanies = await this.getUserCompanies(userId);\n    if (!userCompanies.find(c => c.id === companyId)) return undefined;\n\n    const role = await this.getUserRole(userId, companyId);\n    const permissions = role ? (role.permissions as string[]) : [];\n\n    // Get all companies for hierarchy calculations\n    const allCompanies = await this.getCompanies();\n    \n    // Get parent company\n    const parentCompany = company.parentId \n      ? allCompanies.find(c => c.id === company.parentId) || null \n      : null;\n    \n    // Get direct child companies\n    const childCompanies = allCompanies.filter(c => c.parentId === company.id);\n    \n    // Calculate accessible company IDs based on hierarchy\n    const accessibleCompanyIds = this.getAccessibleCompanyIds(company, allCompanies);\n    \n    // Determine company level (1=Holding, 2=Subsidiary, 3=Branch)\n    const companyLevel = company.level as 1 | 2 | 3;\n    \n    // Only Holding and Subsidiary can consolidate\n    const canConsolidate = company.level <= 2;\n\n    return {\n      activeCompanyId: companyId,\n      activeCompany: company,\n      userCompanies,\n      permissions,\n      role: role || null,\n      companyLevel,\n      accessibleCompanyIds,\n      canConsolidate,\n      parentCompany,\n      childCompanies,\n    };\n  }\n\n  // ===================== CHART OF ACCOUNTS =====================\n  async getAccounts(companyId: string): Promise<Account[]> {\n    return Array.from(this.accounts.values()).filter(a => a.companyId === companyId);\n  }\n\n  async getAccount(id: string): Promise<Account | undefined> {\n    return this.accounts.get(id);\n  }\n\n  async getAccountByCode(companyId: string, accountCode: string): Promise<Account | undefined> {\n    return Array.from(this.accounts.values()).find(\n      a => a.companyId === companyId && a.accountCode === accountCode\n    );\n  }\n\n  async createAccount(account: InsertAccount): Promise<Account> {\n    const id = randomUUID();\n    const newAccount: Account = {\n      id,\n      companyId: account.companyId,\n      accountCode: account.accountCode,\n      name: account.name,\n      accountType: account.accountType,\n      level: account.level ?? 1,\n      parentId: account.parentId ?? null,\n      balance: account.balance ?? \"0\",\n      isPostable: account.isPostable ?? true,\n      isActive: account.isActive ?? true,\n      consolidationAccountId: account.consolidationAccountId ?? null,\n      createdAt: new Date(),\n    };\n    this.accounts.set(id, newAccount);\n    return newAccount;\n  }\n\n  async updateAccount(id: string, updates: Partial<Account>): Promise<Account | undefined> {\n    const account = this.accounts.get(id);\n    if (!account) return undefined;\n    const updated = { ...account, ...updates };\n    this.accounts.set(id, updated);\n    return updated;\n  }\n\n  async deleteAccount(id: string): Promise<boolean> {\n    const account = this.accounts.get(id);\n    if (!account) return false;\n    \n    // Check if account has children\n    const hasChildren = Array.from(this.accounts.values()).some(a => a.parentId === id);\n    if (hasChildren) return false;\n    \n    this.accounts.delete(id);\n    return true;\n  }\n\n  // ===================== WAREHOUSES =====================\n  async getWarehouses(companyId: string): Promise<Warehouse[]> {\n    return Array.from(this.warehouses.values()).filter(w => w.companyId === companyId);\n  }\n\n  async getWarehouse(id: string): Promise<Warehouse | undefined> {\n    return this.warehouses.get(id);\n  }\n\n  async createWarehouse(warehouse: InsertWarehouse): Promise<Warehouse> {\n    const id = randomUUID();\n    const newWarehouse: Warehouse = {\n      id,\n      companyId: warehouse.companyId,\n      code: warehouse.code,\n      name: warehouse.name,\n      warehouseType: warehouse.warehouseType ?? \"standard\",\n      address: warehouse.address ?? null,\n      city: warehouse.city ?? null,\n      state: warehouse.state ?? null,\n      country: warehouse.country ?? null,\n      managerId: warehouse.managerId ?? null,\n      isActive: warehouse.isActive ?? true,\n      allowNegativeStock: warehouse.allowNegativeStock ?? false,\n      createdAt: new Date(),\n    };\n    this.warehouses.set(id, newWarehouse);\n    return newWarehouse;\n  }\n\n  async updateWarehouse(id: string, updates: Partial<Warehouse>): Promise<Warehouse | undefined> {\n    const warehouse = this.warehouses.get(id);\n    if (!warehouse) return undefined;\n    const updated = { ...warehouse, ...updates };\n    this.warehouses.set(id, updated);\n    return updated;\n  }\n\n  async deleteWarehouse(id: string): Promise<boolean> {\n    const warehouse = this.warehouses.get(id);\n    if (!warehouse) return false;\n    this.warehouses.delete(id);\n    return true;\n  }\n\n  // ===================== PRODUCTS =====================\n  async getProducts(companyId: string): Promise<Product[]> {\n    return Array.from(this.products.values()).filter(p => p.companyId === companyId);\n  }\n\n  async getProduct(id: string): Promise<Product | undefined> {\n    return this.products.get(id);\n  }\n\n  async getProductBySku(companyId: string, sku: string): Promise<Product | undefined> {\n    return Array.from(this.products.values()).find(\n      p => p.companyId === companyId && p.sku === sku\n    );\n  }\n\n  async createProduct(product: InsertProduct): Promise<Product> {\n    const id = randomUUID();\n    const newProduct: Product = {\n      id,\n      companyId: product.companyId,\n      sku: product.sku,\n      name: product.name,\n      description: product.description ?? null,\n      category: product.category ?? null,\n      uom: product.uom ?? \"EA\",\n      price: product.price ?? \"0\",\n      cost: product.cost ?? \"0\",\n      minStockLevel: product.minStockLevel ?? 0,\n      maxStockLevel: product.maxStockLevel ?? null,\n      reorderPoint: product.reorderPoint ?? null,\n      isActive: product.isActive ?? true,\n      isSellable: product.isSellable ?? true,\n      isPurchasable: product.isPurchasable ?? true,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    };\n    this.products.set(id, newProduct);\n    return newProduct;\n  }\n\n  async updateProduct(id: string, updates: Partial<Product>): Promise<Product | undefined> {\n    const product = this.products.get(id);\n    if (!product) return undefined;\n    const updated = { ...product, ...updates, updatedAt: new Date() };\n    this.products.set(id, updated);\n    return updated;\n  }\n\n  async deleteProduct(id: string): Promise<boolean> {\n    const product = this.products.get(id);\n    if (!product) return false;\n    this.products.delete(id);\n    return true;\n  }\n\n  // ===================== CUSTOMERS =====================\n  async getCustomers(companyId: string): Promise<Customer[]> {\n    return Array.from(this.customers.values()).filter(c => c.companyId === companyId);\n  }\n\n  async getCustomer(id: string): Promise<Customer | undefined> {\n    return this.customers.get(id);\n  }\n\n  async createCustomer(customer: InsertCustomer): Promise<Customer> {\n    const id = randomUUID();\n    const newCustomer: Customer = {\n      id,\n      companyId: customer.companyId,\n      code: customer.code,\n      name: customer.name,\n      legalName: customer.legalName ?? null,\n      taxId: customer.taxId ?? null,\n      email: customer.email ?? null,\n      phone: customer.phone ?? null,\n      address: customer.address ?? null,\n      city: customer.city ?? null,\n      state: customer.state ?? null,\n      country: customer.country ?? null,\n      postalCode: customer.postalCode ?? null,\n      paymentTerms: customer.paymentTerms ?? 30,\n      creditLimit: customer.creditLimit ?? null,\n      currentBalance: customer.currentBalance ?? \"0\",\n      customerType: customer.customerType ?? \"regular\",\n      isActive: customer.isActive ?? true,\n      isIntercompany: customer.isIntercompany ?? false,\n      linkedCompanyId: customer.linkedCompanyId ?? null,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    };\n    this.customers.set(id, newCustomer);\n    return newCustomer;\n  }\n\n  async updateCustomer(id: string, updates: Partial<Customer>): Promise<Customer | undefined> {\n    const customer = this.customers.get(id);\n    if (!customer) return undefined;\n    const updated = { ...customer, ...updates, updatedAt: new Date() };\n    this.customers.set(id, updated);\n    return updated;\n  }\n\n  async deleteCustomer(id: string): Promise<boolean> {\n    const customer = this.customers.get(id);\n    if (!customer) return false;\n    this.customers.delete(id);\n    return true;\n  }\n\n  // ===================== VENDORS =====================\n  async getVendors(companyId: string): Promise<Vendor[]> {\n    return Array.from(this.vendors.values()).filter(v => v.companyId === companyId);\n  }\n\n  async getVendor(id: string): Promise<Vendor | undefined> {\n    return this.vendors.get(id);\n  }\n\n  async createVendor(vendor: InsertVendor): Promise<Vendor> {\n    const id = randomUUID();\n    const newVendor: Vendor = {\n      id,\n      companyId: vendor.companyId,\n      code: vendor.code,\n      name: vendor.name,\n      legalName: vendor.legalName ?? null,\n      taxId: vendor.taxId ?? null,\n      email: vendor.email ?? null,\n      phone: vendor.phone ?? null,\n      address: vendor.address ?? null,\n      city: vendor.city ?? null,\n      state: vendor.state ?? null,\n      country: vendor.country ?? null,\n      postalCode: vendor.postalCode ?? null,\n      paymentTerms: vendor.paymentTerms ?? 30,\n      vendorType: vendor.vendorType ?? \"regular\",\n      isActive: vendor.isActive ?? true,\n      isIntercompany: vendor.isIntercompany ?? false,\n      linkedCompanyId: vendor.linkedCompanyId ?? null,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    };\n    this.vendors.set(id, newVendor);\n    return newVendor;\n  }\n\n  async updateVendor(id: string, updates: Partial<Vendor>): Promise<Vendor | undefined> {\n    const vendor = this.vendors.get(id);\n    if (!vendor) return undefined;\n    const updated = { ...vendor, ...updates, updatedAt: new Date() };\n    this.vendors.set(id, updated);\n    return updated;\n  }\n\n  async deleteVendor(id: string): Promise<boolean> {\n    const vendor = this.vendors.get(id);\n    if (!vendor) return false;\n    this.vendors.delete(id);\n    return true;\n  }\n\n  // ===================== TAXES =====================\n  async getTaxes(companyId: string): Promise<Tax[]> {\n    return Array.from(this.taxes.values()).filter(t => t.companyId === companyId);\n  }\n\n  async getTax(id: string): Promise<Tax | undefined> {\n    return this.taxes.get(id);\n  }\n\n  async createTax(tax: InsertTax): Promise<Tax> {\n    const id = randomUUID();\n    const newTax: Tax = {\n      id,\n      companyId: tax.companyId,\n      code: tax.code,\n      name: tax.name,\n      rate: tax.rate,\n      taxType: tax.taxType ?? \"sales\",\n      isDefault: tax.isDefault ?? false,\n      isActive: tax.isActive ?? true,\n      accountId: tax.accountId ?? null,\n      createdAt: new Date(),\n    };\n    this.taxes.set(id, newTax);\n    return newTax;\n  }\n\n  async updateTax(id: string, updates: Partial<Tax>): Promise<Tax | undefined> {\n    const tax = this.taxes.get(id);\n    if (!tax) return undefined;\n    const updated = { ...tax, ...updates };\n    this.taxes.set(id, updated);\n    return updated;\n  }\n\n  async deleteTax(id: string): Promise<boolean> {\n    const tax = this.taxes.get(id);\n    if (!tax) return false;\n    this.taxes.delete(id);\n    return true;\n  }\n\n  // ===================== EMPLOYEES =====================\n  async getEmployees(companyId: string): Promise<Employee[]> {\n    return Array.from(this.employees.values()).filter(e => e.companyId === companyId);\n  }\n\n  async getEmployee(id: string): Promise<Employee | undefined> {\n    return this.employees.get(id);\n  }\n\n  async createEmployee(employee: InsertEmployee): Promise<Employee> {\n    const id = randomUUID();\n    const newEmployee: Employee = {\n      id,\n      companyId: employee.companyId,\n      employeeCode: employee.employeeCode,\n      name: employee.name,\n      email: employee.email ?? null,\n      phone: employee.phone ?? null,\n      department: employee.department ?? null,\n      position: employee.position ?? null,\n      hireDate: employee.hireDate ?? new Date(),\n      terminationDate: employee.terminationDate ?? null,\n      status: employee.status ?? \"active\",\n      managerId: employee.managerId ?? null,\n      address: employee.address ?? null,\n      city: employee.city ?? null,\n      state: employee.state ?? null,\n      country: employee.country ?? null,\n      salary: employee.salary ?? null,\n      salaryFrequency: employee.salaryFrequency ?? \"monthly\",\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    };\n    this.employees.set(id, newEmployee);\n    return newEmployee;\n  }\n\n  async updateEmployee(id: string, updates: Partial<Employee>): Promise<Employee | undefined> {\n    const employee = this.employees.get(id);\n    if (!employee) return undefined;\n    const updated = { ...employee, ...updates, updatedAt: new Date() };\n    this.employees.set(id, updated);\n    return updated;\n  }\n\n  async deleteEmployee(id: string): Promise<boolean> {\n    const employee = this.employees.get(id);\n    if (!employee) return false;\n    this.employees.delete(id);\n    return true;\n  }\n\n  // ===================== JOURNAL ENTRIES =====================\n  async getJournalEntries(companyId: string): Promise<JournalEntry[]> {\n    return Array.from(this.journalEntries.values()).filter(e => e.companyId === companyId);\n  }\n\n  async getJournalEntry(id: string): Promise<JournalEntry | undefined> {\n    return this.journalEntries.get(id);\n  }\n\n  async createJournalEntry(entry: InsertJournalEntry): Promise<JournalEntry> {\n    const id = randomUUID();\n    const newEntry: JournalEntry = {\n      id,\n      companyId: entry.companyId,\n      entryNumber: entry.entryNumber,\n      entryDate: entry.entryDate ?? new Date(),\n      fiscalPeriodId: entry.fiscalPeriodId ?? null,\n      description: entry.description ?? null,\n      reference: entry.reference ?? null,\n      sourceDocument: entry.sourceDocument ?? null,\n      sourceDocumentId: entry.sourceDocumentId ?? null,\n      status: entry.status ?? \"draft\",\n      totalDebit: entry.totalDebit ?? \"0\",\n      totalCredit: entry.totalCredit ?? \"0\",\n      isIntercompany: entry.isIntercompany ?? false,\n      counterpartyCompanyId: entry.counterpartyCompanyId ?? null,\n      eliminationGroupId: entry.eliminationGroupId ?? null,\n      postedBy: entry.postedBy ?? null,\n      postedAt: entry.postedAt ?? null,\n      createdBy: entry.createdBy ?? null,\n      createdAt: new Date(),\n    };\n    this.journalEntries.set(id, newEntry);\n    return newEntry;\n  }\n\n  async updateJournalEntry(id: string, updates: Partial<JournalEntry>): Promise<JournalEntry | undefined> {\n    const entry = this.journalEntries.get(id);\n    if (!entry) return undefined;\n    const updated = { ...entry, ...updates };\n    this.journalEntries.set(id, updated);\n    return updated;\n  }\n\n  async deleteJournalEntry(id: string): Promise<boolean> {\n    const entry = this.journalEntries.get(id);\n    if (!entry) return false;\n    this.journalEntries.delete(id);\n    return true;\n  }\n\n  // ===================== SALES ORDERS =====================\n  async getSalesOrders(companyId: string): Promise<SalesOrder[]> {\n    return Array.from(this.salesOrders.values()).filter(o => o.companyId === companyId);\n  }\n\n  async getSalesOrder(id: string): Promise<SalesOrder | undefined> {\n    return this.salesOrders.get(id);\n  }\n\n  async createSalesOrder(order: InsertSalesOrder): Promise<SalesOrder> {\n    const id = randomUUID();\n    const newOrder: SalesOrder = {\n      id,\n      companyId: order.companyId,\n      orderNumber: order.orderNumber,\n      customerId: order.customerId,\n      orderDate: order.orderDate ?? new Date(),\n      requiredDate: order.requiredDate ?? null,\n      status: order.status ?? \"draft\",\n      subtotal: order.subtotal ?? \"0\",\n      taxAmount: order.taxAmount ?? \"0\",\n      total: order.total ?? \"0\",\n      fiscalPeriodId: order.fiscalPeriodId ?? null,\n      warehouseId: order.warehouseId ?? null,\n      isIntercompany: order.isIntercompany ?? false,\n      counterpartyCompanyId: order.counterpartyCompanyId ?? null,\n      linkedPurchaseOrderId: order.linkedPurchaseOrderId ?? null,\n      notes: order.notes ?? null,\n      createdBy: order.createdBy ?? null,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    };\n    this.salesOrders.set(id, newOrder);\n    return newOrder;\n  }\n\n  async updateSalesOrder(id: string, updates: Partial<SalesOrder>): Promise<SalesOrder | undefined> {\n    const order = this.salesOrders.get(id);\n    if (!order) return undefined;\n    const updated = { ...order, ...updates, updatedAt: new Date() };\n    this.salesOrders.set(id, updated);\n    return updated;\n  }\n\n  async deleteSalesOrder(id: string): Promise<boolean> {\n    const order = this.salesOrders.get(id);\n    if (!order) return false;\n    this.salesOrders.delete(id);\n    return true;\n  }\n\n  async getSalesOrderLines(salesOrderId: string): Promise<SalesOrderLine[]> {\n    return [];\n  }\n\n  // ===================== PURCHASE ORDERS =====================\n  async getPurchaseOrders(companyId: string): Promise<PurchaseOrder[]> {\n    return Array.from(this.purchaseOrders.values()).filter(o => o.companyId === companyId);\n  }\n\n  async getPurchaseOrder(id: string): Promise<PurchaseOrder | undefined> {\n    return this.purchaseOrders.get(id);\n  }\n\n  async createPurchaseOrder(order: InsertPurchaseOrder): Promise<PurchaseOrder> {\n    const id = randomUUID();\n    const newOrder: PurchaseOrder = {\n      id,\n      companyId: order.companyId,\n      orderNumber: order.orderNumber,\n      vendorId: order.vendorId,\n      orderDate: order.orderDate ?? new Date(),\n      expectedDate: order.expectedDate ?? null,\n      status: order.status ?? \"draft\",\n      subtotal: order.subtotal ?? \"0\",\n      taxAmount: order.taxAmount ?? \"0\",\n      total: order.total ?? \"0\",\n      fiscalPeriodId: order.fiscalPeriodId ?? null,\n      warehouseId: order.warehouseId ?? null,\n      isIntercompany: order.isIntercompany ?? false,\n      counterpartyCompanyId: order.counterpartyCompanyId ?? null,\n      linkedSalesOrderId: order.linkedSalesOrderId ?? null,\n      notes: order.notes ?? null,\n      createdBy: order.createdBy ?? null,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    };\n    this.purchaseOrders.set(id, newOrder);\n    return newOrder;\n  }\n\n  async updatePurchaseOrder(id: string, updates: Partial<PurchaseOrder>): Promise<PurchaseOrder | undefined> {\n    const order = this.purchaseOrders.get(id);\n    if (!order) return undefined;\n    const updated = { ...order, ...updates, updatedAt: new Date() };\n    this.purchaseOrders.set(id, updated);\n    return updated;\n  }\n\n  async deletePurchaseOrder(id: string): Promise<boolean> {\n    const order = this.purchaseOrders.get(id);\n    if (!order) return false;\n    this.purchaseOrders.delete(id);\n    return true;\n  }\n\n  async getPurchaseOrderLines(purchaseOrderId: string): Promise<PurchaseOrderLine[]> {\n    return [];\n  }\n\n  // ===================== INTERCOMPANY TRANSFERS =====================\n  async getIntercompanyTransfers(companyId: string): Promise<IntercompanyTransfer[]> {\n    return Array.from(this.intercompanyTransfers.values()).filter(\n      t => t.sourceCompanyId === companyId || t.targetCompanyId === companyId\n    );\n  }\n\n  async getIntercompanyTransfer(id: string): Promise<IntercompanyTransfer | undefined> {\n    return this.intercompanyTransfers.get(id);\n  }\n\n  async createIntercompanyTransfer(transfer: InsertIntercompanyTransfer): Promise<IntercompanyTransfer> {\n    const id = randomUUID();\n    const newTransfer: IntercompanyTransfer = {\n      id,\n      transferNumber: transfer.transferNumber,\n      sourceCompanyId: transfer.sourceCompanyId,\n      targetCompanyId: transfer.targetCompanyId,\n      sourceWarehouseId: transfer.sourceWarehouseId,\n      targetWarehouseId: transfer.targetWarehouseId,\n      transferDate: transfer.transferDate ?? new Date(),\n      status: transfer.status ?? \"draft\",\n      totalValue: transfer.totalValue ?? \"0\",\n      sourceSalesOrderId: transfer.sourceSalesOrderId ?? null,\n      targetPurchaseOrderId: transfer.targetPurchaseOrderId ?? null,\n      notes: transfer.notes ?? null,\n      createdBy: transfer.createdBy ?? null,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    };\n    this.intercompanyTransfers.set(id, newTransfer);\n    return newTransfer;\n  }\n\n  async updateIntercompanyTransfer(id: string, updates: Partial<IntercompanyTransfer>): Promise<IntercompanyTransfer | undefined> {\n    const transfer = this.intercompanyTransfers.get(id);\n    if (!transfer) return undefined;\n    const updated = { ...transfer, ...updates, updatedAt: new Date() };\n    this.intercompanyTransfers.set(id, updated);\n    return updated;\n  }\n\n  // ===================== SHARED ACCESS =====================\n  async getSharedAccess(granteeCompanyId: string, entityType: string): Promise<SharedAccess[]> {\n    return Array.from(this.sharedAccess.values()).filter(\n      sa => sa.granteeCompanyId === granteeCompanyId && \n            sa.entityType === entityType && \n            sa.isActive\n    );\n  }\n\n  async grantSharedAccess(access: InsertSharedAccess): Promise<SharedAccess> {\n    const id = randomUUID();\n    const newAccess: SharedAccess = {\n      id,\n      entityType: access.entityType,\n      entityId: access.entityId,\n      ownerCompanyId: access.ownerCompanyId,\n      granteeCompanyId: access.granteeCompanyId,\n      accessLevel: access.accessLevel ?? \"read\",\n      grantedAt: new Date(),\n      grantedBy: access.grantedBy ?? null,\n      expiresAt: access.expiresAt ?? null,\n      isActive: access.isActive ?? true,\n    };\n    this.sharedAccess.set(id, newAccess);\n    return newAccess;\n  }\n\n  async revokeSharedAccess(id: string): Promise<void> {\n    this.sharedAccess.delete(id);\n  }\n\n  // ===================== REFRESH TOKENS (JWT AUTH) =====================\n  async createRefreshToken(token: InsertRefreshToken): Promise<RefreshToken> {\n    const id = randomUUID();\n    const newToken: RefreshToken = {\n      id,\n      userId: token.userId,\n      tokenHash: token.tokenHash,\n      activeCompanyId: token.activeCompanyId ?? null,\n      deviceInfo: token.deviceInfo ?? null,\n      ipAddress: token.ipAddress ?? null,\n      issuedAt: new Date(),\n      expiresAt: token.expiresAt,\n      revokedAt: null,\n      revokedReason: null,\n      tokenVersion: token.tokenVersion ?? 1,\n    };\n    this.refreshTokens.set(id, newToken);\n    return newToken;\n  }\n\n  async getRefreshTokenByHash(tokenHash: string): Promise<RefreshToken | undefined> {\n    return Array.from(this.refreshTokens.values()).find(t => t.tokenHash === tokenHash);\n  }\n\n  async revokeRefreshToken(id: string, reason: string): Promise<void> {\n    const token = this.refreshTokens.get(id);\n    if (token) {\n      token.revokedAt = new Date();\n      token.revokedReason = reason;\n      this.refreshTokens.set(id, token);\n    }\n  }\n\n  async revokeAllUserRefreshTokens(userId: string, reason: string): Promise<void> {\n    const now = new Date();\n    const entries = Array.from(this.refreshTokens.entries());\n    for (const [id, token] of entries) {\n      if (token.userId === userId && !token.revokedAt) {\n        token.revokedAt = now;\n        token.revokedReason = reason;\n        this.refreshTokens.set(id, token);\n      }\n    }\n  }\n\n  // ===================== AUTH AUDIT LOG =====================\n  async createAuthAuditLog(log: InsertAuthAuditLog): Promise<AuthAuditLog> {\n    const id = randomUUID();\n    const newLog: AuthAuditLog = {\n      id,\n      userId: log.userId ?? null,\n      eventType: log.eventType,\n      companyId: log.companyId ?? null,\n      ipAddress: log.ipAddress ?? null,\n      deviceInfo: log.deviceInfo ?? null,\n      success: log.success ?? true,\n      failureReason: log.failureReason ?? null,\n      metadata: log.metadata ?? null,\n      createdAt: new Date(),\n    };\n    this.authAuditLogs.set(id, newLog);\n    return newLog;\n  }\n\n  async getAuthAuditLogs(userId: string, limit: number = 100): Promise<AuthAuditLog[]> {\n    return Array.from(this.authAuditLogs.values())\n      .filter(l => l.userId === userId)\n      .sort((a, b) => (b.createdAt?.getTime() || 0) - (a.createdAt?.getTime() || 0))\n      .slice(0, limit);\n  }\n\n  // ===================== ADDITIONAL AUTH METHODS =====================\n  async getAllCompanies(): Promise<Company[]> {\n    return Array.from(this.companies.values());\n  }\n\n  async getUserCompanyRole(userId: string, companyId: string): Promise<UserCompanyRole | undefined> {\n    return Array.from(this.userCompanyRoles.values()).find(\n      ucr => ucr.userId === userId && ucr.companyId === companyId && ucr.isActive\n    );\n  }\n\n  // ===================== SYSTEM INITIALIZATION =====================\n  async isSystemInitialized(): Promise<boolean> {\n    // System is initialized if there is at least one company\n    return this.companies.size > 0;\n  }\n\n  async getSystemStats(): Promise<{ companyCount: number; userCount: number }> {\n    return {\n      companyCount: this.companies.size,\n      userCount: this.users.size,\n    };\n  }\n\n  // Stock Levels - stub implementations for MemStorage\n  async getStockLevels(companyId: string): Promise<StockLevel[]> {\n    return [];\n  }\n\n  async getStockLevel(companyId: string, productId: string, warehouseId: string): Promise<StockLevel | undefined> {\n    return undefined;\n  }\n\n  async getStockMovements(companyId: string): Promise<StockMovement[]> {\n    return [];\n  }\n\n  async getDeliveries(companyId: string): Promise<Delivery[]> {\n    return [];\n  }\n\n  async getDelivery(id: string): Promise<Delivery | undefined> {\n    return undefined;\n  }\n\n  async getGoodsReceipts(companyId: string): Promise<GoodsReceipt[]> {\n    return [];\n  }\n\n  async getGoodsReceipt(id: string): Promise<GoodsReceipt | undefined> {\n    return undefined;\n  }\n\n  async getInvoices(companyId: string): Promise<Invoice[]> {\n    return [];\n  }\n\n  async getInvoice(id: string): Promise<Invoice | undefined> {\n    return undefined;\n  }\n\n  async getPayments(companyId: string): Promise<Payment[]> {\n    return [];\n  }\n\n  async getPayment(id: string): Promise<Payment | undefined> {\n    return undefined;\n  }\n\n  async getArApLedger(companyId: string, ledgerType: string): Promise<ArApLedger[]> {\n    return [];\n  }\n}\n\nimport { DatabaseStorage } from \"./database-storage\";\n\n// Use DatabaseStorage for production with PostgreSQL\n// Keep MemStorage available for testing/development if needed\nexport const storage: IStorage = new DatabaseStorage();\n","path":null,"size_bytes":54978,"size_tokens":null},"server/auth.ts":{"content":"import jwt from \"jsonwebtoken\";\nimport bcrypt from \"bcryptjs\";\nimport crypto from \"crypto\";\nimport type { Request, Response, NextFunction } from \"express\";\nimport { storage } from \"./storage\";\nimport type {\n  User,\n  Company,\n  Role,\n  JWTAccessTokenPayload,\n  JWTRefreshTokenPayload,\n  AuthContext,\n  LoginResponse,\n  RefreshResponse,\n  CompanyLevel,\n  InsertRefreshToken,\n  InsertAuthAuditLog,\n} from \"@shared/schema\";\nimport { COMPANY_LEVELS, AUTH_EVENTS } from \"@shared/schema\";\n\n// ============================================================================\n// AUTH CONFIGURATION\n// ============================================================================\n\nconst JWT_SECRET = process.env.JWT_SECRET || process.env.SESSION_SECRET || \"unanza-jwt-secret-change-in-production\";\nconst JWT_REFRESH_SECRET = process.env.JWT_REFRESH_SECRET || JWT_SECRET + \"-refresh\";\n\nconst ACCESS_TOKEN_EXPIRES_IN = 15 * 60; // 15 minutes in seconds\nconst REFRESH_TOKEN_EXPIRES_IN = 7 * 24 * 60 * 60; // 7 days in seconds\n\nconst SALT_ROUNDS = 12;\n\n// ============================================================================\n// PASSWORD UTILITIES\n// ============================================================================\n\nexport async function hashPassword(password: string): Promise<string> {\n  return bcrypt.hash(password, SALT_ROUNDS);\n}\n\nexport async function verifyPassword(password: string, hash: string): Promise<boolean> {\n  return bcrypt.compare(password, hash);\n}\n\n// ============================================================================\n// JWT TOKEN UTILITIES\n// ============================================================================\n\nexport function generateAccessToken(payload: Omit<JWTAccessTokenPayload, \"iat\" | \"exp\" | \"jti\">): string {\n  const jti = crypto.randomUUID();\n  return jwt.sign(\n    { ...payload, jti },\n    JWT_SECRET,\n    { expiresIn: ACCESS_TOKEN_EXPIRES_IN }\n  );\n}\n\nexport function generateRefreshToken(payload: Omit<JWTRefreshTokenPayload, \"iat\" | \"exp\">): string {\n  return jwt.sign(\n    payload,\n    JWT_REFRESH_SECRET,\n    { expiresIn: REFRESH_TOKEN_EXPIRES_IN }\n  );\n}\n\nexport function verifyAccessToken(token: string): JWTAccessTokenPayload | null {\n  try {\n    return jwt.verify(token, JWT_SECRET) as JWTAccessTokenPayload;\n  } catch (error) {\n    return null;\n  }\n}\n\nexport function verifyRefreshToken(token: string): JWTRefreshTokenPayload | null {\n  try {\n    return jwt.verify(token, JWT_REFRESH_SECRET) as JWTRefreshTokenPayload;\n  } catch (error) {\n    return null;\n  }\n}\n\nexport function hashToken(token: string): string {\n  return crypto.createHash(\"sha256\").update(token).digest(\"hex\");\n}\n\n// ============================================================================\n// HIERARCHY-BASED ACCESS CALCULATION\n// ============================================================================\n\n/**\n * Calculate allowed company IDs based on user's position in the hierarchy\n * - Branch (level 3): Can only access its own data\n * - Subsidiary (level 2): Can access its own data + all child Branches\n * - Holding (level 1): Can access all Subsidiaries and their Branches\n */\nexport async function calculateAllowedCompanyIds(\n  activeCompanyId: string,\n  allCompanies?: Company[]\n): Promise<{ allowedCompanyIds: string[]; companyLevel: CompanyLevel; canConsolidate: boolean }> {\n  const companies = allCompanies || await storage.getAllCompanies();\n  const activeCompany = companies.find(c => c.id === activeCompanyId);\n  \n  if (!activeCompany) {\n    return { \n      allowedCompanyIds: [], \n      companyLevel: COMPANY_LEVELS.BRANCH, \n      canConsolidate: false \n    };\n  }\n\n  const companyLevel = activeCompany.level as CompanyLevel;\n  let allowedCompanyIds: string[] = [];\n  let canConsolidate = false;\n\n  switch (companyLevel) {\n    case COMPANY_LEVELS.HOLDING:\n      // Holding can see all companies in its hierarchy (path starts with this company's path)\n      allowedCompanyIds = companies\n        .filter(c => c.path.startsWith(activeCompany.path))\n        .map(c => c.id);\n      canConsolidate = true;\n      break;\n\n    case COMPANY_LEVELS.SUBSIDIARY:\n      // Subsidiary can see itself + all its Branches\n      allowedCompanyIds = companies\n        .filter(c => c.path.startsWith(activeCompany.path))\n        .map(c => c.id);\n      canConsolidate = true; // Can consolidate its branches\n      break;\n\n    case COMPANY_LEVELS.BRANCH:\n      // Branch can only see itself\n      allowedCompanyIds = [activeCompanyId];\n      canConsolidate = false;\n      break;\n  }\n\n  return { allowedCompanyIds, companyLevel, canConsolidate };\n}\n\n// ============================================================================\n// AUTH SERVICE\n// ============================================================================\n\nexport interface AuthResult {\n  success: boolean;\n  error?: string;\n  loginResponse?: LoginResponse;\n  refreshToken?: string;\n}\n\nexport async function authenticateUser(\n  username: string,\n  password: string,\n  requestedCompanyId?: string,\n  ipAddress?: string,\n  deviceInfo?: string\n): Promise<AuthResult> {\n  // Find user\n  const user = await storage.getUserByUsername(username);\n  if (!user) {\n    await logAuthEvent({\n      userId: null,\n      eventType: AUTH_EVENTS.LOGIN_FAILED,\n      companyId: null,\n      ipAddress: ipAddress || null,\n      deviceInfo: deviceInfo || null,\n      success: false,\n      failureReason: \"User not found\",\n    });\n    return { success: false, error: \"Invalid username or password\" };\n  }\n\n  // Verify password\n  const isValidPassword = await verifyPassword(password, user.password);\n  if (!isValidPassword) {\n    await logAuthEvent({\n      userId: user.id,\n      eventType: AUTH_EVENTS.LOGIN_FAILED,\n      companyId: null,\n      ipAddress: ipAddress || null,\n      deviceInfo: deviceInfo || null,\n      success: false,\n      failureReason: \"Invalid password\",\n    });\n    return { success: false, error: \"Invalid username or password\" };\n  }\n\n  // Check if user is active\n  if (!user.isActive) {\n    await logAuthEvent({\n      userId: user.id,\n      eventType: AUTH_EVENTS.LOGIN_FAILED,\n      companyId: null,\n      ipAddress: ipAddress || null,\n      deviceInfo: deviceInfo || null,\n      success: false,\n      failureReason: \"User account is disabled\",\n    });\n    return { success: false, error: \"Account is disabled\" };\n  }\n\n  // Get user's company assignments\n  const userCompanies = await storage.getUserCompanies(user.id);\n  if (userCompanies.length === 0) {\n    await logAuthEvent({\n      userId: user.id,\n      eventType: AUTH_EVENTS.LOGIN_FAILED,\n      companyId: null,\n      ipAddress: ipAddress || null,\n      deviceInfo: deviceInfo || null,\n      success: false,\n      failureReason: \"No company assignments\",\n    });\n    return { success: false, error: \"User has no company assignments\" };\n  }\n\n  // Determine active company\n  let activeCompanyId: string;\n  if (requestedCompanyId) {\n    // Check if user has access to requested company\n    const hasAccess = userCompanies.some(c => c.id === requestedCompanyId);\n    if (!hasAccess) {\n      return { success: false, error: \"User does not have access to the requested company\" };\n    }\n    activeCompanyId = requestedCompanyId;\n  } else {\n    // Use default company or first assigned company\n    activeCompanyId = user.defaultCompanyId || userCompanies[0].id;\n  }\n\n  const activeCompany = userCompanies.find(c => c.id === activeCompanyId) || userCompanies[0];\n\n  // Get user's role for the active company\n  const roleAssignment = await storage.getUserCompanyRole(user.id, activeCompanyId);\n  const role = roleAssignment ? await storage.getRole(roleAssignment.roleId) : null;\n  const permissions = role ? (role.permissions as string[]) : [];\n\n  // Calculate allowed company IDs based on hierarchy\n  const allCompanies = await storage.getAllCompanies();\n  const { allowedCompanyIds, companyLevel, canConsolidate } = await calculateAllowedCompanyIds(\n    activeCompanyId,\n    allCompanies\n  );\n\n  // Generate access token\n  const accessToken = generateAccessToken({\n    userId: user.id,\n    username: user.username,\n    activeCompanyId,\n    roleId: role?.id || null,\n    allowedCompanyIds,\n    companyLevel,\n    permissions,\n  });\n\n  // Create refresh token\n  const refreshTokenId = crypto.randomUUID();\n  const refreshToken = generateRefreshToken({\n    userId: user.id,\n    tokenId: refreshTokenId,\n    tokenVersion: 1,\n  });\n\n  // Store refresh token in database\n  const expiresAt = new Date(Date.now() + REFRESH_TOKEN_EXPIRES_IN * 1000);\n  await storage.createRefreshToken({\n    userId: user.id,\n    tokenHash: hashToken(refreshToken),\n    activeCompanyId,\n    deviceInfo: deviceInfo || null,\n    ipAddress: ipAddress || null,\n    expiresAt,\n    tokenVersion: 1,\n  });\n\n  // Update user's last login\n  await storage.updateUser(user.id, { lastLoginAt: new Date() });\n\n  // Log successful login\n  await logAuthEvent({\n    userId: user.id,\n    eventType: AUTH_EVENTS.LOGIN,\n    companyId: activeCompanyId,\n    ipAddress: ipAddress || null,\n    deviceInfo: deviceInfo || null,\n    success: true,\n  });\n\n  const loginResponse: LoginResponse = {\n    accessToken,\n    expiresIn: ACCESS_TOKEN_EXPIRES_IN,\n    user: {\n      id: user.id,\n      username: user.username,\n      email: user.email,\n      fullName: user.fullName,\n    },\n    activeCompany: {\n      id: activeCompany.id,\n      code: activeCompany.code,\n      name: activeCompany.name,\n      companyType: activeCompany.companyType,\n      level: activeCompany.level,\n    },\n    role: role ? {\n      id: role.id,\n      name: role.name,\n      permissions: permissions,\n    } : null,\n    allowedCompanyIds,\n    companyLevel,\n    canConsolidate,\n  };\n\n  return {\n    success: true,\n    loginResponse,\n    refreshToken,\n  };\n}\n\nexport async function refreshAccessToken(\n  refreshToken: string,\n  ipAddress?: string,\n  deviceInfo?: string\n): Promise<{ success: boolean; error?: string; response?: RefreshResponse; newRefreshToken?: string }> {\n  // Verify refresh token\n  const payload = verifyRefreshToken(refreshToken);\n  if (!payload) {\n    return { success: false, error: \"Invalid or expired refresh token\" };\n  }\n\n  // Check if refresh token exists in database and is not revoked\n  const tokenHash = hashToken(refreshToken);\n  const storedToken = await storage.getRefreshTokenByHash(tokenHash);\n  if (!storedToken || storedToken.revokedAt) {\n    await logAuthEvent({\n      userId: payload.userId,\n      eventType: AUTH_EVENTS.REFRESH_FAILED,\n      companyId: null,\n      ipAddress: ipAddress || null,\n      deviceInfo: deviceInfo || null,\n      success: false,\n      failureReason: storedToken?.revokedAt ? \"Token revoked\" : \"Token not found\",\n    });\n    return { success: false, error: \"Refresh token is invalid or has been revoked\" };\n  }\n\n  // Check if token has expired\n  if (new Date(storedToken.expiresAt) < new Date()) {\n    return { success: false, error: \"Refresh token has expired\" };\n  }\n\n  // Get user\n  const user = await storage.getUser(payload.userId);\n  if (!user || !user.isActive) {\n    return { success: false, error: \"User not found or account disabled\" };\n  }\n\n  // Get active company from stored token\n  const activeCompanyId = storedToken.activeCompanyId || user.defaultCompanyId;\n  if (!activeCompanyId) {\n    return { success: false, error: \"No active company\" };\n  }\n\n  const activeCompany = await storage.getCompany(activeCompanyId);\n  if (!activeCompany) {\n    return { success: false, error: \"Company not found\" };\n  }\n\n  // Get role for the company\n  const roleAssignment = await storage.getUserCompanyRole(user.id, activeCompanyId);\n  const role = roleAssignment ? await storage.getRole(roleAssignment.roleId) : null;\n  const permissions = role ? (role.permissions as string[]) : [];\n\n  // Recalculate allowed company IDs\n  const { allowedCompanyIds, companyLevel } = await calculateAllowedCompanyIds(activeCompanyId);\n\n  // Revoke old refresh token (token rotation)\n  await storage.revokeRefreshToken(storedToken.id, \"rotation\");\n\n  // Create new refresh token\n  const newRefreshTokenId = crypto.randomUUID();\n  const newRefreshToken = generateRefreshToken({\n    userId: user.id,\n    tokenId: newRefreshTokenId,\n    tokenVersion: (storedToken.tokenVersion || 1) + 1,\n  });\n\n  const expiresAt = new Date(Date.now() + REFRESH_TOKEN_EXPIRES_IN * 1000);\n  await storage.createRefreshToken({\n    userId: user.id,\n    tokenHash: hashToken(newRefreshToken),\n    activeCompanyId,\n    deviceInfo: deviceInfo || storedToken.deviceInfo || null,\n    ipAddress: ipAddress || storedToken.ipAddress || null,\n    expiresAt,\n    tokenVersion: (storedToken.tokenVersion || 1) + 1,\n  });\n\n  // Generate new access token\n  const accessToken = generateAccessToken({\n    userId: user.id,\n    username: user.username,\n    activeCompanyId,\n    roleId: role?.id || null,\n    allowedCompanyIds,\n    companyLevel,\n    permissions,\n  });\n\n  // Log refresh event\n  await logAuthEvent({\n    userId: user.id,\n    eventType: AUTH_EVENTS.REFRESH,\n    companyId: activeCompanyId,\n    ipAddress: ipAddress || null,\n    deviceInfo: deviceInfo || null,\n    success: true,\n  });\n\n  return {\n    success: true,\n    response: {\n      accessToken,\n      expiresIn: ACCESS_TOKEN_EXPIRES_IN,\n    },\n    newRefreshToken,\n  };\n}\n\nexport async function logout(\n  refreshToken: string,\n  ipAddress?: string,\n  deviceInfo?: string\n): Promise<{ success: boolean }> {\n  const tokenHash = hashToken(refreshToken);\n  const storedToken = await storage.getRefreshTokenByHash(tokenHash);\n  \n  if (storedToken) {\n    await storage.revokeRefreshToken(storedToken.id, \"logout\");\n    \n    await logAuthEvent({\n      userId: storedToken.userId,\n      eventType: AUTH_EVENTS.LOGOUT,\n      companyId: storedToken.activeCompanyId || null,\n      ipAddress: ipAddress || null,\n      deviceInfo: deviceInfo || null,\n      success: true,\n    });\n  }\n\n  return { success: true };\n}\n\nexport async function logoutAllDevices(userId: string): Promise<void> {\n  await storage.revokeAllUserRefreshTokens(userId, \"logout_all_devices\");\n}\n\n// ============================================================================\n// COMPANY SWITCHING\n// ============================================================================\n\nexport async function switchCompany(\n  userId: string,\n  newCompanyId: string,\n  currentRefreshToken: string,\n  ipAddress?: string,\n  deviceInfo?: string\n): Promise<{ success: boolean; error?: string; loginResponse?: LoginResponse; refreshToken?: string }> {\n  // Verify user has access to new company\n  const userCompanies = await storage.getUserCompanies(userId);\n  const hasAccess = userCompanies.some(c => c.id === newCompanyId);\n  \n  if (!hasAccess) {\n    return { success: false, error: \"User does not have access to this company\" };\n  }\n\n  const user = await storage.getUser(userId);\n  if (!user) {\n    return { success: false, error: \"User not found\" };\n  }\n\n  const newCompany = await storage.getCompany(newCompanyId);\n  if (!newCompany) {\n    return { success: false, error: \"Company not found\" };\n  }\n\n  // Get role for new company\n  const roleAssignment = await storage.getUserCompanyRole(userId, newCompanyId);\n  const role = roleAssignment ? await storage.getRole(roleAssignment.roleId) : null;\n  const permissions = role ? (role.permissions as string[]) : [];\n\n  // Calculate allowed companies for new context\n  const allCompanies = await storage.getAllCompanies();\n  const { allowedCompanyIds, companyLevel, canConsolidate } = await calculateAllowedCompanyIds(\n    newCompanyId,\n    allCompanies\n  );\n\n  // Revoke old refresh token\n  const tokenHash = hashToken(currentRefreshToken);\n  const storedToken = await storage.getRefreshTokenByHash(tokenHash);\n  if (storedToken) {\n    await storage.revokeRefreshToken(storedToken.id, \"company_switch\");\n  }\n\n  // Generate new tokens for new company context\n  const accessToken = generateAccessToken({\n    userId: user.id,\n    username: user.username,\n    activeCompanyId: newCompanyId,\n    roleId: role?.id || null,\n    allowedCompanyIds,\n    companyLevel,\n    permissions,\n  });\n\n  const refreshTokenId = crypto.randomUUID();\n  const newRefreshToken = generateRefreshToken({\n    userId: user.id,\n    tokenId: refreshTokenId,\n    tokenVersion: 1,\n  });\n\n  const expiresAt = new Date(Date.now() + REFRESH_TOKEN_EXPIRES_IN * 1000);\n  await storage.createRefreshToken({\n    userId: user.id,\n    tokenHash: hashToken(newRefreshToken),\n    activeCompanyId: newCompanyId,\n    deviceInfo: deviceInfo || null,\n    ipAddress: ipAddress || null,\n    expiresAt,\n    tokenVersion: 1,\n  });\n\n  // Log company switch\n  await logAuthEvent({\n    userId: user.id,\n    eventType: AUTH_EVENTS.COMPANY_SWITCHED,\n    companyId: newCompanyId,\n    ipAddress: ipAddress || null,\n    deviceInfo: deviceInfo || null,\n    success: true,\n    metadata: { previousCompanyId: storedToken?.activeCompanyId },\n  });\n\n  const loginResponse: LoginResponse = {\n    accessToken,\n    expiresIn: ACCESS_TOKEN_EXPIRES_IN,\n    user: {\n      id: user.id,\n      username: user.username,\n      email: user.email,\n      fullName: user.fullName,\n    },\n    activeCompany: {\n      id: newCompany.id,\n      code: newCompany.code,\n      name: newCompany.name,\n      companyType: newCompany.companyType,\n      level: newCompany.level,\n    },\n    role: role ? {\n      id: role.id,\n      name: role.name,\n      permissions: permissions,\n    } : null,\n    allowedCompanyIds,\n    companyLevel,\n    canConsolidate,\n  };\n\n  return {\n    success: true,\n    loginResponse,\n    refreshToken: newRefreshToken,\n  };\n}\n\n// ============================================================================\n// AUDIT LOGGING\n// ============================================================================\n\nasync function logAuthEvent(event: Omit<InsertAuthAuditLog, \"createdAt\">): Promise<void> {\n  try {\n    await storage.createAuthAuditLog(event);\n  } catch (error) {\n    console.error(\"Failed to log auth event:\", error);\n  }\n}\n\n// ============================================================================\n// EXPRESS MIDDLEWARE\n// ============================================================================\n\n// Extend Express Request type\ndeclare global {\n  namespace Express {\n    interface Request {\n      auth?: AuthContext;\n    }\n  }\n}\n\n/**\n * Authentication middleware that validates JWT access tokens\n * and attaches auth context to the request\n */\nexport function authenticateJWT(req: Request, res: Response, next: NextFunction): void {\n  const authHeader = req.headers.authorization;\n  \n  if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n    res.status(401).json({ error: \"No access token provided\" });\n    return;\n  }\n\n  const token = authHeader.substring(7);\n  const payload = verifyAccessToken(token);\n  \n  if (!payload) {\n    res.status(401).json({ error: \"Invalid or expired access token\" });\n    return;\n  }\n\n  // Attach minimal auth context from token\n  // Full context will be loaded by loadAuthContext middleware if needed\n  (req as any).tokenPayload = payload;\n  next();\n}\n\n/**\n * Middleware that loads full auth context from database\n * Use after authenticateJWT when you need the full user/company objects\n */\nexport async function loadAuthContext(req: Request, res: Response, next: NextFunction): Promise<void> {\n  const payload = (req as any).tokenPayload as JWTAccessTokenPayload;\n  \n  if (!payload) {\n    res.status(401).json({ error: \"Not authenticated\" });\n    return;\n  }\n\n  try {\n    const [user, activeCompany, roleResult] = await Promise.all([\n      storage.getUser(payload.userId),\n      storage.getCompany(payload.activeCompanyId),\n      payload.roleId ? storage.getRole(payload.roleId) : Promise.resolve(null),\n    ]);\n\n    if (!user || !activeCompany) {\n      res.status(401).json({ error: \"User or company not found\" });\n      return;\n    }\n\n    req.auth = {\n      user,\n      role: roleResult ?? null,\n      activeCompanyId: payload.activeCompanyId,\n      activeCompany,\n      allowedCompanyIds: payload.allowedCompanyIds,\n      companyLevel: payload.companyLevel,\n      permissions: payload.permissions,\n      canConsolidate: payload.companyLevel !== COMPANY_LEVELS.BRANCH,\n      isAuthenticated: true,\n    };\n\n    next();\n  } catch (error) {\n    console.error(\"Failed to load auth context:\", error);\n    res.status(500).json({ error: \"Failed to load authentication context\" });\n  }\n}\n\n/**\n * Middleware that verifies the user can access a specific company\n * Use after loadAuthContext for company-scoped routes\n */\nexport function verifyCompanyAccess(paramName: string = \"companyId\") {\n  return (req: Request, res: Response, next: NextFunction): void => {\n    const auth = req.auth;\n    if (!auth) {\n      res.status(401).json({ error: \"Not authenticated\" });\n      return;\n    }\n\n    const targetCompanyId = req.params[paramName] || req.body?.companyId;\n    if (!targetCompanyId) {\n      next();\n      return;\n    }\n\n    if (!auth.allowedCompanyIds.includes(targetCompanyId)) {\n      res.status(403).json({ \n        error: \"Access denied: You do not have permission to access this company's data\",\n        companyLevel: auth.companyLevel,\n        allowedCompanies: auth.allowedCompanyIds,\n      });\n      return;\n    }\n\n    next();\n  };\n}\n\n/**\n * Optional authentication - attaches auth context if token is present\n * but doesn't fail if no token is provided\n */\nexport async function optionalAuth(req: Request, res: Response, next: NextFunction): Promise<void> {\n  const authHeader = req.headers.authorization;\n  \n  if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n    next();\n    return;\n  }\n\n  const token = authHeader.substring(7);\n  const payload = verifyAccessToken(token);\n  \n  if (!payload) {\n    next();\n    return;\n  }\n\n  try {\n    const [user, activeCompany, roleResult] = await Promise.all([\n      storage.getUser(payload.userId),\n      storage.getCompany(payload.activeCompanyId),\n      payload.roleId ? storage.getRole(payload.roleId) : Promise.resolve(null),\n    ]);\n\n    if (user && activeCompany) {\n      req.auth = {\n        user,\n        role: roleResult ?? null,\n        activeCompanyId: payload.activeCompanyId,\n        activeCompany,\n        allowedCompanyIds: payload.allowedCompanyIds,\n        companyLevel: payload.companyLevel,\n        permissions: payload.permissions,\n        canConsolidate: payload.companyLevel !== COMPANY_LEVELS.BRANCH,\n        isAuthenticated: true,\n      };\n    }\n  } catch (error) {\n    // Silent fail for optional auth\n  }\n\n  next();\n}\n\n// Export constants for use in routes\nexport const AUTH_CONFIG = {\n  ACCESS_TOKEN_EXPIRES_IN,\n  REFRESH_TOKEN_EXPIRES_IN,\n  REFRESH_TOKEN_COOKIE_NAME: \"unanza_refresh_token\",\n};\n","path":null,"size_bytes":22605,"size_tokens":null},"client/src/components/examples/VendorPortal.tsx":{"content":"import { VendorPortal } from \"../system/VendorPortal\";\n\nexport default function VendorPortalExample() {\n  return <VendorPortal />;\n}\n","path":null,"size_bytes":133,"size_tokens":null},"client/src/pages/setup/SetupAdminUser.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Building2, User, Lock, Mail, AlertCircle, CheckCircle2, ArrowRight, Loader2 } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface SetupStatus {\n  isInitialized: boolean;\n  needsCompanySetup: boolean;\n  needsAdminSetup: boolean;\n  pendingCompany: { id: string; code: string; name: string } | null;\n  stats: { companyCount: number; userCount: number };\n}\n\ninterface AdminSetupData {\n  companyId: string;\n  username: string;\n  password: string;\n  email: string;\n  fullName: string;\n}\n\nexport function SetupAdminUser() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [error, setError] = useState<string | null>(null);\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\n  const [setupComplete, setSetupComplete] = useState(false);\n\n  const { data: setupStatus, isLoading } = useQuery<SetupStatus>({\n    queryKey: [\"/api/setup/status\"],\n    retry: false,\n  });\n\n  const [adminData, setAdminData] = useState<AdminSetupData>({\n    companyId: \"\",\n    username: \"\",\n    password: \"\",\n    email: \"\",\n    fullName: \"\",\n  });\n\n  // Get company name from API or fallback to sessionStorage\n  const companyName = setupStatus?.pendingCompany?.name || \n    sessionStorage.getItem(\"setup_company_name\") || \n    \"your company\";\n\n  useEffect(() => {\n    if (!isLoading && setupStatus) {\n      if (setupStatus.needsCompanySetup) {\n        setLocation(\"/setup/company\");\n      } else if (setupStatus.isInitialized && !setupStatus.needsAdminSetup) {\n        setLocation(\"/login\");\n      } else if (setupStatus.pendingCompany && !adminData.companyId) {\n        // Hydrate company ID from API when available\n        setAdminData(prev => ({ ...prev, companyId: setupStatus.pendingCompany!.id }));\n      }\n    }\n  }, [setupStatus, isLoading, setLocation, adminData.companyId]);\n\n  const adminMutation = useMutation({\n    mutationFn: async (data: AdminSetupData) => {\n      const response = await apiRequest(\"POST\", \"/api/setup/admin\", data);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/setup/status\"] });\n      sessionStorage.removeItem(\"setup_company_id\");\n      sessionStorage.removeItem(\"setup_company_name\");\n      setSetupComplete(true);\n      toast({\n        title: \"Setup Complete\",\n        description: data.message || \"You can now log in with your credentials.\",\n      });\n    },\n    onError: (err: any) => {\n      const message = err?.message || \"Failed to create admin account\";\n      setError(message);\n      toast({\n        variant: \"destructive\",\n        title: \"Setup Failed\",\n        description: message,\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(null);\n\n    if (adminData.password !== confirmPassword) {\n      setError(\"Passwords do not match\");\n      return;\n    }\n\n    if (adminData.password.length < 8) {\n      setError(\"Password must be at least 8 characters\");\n      return;\n    }\n\n    adminMutation.mutate(adminData);\n  };\n\n  const handleGoToLogin = () => {\n    setLocation(\"/login\");\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen bg-background\">\n        <div className=\"text-center\">\n          <Loader2 className=\"w-8 h-8 animate-spin mx-auto mb-4 text-primary\" />\n          <p className=\"text-muted-foreground\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (setupComplete) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen bg-background p-4\">\n        <div className=\"w-full max-w-2xl\">\n          <div className=\"text-center mb-8\">\n            <div className=\"flex items-center justify-center gap-2 mb-4\">\n              <Building2 className=\"w-10 h-10 text-primary\" />\n              <h1 className=\"text-3xl font-bold\">Unanza Setup</h1>\n            </div>\n          </div>\n\n          <div className=\"flex items-center justify-center gap-4 mb-8\">\n            <div className=\"flex items-center gap-2 text-muted-foreground\">\n              <div className=\"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium bg-primary/20 text-primary\">\n                <CheckCircle2 className=\"w-5 h-5\" />\n              </div>\n              <span className=\"font-medium\">Company</span>\n            </div>\n            <div className=\"w-12 h-0.5 bg-border\" />\n            <div className=\"flex items-center gap-2 text-muted-foreground\">\n              <div className=\"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium bg-primary/20 text-primary\">\n                <CheckCircle2 className=\"w-5 h-5\" />\n              </div>\n              <span className=\"font-medium\">Admin Account</span>\n            </div>\n            <div className=\"w-12 h-0.5 bg-border\" />\n            <div className=\"flex items-center gap-2 text-primary\">\n              <div className=\"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium bg-primary text-primary-foreground\">\n                <CheckCircle2 className=\"w-5 h-5\" />\n              </div>\n              <span className=\"font-medium\">Complete</span>\n            </div>\n          </div>\n\n          <Card>\n            <CardHeader className=\"text-center\">\n              <div className=\"w-16 h-16 mx-auto mb-4 rounded-full bg-primary/10 flex items-center justify-center\">\n                <CheckCircle2 className=\"w-8 h-8 text-primary\" />\n              </div>\n              <CardTitle>Setup Complete!</CardTitle>\n              <CardDescription>\n                Your ERP system is now ready to use. You can log in with your Super Admin credentials.\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <div className=\"bg-muted/50 rounded-lg p-4 space-y-3\">\n                <h4 className=\"font-medium\">Next Steps:</h4>\n                <ul className=\"space-y-2 text-sm text-muted-foreground\">\n                  <li className=\"flex items-start gap-2\">\n                    <CheckCircle2 className=\"w-4 h-4 mt-0.5 text-primary shrink-0\" />\n                    <span>Set up your chart of accounts</span>\n                  </li>\n                  <li className=\"flex items-start gap-2\">\n                    <CheckCircle2 className=\"w-4 h-4 mt-0.5 text-primary shrink-0\" />\n                    <span>Create warehouses and inventory locations</span>\n                  </li>\n                  <li className=\"flex items-start gap-2\">\n                    <CheckCircle2 className=\"w-4 h-4 mt-0.5 text-primary shrink-0\" />\n                    <span>Add team members and assign roles</span>\n                  </li>\n                  <li className=\"flex items-start gap-2\">\n                    <CheckCircle2 className=\"w-4 h-4 mt-0.5 text-primary shrink-0\" />\n                    <span>Configure subsidiaries and branches</span>\n                  </li>\n                </ul>\n              </div>\n\n              <Button\n                onClick={handleGoToLogin}\n                className=\"w-full\"\n                data-testid=\"button-go-to-login\"\n              >\n                Go to Login\n                <ArrowRight className=\"w-4 h-4 ml-2\" />\n              </Button>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex items-center justify-center min-h-screen bg-background p-4\">\n      <div className=\"w-full max-w-2xl\">\n        <div className=\"text-center mb-8\">\n          <div className=\"flex items-center justify-center gap-2 mb-4\">\n            <Building2 className=\"w-10 h-10 text-primary\" />\n            <h1 className=\"text-3xl font-bold\">Unanza Setup</h1>\n          </div>\n          <p className=\"text-muted-foreground\">Welcome! Let's get your ERP system configured.</p>\n        </div>\n\n        <div className=\"flex items-center justify-center gap-4 mb-8\">\n          <div className=\"flex items-center gap-2 text-muted-foreground\">\n            <div className=\"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium bg-primary/20 text-primary\">\n              <CheckCircle2 className=\"w-5 h-5\" />\n            </div>\n            <span className=\"font-medium\">Company</span>\n          </div>\n          <div className=\"w-12 h-0.5 bg-border\" />\n          <div className=\"flex items-center gap-2 text-primary\">\n            <div className=\"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium bg-primary text-primary-foreground\">\n              2\n            </div>\n            <span className=\"font-medium\">Admin Account</span>\n          </div>\n          <div className=\"w-12 h-0.5 bg-border\" />\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium bg-muted\">\n              3\n            </div>\n            <span className=\"font-medium text-muted-foreground\">Complete</span>\n          </div>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Create Super Admin Account</CardTitle>\n            <CardDescription>\n              Set up the first administrator account for {companyName}.\n              This account will have full system access.\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <form onSubmit={handleSubmit} className=\"space-y-6\">\n              {error && (\n                <div className=\"flex items-center gap-2 p-3 rounded-md bg-destructive/10 text-destructive text-sm\" data-testid=\"error-admin\">\n                  <AlertCircle className=\"w-4 h-4 shrink-0\" />\n                  <span>{error}</span>\n                </div>\n              )}\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"fullName\">Full Name *</Label>\n                <div className=\"relative\">\n                  <User className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n                  <Input\n                    id=\"fullName\"\n                    placeholder=\"John Doe\"\n                    value={adminData.fullName}\n                    onChange={(e) => setAdminData({ ...adminData, fullName: e.target.value })}\n                    className=\"pl-10\"\n                    required\n                    disabled={adminMutation.isPending}\n                    data-testid=\"input-fullname\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"adminEmail\">Email Address *</Label>\n                <div className=\"relative\">\n                  <Mail className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n                  <Input\n                    id=\"adminEmail\"\n                    type=\"email\"\n                    placeholder=\"admin@company.com\"\n                    value={adminData.email}\n                    onChange={(e) => setAdminData({ ...adminData, email: e.target.value })}\n                    className=\"pl-10\"\n                    required\n                    disabled={adminMutation.isPending}\n                    data-testid=\"input-admin-email\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"username\">Username *</Label>\n                <div className=\"relative\">\n                  <User className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n                  <Input\n                    id=\"username\"\n                    placeholder=\"admin\"\n                    value={adminData.username}\n                    onChange={(e) => setAdminData({ ...adminData, username: e.target.value })}\n                    className=\"pl-10\"\n                    required\n                    disabled={adminMutation.isPending}\n                    data-testid=\"input-admin-username\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"password\">Password *</Label>\n                  <div className=\"relative\">\n                    <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n                    <Input\n                      id=\"password\"\n                      type=\"password\"\n                      placeholder=\"Min 8 characters\"\n                      value={adminData.password}\n                      onChange={(e) => setAdminData({ ...adminData, password: e.target.value })}\n                      className=\"pl-10\"\n                      required\n                      disabled={adminMutation.isPending}\n                      data-testid=\"input-password\"\n                    />\n                  </div>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"confirmPassword\">Confirm Password *</Label>\n                  <div className=\"relative\">\n                    <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n                    <Input\n                      id=\"confirmPassword\"\n                      type=\"password\"\n                      placeholder=\"Confirm password\"\n                      value={confirmPassword}\n                      onChange={(e) => setConfirmPassword(e.target.value)}\n                      className=\"pl-10\"\n                      required\n                      disabled={adminMutation.isPending}\n                      data-testid=\"input-confirm-password\"\n                    />\n                  </div>\n                </div>\n              </div>\n\n              <Button\n                type=\"submit\"\n                className=\"w-full\"\n                disabled={adminMutation.isPending || !adminData.username || !adminData.password || !adminData.email || !adminData.fullName}\n                data-testid=\"button-create-admin\"\n              >\n                {adminMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                    Creating Account...\n                  </>\n                ) : (\n                  <>\n                    Complete Setup\n                    <ArrowRight className=\"w-4 h-4 ml-2\" />\n                  </>\n                )}\n              </Button>\n            </form>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":14926,"size_tokens":null},"client/src/pages/Setup.tsx":{"content":"import { useEffect } from \"react\";\nimport { useLocation, Route, Switch, Redirect } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Loader2, Building2, Lock } from \"lucide-react\";\nimport { SetupCompany } from \"./setup/SetupCompany\";\nimport { SetupAdminUser } from \"./setup/SetupAdminUser\";\n\ninterface SetupStatus {\n  isInitialized: boolean;\n  needsCompanySetup: boolean;\n  needsAdminSetup: boolean;\n  stats: { companyCount: number; userCount: number };\n}\n\nfunction SetupLocked() {\n  const [, setLocation] = useLocation();\n\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      setLocation(\"/login\");\n    }, 3000);\n    return () => clearTimeout(timer);\n  }, [setLocation]);\n\n  return (\n    <div className=\"flex items-center justify-center min-h-screen bg-background\">\n      <div className=\"text-center max-w-md p-8\">\n        <div className=\"w-16 h-16 mx-auto mb-6 rounded-full bg-muted flex items-center justify-center\">\n          <Lock className=\"w-8 h-8 text-muted-foreground\" />\n        </div>\n        <h1 className=\"text-2xl font-bold mb-2\">Setup Complete</h1>\n        <p className=\"text-muted-foreground mb-4\">\n          The system has already been initialized. You will be redirected to the login page.\n        </p>\n        <p className=\"text-sm text-muted-foreground\">\n          Redirecting in 3 seconds...\n        </p>\n      </div>\n    </div>\n  );\n}\n\nfunction SetupRouter({ status }: { status: SetupStatus }) {\n  const [location] = useLocation();\n\n  if (status.isInitialized && !status.needsAdminSetup) {\n    return <SetupLocked />;\n  }\n\n  if (status.needsCompanySetup) {\n    if (location !== \"/setup/company\" && location !== \"/setup\") {\n      return <Redirect to=\"/setup/company\" />;\n    }\n  } else if (status.needsAdminSetup) {\n    if (location !== \"/setup/admin-user\") {\n      return <Redirect to=\"/setup/admin-user\" />;\n    }\n  }\n\n  return (\n    <Switch>\n      <Route path=\"/setup/company\" component={SetupCompany} />\n      <Route path=\"/setup/admin-user\" component={SetupAdminUser} />\n      <Route path=\"/setup\">\n        {status.needsCompanySetup ? (\n          <Redirect to=\"/setup/company\" />\n        ) : status.needsAdminSetup ? (\n          <Redirect to=\"/setup/admin-user\" />\n        ) : (\n          <SetupLocked />\n        )}\n      </Route>\n    </Switch>\n  );\n}\n\nexport function Setup() {\n  const { data: setupStatus, isLoading: statusLoading } = useQuery<SetupStatus>({\n    queryKey: [\"/api/setup/status\"],\n    retry: false,\n    refetchOnWindowFocus: false,\n  });\n\n  if (statusLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen bg-background\">\n        <div className=\"text-center\">\n          <Loader2 className=\"w-8 h-8 animate-spin mx-auto mb-4 text-primary\" />\n          <p className=\"text-muted-foreground\">Checking system status...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!setupStatus) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen bg-background\">\n        <div className=\"text-center\">\n          <Building2 className=\"w-12 h-12 mx-auto mb-4 text-muted-foreground\" />\n          <h1 className=\"text-xl font-semibold mb-2\">Unable to check system status</h1>\n          <p className=\"text-muted-foreground\">Please refresh the page to try again.</p>\n        </div>\n      </div>\n    );\n  }\n\n  return <SetupRouter status={setupStatus} />;\n}\n","path":null,"size_bytes":3376,"size_tokens":null},"client/src/components/examples/PageHeader.tsx":{"content":"import { PageHeader } from \"../layout/PageHeader\";\nimport { Button } from \"@/components/ui/button\";\nimport { Plus, Download } from \"lucide-react\";\n\nexport default function PageHeaderExample() {\n  return (\n    <PageHeader \n      title=\"Sales Orders\" \n      description=\"Manage and track all sales orders\"\n      actions={\n        <>\n          <Button variant=\"outline\" data-testid=\"button-export\">\n            <Download className=\"h-4 w-4 mr-2\" />\n            Export\n          </Button>\n          <Button data-testid=\"button-new-order\">\n            <Plus className=\"h-4 w-4 mr-2\" />\n            New Order\n          </Button>\n        </>\n      }\n    />\n  );\n}\n","path":null,"size_bytes":657,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1080,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"client/src/components/examples/JournalEntries.tsx":{"content":"import { JournalEntries } from \"../financials/JournalEntries\";\n\nexport default function JournalEntriesExample() {\n  return <JournalEntries />;\n}\n","path":null,"size_bytes":145,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":547,"size_tokens":null},"client/src/components/layout/ThemeToggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useTheme } from \"@/contexts/ThemeContext\";\n\nexport function ThemeToggle() {\n  const { theme, toggleTheme } = useTheme();\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={toggleTheme}\n      data-testid=\"button-theme-toggle\"\n    >\n      {theme === \"light\" ? (\n        <Moon className=\"h-4 w-4\" />\n      ) : (\n        <Sun className=\"h-4 w-4\" />\n      )}\n    </Button>\n  );\n}\n","path":null,"size_bytes":503,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/components/hr/LeaveRequests.tsx":{"content":"import { useState } from \"react\";\nimport { DataTable, type Column } from \"@/components/layout/DataTable\";\nimport { StatusBadge } from \"@/components/layout/StatusBadge\";\nimport { PageHeader } from \"@/components/layout/PageHeader\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Plus, Download, CheckCircle, XCircle } from \"lucide-react\";\nimport { mockLeaveRequests, mockEmployees } from \"@/lib/mockData\";\n\ntype LeaveRequest = typeof mockLeaveRequests[0];\n\nexport function LeaveRequests() {\n  const [requests, setRequests] = useState(mockLeaveRequests);\n  const [isFormOpen, setIsFormOpen] = useState(false);\n\n  const [formData, setFormData] = useState({\n    employeeId: \"\",\n    type: \"vacation\",\n    startDate: \"\",\n    endDate: \"\",\n    reason: \"\",\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    const employee = mockEmployees.find(e => e.id === formData.employeeId);\n    const start = new Date(formData.startDate);\n    const end = new Date(formData.endDate);\n    const days = Math.ceil((end.getTime() - start.getTime()) / (1000 * 60 * 60 * 24)) + 1;\n    \n    // todo: remove mock functionality\n    const newRequest: LeaveRequest = {\n      id: `LR-${String(requests.length + 1).padStart(3, \"0\")}`,\n      employeeId: formData.employeeId,\n      employeeName: employee?.name || \"\",\n      type: formData.type as \"vacation\" | \"sick\" | \"personal\",\n      startDate: formData.startDate,\n      endDate: formData.endDate,\n      status: \"pending\",\n      days,\n    };\n    setRequests([newRequest, ...requests]);\n    console.log(\"Created leave request:\", newRequest);\n    setIsFormOpen(false);\n    setFormData({ employeeId: \"\", type: \"vacation\", startDate: \"\", endDate: \"\", reason: \"\" });\n  };\n\n  const handleApprove = (requestId: string) => {\n    setRequests(requests.map(r => \n      r.id === requestId ? { ...r, status: \"approved\" } : r\n    ));\n    console.log(\"Approved leave request:\", requestId);\n  };\n\n  const handleReject = (requestId: string) => {\n    setRequests(requests.map(r => \n      r.id === requestId ? { ...r, status: \"rejected\" } : r\n    ));\n    console.log(\"Rejected leave request:\", requestId);\n  };\n\n  const columns: Column<LeaveRequest>[] = [\n    { key: \"id\", header: \"Request #\", sortable: true },\n    { key: \"employeeName\", header: \"Employee\", sortable: true },\n    { \n      key: \"type\", \n      header: \"Type\",\n      render: (item) => <StatusBadge status={item.type} />\n    },\n    { key: \"startDate\", header: \"Start Date\", sortable: true },\n    { key: \"endDate\", header: \"End Date\", sortable: true },\n    { key: \"days\", header: \"Days\", className: \"text-center\" },\n    { \n      key: \"status\", \n      header: \"Status\",\n      render: (item) => <StatusBadge status={item.status as \"pending\" | \"approved\" | \"rejected\"} />\n    },\n    {\n      key: \"actions\",\n      header: \"\",\n      className: \"text-right\",\n      render: (item) => (\n        <div className=\"flex justify-end gap-1\" onClick={(e) => e.stopPropagation()}>\n          {item.status === \"pending\" && (\n            <>\n              <Button \n                variant=\"ghost\" \n                size=\"icon\"\n                onClick={() => handleApprove(item.id)}\n                className=\"text-green-600 hover:text-green-700\"\n                data-testid={`button-approve-${item.id}`}\n              >\n                <CheckCircle className=\"h-4 w-4\" />\n              </Button>\n              <Button \n                variant=\"ghost\" \n                size=\"icon\"\n                onClick={() => handleReject(item.id)}\n                className=\"text-red-600 hover:text-red-700\"\n                data-testid={`button-reject-${item.id}`}\n              >\n                <XCircle className=\"h-4 w-4\" />\n              </Button>\n            </>\n          )}\n        </div>\n      ),\n    },\n  ];\n\n  return (\n    <div>\n      <PageHeader\n        title=\"Leave Requests\"\n        description=\"Manage employee leave requests\"\n        actions={\n          <>\n            <Button variant=\"outline\" data-testid=\"button-export\">\n              <Download className=\"h-4 w-4 mr-2\" />\n              Export\n            </Button>\n            <Button onClick={() => setIsFormOpen(true)} data-testid=\"button-new-request\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Request\n            </Button>\n          </>\n        }\n      />\n\n      <DataTable\n        data={requests}\n        columns={columns}\n        searchKey=\"employeeName\"\n        searchPlaceholder=\"Search requests...\"\n      />\n\n      <Dialog open={isFormOpen} onOpenChange={setIsFormOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>New Leave Request</DialogTitle>\n          </DialogHeader>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"employee\">Employee *</Label>\n              <Select\n                value={formData.employeeId}\n                onValueChange={(value) => setFormData({ ...formData, employeeId: value })}\n              >\n                <SelectTrigger data-testid=\"select-employee\">\n                  <SelectValue placeholder=\"Select employee\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {mockEmployees.map((emp) => (\n                    <SelectItem key={emp.id} value={emp.id}>\n                      {emp.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"type\">Leave Type *</Label>\n              <Select\n                value={formData.type}\n                onValueChange={(value) => setFormData({ ...formData, type: value })}\n              >\n                <SelectTrigger data-testid=\"select-type\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"vacation\">Vacation</SelectItem>\n                  <SelectItem value=\"sick\">Sick Leave</SelectItem>\n                  <SelectItem value=\"personal\">Personal</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"startDate\">Start Date *</Label>\n                <Input\n                  id=\"startDate\"\n                  type=\"date\"\n                  value={formData.startDate}\n                  onChange={(e) => setFormData({ ...formData, startDate: e.target.value })}\n                  required\n                  data-testid=\"input-start-date\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"endDate\">End Date *</Label>\n                <Input\n                  id=\"endDate\"\n                  type=\"date\"\n                  value={formData.endDate}\n                  onChange={(e) => setFormData({ ...formData, endDate: e.target.value })}\n                  required\n                  data-testid=\"input-end-date\"\n                />\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"reason\">Reason</Label>\n              <Textarea\n                id=\"reason\"\n                value={formData.reason}\n                onChange={(e) => setFormData({ ...formData, reason: e.target.value })}\n                rows={2}\n                data-testid=\"textarea-reason\"\n              />\n            </div>\n            <div className=\"flex justify-end gap-2 pt-4\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => setIsFormOpen(false)} data-testid=\"button-cancel\">\n                Cancel\n              </Button>\n              <Button \n                type=\"submit\" \n                disabled={!formData.employeeId || !formData.startDate || !formData.endDate}\n                data-testid=\"button-submit\"\n              >\n                Submit Request\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":8465,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/components/reports/SalesReports.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Users,\n  TrendingUp,\n  TrendingDown,\n  Target,\n  Award,\n  BarChart3,\n  ArrowRight,\n  Clock,\n  CheckCircle,\n  XCircle,\n} from \"lucide-react\";\nimport {\n  mockSalespersonPerformance,\n  mockCustomerRanking,\n  mockSalesForecast,\n  mockSalesPipeline,\n  mockOrderFulfillment,\n} from \"@/lib/reportData\";\nimport { cn } from \"@/lib/utils\";\n\nexport function SalesReports() {\n  const [activeTab, setActiveTab] = useState(\"performance\");\n\n  const totalQuota = mockSalespersonPerformance.reduce((sum, sp) => sum + sp.quota, 0);\n  const totalAchieved = mockSalespersonPerformance.reduce((sum, sp) => sum + sp.achieved, 0);\n  const overallAttainment = (totalAchieved / totalQuota) * 100;\n\n  return (\n    <div className=\"space-y-6\">\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList className=\"grid grid-cols-5 w-full max-w-3xl\">\n          <TabsTrigger value=\"performance\" data-testid=\"tab-performance\">Performance</TabsTrigger>\n          <TabsTrigger value=\"customers\" data-testid=\"tab-customers\">Customers</TabsTrigger>\n          <TabsTrigger value=\"forecast\" data-testid=\"tab-forecast\">Forecast</TabsTrigger>\n          <TabsTrigger value=\"pipeline\" data-testid=\"tab-pipeline\">Pipeline</TabsTrigger>\n          <TabsTrigger value=\"fulfillment\" data-testid=\"tab-fulfillment\">Fulfillment</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"performance\" className=\"space-y-6 mt-6\">\n          <div className=\"grid md:grid-cols-4 gap-4\">\n            <Card data-testid=\"card-total-quota\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm text-muted-foreground\">Total Quota</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-2xl font-semibold\" data-testid=\"text-total-quota\">${totalQuota.toLocaleString()}</p>\n              </CardContent>\n            </Card>\n            <Card data-testid=\"card-total-achieved\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm text-muted-foreground\">Total Achieved</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-2xl font-semibold text-green-600 dark:text-green-400\" data-testid=\"text-total-achieved\">\n                  ${totalAchieved.toLocaleString()}\n                </p>\n              </CardContent>\n            </Card>\n            <Card data-testid=\"card-attainment\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm text-muted-foreground\">Attainment</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className={cn(\n                  \"text-2xl font-semibold\",\n                  overallAttainment >= 100 ? \"text-green-600 dark:text-green-400\" : \"text-amber-600 dark:text-amber-400\"\n                )} data-testid=\"text-attainment\">\n                  {overallAttainment.toFixed(1)}%\n                </p>\n              </CardContent>\n            </Card>\n            <Card data-testid=\"card-win-rate\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm text-muted-foreground\">Avg Win Rate</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-2xl font-semibold\" data-testid=\"text-win-rate\">\n                  {(mockSalespersonPerformance.reduce((sum, sp) => sum + sp.winRate, 0) / mockSalespersonPerformance.length).toFixed(0)}%\n                </p>\n              </CardContent>\n            </Card>\n          </div>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Award className=\"h-5 w-5\" />\n                Salesperson Performance\n              </CardTitle>\n              <CardDescription>Quota attainment and key metrics by salesperson</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Salesperson</TableHead>\n                    <TableHead>Region</TableHead>\n                    <TableHead className=\"text-right\">Quota</TableHead>\n                    <TableHead className=\"text-right\">Achieved</TableHead>\n                    <TableHead className=\"text-center\">Attainment</TableHead>\n                    <TableHead className=\"text-center\">Orders</TableHead>\n                    <TableHead className=\"text-center\">Customers</TableHead>\n                    <TableHead className=\"text-right\">Avg Order</TableHead>\n                    <TableHead className=\"text-center\">Win Rate</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {mockSalespersonPerformance.map((sp) => {\n                    const attainment = (sp.achieved / sp.quota) * 100;\n                    return (\n                      <TableRow key={sp.id} data-testid={`row-salesperson-${sp.id}`}>\n                        <TableCell className=\"font-medium\">{sp.name}</TableCell>\n                        <TableCell>{sp.region}</TableCell>\n                        <TableCell className=\"text-right\">${sp.quota.toLocaleString()}</TableCell>\n                        <TableCell className=\"text-right\">${sp.achieved.toLocaleString()}</TableCell>\n                        <TableCell>\n                          <div className=\"flex items-center gap-2\">\n                            <Progress value={Math.min(attainment, 100)} className=\"h-2 w-16\" />\n                            <span className={cn(\n                              \"text-sm font-medium\",\n                              attainment >= 100 ? \"text-green-600\" : attainment >= 80 ? \"text-amber-600\" : \"text-red-600\"\n                            )}>\n                              {attainment.toFixed(0)}%\n                            </span>\n                          </div>\n                        </TableCell>\n                        <TableCell className=\"text-center\">{sp.orders}</TableCell>\n                        <TableCell className=\"text-center\">{sp.customers}</TableCell>\n                        <TableCell className=\"text-right\">${sp.avgOrderValue.toLocaleString()}</TableCell>\n                        <TableCell className=\"text-center\">\n                          <Badge variant={sp.winRate >= 70 ? \"default\" : \"secondary\"}>\n                            {sp.winRate}%\n                          </Badge>\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })}\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"customers\" className=\"space-y-6 mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Users className=\"h-5 w-5\" />\n                Customer Ranking by Revenue\n              </CardTitle>\n              <CardDescription>Top customers sorted by total revenue contribution</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Rank</TableHead>\n                    <TableHead>Customer</TableHead>\n                    <TableHead>Segment</TableHead>\n                    <TableHead className=\"text-right\">Revenue</TableHead>\n                    <TableHead className=\"text-center\">Orders</TableHead>\n                    <TableHead className=\"text-right\">Avg Order</TableHead>\n                    <TableHead>Last Order</TableHead>\n                    <TableHead className=\"text-center\">Growth</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {mockCustomerRanking\n                    .sort((a, b) => b.revenue - a.revenue)\n                    .map((customer, index) => (\n                      <TableRow key={customer.id} data-testid={`row-customer-${customer.id}`}>\n                        <TableCell>\n                          <Badge variant={index < 3 ? \"default\" : \"outline\"}>\n                            #{index + 1}\n                          </Badge>\n                        </TableCell>\n                        <TableCell className=\"font-medium\">{customer.name}</TableCell>\n                        <TableCell>\n                          <Badge variant=\"secondary\">{customer.segment}</Badge>\n                        </TableCell>\n                        <TableCell className=\"text-right font-semibold\">\n                          ${customer.revenue.toLocaleString()}\n                        </TableCell>\n                        <TableCell className=\"text-center\">{customer.orders}</TableCell>\n                        <TableCell className=\"text-right\">${customer.avgOrderValue.toLocaleString()}</TableCell>\n                        <TableCell>{customer.lastOrder}</TableCell>\n                        <TableCell className=\"text-center\">\n                          <div className={cn(\n                            \"flex items-center justify-center gap-1\",\n                            customer.growthRate >= 0 ? \"text-green-600\" : \"text-red-600\"\n                          )}>\n                            {customer.growthRate >= 0 ? (\n                              <TrendingUp className=\"h-4 w-4\" />\n                            ) : (\n                              <TrendingDown className=\"h-4 w-4\" />\n                            )}\n                            {Math.abs(customer.growthRate)}%\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"forecast\" className=\"space-y-6 mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <TrendingUp className=\"h-5 w-5\" />\n                Sales Forecast (6 Months)\n              </CardTitle>\n              <CardDescription>AI-powered sales predictions with confidence intervals</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                {mockSalesForecast.map((forecast, index) => (\n                  <div key={forecast.month} className=\"space-y-2\">\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"font-medium\">{forecast.month}</span>\n                      <div className=\"flex items-center gap-4\">\n                        <span className=\"text-sm text-muted-foreground\">\n                          Range: ${forecast.lowerBound.toLocaleString()} - ${forecast.upperBound.toLocaleString()}\n                        </span>\n                        <Badge variant=\"outline\">{forecast.confidence}% confidence</Badge>\n                      </div>\n                    </div>\n                    <div className=\"relative\">\n                      <div className=\"h-8 bg-muted rounded-md overflow-hidden relative\">\n                        <div\n                          className=\"absolute h-full bg-blue-200 dark:bg-blue-900/50\"\n                          style={{\n                            left: `${(forecast.lowerBound / forecast.upperBound) * 80}%`,\n                            width: `${((forecast.upperBound - forecast.lowerBound) / forecast.upperBound) * 80}%`,\n                          }}\n                        />\n                        <div\n                          className=\"absolute h-full w-1 bg-blue-600\"\n                          style={{ left: `${(forecast.predicted / forecast.upperBound) * 80}%` }}\n                        />\n                      </div>\n                      <div className=\"flex justify-between mt-1 text-sm\">\n                        <span className=\"text-muted-foreground\">$0</span>\n                        <span className=\"font-semibold text-blue-600\">${forecast.predicted.toLocaleString()}</span>\n                        <span className=\"text-muted-foreground\">${(forecast.upperBound * 1.25).toLocaleString()}</span>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"pipeline\" className=\"space-y-6 mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <BarChart3 className=\"h-5 w-5\" />\n                Sales Pipeline\n              </CardTitle>\n              <CardDescription>Lead to order conversion funnel</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                {mockSalesPipeline.map((stage, index) => {\n                  const maxValue = mockSalesPipeline[0].value;\n                  const width = (stage.value / maxValue) * 100;\n                  const isLast = index === mockSalesPipeline.length - 1;\n\n                  return (\n                    <div key={stage.stage} className=\"space-y-2\">\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"font-medium\">{stage.stage}</span>\n                          <Badge variant=\"secondary\">{stage.count} opportunities</Badge>\n                        </div>\n                        <div className=\"flex items-center gap-4\">\n                          <span className=\"font-semibold\">${stage.value.toLocaleString()}</span>\n                          {!isLast && (\n                            <div className=\"flex items-center gap-1 text-sm text-muted-foreground\">\n                              <ArrowRight className=\"h-4 w-4\" />\n                              <span>{stage.conversionRate}%</span>\n                            </div>\n                          )}\n                        </div>\n                      </div>\n                      <div className=\"h-10 bg-muted rounded-md overflow-hidden\">\n                        <div\n                          className={cn(\n                            \"h-full flex items-center justify-center text-white font-medium transition-all\",\n                            isLast ? \"bg-green-600\" : \"bg-blue-600\"\n                          )}\n                          style={{ width: `${width}%` }}\n                        >\n                          {width > 20 && `$${stage.value.toLocaleString()}`}\n                        </div>\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n\n              <div className=\"mt-8 grid md:grid-cols-3 gap-4\">\n                <div className=\"p-4 border rounded-md\">\n                  <p className=\"text-sm text-muted-foreground\">Total Pipeline Value</p>\n                  <p className=\"text-2xl font-semibold\">\n                    ${mockSalesPipeline.reduce((sum, s) => sum + s.value, 0).toLocaleString()}\n                  </p>\n                </div>\n                <div className=\"p-4 border rounded-md\">\n                  <p className=\"text-sm text-muted-foreground\">Weighted Pipeline</p>\n                  <p className=\"text-2xl font-semibold\">\n                    ${mockSalesPipeline.reduce((sum, s) => sum + (s.value * s.conversionRate / 100), 0).toLocaleString()}\n                  </p>\n                </div>\n                <div className=\"p-4 border rounded-md\">\n                  <p className=\"text-sm text-muted-foreground\">Overall Conversion</p>\n                  <p className=\"text-2xl font-semibold\">\n                    {((mockSalesPipeline[4].count / mockSalesPipeline[0].count) * 100).toFixed(1)}%\n                  </p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"fulfillment\" className=\"space-y-6 mt-6\">\n          <div className=\"grid md:grid-cols-3 gap-4\">\n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm text-muted-foreground\">Avg Fulfillment Rate</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-2xl font-semibold text-green-600 dark:text-green-400\">\n                  {(mockOrderFulfillment.reduce((sum, m) => sum + m.fulfillmentRate, 0) / mockOrderFulfillment.length).toFixed(1)}%\n                </p>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm text-muted-foreground\">Total Orders (6 mo)</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-2xl font-semibold\">\n                  {mockOrderFulfillment.reduce((sum, m) => sum + m.totalOrders, 0).toLocaleString()}\n                </p>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm text-muted-foreground\">Late Deliveries</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-2xl font-semibold text-amber-600 dark:text-amber-400\">\n                  {mockOrderFulfillment.reduce((sum, m) => sum + m.late, 0)}\n                </p>\n              </CardContent>\n            </Card>\n          </div>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Clock className=\"h-5 w-5\" />\n                Order Fulfillment Rate\n              </CardTitle>\n              <CardDescription>Monthly delivery performance metrics</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Month</TableHead>\n                    <TableHead className=\"text-center\">Total Orders</TableHead>\n                    <TableHead className=\"text-center\">\n                      <div className=\"flex items-center justify-center gap-1\">\n                        <CheckCircle className=\"h-4 w-4 text-green-600\" />\n                        On Time\n                      </div>\n                    </TableHead>\n                    <TableHead className=\"text-center\">\n                      <div className=\"flex items-center justify-center gap-1\">\n                        <Clock className=\"h-4 w-4 text-amber-600\" />\n                        Late\n                      </div>\n                    </TableHead>\n                    <TableHead className=\"text-center\">\n                      <div className=\"flex items-center justify-center gap-1\">\n                        <XCircle className=\"h-4 w-4 text-red-600\" />\n                        Cancelled\n                      </div>\n                    </TableHead>\n                    <TableHead className=\"text-center\">Fulfillment Rate</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {mockOrderFulfillment.map((month) => (\n                    <TableRow key={month.month}>\n                      <TableCell className=\"font-medium\">{month.month}</TableCell>\n                      <TableCell className=\"text-center\">{month.totalOrders}</TableCell>\n                      <TableCell className=\"text-center text-green-600\">{month.onTime}</TableCell>\n                      <TableCell className=\"text-center text-amber-600\">{month.late}</TableCell>\n                      <TableCell className=\"text-center text-red-600\">{month.cancelled}</TableCell>\n                      <TableCell className=\"text-center\">\n                        <div className=\"flex items-center justify-center gap-2\">\n                          <Progress value={month.fulfillmentRate} className=\"h-2 w-16\" />\n                          <span className={cn(\n                            \"font-medium\",\n                            month.fulfillmentRate >= 95 ? \"text-green-600\" : \"text-amber-600\"\n                          )}>\n                            {month.fulfillmentRate}%\n                          </span>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":20908,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/src/components/examples/ThemeToggle.tsx":{"content":"import { ThemeProvider } from \"@/contexts/ThemeContext\";\nimport { ThemeToggle } from \"../layout/ThemeToggle\";\n\nexport default function ThemeToggleExample() {\n  return (\n    <ThemeProvider>\n      <ThemeToggle />\n    </ThemeProvider>\n  );\n}\n","path":null,"size_bytes":239,"size_tokens":null},"client/src/components/sales/InvoiceList.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { DataTable, type Column } from \"@/components/layout/DataTable\";\nimport { StatusBadge } from \"@/components/layout/StatusBadge\";\nimport { PageHeader } from \"@/components/layout/PageHeader\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Download, Eye, DollarSign, Printer, Loader2 } from \"lucide-react\";\nimport { useCompany } from \"@/contexts/CompanyContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { exportToCSV } from \"@/lib/export\";\nimport type { Invoice, Customer } from \"@shared/schema\";\n\ninterface InvoiceDisplay extends Invoice {\n  customerName: string;\n}\n\nexport function InvoiceList() {\n  const { activeCompany } = useCompany();\n  const { toast } = useToast();\n  const [selectedInvoice, setSelectedInvoice] = useState<InvoiceDisplay | null>(null);\n  const [isDetailOpen, setIsDetailOpen] = useState(false);\n  const [isPaymentOpen, setIsPaymentOpen] = useState(false);\n  const [paymentAmount, setPaymentAmount] = useState(\"\");\n\n  const { data: invoices = [], isLoading } = useQuery<Invoice[]>({\n    queryKey: [\"/api/companies\", activeCompany?.id, \"invoices\"],\n    enabled: !!activeCompany?.id,\n  });\n\n  const { data: customers = [] } = useQuery<Customer[]>({\n    queryKey: [\"/api/companies\", activeCompany?.id, \"customers\"],\n    enabled: !!activeCompany?.id,\n  });\n\n  // Filter for customer (AR) invoices - backend uses \"customer\" type\n  const invoicesWithCustomers: InvoiceDisplay[] = invoices\n    .filter(inv => inv.invoiceType === \"customer\")\n    .map(invoice => ({\n      ...invoice,\n      customerName: customers.find(c => c.id === invoice.customerId)?.name || \"Unknown Customer\",\n    }));\n\n  // Workflow mutation: Receive customer payment\n  const receivePaymentMutation = useMutation({\n    mutationFn: async ({ customerId, invoiceIds, amount }: { customerId: string; invoiceIds: string[]; amount: number }) => {\n      const response = await apiRequest(\"POST\", `/api/companies/${activeCompany?.id}/payments/receive`, {\n        customerId,\n        invoiceIds,\n        amount,\n        paymentMethod: \"bank_transfer\",\n      });\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"invoices\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"ar-ledger\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"payments\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"journal-entries\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"sales-orders\"] });\n      toast({ \n        title: \"Payment Received\", \n        description: `Payment ${data.payment?.paymentNumber || ''} recorded and AR updated` \n      });\n      setIsPaymentOpen(false);\n      setSelectedInvoice(null);\n      setPaymentAmount(\"\");\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Failed to record payment\", \n        description: error.message,\n        variant: \"destructive\" \n      });\n    },\n  });\n\n  const handleViewInvoice = (invoice: InvoiceDisplay) => {\n    setSelectedInvoice(invoice);\n    setIsDetailOpen(true);\n  };\n\n  const handleOpenPayment = (invoice: InvoiceDisplay) => {\n    setSelectedInvoice(invoice);\n    // Normalize to string since schema may return numbers\n    const balance = invoice.amountDue ?? invoice.total ?? 0;\n    setPaymentAmount(String(balance));\n    setIsPaymentOpen(true);\n  };\n\n  const handleRecordPayment = () => {\n    if (!selectedInvoice || !paymentAmount) return;\n    if (!selectedInvoice.customerId) {\n      toast({ \n        title: \"Cannot record payment\", \n        description: \"Invoice is missing customer information\",\n        variant: \"destructive\" \n      });\n      return;\n    }\n    const amount = parseFloat(paymentAmount);\n    if (isNaN(amount) || amount <= 0) {\n      toast({ \n        title: \"Invalid amount\", \n        description: \"Please enter a valid payment amount greater than zero\",\n        variant: \"destructive\" \n      });\n      return;\n    }\n    const balanceDue = Number(selectedInvoice.amountDue ?? selectedInvoice.total ?? 0);\n    if (amount > balanceDue) {\n      toast({ \n        title: \"Invalid amount\", \n        description: `Payment cannot exceed balance due (Rp ${balanceDue.toLocaleString()})`,\n        variant: \"destructive\" \n      });\n      return;\n    }\n    receivePaymentMutation.mutate({\n      customerId: selectedInvoice.customerId,\n      invoiceIds: [selectedInvoice.id],\n      amount,\n    });\n  };\n\n  const handlePrint = () => {\n    window.print();\n  };\n\n  const columns: Column<InvoiceDisplay>[] = [\n    { key: \"invoiceNumber\", header: \"Invoice #\", sortable: true },\n    { key: \"customerName\", header: \"Customer\", sortable: true },\n    { \n      key: \"invoiceDate\", \n      header: \"Date\", \n      sortable: true,\n      render: (item) => item.invoiceDate ? new Date(item.invoiceDate).toLocaleDateString() : \"-\"\n    },\n    { \n      key: \"dueDate\", \n      header: \"Due Date\", \n      sortable: true,\n      render: (item) => item.dueDate ? new Date(item.dueDate).toLocaleDateString() : \"-\"\n    },\n    { \n      key: \"status\", \n      header: \"Status\",\n      render: (item) => <StatusBadge status={item.status as \"paid\" | \"unpaid\" | \"partial\"} />\n    },\n    { \n      key: \"total\", \n      header: \"Total\", \n      sortable: true,\n      className: \"text-right\",\n      render: (item) => `Rp ${Number(item.total ?? 0).toLocaleString()}`\n    },\n    { \n      key: \"amountDue\", \n      header: \"Balance\", \n      sortable: true,\n      className: \"text-right\",\n      render: (item) => `Rp ${Number(item.amountDue ?? 0).toLocaleString()}`\n    },\n    {\n      key: \"actions\",\n      header: \"\",\n      className: \"text-right\",\n      render: (item) => (\n        <div className=\"flex justify-end gap-1\" onClick={(e) => e.stopPropagation()}>\n          {item.status !== \"paid\" && (\n            <Button \n              variant=\"ghost\" \n              size=\"icon\" \n              onClick={() => handleOpenPayment(item)}\n              disabled={receivePaymentMutation.isPending}\n              data-testid={`button-pay-${item.id}`}\n            >\n              <DollarSign className=\"h-4 w-4\" />\n            </Button>\n          )}\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => handleViewInvoice(item)} data-testid={`button-view-${item.id}`}>\n            <Eye className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      ),\n    },\n  ];\n\n  const handleExport = () => {\n    if (invoicesWithCustomers.length === 0) {\n      toast({ title: \"No data to export\", variant: \"destructive\" });\n      return;\n    }\n    exportToCSV(\n      invoicesWithCustomers.map(inv => ({\n        invoiceNumber: inv.invoiceNumber,\n        customer: inv.customerName,\n        invoiceDate: new Date(inv.invoiceDate).toLocaleDateString(\"id-ID\"),\n        dueDate: inv.dueDate ? new Date(inv.dueDate).toLocaleDateString(\"id-ID\") : \"\",\n        subtotal: inv.subtotal,\n        tax: inv.taxAmount,\n        total: inv.total,\n        paid: inv.amountPaid,\n        status: inv.status\n      })),\n      [\n        { key: \"invoiceNumber\", label: \"Invoice Number\" },\n        { key: \"customer\", label: \"Customer\" },\n        { key: \"invoiceDate\", label: \"Invoice Date\" },\n        { key: \"dueDate\", label: \"Due Date\" },\n        { key: \"subtotal\", label: \"Subtotal (IDR)\" },\n        { key: \"tax\", label: \"Tax (IDR)\" },\n        { key: \"total\", label: \"Total (IDR)\" },\n        { key: \"paid\", label: \"Amount Paid (IDR)\" },\n        { key: \"status\", label: \"Status\" }\n      ],\n      \"invoices\"\n    );\n    toast({ title: \"Invoices exported successfully\" });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <PageHeader\n        title=\"Sales Invoices\"\n        description=\"Manage customer invoices and payments\"\n        actions={\n          <Button variant=\"outline\" onClick={handleExport} data-testid=\"button-export\">\n            <Download className=\"h-4 w-4 mr-2\" />\n            Export\n          </Button>\n        }\n      />\n\n      <DataTable\n        data={invoicesWithCustomers}\n        columns={columns}\n        searchKey=\"customerName\"\n        searchPlaceholder=\"Search invoices...\"\n        onRowClick={handleViewInvoice}\n      />\n\n      {/* Payment Dialog */}\n      <Dialog open={isPaymentOpen} onOpenChange={setIsPaymentOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Record Payment</DialogTitle>\n            <DialogDescription>\n              Record payment for invoice {selectedInvoice?.invoiceNumber}\n            </DialogDescription>\n          </DialogHeader>\n          {selectedInvoice && (\n            <div className=\"space-y-4\">\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-muted-foreground\">Customer:</span>\n                <span>{selectedInvoice.customerName}</span>\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-muted-foreground\">Invoice Total:</span>\n                <span>Rp {Number(selectedInvoice.total ?? 0).toLocaleString()}</span>\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-muted-foreground\">Balance Due:</span>\n                <span className=\"font-semibold\">Rp {Number(selectedInvoice.amountDue ?? 0).toLocaleString()}</span>\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"amount\">Payment Amount</Label>\n                <Input\n                  id=\"amount\"\n                  type=\"number\"\n                  value={paymentAmount}\n                  onChange={(e) => setPaymentAmount(e.target.value)}\n                  placeholder=\"Enter payment amount\"\n                  data-testid=\"input-payment-amount\"\n                />\n              </div>\n              <div className=\"flex justify-end gap-2\">\n                <Button variant=\"outline\" onClick={() => setIsPaymentOpen(false)}>\n                  Cancel\n                </Button>\n                <Button \n                  onClick={handleRecordPayment} \n                  disabled={receivePaymentMutation.isPending || !paymentAmount}\n                  data-testid=\"button-confirm-payment\"\n                >\n                  {receivePaymentMutation.isPending ? (\n                    <>\n                      <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      Processing...\n                    </>\n                  ) : (\n                    <>\n                      <DollarSign className=\"h-4 w-4 mr-2\" />\n                      Record Payment\n                    </>\n                  )}\n                </Button>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* Invoice Detail Dialog */}\n      <Dialog open={isDetailOpen} onOpenChange={setIsDetailOpen}>\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Invoice Preview</DialogTitle>\n          </DialogHeader>\n          {selectedInvoice && (\n            <div className=\"space-y-6\">\n              <Card className=\"print:shadow-none\">\n                <CardContent className=\"p-8\">\n                  <div className=\"flex justify-between items-start mb-8\">\n                    <div>\n                      <div className=\"flex items-center gap-2 mb-2\">\n                        <div className=\"flex items-center justify-center w-10 h-10 rounded-md bg-primary text-primary-foreground font-bold text-xl\">\n                          U\n                        </div>\n                        <span className=\"font-bold text-xl\">Unanza</span>\n                      </div>\n                      <p className=\"text-sm text-muted-foreground\">\n                        Enterprise Resource Planning\n                      </p>\n                    </div>\n                    <div className=\"text-right\">\n                      <h2 className=\"text-2xl font-bold\" data-testid=\"text-invoice-number\">{selectedInvoice.invoiceNumber}</h2>\n                      <StatusBadge status={selectedInvoice.status as \"paid\" | \"unpaid\" | \"partial\"} className=\"mt-2\" />\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-2 gap-8 mb-8\">\n                    <div>\n                      <h3 className=\"text-sm font-medium text-muted-foreground mb-1\">Bill To</h3>\n                      <p className=\"font-medium\">{selectedInvoice.customerName}</p>\n                    </div>\n                    <div className=\"text-right\">\n                      <div className=\"space-y-1 text-sm\">\n                        <div className=\"flex justify-between gap-4\">\n                          <span className=\"text-muted-foreground\">Invoice Date:</span>\n                          <span>{selectedInvoice.invoiceDate ? new Date(selectedInvoice.invoiceDate).toLocaleDateString() : \"-\"}</span>\n                        </div>\n                        <div className=\"flex justify-between gap-4\">\n                          <span className=\"text-muted-foreground\">Due Date:</span>\n                          <span>{selectedInvoice.dueDate ? new Date(selectedInvoice.dueDate).toLocaleDateString() : \"-\"}</span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"border-t pt-4 space-y-2\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Subtotal</span>\n                      <span>Rp {Number(selectedInvoice.subtotal ?? 0).toLocaleString()}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Tax</span>\n                      <span>Rp {Number(selectedInvoice.taxAmount ?? 0).toLocaleString()}</span>\n                    </div>\n                    <div className=\"flex justify-between font-semibold text-lg pt-2 border-t\">\n                      <span>Total</span>\n                      <span data-testid=\"text-invoice-total\">Rp {Number(selectedInvoice.total ?? 0).toLocaleString()}</span>\n                    </div>\n                    {selectedInvoice.status !== \"paid\" && (\n                      <div className=\"flex justify-between font-semibold text-destructive\">\n                        <span>Balance Due</span>\n                        <span>Rp {Number(selectedInvoice.amountDue ?? 0).toLocaleString()}</span>\n                      </div>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n\n              <div className=\"flex justify-between print:hidden\">\n                {selectedInvoice.status !== \"paid\" && (\n                  <Button onClick={() => { setIsDetailOpen(false); handleOpenPayment(selectedInvoice); }}>\n                    <DollarSign className=\"h-4 w-4 mr-2\" />\n                    Record Payment\n                  </Button>\n                )}\n                <div className=\"flex gap-2\">\n                  <Button variant=\"outline\" onClick={handlePrint}>\n                    <Printer className=\"h-4 w-4 mr-2\" />\n                    Print\n                  </Button>\n                  <Button variant=\"outline\" onClick={() => setIsDetailOpen(false)}>\n                    Close\n                  </Button>\n                </div>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":16123,"size_tokens":null},"client/src/components/financials/AccountsReceivable.tsx":{"content":"import { useState } from \"react\";\nimport { DataTable, type Column } from \"@/components/layout/DataTable\";\nimport { StatusBadge } from \"@/components/layout/StatusBadge\";\nimport { PageHeader } from \"@/components/layout/PageHeader\";\nimport { StatCard } from \"@/components/layout/StatCard\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Download, DollarSign, Clock, AlertTriangle, CheckCircle } from \"lucide-react\";\nimport { mockInvoices } from \"@/lib/mockData\";\n\ntype Invoice = typeof mockInvoices[0];\n\n// todo: remove mock functionality\nconst agingData = [\n  { range: \"Current (0-30)\", amount: 2340.00, count: 1 },\n  { range: \"31-60 Days\", amount: 4750.00, count: 2 },\n  { range: \"61-90 Days\", amount: 0, count: 0 },\n  { range: \"Over 90 Days\", amount: 8900.00, count: 1 },\n];\n\nexport function AccountsReceivable() {\n  const [invoices] = useState(mockInvoices);\n\n  const totalReceivable = invoices.reduce((sum, inv) => {\n    if (inv.status === \"paid\") return sum;\n    if (inv.status === \"partial\") return sum + (inv.total - ((inv as Invoice & { paid?: number }).paid || 0));\n    return sum + inv.total;\n  }, 0);\n\n  const overdueAmount = agingData.slice(1).reduce((sum, a) => sum + a.amount, 0);\n  const currentAmount = agingData[0].amount;\n\n  const handleRecordPayment = (invoiceId: string) => {\n    console.log(\"Record payment for:\", invoiceId);\n  };\n\n  const columns: Column<Invoice>[] = [\n    { key: \"id\", header: \"Invoice #\", sortable: true },\n    { key: \"customerName\", header: \"Customer\", sortable: true },\n    { key: \"date\", header: \"Invoice Date\", sortable: true },\n    { key: \"dueDate\", header: \"Due Date\", sortable: true },\n    { \n      key: \"status\", \n      header: \"Status\",\n      render: (item) => <StatusBadge status={item.status as \"paid\" | \"unpaid\" | \"partial\"} />\n    },\n    { \n      key: \"total\", \n      header: \"Amount\", \n      sortable: true,\n      className: \"text-right\",\n      render: (item) => `$${item.total.toLocaleString()}`\n    },\n    {\n      key: \"actions\",\n      header: \"\",\n      className: \"text-right\",\n      render: (item) => (\n        <div className=\"flex justify-end gap-1\" onClick={(e) => e.stopPropagation()}>\n          {item.status !== \"paid\" && (\n            <Button \n              variant=\"ghost\" \n              size=\"sm\" \n              onClick={() => handleRecordPayment(item.id)}\n              data-testid={`button-pay-${item.id}`}\n            >\n              <DollarSign className=\"h-4 w-4 mr-1\" />\n              Payment\n            </Button>\n          )}\n        </div>\n      ),\n    },\n  ];\n\n  return (\n    <div>\n      <PageHeader\n        title=\"Accounts Receivable\"\n        description=\"Track customer invoices and payments\"\n        actions={\n          <Button variant=\"outline\" data-testid=\"button-export\">\n            <Download className=\"h-4 w-4 mr-2\" />\n            Export\n          </Button>\n        }\n      />\n\n      <div className=\"grid md:grid-cols-4 gap-4 mb-6\">\n        <StatCard\n          title=\"Total Receivable\"\n          value={totalReceivable}\n          icon={DollarSign}\n        />\n        <StatCard\n          title=\"Current\"\n          value={currentAmount}\n          icon={CheckCircle}\n        />\n        <StatCard\n          title=\"Overdue\"\n          value={overdueAmount}\n          icon={AlertTriangle}\n        />\n        <StatCard\n          title=\"Avg Days Outstanding\"\n          value=\"32\"\n          icon={Clock}\n          subtitle=\"days\"\n        />\n      </div>\n\n      <div className=\"grid md:grid-cols-3 gap-6 mb-6\">\n        <Card className=\"md:col-span-2\">\n          <CardHeader>\n            <CardTitle className=\"text-base\">Aging Report</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              {agingData.map((item, index) => (\n                <div key={index} className=\"flex items-center justify-between p-3 border rounded-md\">\n                  <div>\n                    <p className=\"font-medium\">{item.range}</p>\n                    <p className=\"text-sm text-muted-foreground\">{item.count} invoice(s)</p>\n                  </div>\n                  <p className=\"font-semibold\">${item.amount.toLocaleString()}</p>\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-base\">Collection Summary</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-muted-foreground\">Invoiced This Month</span>\n              <span className=\"font-semibold\">$15,689.50</span>\n            </div>\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-muted-foreground\">Collected This Month</span>\n              <span className=\"font-semibold text-green-600\">$9,234.00</span>\n            </div>\n            <div className=\"flex justify-between items-center pt-3 border-t\">\n              <span className=\"text-muted-foreground\">Collection Rate</span>\n              <span className=\"font-semibold\">58.9%</span>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <DataTable\n        data={invoices.filter(inv => inv.status !== \"paid\")}\n        columns={columns}\n        searchKey=\"customerName\"\n        searchPlaceholder=\"Search invoices...\"\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":5492,"size_tokens":null},"client/src/contexts/AuthContext.tsx":{"content":"import { createContext, useContext, useState, useCallback, useEffect, type ReactNode } from \"react\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { Company, Role } from \"@shared/schema\";\n\ninterface AuthUser {\n  id: string;\n  username: string;\n  email: string;\n  fullName: string | null;\n}\n\ninterface AuthState {\n  isAuthenticated: boolean;\n  isLoading: boolean;\n  user: AuthUser | null;\n  accessToken: string | null;\n  activeCompany: {\n    id: string;\n    code: string;\n    name: string;\n    companyType: string;\n    level: number;\n  } | null;\n  role: {\n    id: string;\n    name: string;\n    permissions: string[];\n  } | null;\n  allowedCompanyIds: string[];\n  companyLevel: number;\n  canConsolidate: boolean;\n  error: string | null;\n}\n\ninterface AuthActions {\n  login: (username: string, password: string, companyId?: string) => Promise<boolean>;\n  logout: () => Promise<void>;\n  refreshToken: () => Promise<boolean>;\n  switchCompany: (companyId: string) => Promise<boolean>;\n  hasPermission: (permission: string) => boolean;\n  canAccessCompany: (companyId: string) => boolean;\n  getAuthHeaders: () => Record<string, string>;\n}\n\ntype AuthContextValue = AuthState & AuthActions;\n\nconst AuthContext = createContext<AuthContextValue | null>(null);\n\nconst TOKEN_STORAGE_KEY = \"unanza_access_token\";\nconst TOKEN_EXPIRY_KEY = \"unanza_token_expiry\";\n\ninterface LoginResponse {\n  accessToken: string;\n  expiresIn: number;\n  user: AuthUser;\n  activeCompany: AuthState[\"activeCompany\"];\n  role: AuthState[\"role\"];\n  allowedCompanyIds: string[];\n  companyLevel: number;\n  canConsolidate: boolean;\n}\n\ninterface AuthProviderProps {\n  children: ReactNode;\n}\n\nexport function AuthProvider({ children }: AuthProviderProps) {\n  const queryClient = useQueryClient();\n  \n  const [state, setState] = useState<AuthState>(() => {\n    const storedToken = localStorage.getItem(TOKEN_STORAGE_KEY);\n    const storedExpiry = localStorage.getItem(TOKEN_EXPIRY_KEY);\n    const isExpired = storedExpiry ? Date.now() > parseInt(storedExpiry) : true;\n    \n    return {\n      isAuthenticated: !!(storedToken && !isExpired),\n      isLoading: !!(storedToken && !isExpired),\n      user: null,\n      accessToken: storedToken && !isExpired ? storedToken : null,\n      activeCompany: null,\n      role: null,\n      allowedCompanyIds: [],\n      companyLevel: 3,\n      canConsolidate: false,\n      error: null,\n    };\n  });\n\n  const storeTokens = useCallback((accessToken: string, expiresIn: number) => {\n    const expiryTime = Date.now() + expiresIn * 1000;\n    localStorage.setItem(TOKEN_STORAGE_KEY, accessToken);\n    localStorage.setItem(TOKEN_EXPIRY_KEY, expiryTime.toString());\n  }, []);\n\n  const clearTokens = useCallback(() => {\n    localStorage.removeItem(TOKEN_STORAGE_KEY);\n    localStorage.removeItem(TOKEN_EXPIRY_KEY);\n  }, []);\n\n  const updateStateFromResponse = useCallback((response: LoginResponse) => {\n    storeTokens(response.accessToken, response.expiresIn);\n    \n    setState(prev => ({\n      ...prev,\n      isAuthenticated: true,\n      isLoading: false,\n      user: response.user,\n      accessToken: response.accessToken,\n      activeCompany: response.activeCompany,\n      role: response.role,\n      allowedCompanyIds: response.allowedCompanyIds,\n      companyLevel: response.companyLevel,\n      canConsolidate: response.canConsolidate,\n      error: null,\n    }));\n  }, [storeTokens]);\n\n  const loginMutation = useMutation({\n    mutationFn: async ({ username, password, companyId }: { \n      username: string; \n      password: string; \n      companyId?: string;\n    }) => {\n      const response = await fetch(\"/api/auth/login\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify({ username, password, companyId }),\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Login failed\");\n      }\n      \n      return response.json() as Promise<LoginResponse>;\n    },\n    onSuccess: (data) => {\n      updateStateFromResponse(data);\n      queryClient.invalidateQueries();\n    },\n    onError: (error: Error) => {\n      clearTokens();\n      setState(prev => ({\n        ...prev,\n        isAuthenticated: false,\n        isLoading: false,\n        user: null,\n        accessToken: null,\n        activeCompany: null,\n        role: null,\n        allowedCompanyIds: [],\n        error: error.message,\n      }));\n    },\n  });\n\n  const logoutMutation = useMutation({\n    mutationFn: async () => {\n      await fetch(\"/api/auth/logout\", {\n        method: \"POST\",\n        credentials: \"include\",\n      });\n    },\n    onSettled: () => {\n      clearTokens();\n      setState({\n        isAuthenticated: false,\n        isLoading: false,\n        user: null,\n        accessToken: null,\n        activeCompany: null,\n        role: null,\n        allowedCompanyIds: [],\n        companyLevel: 3,\n        canConsolidate: false,\n        error: null,\n      });\n      queryClient.clear();\n    },\n  });\n\n  const refreshMutation = useMutation({\n    mutationFn: async () => {\n      const response = await fetch(\"/api/auth/refresh\", {\n        method: \"POST\",\n        credentials: \"include\",\n      });\n      \n      if (!response.ok) {\n        throw new Error(\"Token refresh failed\");\n      }\n      \n      return response.json() as Promise<LoginResponse>;\n    },\n    onSuccess: (data) => {\n      updateStateFromResponse(data);\n    },\n    onError: () => {\n      clearTokens();\n      setState(prev => ({\n        ...prev,\n        isAuthenticated: false,\n        isLoading: false,\n        user: null,\n        accessToken: null,\n        error: \"Session expired\",\n      }));\n    },\n  });\n\n  const switchCompanyMutation = useMutation({\n    mutationFn: async (companyId: string) => {\n      const response = await fetch(\"/api/auth/switch-company\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"Authorization\": `Bearer ${state.accessToken}`,\n        },\n        credentials: \"include\",\n        body: JSON.stringify({ companyId }),\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Company switch failed\");\n      }\n      \n      return response.json() as Promise<LoginResponse>;\n    },\n    onSuccess: (data) => {\n      updateStateFromResponse(data);\n      queryClient.invalidateQueries();\n    },\n    onError: (error: Error) => {\n      setState(prev => ({ ...prev, error: error.message }));\n    },\n  });\n\n  const fetchMe = useCallback(async () => {\n    if (!state.accessToken) return;\n    \n    try {\n      const response = await fetch(\"/api/auth/me\", {\n        headers: {\n          \"Authorization\": `Bearer ${state.accessToken}`,\n        },\n        credentials: \"include\",\n      });\n      \n      if (!response.ok) {\n        if (response.status === 401) {\n          await refreshMutation.mutateAsync();\n        }\n        return;\n      }\n      \n      const data = await response.json();\n      setState(prev => ({\n        ...prev,\n        isLoading: false,\n        user: data.user,\n        activeCompany: data.activeCompany,\n        role: data.role,\n        allowedCompanyIds: data.allowedCompanyIds,\n        companyLevel: data.companyLevel,\n        canConsolidate: data.canConsolidate,\n      }));\n    } catch (error) {\n      await refreshMutation.mutateAsync();\n    }\n  }, [state.accessToken, refreshMutation]);\n\n  useEffect(() => {\n    if (state.accessToken && !state.user) {\n      fetchMe();\n    }\n  }, [state.accessToken, state.user, fetchMe]);\n\n  useEffect(() => {\n    const checkTokenExpiry = () => {\n      const expiry = localStorage.getItem(TOKEN_EXPIRY_KEY);\n      if (expiry) {\n        const expiryTime = parseInt(expiry);\n        const timeUntilExpiry = expiryTime - Date.now();\n        \n        if (timeUntilExpiry < 60000) {\n          refreshMutation.mutate();\n        }\n      }\n    };\n\n    const interval = setInterval(checkTokenExpiry, 30000);\n    return () => clearInterval(interval);\n  }, [refreshMutation]);\n\n  const login = useCallback(async (username: string, password: string, companyId?: string): Promise<boolean> => {\n    try {\n      await loginMutation.mutateAsync({ username, password, companyId });\n      return true;\n    } catch {\n      return false;\n    }\n  }, [loginMutation]);\n\n  const logout = useCallback(async () => {\n    await logoutMutation.mutateAsync();\n  }, [logoutMutation]);\n\n  const refreshToken = useCallback(async (): Promise<boolean> => {\n    try {\n      await refreshMutation.mutateAsync();\n      return true;\n    } catch {\n      return false;\n    }\n  }, [refreshMutation]);\n\n  const switchCompany = useCallback(async (companyId: string): Promise<boolean> => {\n    try {\n      await switchCompanyMutation.mutateAsync(companyId);\n      return true;\n    } catch {\n      return false;\n    }\n  }, [switchCompanyMutation]);\n\n  const hasPermission = useCallback((permission: string): boolean => {\n    if (!state.role?.permissions) return false;\n    if (state.role.permissions.includes(\"*\")) return true;\n    if (state.role.permissions.includes(permission)) return true;\n    const [action] = permission.split(\":\");\n    if (state.role.permissions.includes(`${action}:*`)) return true;\n    return false;\n  }, [state.role?.permissions]);\n\n  const canAccessCompany = useCallback((companyId: string): boolean => {\n    return state.allowedCompanyIds.includes(companyId);\n  }, [state.allowedCompanyIds]);\n\n  const getAuthHeaders = useCallback((): Record<string, string> => {\n    if (!state.accessToken) return {};\n    return {\n      \"Authorization\": `Bearer ${state.accessToken}`,\n    };\n  }, [state.accessToken]);\n\n  const value: AuthContextValue = {\n    ...state,\n    isLoading: state.isLoading || loginMutation.isPending || logoutMutation.isPending || switchCompanyMutation.isPending,\n    login,\n    logout,\n    refreshToken,\n    switchCompany,\n    hasPermission,\n    canAccessCompany,\n    getAuthHeaders,\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  return context;\n}\n\nexport function useIsAuthenticated() {\n  const { isAuthenticated, isLoading } = useAuth();\n  return { isAuthenticated, isLoading };\n}\n\nexport function useAuthUser() {\n  const { user, isAuthenticated } = useAuth();\n  return isAuthenticated ? user : null;\n}\n","path":null,"size_bytes":10604,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"client/src/components/Dashboard.tsx":{"content":"import { useState } from \"react\";\nimport { PageHeader } from \"@/components/layout/PageHeader\";\nimport { StatCard } from \"@/components/layout/StatCard\";\nimport { StatusBadge } from \"@/components/layout/StatusBadge\";\nimport { OnboardingChecklist } from \"@/components/onboarding/OnboardingChecklist\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { \n  DollarSign, \n  ShoppingCart, \n  Package, \n  Users, \n  AlertTriangle,\n  TrendingUp,\n  ArrowRight,\n  Clock,\n} from \"lucide-react\";\nimport { mockDashboardStats, mockSalesOrders, mockProducts, mockPurchaseOrders, mockLeaveRequests } from \"@/lib/mockData\";\nimport { Link } from \"wouter\";\n\nexport function Dashboard() {\n  const [stats] = useState(mockDashboardStats);\n  const lowStockProducts = mockProducts.filter(p => p.stock < p.minLevel);\n  const pendingOrders = mockSalesOrders.filter(o => o.status === \"draft\" || o.status === \"confirmed\");\n  const pendingPOs = mockPurchaseOrders.filter(po => po.status === \"draft\" || po.status === \"ordered\");\n  const pendingLeaves = mockLeaveRequests.filter(lr => lr.status === \"pending\");\n\n  return (\n    <div>\n      <PageHeader\n        title=\"Dashboard\"\n        description={`Welcome back! Here's what's happening today.`}\n      />\n\n      <OnboardingChecklist />\n\n      <div className=\"grid md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6\">\n        <StatCard\n          title=\"Today's Sales\"\n          value={stats.sales.today}\n          icon={DollarSign}\n          trend={stats.sales.trend}\n          subtitle=\"vs yesterday\"\n        />\n        <StatCard\n          title=\"Pending Orders\"\n          value={stats.sales.pending}\n          icon={ShoppingCart}\n        />\n        <StatCard\n          title=\"Inventory Value\"\n          value={stats.inventory.totalValue}\n          icon={Package}\n          trend={stats.inventory.trend}\n          subtitle=\"this week\"\n        />\n        <StatCard\n          title=\"Low Stock Items\"\n          value={stats.inventory.lowStock}\n          icon={AlertTriangle}\n        />\n      </div>\n\n      <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2\">\n            <CardTitle className=\"text-base\">Recent Orders</CardTitle>\n            <Link href=\"/sales/orders\">\n              <Button variant=\"ghost\" size=\"sm\" data-testid=\"link-view-all-orders\">\n                View All <ArrowRight className=\"h-4 w-4 ml-1\" />\n              </Button>\n            </Link>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              {mockSalesOrders.slice(0, 4).map((order) => (\n                <div key={order.id} className=\"flex items-center justify-between p-3 border rounded-md\">\n                  <div>\n                    <p className=\"font-medium\">{order.id}</p>\n                    <p className=\"text-sm text-muted-foreground\">{order.customerName}</p>\n                  </div>\n                  <div className=\"text-right\">\n                    <StatusBadge status={order.status as \"draft\" | \"confirmed\" | \"delivered\" | \"invoiced\"} />\n                    <p className=\"text-sm font-medium mt-1\">${order.total.toLocaleString()}</p>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2\">\n            <CardTitle className=\"text-base\">Low Stock Alerts</CardTitle>\n            <Link href=\"/warehouse/stock\">\n              <Button variant=\"ghost\" size=\"sm\" data-testid=\"link-view-stock\">\n                View Stock <ArrowRight className=\"h-4 w-4 ml-1\" />\n              </Button>\n            </Link>\n          </CardHeader>\n          <CardContent>\n            {lowStockProducts.length > 0 ? (\n              <div className=\"space-y-3\">\n                {lowStockProducts.slice(0, 4).map((product) => (\n                  <div key={product.id} className=\"flex items-center justify-between p-3 border rounded-md border-red-200 dark:border-red-900/30 bg-red-50/50 dark:bg-red-900/10\">\n                    <div className=\"flex items-center gap-3\">\n                      <AlertTriangle className=\"h-4 w-4 text-red-600 dark:text-red-400\" />\n                      <div>\n                        <p className=\"font-medium\">{product.name}</p>\n                        <p className=\"text-sm text-muted-foreground\">{product.sku}</p>\n                      </div>\n                    </div>\n                    <div className=\"text-right\">\n                      <p className=\"font-medium text-red-600 dark:text-red-400\">{product.stock}</p>\n                      <p className=\"text-xs text-muted-foreground\">Min: {product.minLevel}</p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <p className=\"text-sm text-muted-foreground text-center py-8\">All products are well stocked</p>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2\">\n            <CardTitle className=\"text-base\">Pending Approvals</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              {pendingPOs.slice(0, 2).map((po) => (\n                <div key={po.id} className=\"flex items-center justify-between p-3 border rounded-md\">\n                  <div className=\"flex items-center gap-3\">\n                    <Package className=\"h-4 w-4 text-muted-foreground\" />\n                    <div>\n                      <p className=\"font-medium\">{po.id}</p>\n                      <p className=\"text-sm text-muted-foreground\">{po.vendorName}</p>\n                    </div>\n                  </div>\n                  <StatusBadge status={po.status as \"draft\" | \"ordered\" | \"received\"} />\n                </div>\n              ))}\n              {pendingLeaves.slice(0, 2).map((leave) => (\n                <div key={leave.id} className=\"flex items-center justify-between p-3 border rounded-md\">\n                  <div className=\"flex items-center gap-3\">\n                    <Clock className=\"h-4 w-4 text-muted-foreground\" />\n                    <div>\n                      <p className=\"font-medium\">Leave Request</p>\n                      <p className=\"text-sm text-muted-foreground\">{leave.employeeName}</p>\n                    </div>\n                  </div>\n                  <StatusBadge status=\"pending\" />\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"grid md:grid-cols-2 gap-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-base\">Financial Overview</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between p-4 border rounded-md\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"p-2 rounded-md bg-green-100 dark:bg-green-900/30\">\n                    <TrendingUp className=\"h-5 w-5 text-green-600 dark:text-green-400\" />\n                  </div>\n                  <div>\n                    <p className=\"font-medium\">Accounts Receivable</p>\n                    <p className=\"text-sm text-muted-foreground\">Outstanding invoices</p>\n                  </div>\n                </div>\n                <p className=\"text-xl font-semibold\">${stats.receivables.total.toLocaleString()}</p>\n              </div>\n              <div className=\"flex items-center justify-between p-4 border rounded-md\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"p-2 rounded-md bg-red-100 dark:bg-red-900/30\">\n                    <DollarSign className=\"h-5 w-5 text-red-600 dark:text-red-400\" />\n                  </div>\n                  <div>\n                    <p className=\"font-medium\">Accounts Payable</p>\n                    <p className=\"text-sm text-muted-foreground\">Pending payments</p>\n                  </div>\n                </div>\n                <p className=\"text-xl font-semibold\">${stats.payables.total.toLocaleString()}</p>\n              </div>\n              <div className=\"flex items-center justify-between p-4 border rounded-md\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"p-2 rounded-md bg-amber-100 dark:bg-amber-900/30\">\n                    <AlertTriangle className=\"h-5 w-5 text-amber-600 dark:text-amber-400\" />\n                  </div>\n                  <div>\n                    <p className=\"font-medium\">Overdue Receivables</p>\n                    <p className=\"text-sm text-muted-foreground\">Past due date</p>\n                  </div>\n                </div>\n                <p className=\"text-xl font-semibold text-amber-600 dark:text-amber-400\">\n                  ${stats.receivables.overdue.toLocaleString()}\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-base\">Quick Actions</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-2 gap-3\">\n              <Link href=\"/sales/orders\">\n                <Button variant=\"outline\" className=\"w-full justify-start\" data-testid=\"button-quick-new-order\">\n                  <ShoppingCart className=\"h-4 w-4 mr-2\" />\n                  New Sales Order\n                </Button>\n              </Link>\n              <Link href=\"/warehouse/purchase-orders\">\n                <Button variant=\"outline\" className=\"w-full justify-start\" data-testid=\"button-quick-new-po\">\n                  <Package className=\"h-4 w-4 mr-2\" />\n                  New Purchase Order\n                </Button>\n              </Link>\n              <Link href=\"/sales/customers\">\n                <Button variant=\"outline\" className=\"w-full justify-start\" data-testid=\"button-quick-customers\">\n                  <Users className=\"h-4 w-4 mr-2\" />\n                  Add Customer\n                </Button>\n              </Link>\n              <Link href=\"/warehouse/products\">\n                <Button variant=\"outline\" className=\"w-full justify-start\" data-testid=\"button-quick-products\">\n                  <Package className=\"h-4 w-4 mr-2\" />\n                  Add Product\n                </Button>\n              </Link>\n              <Link href=\"/financials/journal\">\n                <Button variant=\"outline\" className=\"w-full justify-start\" data-testid=\"button-quick-journal\">\n                  <DollarSign className=\"h-4 w-4 mr-2\" />\n                  Journal Entry\n                </Button>\n              </Link>\n              <Link href=\"/reports\">\n                <Button variant=\"outline\" className=\"w-full justify-start\" data-testid=\"button-quick-reports\">\n                  <TrendingUp className=\"h-4 w-4 mr-2\" />\n                  View Reports\n                </Button>\n              </Link>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":11238,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/components/reports/ConsolidationReports.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { format } from \"date-fns\";\nimport {\n  Building2,\n  TrendingUp,\n  TrendingDown,\n  DollarSign,\n  PieChart,\n  FileText,\n  Download,\n  Filter,\n  ChevronRight,\n  ChevronDown,\n  Minus,\n  Calculator,\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Tabs,\n  TabsContent,\n  TabsList,\n  TabsTrigger,\n} from \"@/components/ui/tabs\";\nimport { useToast } from \"@/hooks/use-toast\";\ninterface LocalCompany {\n  id: string;\n  name: string;\n  code: string;\n  currency: string;\n  companyType: string;\n  path: string;\n  parentId: string | null;\n}\nimport { cn } from \"@/lib/utils\";\n\ninterface ConsolidatedAccount {\n  accountCode: string;\n  accountName: string;\n  accountType: string;\n  level: number;\n  isHeader: boolean;\n  balances: Record<string, number>;\n  consolidatedBalance: number;\n  eliminationAmount: number;\n  netBalance: number;\n}\n\ninterface ConsolidatedFinancials {\n  companies: LocalCompany[];\n  accounts: ConsolidatedAccount[];\n  totalAssets: number;\n  totalLiabilities: number;\n  totalEquity: number;\n  totalRevenue: number;\n  totalExpenses: number;\n  netIncome: number;\n  intercompanyEliminations: number;\n}\n\ninterface EliminationEntry {\n  id: string;\n  description: string;\n  debitAccount: string;\n  creditAccount: string;\n  amount: number;\n  sourceCompanyId: string;\n  targetCompanyId: string;\n  eliminationType: string;\n}\n\nconst mockConsolidatedData: ConsolidatedFinancials = {\n  companies: [\n    { id: \"comp-holding\", name: \"Unanza Holdings\", code: \"HOLD\", currency: \"USD\", companyType: \"holding\", path: \"HOLD\", parentId: null },\n    { id: \"comp-us\", name: \"Unanza USA\", code: \"USA\", currency: \"USD\", companyType: \"subsidiary\", path: \"HOLD.USA\", parentId: \"comp-holding\" },\n    { id: \"comp-eu\", name: \"Unanza Europe\", code: \"EU\", currency: \"EUR\", companyType: \"subsidiary\", path: \"HOLD.EU\", parentId: \"comp-holding\" },\n  ],\n  accounts: [\n    { accountCode: \"1000\", accountName: \"Assets\", accountType: \"asset\", level: 1, isHeader: true, balances: {}, consolidatedBalance: 0, eliminationAmount: 0, netBalance: 0 },\n    { accountCode: \"1100\", accountName: \"Current Assets\", accountType: \"asset\", level: 2, isHeader: true, balances: {}, consolidatedBalance: 0, eliminationAmount: 0, netBalance: 0 },\n    { accountCode: \"1110\", accountName: \"Cash and Equivalents\", accountType: \"asset\", level: 3, isHeader: false, balances: { \"comp-holding\": 500000, \"comp-us\": 350000, \"comp-eu\": 280000 }, consolidatedBalance: 1130000, eliminationAmount: 0, netBalance: 1130000 },\n    { accountCode: \"1120\", accountName: \"Accounts Receivable\", accountType: \"asset\", level: 3, isHeader: false, balances: { \"comp-holding\": 120000, \"comp-us\": 450000, \"comp-eu\": 380000 }, consolidatedBalance: 950000, eliminationAmount: -85000, netBalance: 865000 },\n    { accountCode: \"1130\", accountName: \"Inventory\", accountType: \"asset\", level: 3, isHeader: false, balances: { \"comp-holding\": 0, \"comp-us\": 780000, \"comp-eu\": 620000 }, consolidatedBalance: 1400000, eliminationAmount: -45000, netBalance: 1355000 },\n    { accountCode: \"1500\", accountName: \"Non-Current Assets\", accountType: \"asset\", level: 2, isHeader: true, balances: {}, consolidatedBalance: 0, eliminationAmount: 0, netBalance: 0 },\n    { accountCode: \"1510\", accountName: \"Property & Equipment\", accountType: \"asset\", level: 3, isHeader: false, balances: { \"comp-holding\": 2500000, \"comp-us\": 1800000, \"comp-eu\": 1200000 }, consolidatedBalance: 5500000, eliminationAmount: 0, netBalance: 5500000 },\n    { accountCode: \"1520\", accountName: \"Investment in Subsidiaries\", accountType: \"asset\", level: 3, isHeader: false, balances: { \"comp-holding\": 3500000, \"comp-us\": 0, \"comp-eu\": 0 }, consolidatedBalance: 3500000, eliminationAmount: -3500000, netBalance: 0 },\n    { accountCode: \"2000\", accountName: \"Liabilities\", accountType: \"liability\", level: 1, isHeader: true, balances: {}, consolidatedBalance: 0, eliminationAmount: 0, netBalance: 0 },\n    { accountCode: \"2100\", accountName: \"Current Liabilities\", accountType: \"liability\", level: 2, isHeader: true, balances: {}, consolidatedBalance: 0, eliminationAmount: 0, netBalance: 0 },\n    { accountCode: \"2110\", accountName: \"Accounts Payable\", accountType: \"liability\", level: 3, isHeader: false, balances: { \"comp-holding\": 80000, \"comp-us\": 320000, \"comp-eu\": 290000 }, consolidatedBalance: 690000, eliminationAmount: -85000, netBalance: 605000 },\n    { accountCode: \"2120\", accountName: \"Intercompany Payable\", accountType: \"liability\", level: 3, isHeader: false, balances: { \"comp-holding\": 0, \"comp-us\": 150000, \"comp-eu\": 100000 }, consolidatedBalance: 250000, eliminationAmount: -250000, netBalance: 0 },\n    { accountCode: \"3000\", accountName: \"Equity\", accountType: \"equity\", level: 1, isHeader: true, balances: {}, consolidatedBalance: 0, eliminationAmount: 0, netBalance: 0 },\n    { accountCode: \"3100\", accountName: \"Share Capital\", accountType: \"equity\", level: 2, isHeader: false, balances: { \"comp-holding\": 5000000, \"comp-us\": 2000000, \"comp-eu\": 1500000 }, consolidatedBalance: 8500000, eliminationAmount: -3500000, netBalance: 5000000 },\n    { accountCode: \"3200\", accountName: \"Retained Earnings\", accountType: \"equity\", level: 2, isHeader: false, balances: { \"comp-holding\": 1540000, \"comp-us\": 910000, \"comp-eu\": 595000 }, consolidatedBalance: 3045000, eliminationAmount: 0, netBalance: 3045000 },\n    { accountCode: \"4000\", accountName: \"Revenue\", accountType: \"revenue\", level: 1, isHeader: true, balances: {}, consolidatedBalance: 0, eliminationAmount: 0, netBalance: 0 },\n    { accountCode: \"4100\", accountName: \"Sales Revenue\", accountType: \"revenue\", level: 2, isHeader: false, balances: { \"comp-holding\": 0, \"comp-us\": 4500000, \"comp-eu\": 3200000 }, consolidatedBalance: 7700000, eliminationAmount: -320000, netBalance: 7380000 },\n    { accountCode: \"4200\", accountName: \"Service Revenue\", accountType: \"revenue\", level: 2, isHeader: false, balances: { \"comp-holding\": 500000, \"comp-us\": 800000, \"comp-eu\": 450000 }, consolidatedBalance: 1750000, eliminationAmount: -180000, netBalance: 1570000 },\n    { accountCode: \"5000\", accountName: \"Expenses\", accountType: \"expense\", level: 1, isHeader: true, balances: {}, consolidatedBalance: 0, eliminationAmount: 0, netBalance: 0 },\n    { accountCode: \"5100\", accountName: \"Cost of Goods Sold\", accountType: \"expense\", level: 2, isHeader: false, balances: { \"comp-holding\": 0, \"comp-us\": 2700000, \"comp-eu\": 1920000 }, consolidatedBalance: 4620000, eliminationAmount: -275000, netBalance: 4345000 },\n    { accountCode: \"5200\", accountName: \"Operating Expenses\", accountType: \"expense\", level: 2, isHeader: false, balances: { \"comp-holding\": 400000, \"comp-us\": 1200000, \"comp-eu\": 850000 }, consolidatedBalance: 2450000, eliminationAmount: -225000, netBalance: 2225000 },\n  ],\n  totalAssets: 8850000,\n  totalLiabilities: 605000,\n  totalEquity: 8045000,\n  totalRevenue: 8950000,\n  totalExpenses: 6570000,\n  netIncome: 2380000,\n  intercompanyEliminations: 4465000,\n};\n\nconst mockEliminations: EliminationEntry[] = [\n  { id: \"elim-1\", description: \"Eliminate intercompany receivable/payable - US to EU\", debitAccount: \"2110\", creditAccount: \"1120\", amount: 85000, sourceCompanyId: \"comp-us\", targetCompanyId: \"comp-eu\", eliminationType: \"receivable_payable\" },\n  { id: \"elim-2\", description: \"Eliminate intercompany payables\", debitAccount: \"2120\", creditAccount: \"2120\", amount: 250000, sourceCompanyId: \"comp-us\", targetCompanyId: \"comp-eu\", eliminationType: \"intercompany_balance\" },\n  { id: \"elim-3\", description: \"Eliminate investment in subsidiaries\", debitAccount: \"3100\", creditAccount: \"1520\", amount: 3500000, sourceCompanyId: \"comp-holding\", targetCompanyId: \"comp-us\", eliminationType: \"investment_equity\" },\n  { id: \"elim-4\", description: \"Eliminate intercompany sales\", debitAccount: \"4100\", creditAccount: \"5100\", amount: 320000, sourceCompanyId: \"comp-us\", targetCompanyId: \"comp-eu\", eliminationType: \"intercompany_sales\" },\n  { id: \"elim-5\", description: \"Eliminate intercompany services\", debitAccount: \"4200\", creditAccount: \"5200\", amount: 180000, sourceCompanyId: \"comp-holding\", targetCompanyId: \"comp-us\", eliminationType: \"intercompany_services\" },\n  { id: \"elim-6\", description: \"Eliminate unrealized profit in inventory\", debitAccount: \"5100\", creditAccount: \"1130\", amount: 45000, sourceCompanyId: \"comp-us\", targetCompanyId: \"comp-eu\", eliminationType: \"unrealized_profit\" },\n];\n\nconst eliminationTypeColors: Record<string, string> = {\n  receivable_payable: \"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200\",\n  intercompany_balance: \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\",\n  investment_equity: \"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200\",\n  intercompany_sales: \"bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200\",\n  intercompany_services: \"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200\",\n  unrealized_profit: \"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200\",\n};\n\ninterface HierarchyRowProps {\n  account: ConsolidatedAccount;\n  companies: LocalCompany[];\n  isExpanded: boolean;\n  onToggle: () => void;\n  hasChildren: boolean;\n}\n\nfunction HierarchyRow({ account, companies, isExpanded, onToggle, hasChildren }: HierarchyRowProps) {\n  const indent = (account.level - 1) * 20;\n\n  return (\n    <TableRow \n      className={cn(\n        account.isHeader && \"bg-muted/50 font-semibold\",\n        !account.isHeader && \"hover-elevate\"\n      )}\n      data-testid={`row-account-${account.accountCode}`}\n    >\n      <TableCell style={{ paddingLeft: `${indent + 16}px` }}>\n        <div className=\"flex items-center gap-2\">\n          {hasChildren ? (\n            <button onClick={onToggle} className=\"p-0.5 rounded hover:bg-accent\">\n              {isExpanded ? (\n                <ChevronDown className=\"h-4 w-4\" />\n              ) : (\n                <ChevronRight className=\"h-4 w-4\" />\n              )}\n            </button>\n          ) : (\n            <span className=\"w-5\" />\n          )}\n          <span>{account.accountCode}</span>\n        </div>\n      </TableCell>\n      <TableCell className={cn(account.isHeader && \"font-semibold\")}>\n        {account.accountName}\n      </TableCell>\n      {companies.map((company) => (\n        <TableCell key={company.id} className=\"text-right font-mono\">\n          {account.balances[company.id] !== undefined ? (\n            account.balances[company.id].toLocaleString(\"en-US\", {\n              style: \"currency\",\n              currency: \"USD\",\n              minimumFractionDigits: 0,\n            })\n          ) : (\n            \"-\"\n          )}\n        </TableCell>\n      ))}\n      <TableCell className=\"text-right font-mono font-semibold\">\n        {account.consolidatedBalance > 0 ? (\n          account.consolidatedBalance.toLocaleString(\"en-US\", {\n            style: \"currency\",\n            currency: \"USD\",\n            minimumFractionDigits: 0,\n          })\n        ) : (\n          \"-\"\n        )}\n      </TableCell>\n      <TableCell className=\"text-right font-mono text-destructive\">\n        {account.eliminationAmount !== 0 ? (\n          <>\n            ({Math.abs(account.eliminationAmount).toLocaleString(\"en-US\", {\n              style: \"currency\",\n              currency: \"USD\",\n              minimumFractionDigits: 0,\n            })})\n          </>\n        ) : (\n          \"-\"\n        )}\n      </TableCell>\n      <TableCell className=\"text-right font-mono font-bold\">\n        {account.netBalance > 0 ? (\n          account.netBalance.toLocaleString(\"en-US\", {\n            style: \"currency\",\n            currency: \"USD\",\n            minimumFractionDigits: 0,\n          })\n        ) : (\n          \"-\"\n        )}\n      </TableCell>\n    </TableRow>\n  );\n}\n\nexport function ConsolidationReports() {\n  const { toast } = useToast();\n  const [period, setPeriod] = useState(\"2024-12\");\n  const [consolidationScope, setConsolidationScope] = useState(\"full\");\n  const [expandedAccounts, setExpandedAccounts] = useState<Set<string>>(new Set([\"1000\", \"2000\", \"3000\", \"4000\", \"5000\"]));\n\n  // In a real implementation, this would fetch from the API\n  const consolidatedData = mockConsolidatedData;\n  const eliminations = mockEliminations;\n\n  const toggleAccount = (code: string) => {\n    setExpandedAccounts((prev) => {\n      const next = new Set(prev);\n      if (next.has(code)) {\n        next.delete(code);\n      } else {\n        next.add(code);\n      }\n      return next;\n    });\n  };\n\n  const visibleAccounts = consolidatedData.accounts.filter((account) => {\n    // Always show level 1 accounts\n    if (account.level === 1) return true;\n    \n    // Find parent account\n    const parentCode = account.accountCode.substring(0, (account.level - 1) * 2 || 1) + \"00\".repeat(3 - account.level + 1);\n    \n    // Check if any ancestor is expanded\n    for (let i = 1; i < account.level; i++) {\n      const ancestorCode = account.accountCode.substring(0, i * 2 || 1) + \"00\".repeat(3 - i);\n      if (!expandedAccounts.has(ancestorCode)) {\n        return false;\n      }\n    }\n    return true;\n  });\n\n  const hasChildren = (code: string, level: number): boolean => {\n    return consolidatedData.accounts.some(\n      (a) => a.level === level + 1 && a.accountCode.startsWith(code.substring(0, level * 2 || 1))\n    );\n  };\n\n  const handleExport = () => {\n    toast({ title: \"Exporting consolidated report...\" });\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\" data-testid=\"text-page-title\">\n            Consolidation Reports\n          </h1>\n          <p className=\"text-muted-foreground\">\n            Consolidated financial statements with elimination entries\n          </p>\n        </div>\n        <div className=\"flex items-center gap-2 flex-wrap\">\n          <Select value={period} onValueChange={setPeriod}>\n            <SelectTrigger className=\"w-[150px]\" data-testid=\"select-period\">\n              <SelectValue placeholder=\"Period\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"2024-12\">Dec 2024</SelectItem>\n              <SelectItem value=\"2024-11\">Nov 2024</SelectItem>\n              <SelectItem value=\"2024-10\">Oct 2024</SelectItem>\n              <SelectItem value=\"2024-Q4\">Q4 2024</SelectItem>\n              <SelectItem value=\"2024\">FY 2024</SelectItem>\n            </SelectContent>\n          </Select>\n          <Select value={consolidationScope} onValueChange={setConsolidationScope}>\n            <SelectTrigger className=\"w-[180px]\" data-testid=\"select-scope\">\n              <SelectValue placeholder=\"Scope\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"full\">Full Consolidation</SelectItem>\n              <SelectItem value=\"proportional\">Proportional</SelectItem>\n              <SelectItem value=\"equity\">Equity Method</SelectItem>\n            </SelectContent>\n          </Select>\n          <Button variant=\"outline\" onClick={handleExport} data-testid=\"button-export\">\n            <Download className=\"h-4 w-4 mr-2\" />\n            Export\n          </Button>\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n              Consolidated Assets\n            </CardTitle>\n            <Building2 className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"text-total-assets\">\n              ${(consolidatedData.totalAssets / 1000000).toFixed(2)}M\n            </div>\n            <p className=\"text-xs text-muted-foreground\">\n              After eliminations\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n              Consolidated Revenue\n            </CardTitle>\n            <TrendingUp className=\"h-4 w-4 text-green-500\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"text-total-revenue\">\n              ${(consolidatedData.totalRevenue / 1000000).toFixed(2)}M\n            </div>\n            <p className=\"text-xs text-muted-foreground\">\n              Excluding intercompany\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n              Net Income\n            </CardTitle>\n            <DollarSign className=\"h-4 w-4 text-green-500\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"text-net-income\">\n              ${(consolidatedData.netIncome / 1000000).toFixed(2)}M\n            </div>\n            <p className=\"text-xs text-muted-foreground\">\n              Consolidated profit\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n              IC Eliminations\n            </CardTitle>\n            <Calculator className=\"h-4 w-4 text-destructive\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-destructive\" data-testid=\"text-eliminations\">\n              ${(consolidatedData.intercompanyEliminations / 1000000).toFixed(2)}M\n            </div>\n            <p className=\"text-xs text-muted-foreground\">\n              Total eliminated\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Tabs defaultValue=\"trial-balance\" className=\"space-y-4\">\n        <TabsList data-testid=\"tabs-view-selector\">\n          <TabsTrigger value=\"trial-balance\" data-testid=\"tab-trial-balance\">\n            <FileText className=\"h-4 w-4 mr-2\" />\n            Consolidated Trial Balance\n          </TabsTrigger>\n          <TabsTrigger value=\"eliminations\" data-testid=\"tab-eliminations\">\n            <Minus className=\"h-4 w-4 mr-2\" />\n            Elimination Entries\n          </TabsTrigger>\n          <TabsTrigger value=\"hierarchy\" data-testid=\"tab-hierarchy\">\n            <PieChart className=\"h-4 w-4 mr-2\" />\n            By Entity\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"trial-balance\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Consolidated Trial Balance</CardTitle>\n              <CardDescription>\n                Combined financial position across all entities with eliminations\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"overflow-x-auto\">\n              <Table data-testid=\"table-trial-balance\">\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"w-[100px]\">Code</TableHead>\n                    <TableHead>Account</TableHead>\n                    {consolidatedData.companies.map((company) => (\n                      <TableHead key={company.id} className=\"text-right\">\n                        {company.code}\n                      </TableHead>\n                    ))}\n                    <TableHead className=\"text-right\">Consolidated</TableHead>\n                    <TableHead className=\"text-right\">Eliminations</TableHead>\n                    <TableHead className=\"text-right\">Net</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {visibleAccounts.map((account) => (\n                    <HierarchyRow\n                      key={account.accountCode}\n                      account={account}\n                      companies={consolidatedData.companies}\n                      isExpanded={expandedAccounts.has(account.accountCode)}\n                      onToggle={() => toggleAccount(account.accountCode)}\n                      hasChildren={hasChildren(account.accountCode, account.level)}\n                    />\n                  ))}\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"eliminations\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Calculator className=\"h-5 w-5\" />\n                Inter-Company Elimination Entries\n              </CardTitle>\n              <CardDescription>\n                Adjustments to remove inter-company transactions from consolidated statements\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Table data-testid=\"table-eliminations\">\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Description</TableHead>\n                    <TableHead>Type</TableHead>\n                    <TableHead>Dr Account</TableHead>\n                    <TableHead>Cr Account</TableHead>\n                    <TableHead className=\"text-right\">Amount</TableHead>\n                    <TableHead>Companies</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {eliminations.map((entry) => {\n                    const sourceCompany = consolidatedData.companies.find(\n                      (c) => c.id === entry.sourceCompanyId\n                    );\n                    const targetCompany = consolidatedData.companies.find(\n                      (c) => c.id === entry.targetCompanyId\n                    );\n                    return (\n                      <TableRow key={entry.id} data-testid={`row-elimination-${entry.id}`}>\n                        <TableCell className=\"font-medium\">\n                          {entry.description}\n                        </TableCell>\n                        <TableCell>\n                          <Badge \n                            variant=\"secondary\"\n                            className={eliminationTypeColors[entry.eliminationType]}\n                          >\n                            {entry.eliminationType.replace(/_/g, \" \")}\n                          </Badge>\n                        </TableCell>\n                        <TableCell className=\"font-mono\">{entry.debitAccount}</TableCell>\n                        <TableCell className=\"font-mono\">{entry.creditAccount}</TableCell>\n                        <TableCell className=\"text-right font-mono\">\n                          {entry.amount.toLocaleString(\"en-US\", {\n                            style: \"currency\",\n                            currency: \"USD\",\n                            minimumFractionDigits: 0,\n                          })}\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex items-center gap-1\">\n                            <Badge variant=\"outline\">{sourceCompany?.code}</Badge>\n                            <ChevronRight className=\"h-3 w-3 text-muted-foreground\" />\n                            <Badge variant=\"outline\">{targetCompany?.code}</Badge>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })}\n                </TableBody>\n              </Table>\n\n              <div className=\"mt-4 p-4 bg-muted rounded-md\">\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"font-medium\">Total Eliminations</span>\n                  <span className=\"text-xl font-bold font-mono\" data-testid=\"text-total-eliminations\">\n                    {eliminations\n                      .reduce((sum, e) => sum + e.amount, 0)\n                      .toLocaleString(\"en-US\", {\n                        style: \"currency\",\n                        currency: \"USD\",\n                        minimumFractionDigits: 0,\n                      })}\n                  </span>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"hierarchy\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Financial Summary by Entity</CardTitle>\n              <CardDescription>\n                Individual company contributions to consolidated results\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Table data-testid=\"table-by-entity\">\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Company</TableHead>\n                    <TableHead>Type</TableHead>\n                    <TableHead className=\"text-right\">Assets</TableHead>\n                    <TableHead className=\"text-right\">Liabilities</TableHead>\n                    <TableHead className=\"text-right\">Revenue</TableHead>\n                    <TableHead className=\"text-right\">Net Income</TableHead>\n                    <TableHead className=\"text-right\">% of Group</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {consolidatedData.companies.map((company) => {\n                    const assets = consolidatedData.accounts\n                      .filter((a) => a.accountType === \"asset\" && !a.isHeader)\n                      .reduce((sum, a) => sum + (a.balances[company.id] || 0), 0);\n                    const liabilities = consolidatedData.accounts\n                      .filter((a) => a.accountType === \"liability\" && !a.isHeader)\n                      .reduce((sum, a) => sum + (a.balances[company.id] || 0), 0);\n                    const revenue = consolidatedData.accounts\n                      .filter((a) => a.accountType === \"revenue\" && !a.isHeader)\n                      .reduce((sum, a) => sum + (a.balances[company.id] || 0), 0);\n                    const expenses = consolidatedData.accounts\n                      .filter((a) => a.accountType === \"expense\" && !a.isHeader)\n                      .reduce((sum, a) => sum + (a.balances[company.id] || 0), 0);\n                    const netIncome = revenue - expenses;\n                    const groupPct = (netIncome / consolidatedData.netIncome) * 100;\n\n                    return (\n                      <TableRow key={company.id} data-testid={`row-entity-${company.id}`}>\n                        <TableCell>\n                          <div className=\"flex items-center gap-2\">\n                            <Building2 className=\"h-4 w-4 text-muted-foreground\" />\n                            <span className=\"font-medium\">{company.name}</span>\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <Badge variant=\"outline\">{company.companyType}</Badge>\n                        </TableCell>\n                        <TableCell className=\"text-right font-mono\">\n                          ${(assets / 1000000).toFixed(2)}M\n                        </TableCell>\n                        <TableCell className=\"text-right font-mono\">\n                          ${(liabilities / 1000000).toFixed(2)}M\n                        </TableCell>\n                        <TableCell className=\"text-right font-mono\">\n                          ${(revenue / 1000000).toFixed(2)}M\n                        </TableCell>\n                        <TableCell className=\"text-right font-mono\">\n                          ${(netIncome / 1000000).toFixed(2)}M\n                        </TableCell>\n                        <TableCell className=\"text-right\">\n                          <Badge variant={groupPct > 0 ? \"default\" : \"secondary\"}>\n                            {groupPct.toFixed(1)}%\n                          </Badge>\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })}\n                  <TableRow className=\"bg-muted/50 font-bold\">\n                    <TableCell colSpan={2}>Group Total (After Eliminations)</TableCell>\n                    <TableCell className=\"text-right font-mono\">\n                      ${(consolidatedData.totalAssets / 1000000).toFixed(2)}M\n                    </TableCell>\n                    <TableCell className=\"text-right font-mono\">\n                      ${(consolidatedData.totalLiabilities / 1000000).toFixed(2)}M\n                    </TableCell>\n                    <TableCell className=\"text-right font-mono\">\n                      ${(consolidatedData.totalRevenue / 1000000).toFixed(2)}M\n                    </TableCell>\n                    <TableCell className=\"text-right font-mono\">\n                      ${(consolidatedData.netIncome / 1000000).toFixed(2)}M\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      <Badge>100%</Badge>\n                    </TableCell>\n                  </TableRow>\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":29739,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"client/src/contexts/CompanyContext.tsx":{"content":"import { createContext, useContext, useState, useCallback, useEffect, type ReactNode } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport type { Company, CompanyContext as CompanyContextType, CompanyHierarchyNode, CompanyLevel } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface CompanyProviderState {\n  activeCompanyId: string | null;\n  activeCompany: Company | null;\n  userCompanies: Company[];\n  permissions: string[];\n  isLoading: boolean;\n  error: string | null;\n  // Hierarchy-aware access\n  companyLevel: CompanyLevel;\n  accessibleCompanyIds: string[];\n  canConsolidate: boolean;\n  parentCompany: Company | null;\n  childCompanies: Company[];\n}\n\ninterface CompanyProviderActions {\n  switchCompany: (companyId: string) => Promise<void>;\n  hasPermission: (permission: string) => boolean;\n  refreshContext: () => void;\n  canAccessCompanyData: (targetCompanyId: string) => boolean;\n}\n\ntype CompanyProviderValue = CompanyProviderState & CompanyProviderActions;\n\nconst CompanyContext = createContext<CompanyProviderValue | null>(null);\n\nconst STORAGE_KEY_COMPANY = \"unanza_active_company\";\nconst STORAGE_KEY_USER = \"unanza_user_id\";\n\n// Default admin user for demo purposes\nconst DEFAULT_USER_ID = \"user-admin\";\nconst DEFAULT_COMPANY_ID = \"comp-holding\";\n\ninterface CompanyProviderProps {\n  children: ReactNode;\n}\n\nexport function CompanyProvider({ children }: CompanyProviderProps) {\n  const queryClient = useQueryClient();\n  \n  // Initialize from localStorage or defaults\n  const [userId] = useState<string>(() => {\n    return localStorage.getItem(STORAGE_KEY_USER) || DEFAULT_USER_ID;\n  });\n  \n  const [activeCompanyId, setActiveCompanyId] = useState<string | null>(() => {\n    return localStorage.getItem(STORAGE_KEY_COMPANY) || DEFAULT_COMPANY_ID;\n  });\n\n  // Fetch all companies for the switcher\n  const { data: allCompanies = [] } = useQuery<Company[]>({\n    queryKey: [\"/api/companies\"],\n  });\n\n  // Fetch user's accessible companies\n  const { data: userCompanies = [] } = useQuery<Company[]>({\n    queryKey: [\"/api/users\", userId, \"companies\"],\n    enabled: !!userId,\n  });\n\n  // Fetch company hierarchy\n  const { data: companyHierarchy = [] } = useQuery<CompanyHierarchyNode[]>({\n    queryKey: [\"/api/companies/hierarchy\"],\n  });\n\n  // Fetch current context - include activeCompanyId in query key so it refetches on switch\n  const { \n    data: context, \n    isLoading, \n    error,\n    refetch: refreshContext \n  } = useQuery<CompanyContextType>({\n    queryKey: [\"/api/session/context\", activeCompanyId],\n    enabled: !!userId && !!activeCompanyId,\n    meta: {\n      headers: {\n        \"x-user-id\": userId,\n        \"x-company-id\": activeCompanyId || \"\",\n      },\n    },\n  });\n\n  // Switch company mutation\n  const switchCompanyMutation = useMutation({\n    mutationFn: async (companyId: string) => {\n      const response = await apiRequest(\"POST\", \"/api/session/switch-company\", {\n        userId,\n        companyId,\n      });\n      return response.json();\n    },\n    onSuccess: (data: CompanyContextType, companyId: string) => {\n      setActiveCompanyId(companyId);\n      localStorage.setItem(STORAGE_KEY_COMPANY, companyId);\n      \n      // Update the cache directly with the new context data\n      queryClient.setQueryData([\"/api/session/context\", companyId], data);\n      \n      // Invalidate companies list and hierarchy\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies/hierarchy\"] });\n      \n      // Invalidate all company-scoped queries to force refetch with new context\n      queryClient.invalidateQueries({ \n        predicate: (query) => {\n          const key = query.queryKey;\n          // Invalidate queries that have company-specific data (but not the new context we just set)\n          return Array.isArray(key) && (\n            key.some(k => typeof k === \"string\" && k.includes(\"/companies/\"))\n          );\n        }\n      });\n    },\n  });\n\n  // Switch company function\n  const switchCompany = useCallback(async (companyId: string) => {\n    await switchCompanyMutation.mutateAsync(companyId);\n  }, [switchCompanyMutation]);\n\n  // Check if user has a specific permission\n  const hasPermission = useCallback((permission: string): boolean => {\n    if (!context?.permissions) return false;\n    // Wildcard permission\n    if (context.permissions.includes(\"*\")) return true;\n    // Direct match\n    if (context.permissions.includes(permission)) return true;\n    // Prefix match (e.g., \"read:*\" matches \"read:customers\")\n    const [action] = permission.split(\":\");\n    if (context.permissions.includes(`${action}:*`)) return true;\n    return false;\n  }, [context?.permissions]);\n\n  // Check if user can access data for a target company based on hierarchy\n  const canAccessCompanyData = useCallback((targetCompanyId: string): boolean => {\n    if (!context?.accessibleCompanyIds) return false;\n    return context.accessibleCompanyIds.includes(targetCompanyId);\n  }, [context?.accessibleCompanyIds]);\n\n  // Get active company from context or find from list\n  const activeCompany = context?.activeCompany || \n    (activeCompanyId ? allCompanies.find(c => c.id === activeCompanyId) || null : null);\n\n  const value: CompanyProviderValue = {\n    activeCompanyId,\n    activeCompany,\n    userCompanies: context?.userCompanies || userCompanies,\n    permissions: context?.permissions || [],\n    isLoading: isLoading || switchCompanyMutation.isPending,\n    error: error?.message || switchCompanyMutation.error?.message || null,\n    // Hierarchy-aware access\n    companyLevel: context?.companyLevel || 3,\n    accessibleCompanyIds: context?.accessibleCompanyIds || [],\n    canConsolidate: context?.canConsolidate || false,\n    parentCompany: context?.parentCompany || null,\n    childCompanies: context?.childCompanies || [],\n    switchCompany,\n    hasPermission,\n    refreshContext: () => refreshContext(),\n    canAccessCompanyData,\n  };\n\n  return (\n    <CompanyContext.Provider value={value}>\n      {children}\n    </CompanyContext.Provider>\n  );\n}\n\nexport function useCompany() {\n  const context = useContext(CompanyContext);\n  if (!context) {\n    throw new Error(\"useCompany must be used within a CompanyProvider\");\n  }\n  return context;\n}\n\n// Hook to get the active company ID for query keys\nexport function useActiveCompanyId() {\n  const { activeCompanyId } = useCompany();\n  return activeCompanyId;\n}\n\n// Hook to check permissions\nexport function usePermission(permission: string) {\n  const { hasPermission } = useCompany();\n  return hasPermission(permission);\n}\n","path":null,"size_bytes":6637,"size_tokens":null},"client/src/components/reports/HRReports.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Users,\n  Clock,\n  Calendar,\n  DollarSign,\n  Timer,\n  CheckCircle,\n  AlertCircle,\n} from \"lucide-react\";\nimport {\n  mockAttendanceSummary,\n  mockLeaveBalance,\n  mockOvertimeSummary,\n  mockPayrollByDepartment,\n} from \"@/lib/reportData\";\nimport { cn } from \"@/lib/utils\";\n\nexport function HRReports() {\n  const [activeTab, setActiveTab] = useState(\"attendance\");\n\n  const totalEmployees = mockAttendanceSummary.length;\n  const avgAttendanceRate = (mockAttendanceSummary.reduce((sum, e) => sum + e.daysWorked, 0) / (totalEmployees * 22)) * 100;\n  const totalOvertime = mockOvertimeSummary.reduce((sum, d) => sum + d.totalHours, 0);\n  const totalPayroll = mockPayrollByDepartment.reduce((sum, d) => sum + d.netPayroll, 0);\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"grid md:grid-cols-4 gap-4\">\n        <Card data-testid=\"card-total-employees\">\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm text-muted-foreground\">Total Employees</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-2xl font-semibold\" data-testid=\"text-total-employees\">{mockPayrollByDepartment.reduce((sum, d) => sum + d.employees, 0)}</p>\n          </CardContent>\n        </Card>\n        <Card data-testid=\"card-attendance-rate\">\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm text-muted-foreground\">Avg Attendance Rate</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-2xl font-semibold text-green-600 dark:text-green-400\" data-testid=\"text-attendance-rate\">\n              {avgAttendanceRate.toFixed(1)}%\n            </p>\n          </CardContent>\n        </Card>\n        <Card data-testid=\"card-overtime\">\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm text-muted-foreground\">Total Overtime (Month)</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-2xl font-semibold text-amber-600 dark:text-amber-400\" data-testid=\"text-overtime\">\n              {totalOvertime} hrs\n            </p>\n          </CardContent>\n        </Card>\n        <Card data-testid=\"card-payroll\">\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm text-muted-foreground\">Monthly Payroll</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-2xl font-semibold\" data-testid=\"text-payroll\">${totalPayroll.toLocaleString()}</p>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList className=\"grid grid-cols-4 w-full max-w-2xl\">\n          <TabsTrigger value=\"attendance\" data-testid=\"tab-attendance\">Attendance</TabsTrigger>\n          <TabsTrigger value=\"leave\" data-testid=\"tab-leave\">Leave Balance</TabsTrigger>\n          <TabsTrigger value=\"overtime\" data-testid=\"tab-overtime\">Overtime</TabsTrigger>\n          <TabsTrigger value=\"payroll\" data-testid=\"tab-payroll\">Payroll</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"attendance\" className=\"space-y-6 mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Clock className=\"h-5 w-5\" />\n                Attendance Summary\n              </CardTitle>\n              <CardDescription>Monthly attendance metrics by employee</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Employee</TableHead>\n                    <TableHead>Department</TableHead>\n                    <TableHead className=\"text-center\">Days Worked</TableHead>\n                    <TableHead className=\"text-center\">Days Absent</TableHead>\n                    <TableHead className=\"text-center\">Late Arrivals</TableHead>\n                    <TableHead className=\"text-center\">Avg Hours</TableHead>\n                    <TableHead className=\"text-center\">Overtime</TableHead>\n                    <TableHead className=\"text-center\">Status</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {mockAttendanceSummary.map((employee) => {\n                    const attendanceRate = (employee.daysWorked / 22) * 100;\n                    return (\n                      <TableRow key={employee.employeeId}>\n                        <TableCell className=\"font-medium\">{employee.name}</TableCell>\n                        <TableCell>{employee.department}</TableCell>\n                        <TableCell className=\"text-center\">{employee.daysWorked}/22</TableCell>\n                        <TableCell className={cn(\n                          \"text-center\",\n                          employee.daysAbsent > 2 && \"text-red-600\"\n                        )}>\n                          {employee.daysAbsent}\n                        </TableCell>\n                        <TableCell className={cn(\n                          \"text-center\",\n                          employee.lateArrivals > 3 && \"text-amber-600\"\n                        )}>\n                          {employee.lateArrivals}\n                        </TableCell>\n                        <TableCell className=\"text-center\">{employee.avgHours}</TableCell>\n                        <TableCell className=\"text-center\">\n                          {employee.overtimeHours > 0 && (\n                            <Badge variant=\"secondary\">{employee.overtimeHours} hrs</Badge>\n                          )}\n                        </TableCell>\n                        <TableCell className=\"text-center\">\n                          {attendanceRate >= 95 ? (\n                            <Badge className=\"bg-green-500\">Excellent</Badge>\n                          ) : attendanceRate >= 85 ? (\n                            <Badge className=\"bg-blue-500\">Good</Badge>\n                          ) : (\n                            <Badge className=\"bg-amber-500\">Needs Review</Badge>\n                          )}\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })}\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"leave\" className=\"space-y-6 mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Calendar className=\"h-5 w-5\" />\n                Leave Balance Report\n              </CardTitle>\n              <CardDescription>Annual and sick leave balances by employee</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Employee</TableHead>\n                    <TableHead>Department</TableHead>\n                    <TableHead className=\"text-center\">Annual Allowed</TableHead>\n                    <TableHead className=\"text-center\">Annual Used</TableHead>\n                    <TableHead className=\"text-center\">Annual Remaining</TableHead>\n                    <TableHead className=\"text-center\">Sick Used</TableHead>\n                    <TableHead className=\"text-center\">Sick Remaining</TableHead>\n                    <TableHead className=\"text-center\">Usage</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {mockLeaveBalance.map((employee) => {\n                    const usagePercent = (employee.used / employee.annualAllowed) * 100;\n                    return (\n                      <TableRow key={employee.employeeId}>\n                        <TableCell className=\"font-medium\">{employee.name}</TableCell>\n                        <TableCell>{employee.department}</TableCell>\n                        <TableCell className=\"text-center\">{employee.annualAllowed}</TableCell>\n                        <TableCell className=\"text-center\">{employee.used}</TableCell>\n                        <TableCell className={cn(\n                          \"text-center font-medium\",\n                          employee.remaining < 5 ? \"text-amber-600\" : \"text-green-600\"\n                        )}>\n                          {employee.remaining}\n                        </TableCell>\n                        <TableCell className=\"text-center\">{employee.sickUsed}</TableCell>\n                        <TableCell className=\"text-center\">{employee.sickRemaining}</TableCell>\n                        <TableCell>\n                          <div className=\"flex items-center gap-2\">\n                            <Progress value={usagePercent} className=\"h-2 w-16\" />\n                            <span className=\"text-sm\">{usagePercent.toFixed(0)}%</span>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })}\n                </TableBody>\n              </Table>\n\n              <div className=\"mt-6 p-4 bg-muted/50 rounded-md\">\n                <h4 className=\"font-medium mb-3\">Leave Summary</h4>\n                <div className=\"grid md:grid-cols-4 gap-4 text-sm\">\n                  <div>\n                    <p className=\"text-muted-foreground\">Total Annual Allowed</p>\n                    <p className=\"text-xl font-semibold\">{mockLeaveBalance.reduce((sum, e) => sum + e.annualAllowed, 0)} days</p>\n                  </div>\n                  <div>\n                    <p className=\"text-muted-foreground\">Total Annual Used</p>\n                    <p className=\"text-xl font-semibold\">{mockLeaveBalance.reduce((sum, e) => sum + e.used, 0)} days</p>\n                  </div>\n                  <div>\n                    <p className=\"text-muted-foreground\">Total Annual Remaining</p>\n                    <p className=\"text-xl font-semibold text-green-600\">{mockLeaveBalance.reduce((sum, e) => sum + e.remaining, 0)} days</p>\n                  </div>\n                  <div>\n                    <p className=\"text-muted-foreground\">Total Sick Used</p>\n                    <p className=\"text-xl font-semibold\">{mockLeaveBalance.reduce((sum, e) => sum + e.sickUsed, 0)} days</p>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"overtime\" className=\"space-y-6 mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Timer className=\"h-5 w-5\" />\n                Overtime Summary\n              </CardTitle>\n              <CardDescription>Monthly overtime hours and costs by department</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Department</TableHead>\n                    <TableHead className=\"text-center\">Employees</TableHead>\n                    <TableHead className=\"text-center\">Total Hours</TableHead>\n                    <TableHead className=\"text-center\">Avg per Employee</TableHead>\n                    <TableHead className=\"text-right\">Cost</TableHead>\n                    <TableHead>Distribution</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {mockOvertimeSummary.map((dept) => {\n                    const maxHours = Math.max(...mockOvertimeSummary.map(d => d.totalHours));\n                    return (\n                      <TableRow key={dept.department}>\n                        <TableCell className=\"font-medium\">{dept.department}</TableCell>\n                        <TableCell className=\"text-center\">{dept.employees}</TableCell>\n                        <TableCell className=\"text-center font-medium\">{dept.totalHours} hrs</TableCell>\n                        <TableCell className=\"text-center\">{dept.avgPerEmployee.toFixed(1)} hrs</TableCell>\n                        <TableCell className=\"text-right\">${dept.cost.toLocaleString()}</TableCell>\n                        <TableCell>\n                          <div className=\"h-4 bg-muted rounded-md overflow-hidden w-32\">\n                            <div\n                              className=\"h-full bg-amber-500\"\n                              style={{ width: `${(dept.totalHours / maxHours) * 100}%` }}\n                            />\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })}\n                </TableBody>\n              </Table>\n\n              <div className=\"mt-6 grid md:grid-cols-3 gap-4\">\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm text-muted-foreground\">Total Overtime Hours</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-2xl font-semibold\">{totalOvertime} hours</p>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm text-muted-foreground\">Total Overtime Cost</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-2xl font-semibold text-amber-600\">\n                      ${mockOvertimeSummary.reduce((sum, d) => sum + d.cost, 0).toLocaleString()}\n                    </p>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm text-muted-foreground\">Avg Overtime/Employee</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-2xl font-semibold\">\n                      {(totalOvertime / mockOvertimeSummary.reduce((sum, d) => sum + d.employees, 0)).toFixed(1)} hrs\n                    </p>\n                  </CardContent>\n                </Card>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"payroll\" className=\"space-y-6 mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <DollarSign className=\"h-5 w-5\" />\n                Payroll Breakdown by Department\n              </CardTitle>\n              <CardDescription>Monthly payroll components and net amounts</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Department</TableHead>\n                    <TableHead className=\"text-center\">Employees</TableHead>\n                    <TableHead className=\"text-right\">Base Salary</TableHead>\n                    <TableHead className=\"text-right\">Overtime</TableHead>\n                    <TableHead className=\"text-right\">Bonuses</TableHead>\n                    <TableHead className=\"text-right\">Deductions</TableHead>\n                    <TableHead className=\"text-right\">Net Payroll</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {mockPayrollByDepartment.map((dept) => (\n                    <TableRow key={dept.department}>\n                      <TableCell className=\"font-medium\">{dept.department}</TableCell>\n                      <TableCell className=\"text-center\">{dept.employees}</TableCell>\n                      <TableCell className=\"text-right\">${dept.baseSalary.toLocaleString()}</TableCell>\n                      <TableCell className=\"text-right text-amber-600\">+${dept.overtime.toLocaleString()}</TableCell>\n                      <TableCell className=\"text-right text-green-600\">+${dept.bonuses.toLocaleString()}</TableCell>\n                      <TableCell className=\"text-right text-red-600\">-${dept.deductions.toLocaleString()}</TableCell>\n                      <TableCell className=\"text-right font-semibold\">${dept.netPayroll.toLocaleString()}</TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n\n              <div className=\"mt-6 p-4 bg-muted/50 rounded-md\">\n                <div className=\"grid md:grid-cols-5 gap-4 text-sm\">\n                  <div>\n                    <p className=\"text-muted-foreground\">Total Base</p>\n                    <p className=\"text-xl font-semibold\">\n                      ${mockPayrollByDepartment.reduce((sum, d) => sum + d.baseSalary, 0).toLocaleString()}\n                    </p>\n                  </div>\n                  <div>\n                    <p className=\"text-muted-foreground\">Total Overtime</p>\n                    <p className=\"text-xl font-semibold text-amber-600\">\n                      +${mockPayrollByDepartment.reduce((sum, d) => sum + d.overtime, 0).toLocaleString()}\n                    </p>\n                  </div>\n                  <div>\n                    <p className=\"text-muted-foreground\">Total Bonuses</p>\n                    <p className=\"text-xl font-semibold text-green-600\">\n                      +${mockPayrollByDepartment.reduce((sum, d) => sum + d.bonuses, 0).toLocaleString()}\n                    </p>\n                  </div>\n                  <div>\n                    <p className=\"text-muted-foreground\">Total Deductions</p>\n                    <p className=\"text-xl font-semibold text-red-600\">\n                      -${mockPayrollByDepartment.reduce((sum, d) => sum + d.deductions, 0).toLocaleString()}\n                    </p>\n                  </div>\n                  <div>\n                    <p className=\"text-muted-foreground\">Net Payroll</p>\n                    <p className=\"text-xl font-semibold\">\n                      ${mockPayrollByDepartment.reduce((sum, d) => sum + d.netPayroll, 0).toLocaleString()}\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":18585,"size_tokens":null},"client/src/components/examples/WorkflowStepper.tsx":{"content":"import { WorkflowStepper } from \"../layout/WorkflowStepper\";\n\nconst orderSteps = [\n  { id: \"draft\", label: \"Draft\" },\n  { id: \"confirmed\", label: \"Confirmed\" },\n  { id: \"delivered\", label: \"Delivered\" },\n  { id: \"invoiced\", label: \"Invoiced\" },\n];\n\nexport default function WorkflowStepperExample() {\n  return (\n    <WorkflowStepper steps={orderSteps} currentStep=\"confirmed\" />\n  );\n}\n","path":null,"size_bytes":385,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"server/routes.ts":{"content":"import type { Express, Request, Response, NextFunction } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { \n  insertCompanySchema, \n  insertUserCompanyRoleSchema,\n  insertAccountSchema,\n  insertWarehouseSchema,\n  insertProductSchema,\n  insertCustomerSchema,\n  insertVendorSchema,\n  insertTaxSchema,\n  insertEmployeeSchema,\n  insertJournalEntrySchema,\n  insertFiscalPeriodSchema,\n  insertSalesOrderSchema,\n  insertPurchaseOrderSchema,\n  loginSchema,\n  type CompanyContext,\n  type Account,\n  type CompanyHierarchyNode,\n} from \"@shared/schema\";\nimport { z } from \"zod\";\nimport {\n  authenticateUser,\n  refreshAccessToken,\n  logout,\n  switchCompany,\n  authenticateJWT,\n  loadAuthContext,\n  AUTH_CONFIG,\n} from \"./auth\";\n\n// Middleware to extract company context from headers\ninterface CompanyRequest extends Request {\n  companyContext?: CompanyContext;\n  activeCompanyId?: string;\n  userId?: string;\n}\n\n// Public routes that don't require authentication\n// Note: These paths are relative to the /api mount point\n// Only auth endpoints and setup endpoints are truly public - all others require JWT\nconst publicRoutes = [\n  \"/auth/login\",\n  \"/auth/refresh\",\n  \"/auth/logout\",\n  \"/setup/status\",\n  \"/setup/company\",\n  \"/setup/admin\",\n];\n\nasync function companyContextMiddleware(\n  req: CompanyRequest, \n  res: Response, \n  next: NextFunction\n) {\n  // Check if this is a public route (allow without auth)\n  const isPublicRoute = publicRoutes.some(route => \n    req.path === route || req.path.startsWith(route + \"/\")\n  );\n\n  // Public routes don't require authentication\n  if (isPublicRoute) {\n    return next();\n  }\n\n  // All non-public routes require JWT authentication (via req.auth)\n  if (!req.auth) {\n    return res.status(401).json({ \n      error: \"Authentication required. Please login.\" \n    });\n  }\n\n  // Build company context from JWT claims\n  const rolePermissions = req.auth.role?.permissions;\n  const permissionsArray = Array.isArray(rolePermissions) ? rolePermissions : [];\n  \n  req.companyContext = {\n    activeCompanyId: req.auth.activeCompanyId,\n    activeCompany: req.auth.activeCompany,\n    userCompanies: [req.auth.activeCompany],\n    permissions: permissionsArray,\n    role: req.auth.role,\n    companyLevel: req.auth.companyLevel,\n    accessibleCompanyIds: req.auth.allowedCompanyIds,\n    canConsolidate: req.auth.canConsolidate,\n    parentCompany: null,\n    childCompanies: [],\n  };\n  req.activeCompanyId = req.auth.activeCompanyId;\n  req.userId = req.auth.user.id;\n  next();\n}\n\n// Middleware to verify company access for company-scoped routes\n// Uses hierarchy-derived accessibleCompanyIds for proper level-based visibility:\n// - Branch (level 3): Can only see its own data\n// - Subsidiary (level 2): Can see its own data + all its Branches\n// - Holding (level 1): Can see all Subsidiaries and their Branches\nfunction verifyCompanyAccess(\n  req: CompanyRequest,\n  res: Response,\n  next: NextFunction\n) {\n  const urlCompanyId = req.params.companyId;\n  \n  // If route has companyId param, verify access using hierarchy-derived accessible IDs\n  if (urlCompanyId && req.companyContext) {\n    // Use accessibleCompanyIds which is computed based on company level\n    const hasHierarchyAccess = req.companyContext.accessibleCompanyIds.includes(urlCompanyId);\n    // Also check if user is directly assigned to the company (for users at different levels)\n    const hasDirectAccess = req.companyContext.userCompanies.some(c => c.id === urlCompanyId);\n    \n    if (!hasHierarchyAccess && !hasDirectAccess) {\n      return res.status(403).json({\n        error: \"Access denied: You do not have access to this company's data based on your company level\"\n      });\n    }\n  }\n  next();\n}\n\n// JWT middleware wrapper that skips for public routes\nfunction optionalJWT(req: Request, res: Response, next: NextFunction) {\n  const isPublicRoute = publicRoutes.some(route => \n    req.path === route || req.path.startsWith(route + \"/\")\n  );\n  \n  if (isPublicRoute) {\n    return next();\n  }\n  \n  // Apply JWT authentication for non-public routes\n  authenticateJWT(req, res, (err?: any) => {\n    if (err) return next(err);\n    loadAuthContext(req, res, next);\n  });\n}\n\nexport async function registerRoutes(\n  httpServer: Server,\n  app: Express\n): Promise<Server> {\n  // Apply JWT authentication + company context middleware to all /api routes\n  app.use(\"/api\", optionalJWT, companyContextMiddleware);\n\n  // ============================================================================\n  // AUTHENTICATION (JWT)\n  // ============================================================================\n\n  // Login - Get access token + refresh token\n  app.post(\"/api/auth/login\", async (req: Request, res: Response) => {\n    try {\n      const parsed = loginSchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ error: \"Invalid credentials format\", details: parsed.error.errors });\n      }\n\n      const { username, password, companyId } = parsed.data;\n      const ipAddress = req.ip || req.socket.remoteAddress;\n      const deviceInfo = req.headers[\"user-agent\"];\n\n      const result = await authenticateUser(username, password, companyId, ipAddress, deviceInfo);\n\n      if (!result.success) {\n        return res.status(401).json({ error: result.error });\n      }\n\n      // Set refresh token in httpOnly cookie\n      res.cookie(AUTH_CONFIG.REFRESH_TOKEN_COOKIE_NAME, result.refreshToken, {\n        httpOnly: true,\n        secure: process.env.NODE_ENV === \"production\",\n        sameSite: \"lax\",\n        maxAge: AUTH_CONFIG.REFRESH_TOKEN_EXPIRES_IN * 1000,\n        path: \"/\",\n      });\n\n      res.json(result.loginResponse);\n    } catch (error) {\n      console.error(\"Login error:\", error);\n      res.status(500).json({ error: \"Authentication failed\" });\n    }\n  });\n\n  // Refresh access token\n  app.post(\"/api/auth/refresh\", async (req: Request, res: Response) => {\n    try {\n      const refreshToken = req.cookies?.[AUTH_CONFIG.REFRESH_TOKEN_COOKIE_NAME] || req.body.refreshToken;\n\n      if (!refreshToken) {\n        return res.status(401).json({ error: \"No refresh token provided\" });\n      }\n\n      const ipAddress = req.ip || req.socket.remoteAddress;\n      const deviceInfo = req.headers[\"user-agent\"];\n\n      const result = await refreshAccessToken(refreshToken, ipAddress, deviceInfo);\n\n      if (!result.success) {\n        // Clear invalid cookie\n        res.clearCookie(AUTH_CONFIG.REFRESH_TOKEN_COOKIE_NAME);\n        return res.status(401).json({ error: result.error });\n      }\n\n      // Set new refresh token in cookie (rotation)\n      if (result.newRefreshToken) {\n        res.cookie(AUTH_CONFIG.REFRESH_TOKEN_COOKIE_NAME, result.newRefreshToken, {\n          httpOnly: true,\n          secure: process.env.NODE_ENV === \"production\",\n          sameSite: \"lax\",\n          maxAge: AUTH_CONFIG.REFRESH_TOKEN_EXPIRES_IN * 1000,\n          path: \"/\",\n        });\n      }\n\n      res.json(result.response);\n    } catch (error) {\n      console.error(\"Refresh error:\", error);\n      res.status(500).json({ error: \"Token refresh failed\" });\n    }\n  });\n\n  // Logout - Revoke refresh token\n  app.post(\"/api/auth/logout\", async (req: Request, res: Response) => {\n    try {\n      const refreshToken = req.cookies?.[AUTH_CONFIG.REFRESH_TOKEN_COOKIE_NAME] || req.body.refreshToken;\n\n      if (refreshToken) {\n        const ipAddress = req.ip || req.socket.remoteAddress;\n        const deviceInfo = req.headers[\"user-agent\"];\n        await logout(refreshToken, ipAddress, deviceInfo);\n      }\n\n      // Clear cookie\n      res.clearCookie(AUTH_CONFIG.REFRESH_TOKEN_COOKIE_NAME);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Logout error:\", error);\n      res.status(500).json({ error: \"Logout failed\" });\n    }\n  });\n\n  // Get current user info (requires valid JWT)\n  app.get(\"/api/auth/me\", authenticateJWT, loadAuthContext, async (req: Request, res: Response) => {\n    try {\n      const auth = req.auth;\n      if (!auth) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n\n      res.json({\n        user: {\n          id: auth.user.id,\n          username: auth.user.username,\n          email: auth.user.email,\n          fullName: auth.user.fullName,\n        },\n        activeCompany: {\n          id: auth.activeCompany.id,\n          code: auth.activeCompany.code,\n          name: auth.activeCompany.name,\n          companyType: auth.activeCompany.companyType,\n          level: auth.activeCompany.level,\n        },\n        role: auth.role ? {\n          id: auth.role.id,\n          name: auth.role.name,\n          permissions: auth.role.permissions,\n        } : null,\n        allowedCompanyIds: auth.allowedCompanyIds,\n        companyLevel: auth.companyLevel,\n        canConsolidate: auth.canConsolidate,\n      });\n    } catch (error) {\n      console.error(\"Get user error:\", error);\n      res.status(500).json({ error: \"Failed to get user info\" });\n    }\n  });\n\n  // Switch company (requires valid JWT)\n  app.post(\"/api/auth/switch-company\", authenticateJWT, loadAuthContext, async (req: Request, res: Response) => {\n    try {\n      const auth = req.auth;\n      if (!auth) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n\n      const { companyId } = req.body;\n      if (!companyId) {\n        return res.status(400).json({ error: \"Company ID is required\" });\n      }\n\n      const refreshToken = req.cookies?.[AUTH_CONFIG.REFRESH_TOKEN_COOKIE_NAME];\n      if (!refreshToken) {\n        return res.status(401).json({ error: \"Refresh token required for company switch\" });\n      }\n\n      const ipAddress = req.ip || req.socket.remoteAddress;\n      const deviceInfo = req.headers[\"user-agent\"];\n\n      const result = await switchCompany(auth.user.id, companyId, refreshToken, ipAddress, deviceInfo);\n\n      if (!result.success) {\n        return res.status(403).json({ error: result.error });\n      }\n\n      // Set new refresh token\n      if (result.refreshToken) {\n        res.cookie(AUTH_CONFIG.REFRESH_TOKEN_COOKIE_NAME, result.refreshToken, {\n          httpOnly: true,\n          secure: process.env.NODE_ENV === \"production\",\n          sameSite: \"lax\",\n          maxAge: AUTH_CONFIG.REFRESH_TOKEN_EXPIRES_IN * 1000,\n          path: \"/\",\n        });\n      }\n\n      res.json(result.loginResponse);\n    } catch (error) {\n      console.error(\"Switch company error:\", error);\n      res.status(500).json({ error: \"Failed to switch company\" });\n    }\n  });\n\n  // ============================================================================\n  // FIRST-TIME SETUP (Public - only works when system is uninitialized)\n  // ============================================================================\n\n  // Setup status - Check if system needs initial setup\n  app.get(\"/api/setup/status\", async (req: Request, res: Response) => {\n    try {\n      const stats = await storage.getSystemStats();\n      const isInitialized = stats.companyCount > 0;\n      const needsAdminSetup = stats.companyCount > 0 && stats.userCount === 0;\n      \n      // If we need admin setup, include the pending company info\n      let pendingCompany = null;\n      if (needsAdminSetup) {\n        const companies = await storage.getCompanies();\n        if (companies.length > 0) {\n          const company = companies[0];\n          pendingCompany = {\n            id: company.id,\n            code: company.code,\n            name: company.name,\n          };\n        }\n      }\n      \n      res.json({\n        isInitialized,\n        needsCompanySetup: stats.companyCount === 0,\n        needsAdminSetup,\n        pendingCompany,\n        stats,\n      });\n    } catch (error) {\n      console.error(\"Setup status error:\", error);\n      res.status(500).json({ error: \"Failed to get setup status\" });\n    }\n  });\n\n  // Setup company - Create the first company (only when no companies exist)\n  const setupCompanySchema = z.object({\n    code: z.string().min(2).max(20).regex(/^[A-Z0-9-]+$/, \"Code must be uppercase alphanumeric with dashes\"),\n    name: z.string().min(2).max(100),\n    legalName: z.string().optional(),\n    taxId: z.string().optional(),\n    companyType: z.enum([\"holding\", \"subsidiary\", \"branch\"]),\n    currency: z.string().length(3).default(\"USD\"),\n    timezone: z.string().default(\"UTC\"),\n    locale: z.string().default(\"en-US\"),\n    address: z.string().optional(),\n    city: z.string().optional(),\n    state: z.string().optional(),\n    country: z.string().length(2).optional(),\n    postalCode: z.string().optional(),\n    phone: z.string().optional(),\n    email: z.string().email().optional(),\n    website: z.string().url().optional(),\n  });\n\n  app.post(\"/api/setup/company\", async (req: Request, res: Response) => {\n    try {\n      // Only allow if no companies exist\n      const stats = await storage.getSystemStats();\n      if (stats.companyCount > 0) {\n        return res.status(400).json({ \n          error: \"System is already initialized. Cannot create initial company.\" \n        });\n      }\n\n      const parsed = setupCompanySchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ \n          error: \"Invalid company data\", \n          details: parsed.error.errors \n        });\n      }\n\n      const data = parsed.data;\n\n      // First company must be a holding company (level 1)\n      if (data.companyType !== \"holding\") {\n        return res.status(400).json({ \n          error: \"The first company must be a Holding company (top level of hierarchy)\" \n        });\n      }\n\n      // Create the holding company (level and path are auto-calculated by storage)\n      const company = await storage.createCompany({\n        code: data.code,\n        name: data.name,\n        legalName: data.legalName || data.name,\n        taxId: data.taxId,\n        parentId: null,\n        companyType: \"holding\",\n        currency: data.currency,\n        locale: data.locale,\n        timezone: data.timezone,\n        address: data.address,\n        city: data.city,\n        state: data.state,\n        country: data.country,\n        postalCode: data.postalCode,\n        phone: data.phone,\n        email: data.email,\n        website: data.website,\n        consolidationEnabled: true,\n        isActive: true,\n      });\n\n      // Create default company settings\n      await storage.createCompanySettings({\n        companyId: company.id,\n        fiscalYearStart: 1,\n        fiscalYearEnd: 12,\n        defaultPaymentTerms: 30,\n        inventoryCostingMethod: \"fifo\",\n        multiCurrencyEnabled: false,\n        intercompanyEnabled: true,\n        autoPostIntercompany: false,\n      });\n\n      res.status(201).json({\n        success: true,\n        company: {\n          id: company.id,\n          code: company.code,\n          name: company.name,\n          companyType: company.companyType,\n          level: company.level,\n        },\n        nextStep: \"Create the first Super Admin account\",\n      });\n    } catch (error) {\n      console.error(\"Setup company error:\", error);\n      res.status(500).json({ error: \"Failed to create company\" });\n    }\n  });\n\n  // Setup admin - Create the first Super Admin (only when company exists but no users)\n  const setupAdminSchema = z.object({\n    companyId: z.string().uuid(),\n    username: z.string().min(3).max(50).regex(/^[a-zA-Z0-9._-]+$/, \"Username must be alphanumeric with ._-\"),\n    password: z.string().min(8, \"Password must be at least 8 characters\"),\n    email: z.string().email(),\n    fullName: z.string().min(2).max(100),\n  });\n\n  app.post(\"/api/setup/admin\", async (req: Request, res: Response) => {\n    try {\n      // Only allow if company exists but no users\n      const stats = await storage.getSystemStats();\n      if (stats.companyCount === 0) {\n        return res.status(400).json({ \n          error: \"Create a company first before creating the admin account\" \n        });\n      }\n      if (stats.userCount > 0) {\n        return res.status(400).json({ \n          error: \"Admin account already exists. Use login instead.\" \n        });\n      }\n\n      const parsed = setupAdminSchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ \n          error: \"Invalid admin data\", \n          details: parsed.error.errors \n        });\n      }\n\n      const data = parsed.data;\n\n      // Verify company exists\n      const company = await storage.getCompany(data.companyId);\n      if (!company) {\n        return res.status(400).json({ error: \"Invalid company ID\" });\n      }\n\n      // Check if username is taken\n      const existingUser = await storage.getUserByUsername(data.username);\n      if (existingUser) {\n        return res.status(400).json({ error: \"Username already taken\" });\n      }\n\n      // Get or create Super Admin role\n      let adminRole = await storage.getRoleByCode(\"SUPER_ADMIN\");\n      if (!adminRole) {\n        adminRole = await storage.getRoleByCode(\"ADMIN\");\n      }\n      if (!adminRole) {\n        // Create SUPER_ADMIN role if it doesn't exist\n        adminRole = await storage.createRole({\n          code: \"SUPER_ADMIN\",\n          name: \"Super Administrator\",\n          description: \"Full system access with all permissions\",\n          isSystemRole: true,\n          permissions: [\"*\"],\n        });\n      }\n\n      // Create the admin user (password will be hashed by storage layer)\n      const user = await storage.createUser({\n        username: data.username,\n        password: data.password,\n        email: data.email,\n        fullName: data.fullName,\n      });\n\n      // Set the user's default company\n      await storage.updateUser(user.id, { defaultCompanyId: company.id });\n\n      // Assign user to company with admin role\n      await storage.assignUserToCompany({\n        userId: user.id,\n        companyId: company.id,\n        roleId: adminRole.id,\n        isActive: true,\n        isDefault: true,\n      });\n\n      // Log the setup event\n      await storage.createAuthAuditLog({\n        userId: user.id,\n        eventType: \"setup_complete\",\n        companyId: company.id,\n        ipAddress: req.ip || req.socket.remoteAddress,\n        deviceInfo: req.headers[\"user-agent\"],\n        success: true,\n        metadata: { action: \"first_admin_created\" },\n      });\n\n      res.status(201).json({\n        success: true,\n        user: {\n          id: user.id,\n          username: user.username,\n          email: user.email,\n          fullName: user.fullName,\n        },\n        company: {\n          id: company.id,\n          code: company.code,\n          name: company.name,\n        },\n        role: {\n          id: adminRole.id,\n          name: adminRole.name,\n        },\n        message: \"Setup complete! You can now log in with your credentials.\",\n      });\n    } catch (error) {\n      console.error(\"Setup admin error:\", error);\n      res.status(500).json({ error: \"Failed to create admin account\" });\n    }\n  });\n\n  // ============================================================================\n  // COMPANY MANAGEMENT\n  // ============================================================================\n\n  // Get all companies (for company switcher)\n  app.get(\"/api/companies\", async (req: CompanyRequest, res) => {\n    try {\n      const companies = await storage.getCompanies();\n      res.json(companies);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch companies\" });\n    }\n  });\n\n  // Get company hierarchy - PUBLIC (must come before /:id route)\n  app.get(\"/api/companies/hierarchy\", async (req: CompanyRequest, res) => {\n    try {\n      const rootId = req.query.rootId as string | undefined;\n      const hierarchy = await storage.getCompanyHierarchy(rootId);\n      res.json(hierarchy);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch company hierarchy\" });\n    }\n  });\n\n  // Get single company (must come after /hierarchy)\n  app.get(\"/api/companies/:id\", async (req: CompanyRequest, res) => {\n    try {\n      const company = await storage.getCompany(req.params.id);\n      if (!company) {\n        return res.status(404).json({ error: \"Company not found\" });\n      }\n      res.json(company);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch company\" });\n    }\n  });\n\n  // Create company\n  app.post(\"/api/companies\", async (req: CompanyRequest, res) => {\n    try {\n      const parsed = insertCompanySchema.parse(req.body);\n      const company = await storage.createCompany(parsed);\n      res.status(201).json(company);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      res.status(500).json({ error: \"Failed to create company\" });\n    }\n  });\n\n  // Update company\n  app.patch(\"/api/companies/:id\", async (req: CompanyRequest, res) => {\n    try {\n      const company = await storage.updateCompany(req.params.id, req.body);\n      if (!company) {\n        return res.status(404).json({ error: \"Company not found\" });\n      }\n      res.json(company);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update company\" });\n    }\n  });\n\n  // Get child companies\n  app.get(\"/api/companies/:id/children\", async (req: CompanyRequest, res) => {\n    try {\n      const children = await storage.getChildCompanies(req.params.id);\n      res.json(children);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch child companies\" });\n    }\n  });\n\n  // ============================================================================\n  // COMPANY CONTEXT & SESSION\n  // ============================================================================\n\n  // Get user's companies\n  app.get(\"/api/users/:userId/companies\", async (req: CompanyRequest, res) => {\n    try {\n      const companies = await storage.getUserCompanies(req.params.userId);\n      res.json(companies);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch user companies\" });\n    }\n  });\n\n  // Switch company (get new context)\n  app.post(\"/api/session/switch-company\", async (req: CompanyRequest, res) => {\n    try {\n      const { userId, companyId } = req.body;\n      if (!userId || !companyId) {\n        return res.status(400).json({ error: \"userId and companyId required\" });\n      }\n\n      const context = await storage.getCompanyContext(userId, companyId);\n      if (!context) {\n        return res.status(403).json({ error: \"User does not have access to this company\" });\n      }\n\n      // Update user's default company\n      await storage.updateUser(userId, { defaultCompanyId: companyId });\n\n      res.json(context);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to switch company\" });\n    }\n  });\n\n  // Get current company context\n  app.get(\"/api/session/context\", async (req: CompanyRequest, res) => {\n    try {\n      const userId = req.headers[\"x-user-id\"] as string;\n      const companyId = req.headers[\"x-company-id\"] as string;\n\n      if (!userId || !companyId) {\n        return res.status(400).json({ error: \"x-user-id and x-company-id headers required\" });\n      }\n\n      const context = await storage.getCompanyContext(userId, companyId);\n      if (!context) {\n        return res.status(403).json({ error: \"Invalid context\" });\n      }\n\n      res.json(context);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to get context\" });\n    }\n  });\n\n  // ============================================================================\n  // USER-COMPANY ROLE MANAGEMENT\n  // ============================================================================\n\n  // Get roles\n  app.get(\"/api/roles\", async (req: CompanyRequest, res) => {\n    try {\n      const roles = await storage.getRoles();\n      res.json(roles);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch roles\" });\n    }\n  });\n\n  // Assign user to company\n  app.post(\"/api/user-company-roles\", async (req: CompanyRequest, res) => {\n    try {\n      const parsed = insertUserCompanyRoleSchema.parse(req.body);\n      const assignment = await storage.assignUserToCompany(parsed);\n      res.status(201).json(assignment);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      res.status(500).json({ error: \"Failed to assign user to company\" });\n    }\n  });\n\n  // Remove user from company\n  app.delete(\"/api/user-company-roles/:userId/:companyId\", async (req: CompanyRequest, res) => {\n    try {\n      await storage.removeUserFromCompany(req.params.userId, req.params.companyId);\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to remove user from company\" });\n    }\n  });\n\n  // ============================================================================\n  // COMPANY-SCOPED MASTER DATA\n  // ============================================================================\n\n  // Chart of Accounts\n  app.get(\"/api/companies/:companyId/accounts\", async (req: CompanyRequest, res) => {\n    try {\n      const accounts = await storage.getAccounts(req.params.companyId);\n      res.json(accounts);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch accounts\" });\n    }\n  });\n\n  app.post(\"/api/companies/:companyId/accounts\", async (req: CompanyRequest, res) => {\n    try {\n      const parsed = insertAccountSchema.parse({\n        ...req.body,\n        companyId: req.params.companyId,\n      });\n      const account = await storage.createAccount(parsed);\n      res.status(201).json(account);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      res.status(500).json({ error: \"Failed to create account\" });\n    }\n  });\n\n  app.patch(\"/api/companies/:companyId/accounts/:accountId\", async (req: CompanyRequest, res) => {\n    try {\n      const account = await storage.getAccount(req.params.accountId);\n      if (!account) {\n        return res.status(404).json({ error: \"Account not found\" });\n      }\n      if (account.companyId !== req.params.companyId) {\n        return res.status(403).json({ error: \"Account does not belong to this company\" });\n      }\n      // Sanitize: remove ownership fields from update payload to prevent cross-company tampering\n      const { companyId, id, ...sanitizedUpdates } = req.body;\n      const updated = await storage.updateAccount(req.params.accountId, sanitizedUpdates);\n      res.json(updated);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update account\" });\n    }\n  });\n\n  app.delete(\"/api/companies/:companyId/accounts/:accountId\", async (req: CompanyRequest, res) => {\n    try {\n      const account = await storage.getAccount(req.params.accountId);\n      if (!account) {\n        return res.status(404).json({ error: \"Account not found\" });\n      }\n      if (account.companyId !== req.params.companyId) {\n        return res.status(403).json({ error: \"Account does not belong to this company\" });\n      }\n      const deleted = await storage.deleteAccount(req.params.accountId);\n      if (!deleted) {\n        return res.status(400).json({ error: \"Cannot delete account with child accounts\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete account\" });\n    }\n  });\n\n  // Warehouses\n  app.get(\"/api/companies/:companyId/warehouses\", async (req: CompanyRequest, res) => {\n    try {\n      const warehouses = await storage.getWarehouses(req.params.companyId);\n      res.json(warehouses);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch warehouses\" });\n    }\n  });\n\n  app.post(\"/api/companies/:companyId/warehouses\", async (req: CompanyRequest, res) => {\n    try {\n      const parsed = insertWarehouseSchema.parse({\n        ...req.body,\n        companyId: req.params.companyId,\n      });\n      const warehouse = await storage.createWarehouse(parsed);\n      res.status(201).json(warehouse);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      res.status(500).json({ error: \"Failed to create warehouse\" });\n    }\n  });\n\n  app.patch(\"/api/companies/:companyId/warehouses/:warehouseId\", async (req: CompanyRequest, res) => {\n    try {\n      const warehouse = await storage.getWarehouse(req.params.warehouseId);\n      if (!warehouse) {\n        return res.status(404).json({ error: \"Warehouse not found\" });\n      }\n      if (warehouse.companyId !== req.params.companyId) {\n        return res.status(403).json({ error: \"Warehouse does not belong to this company\" });\n      }\n      // Sanitize: remove ownership fields from update payload to prevent cross-company tampering\n      const { companyId, id, ...sanitizedUpdates } = req.body;\n      const updated = await storage.updateWarehouse(req.params.warehouseId, sanitizedUpdates);\n      res.json(updated);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update warehouse\" });\n    }\n  });\n\n  app.delete(\"/api/companies/:companyId/warehouses/:warehouseId\", async (req: CompanyRequest, res) => {\n    try {\n      const warehouse = await storage.getWarehouse(req.params.warehouseId);\n      if (!warehouse) {\n        return res.status(404).json({ error: \"Warehouse not found\" });\n      }\n      if (warehouse.companyId !== req.params.companyId) {\n        return res.status(403).json({ error: \"Warehouse does not belong to this company\" });\n      }\n      await storage.deleteWarehouse(req.params.warehouseId);\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete warehouse\" });\n    }\n  });\n\n  // Products\n  app.get(\"/api/companies/:companyId/products\", async (req: CompanyRequest, res) => {\n    try {\n      const products = await storage.getProducts(req.params.companyId);\n      res.json(products);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch products\" });\n    }\n  });\n\n  app.post(\"/api/companies/:companyId/products\", async (req: CompanyRequest, res) => {\n    try {\n      const parsed = insertProductSchema.parse({\n        ...req.body,\n        companyId: req.params.companyId,\n      });\n      const product = await storage.createProduct(parsed);\n      res.status(201).json(product);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      res.status(500).json({ error: \"Failed to create product\" });\n    }\n  });\n\n  app.patch(\"/api/companies/:companyId/products/:productId\", async (req: CompanyRequest, res) => {\n    try {\n      const product = await storage.getProduct(req.params.productId);\n      if (!product) {\n        return res.status(404).json({ error: \"Product not found\" });\n      }\n      if (product.companyId !== req.params.companyId) {\n        return res.status(403).json({ error: \"Product does not belong to this company\" });\n      }\n      // Sanitize: remove ownership fields from update payload to prevent cross-company tampering\n      const { companyId, id, ...sanitizedUpdates } = req.body;\n      const updated = await storage.updateProduct(req.params.productId, sanitizedUpdates);\n      res.json(updated);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update product\" });\n    }\n  });\n\n  app.delete(\"/api/companies/:companyId/products/:productId\", async (req: CompanyRequest, res) => {\n    try {\n      const product = await storage.getProduct(req.params.productId);\n      if (!product) {\n        return res.status(404).json({ error: \"Product not found\" });\n      }\n      if (product.companyId !== req.params.companyId) {\n        return res.status(403).json({ error: \"Product does not belong to this company\" });\n      }\n      await storage.deleteProduct(req.params.productId);\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete product\" });\n    }\n  });\n\n  // Customers\n  app.get(\"/api/companies/:companyId/customers\", async (req: CompanyRequest, res) => {\n    try {\n      const customers = await storage.getCustomers(req.params.companyId);\n      res.json(customers);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch customers\" });\n    }\n  });\n\n  app.post(\"/api/companies/:companyId/customers\", async (req: CompanyRequest, res) => {\n    try {\n      const parsed = insertCustomerSchema.parse({\n        ...req.body,\n        companyId: req.params.companyId,\n      });\n      const customer = await storage.createCustomer(parsed);\n      res.status(201).json(customer);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      res.status(500).json({ error: \"Failed to create customer\" });\n    }\n  });\n\n  app.patch(\"/api/companies/:companyId/customers/:customerId\", async (req: CompanyRequest, res) => {\n    try {\n      const customer = await storage.getCustomer(req.params.customerId);\n      if (!customer) {\n        return res.status(404).json({ error: \"Customer not found\" });\n      }\n      if (customer.companyId !== req.params.companyId) {\n        return res.status(403).json({ error: \"Customer does not belong to this company\" });\n      }\n      // Sanitize: remove ownership fields from update payload to prevent cross-company tampering\n      const { companyId, id, ...sanitizedUpdates } = req.body;\n      const updated = await storage.updateCustomer(req.params.customerId, sanitizedUpdates);\n      res.json(updated);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update customer\" });\n    }\n  });\n\n  app.delete(\"/api/companies/:companyId/customers/:customerId\", async (req: CompanyRequest, res) => {\n    try {\n      const customer = await storage.getCustomer(req.params.customerId);\n      if (!customer) {\n        return res.status(404).json({ error: \"Customer not found\" });\n      }\n      if (customer.companyId !== req.params.companyId) {\n        return res.status(403).json({ error: \"Customer does not belong to this company\" });\n      }\n      await storage.deleteCustomer(req.params.customerId);\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete customer\" });\n    }\n  });\n\n  // Vendors\n  app.get(\"/api/companies/:companyId/vendors\", async (req: CompanyRequest, res) => {\n    try {\n      const vendors = await storage.getVendors(req.params.companyId);\n      res.json(vendors);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch vendors\" });\n    }\n  });\n\n  app.post(\"/api/companies/:companyId/vendors\", async (req: CompanyRequest, res) => {\n    try {\n      const parsed = insertVendorSchema.parse({\n        ...req.body,\n        companyId: req.params.companyId,\n      });\n      const vendor = await storage.createVendor(parsed);\n      res.status(201).json(vendor);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      res.status(500).json({ error: \"Failed to create vendor\" });\n    }\n  });\n\n  app.patch(\"/api/companies/:companyId/vendors/:vendorId\", async (req: CompanyRequest, res) => {\n    try {\n      const vendor = await storage.getVendor(req.params.vendorId);\n      if (!vendor) {\n        return res.status(404).json({ error: \"Vendor not found\" });\n      }\n      if (vendor.companyId !== req.params.companyId) {\n        return res.status(403).json({ error: \"Vendor does not belong to this company\" });\n      }\n      // Sanitize: remove ownership fields from update payload to prevent cross-company tampering\n      const { companyId, id, ...sanitizedUpdates } = req.body;\n      const updated = await storage.updateVendor(req.params.vendorId, sanitizedUpdates);\n      res.json(updated);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update vendor\" });\n    }\n  });\n\n  app.delete(\"/api/companies/:companyId/vendors/:vendorId\", async (req: CompanyRequest, res) => {\n    try {\n      const vendor = await storage.getVendor(req.params.vendorId);\n      if (!vendor) {\n        return res.status(404).json({ error: \"Vendor not found\" });\n      }\n      if (vendor.companyId !== req.params.companyId) {\n        return res.status(403).json({ error: \"Vendor does not belong to this company\" });\n      }\n      await storage.deleteVendor(req.params.vendorId);\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete vendor\" });\n    }\n  });\n\n  // Taxes\n  app.get(\"/api/companies/:companyId/taxes\", async (req: CompanyRequest, res) => {\n    try {\n      const taxes = await storage.getTaxes(req.params.companyId);\n      res.json(taxes);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch taxes\" });\n    }\n  });\n\n  app.post(\"/api/companies/:companyId/taxes\", async (req: CompanyRequest, res) => {\n    try {\n      const parsed = insertTaxSchema.parse({\n        ...req.body,\n        companyId: req.params.companyId,\n      });\n      const tax = await storage.createTax(parsed);\n      res.status(201).json(tax);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      res.status(500).json({ error: \"Failed to create tax\" });\n    }\n  });\n\n  app.patch(\"/api/companies/:companyId/taxes/:taxId\", async (req: CompanyRequest, res) => {\n    try {\n      const tax = await storage.getTax(req.params.taxId);\n      if (!tax) {\n        return res.status(404).json({ error: \"Tax not found\" });\n      }\n      if (tax.companyId !== req.params.companyId) {\n        return res.status(403).json({ error: \"Tax belongs to different company\" });\n      }\n      // Sanitize: remove ownership fields from update payload to prevent cross-company tampering\n      const { companyId, id, ...sanitizedUpdates } = req.body;\n      const updated = await storage.updateTax(req.params.taxId, sanitizedUpdates);\n      res.json(updated);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update tax\" });\n    }\n  });\n\n  app.delete(\"/api/companies/:companyId/taxes/:taxId\", async (req: CompanyRequest, res) => {\n    try {\n      const tax = await storage.getTax(req.params.taxId);\n      if (!tax) {\n        return res.status(404).json({ error: \"Tax not found\" });\n      }\n      if (tax.companyId !== req.params.companyId) {\n        return res.status(403).json({ error: \"Tax belongs to different company\" });\n      }\n      await storage.deleteTax(req.params.taxId);\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete tax\" });\n    }\n  });\n\n  // Employees\n  app.get(\"/api/companies/:companyId/employees\", async (req: CompanyRequest, res) => {\n    try {\n      const employees = await storage.getEmployees(req.params.companyId);\n      res.json(employees);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch employees\" });\n    }\n  });\n\n  app.post(\"/api/companies/:companyId/employees\", async (req: CompanyRequest, res) => {\n    try {\n      const parsed = insertEmployeeSchema.parse({\n        ...req.body,\n        companyId: req.params.companyId,\n      });\n      const employee = await storage.createEmployee(parsed);\n      res.status(201).json(employee);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      res.status(500).json({ error: \"Failed to create employee\" });\n    }\n  });\n\n  app.patch(\"/api/companies/:companyId/employees/:employeeId\", async (req: CompanyRequest, res) => {\n    try {\n      const employee = await storage.getEmployee(req.params.employeeId);\n      if (!employee) {\n        return res.status(404).json({ error: \"Employee not found\" });\n      }\n      if (employee.companyId !== req.params.companyId) {\n        return res.status(403).json({ error: \"Employee belongs to different company\" });\n      }\n      // Sanitize: remove ownership fields from update payload to prevent cross-company tampering\n      const { companyId, id, employeeNumber, ...sanitizedUpdates } = req.body;\n      const updated = await storage.updateEmployee(req.params.employeeId, sanitizedUpdates);\n      res.json(updated);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update employee\" });\n    }\n  });\n\n  app.delete(\"/api/companies/:companyId/employees/:employeeId\", async (req: CompanyRequest, res) => {\n    try {\n      const employee = await storage.getEmployee(req.params.employeeId);\n      if (!employee) {\n        return res.status(404).json({ error: \"Employee not found\" });\n      }\n      if (employee.companyId !== req.params.companyId) {\n        return res.status(403).json({ error: \"Employee belongs to different company\" });\n      }\n      await storage.deleteEmployee(req.params.employeeId);\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete employee\" });\n    }\n  });\n\n  // Journal Entries\n  app.get(\"/api/companies/:companyId/journal-entries\", async (req: CompanyRequest, res) => {\n    try {\n      const entries = await storage.getJournalEntries(req.params.companyId);\n      res.json(entries);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch journal entries\" });\n    }\n  });\n\n  app.post(\"/api/companies/:companyId/journal-entries\", async (req: CompanyRequest, res) => {\n    try {\n      const parsed = insertJournalEntrySchema.parse({\n        ...req.body,\n        companyId: req.params.companyId,\n      });\n      const entry = await storage.createJournalEntry(parsed);\n      res.status(201).json(entry);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      res.status(500).json({ error: \"Failed to create journal entry\" });\n    }\n  });\n\n  app.patch(\"/api/companies/:companyId/journal-entries/:entryId\", async (req: CompanyRequest, res) => {\n    try {\n      const entry = await storage.getJournalEntry(req.params.entryId);\n      if (!entry) {\n        return res.status(404).json({ error: \"Journal entry not found\" });\n      }\n      if (entry.companyId !== req.params.companyId) {\n        return res.status(403).json({ error: \"Journal entry belongs to different company\" });\n      }\n      // Sanitize: remove ownership fields from update payload to prevent cross-company tampering\n      const { companyId, id, createdAt, ...sanitizedUpdates } = req.body;\n      const updated = await storage.updateJournalEntry(req.params.entryId, sanitizedUpdates);\n      res.json(updated);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update journal entry\" });\n    }\n  });\n\n  app.delete(\"/api/companies/:companyId/journal-entries/:entryId\", async (req: CompanyRequest, res) => {\n    try {\n      const entry = await storage.getJournalEntry(req.params.entryId);\n      if (!entry) {\n        return res.status(404).json({ error: \"Journal entry not found\" });\n      }\n      if (entry.companyId !== req.params.companyId) {\n        return res.status(403).json({ error: \"Journal entry belongs to different company\" });\n      }\n      await storage.deleteJournalEntry(req.params.entryId);\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete journal entry\" });\n    }\n  });\n\n  // Fiscal Periods\n  app.get(\"/api/companies/:companyId/fiscal-periods\", async (req: CompanyRequest, res) => {\n    try {\n      const periods = await storage.getFiscalPeriods(req.params.companyId);\n      res.json(periods);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch fiscal periods\" });\n    }\n  });\n\n  app.post(\"/api/companies/:companyId/fiscal-periods\", async (req: CompanyRequest, res) => {\n    try {\n      const parsed = insertFiscalPeriodSchema.parse({\n        ...req.body,\n        companyId: req.params.companyId,\n      });\n      const period = await storage.createFiscalPeriod(parsed);\n      res.status(201).json(period);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      res.status(500).json({ error: \"Failed to create fiscal period\" });\n    }\n  });\n\n  // ============================================================================\n  // TRANSACTIONS (COMPANY-SCOPED)\n  // ============================================================================\n\n  // Sales Orders\n  app.get(\"/api/companies/:companyId/sales-orders\", async (req: CompanyRequest, res) => {\n    try {\n      const orders = await storage.getSalesOrders(req.params.companyId);\n      res.json(orders);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch sales orders\" });\n    }\n  });\n\n  app.post(\"/api/companies/:companyId/sales-orders\", async (req: CompanyRequest, res) => {\n    try {\n      const parsed = insertSalesOrderSchema.parse({\n        ...req.body,\n        companyId: req.params.companyId,\n      });\n      const order = await storage.createSalesOrder(parsed);\n      res.status(201).json(order);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      res.status(500).json({ error: \"Failed to create sales order\" });\n    }\n  });\n\n  app.patch(\"/api/companies/:companyId/sales-orders/:orderId\", async (req: CompanyRequest, res) => {\n    try {\n      const order = await storage.getSalesOrder(req.params.orderId);\n      if (!order) {\n        return res.status(404).json({ error: \"Sales order not found\" });\n      }\n      if (order.companyId !== req.params.companyId) {\n        return res.status(403).json({ error: \"Order belongs to different company\" });\n      }\n      // Sanitize: remove ownership fields from update payload to prevent cross-company tampering\n      const { companyId, id, orderNumber, ...sanitizedUpdates } = req.body;\n      const updated = await storage.updateSalesOrder(req.params.orderId, sanitizedUpdates);\n      res.json(updated);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update sales order\" });\n    }\n  });\n\n  app.delete(\"/api/companies/:companyId/sales-orders/:orderId\", async (req: CompanyRequest, res) => {\n    try {\n      const order = await storage.getSalesOrder(req.params.orderId);\n      if (!order) {\n        return res.status(404).json({ error: \"Sales order not found\" });\n      }\n      if (order.companyId !== req.params.companyId) {\n        return res.status(403).json({ error: \"Order belongs to different company\" });\n      }\n      await storage.deleteSalesOrder(req.params.orderId);\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete sales order\" });\n    }\n  });\n\n  app.get(\"/api/companies/:companyId/sales-orders/:orderId/lines\", async (req: CompanyRequest, res) => {\n    try {\n      const order = await storage.getSalesOrder(req.params.orderId);\n      if (!order) {\n        return res.status(404).json({ error: \"Sales order not found\" });\n      }\n      if (order.companyId !== req.params.companyId) {\n        return res.status(403).json({ error: \"Order belongs to different company\" });\n      }\n      const lines = await storage.getSalesOrderLines(req.params.orderId);\n      res.json(lines);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch sales order lines\" });\n    }\n  });\n\n  // Purchase Orders\n  app.get(\"/api/companies/:companyId/purchase-orders\", async (req: CompanyRequest, res) => {\n    try {\n      const orders = await storage.getPurchaseOrders(req.params.companyId);\n      res.json(orders);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch purchase orders\" });\n    }\n  });\n\n  app.post(\"/api/companies/:companyId/purchase-orders\", async (req: CompanyRequest, res) => {\n    try {\n      const parsed = insertPurchaseOrderSchema.parse({\n        ...req.body,\n        companyId: req.params.companyId,\n      });\n      const order = await storage.createPurchaseOrder(parsed);\n      res.status(201).json(order);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: error.errors });\n      }\n      res.status(500).json({ error: \"Failed to create purchase order\" });\n    }\n  });\n\n  app.patch(\"/api/companies/:companyId/purchase-orders/:orderId\", async (req: CompanyRequest, res) => {\n    try {\n      const order = await storage.getPurchaseOrder(req.params.orderId);\n      if (!order) {\n        return res.status(404).json({ error: \"Purchase order not found\" });\n      }\n      if (order.companyId !== req.params.companyId) {\n        return res.status(403).json({ error: \"Order belongs to different company\" });\n      }\n      // Sanitize: remove ownership fields from update payload to prevent cross-company tampering\n      const { companyId, id, orderNumber, ...sanitizedUpdates } = req.body;\n      const updated = await storage.updatePurchaseOrder(req.params.orderId, sanitizedUpdates);\n      res.json(updated);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update purchase order\" });\n    }\n  });\n\n  app.delete(\"/api/companies/:companyId/purchase-orders/:orderId\", async (req: CompanyRequest, res) => {\n    try {\n      const order = await storage.getPurchaseOrder(req.params.orderId);\n      if (!order) {\n        return res.status(404).json({ error: \"Purchase order not found\" });\n      }\n      if (order.companyId !== req.params.companyId) {\n        return res.status(403).json({ error: \"Order belongs to different company\" });\n      }\n      await storage.deletePurchaseOrder(req.params.orderId);\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete purchase order\" });\n    }\n  });\n\n  app.get(\"/api/companies/:companyId/purchase-orders/:orderId/lines\", async (req: CompanyRequest, res) => {\n    try {\n      const order = await storage.getPurchaseOrder(req.params.orderId);\n      if (!order) {\n        return res.status(404).json({ error: \"Purchase order not found\" });\n      }\n      if (order.companyId !== req.params.companyId) {\n        return res.status(403).json({ error: \"Order belongs to different company\" });\n      }\n      const lines = await storage.getPurchaseOrderLines(req.params.orderId);\n      res.json(lines);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch purchase order lines\" });\n    }\n  });\n\n  // ============================================================================\n  // WORKFLOW ACTIONS - SALES ORDER LIFECYCLE\n  // ============================================================================\n\n  // Confirm Sales Order - reserves stock\n  app.post(\"/api/companies/:companyId/sales-orders/:orderId/confirm\", async (req: CompanyRequest, res) => {\n    try {\n      const { workflowService } = await import(\"./services/workflow-service\");\n      const order = await storage.getSalesOrder(req.params.orderId);\n      if (!order) {\n        return res.status(404).json({ error: \"Sales order not found\" });\n      }\n      if (order.companyId !== req.params.companyId) {\n        return res.status(403).json({ error: \"Order belongs to different company\" });\n      }\n      const result = await workflowService.confirmSalesOrder(\n        req.params.orderId,\n        req.userId || \"\"\n      );\n      res.json({\n        success: true,\n        message: \"Sales order confirmed and stock reserved\",\n        salesOrder: result.salesOrder,\n        reservations: result.reservations\n      });\n    } catch (error: any) {\n      res.status(400).json({ error: error.message || \"Failed to confirm sales order\" });\n    }\n  });\n\n  // Deliver Sales Order - reduces stock, creates delivery note\n  app.post(\"/api/companies/:companyId/sales-orders/:orderId/deliver\", async (req: CompanyRequest, res) => {\n    try {\n      const { workflowService } = await import(\"./services/workflow-service\");\n      const order = await storage.getSalesOrder(req.params.orderId);\n      if (!order) {\n        return res.status(404).json({ error: \"Sales order not found\" });\n      }\n      if (order.companyId !== req.params.companyId) {\n        return res.status(403).json({ error: \"Order belongs to different company\" });\n      }\n      const result = await workflowService.createDeliveryFromSalesOrder(\n        req.params.orderId,\n        req.userId || \"\"\n      );\n      res.json({\n        success: true,\n        message: \"Delivery created and inventory updated\",\n        delivery: result.delivery,\n        deliveryLines: result.deliveryLines,\n        stockMovements: result.stockMovements,\n        journalEntry: result.journalEntry\n      });\n    } catch (error: any) {\n      res.status(400).json({ error: error.message || \"Failed to create delivery\" });\n    }\n  });\n\n  // Invoice Sales Order - creates AR invoice\n  app.post(\"/api/companies/:companyId/sales-orders/:orderId/invoice\", async (req: CompanyRequest, res) => {\n    try {\n      const { workflowService } = await import(\"./services/workflow-service\");\n      const order = await storage.getSalesOrder(req.params.orderId);\n      if (!order) {\n        return res.status(404).json({ error: \"Sales order not found\" });\n      }\n      if (order.companyId !== req.params.companyId) {\n        return res.status(403).json({ error: \"Order belongs to different company\" });\n      }\n      const result = await workflowService.createInvoiceFromSalesOrder(\n        req.params.orderId,\n        req.userId || \"\"\n      );\n      res.json({\n        success: true,\n        message: \"Invoice created and AR updated\",\n        invoice: result.invoice,\n        invoiceLines: result.invoiceLines,\n        journalEntry: result.journalEntry,\n        arLedgerEntry: result.arLedgerEntry\n      });\n    } catch (error: any) {\n      res.status(400).json({ error: error.message || \"Failed to create invoice\" });\n    }\n  });\n\n  // ============================================================================\n  // WORKFLOW ACTIONS - PURCHASE ORDER LIFECYCLE\n  // ============================================================================\n\n  // Confirm Purchase Order\n  app.post(\"/api/companies/:companyId/purchase-orders/:orderId/confirm\", async (req: CompanyRequest, res) => {\n    try {\n      const { workflowService } = await import(\"./services/workflow-service\");\n      const order = await storage.getPurchaseOrder(req.params.orderId);\n      if (!order) {\n        return res.status(404).json({ error: \"Purchase order not found\" });\n      }\n      if (order.companyId !== req.params.companyId) {\n        return res.status(403).json({ error: \"Order belongs to different company\" });\n      }\n      const result = await workflowService.confirmPurchaseOrder(\n        req.params.orderId,\n        req.userId || \"\"\n      );\n      res.json({\n        success: true,\n        message: \"Purchase order confirmed\",\n        purchaseOrder: result\n      });\n    } catch (error: any) {\n      res.status(400).json({ error: error.message || \"Failed to confirm purchase order\" });\n    }\n  });\n\n  // Receive Goods from Purchase Order - increases stock\n  app.post(\"/api/companies/:companyId/purchase-orders/:orderId/receive\", async (req: CompanyRequest, res) => {\n    try {\n      const { workflowService } = await import(\"./services/workflow-service\");\n      const order = await storage.getPurchaseOrder(req.params.orderId);\n      if (!order) {\n        return res.status(404).json({ error: \"Purchase order not found\" });\n      }\n      if (order.companyId !== req.params.companyId) {\n        return res.status(403).json({ error: \"Order belongs to different company\" });\n      }\n      const result = await workflowService.receiveGoodsFromPurchaseOrder(\n        req.params.orderId,\n        req.userId || \"\"\n      );\n      res.json({\n        success: true,\n        message: \"Goods received and inventory updated\",\n        goodsReceipt: result.goodsReceipt,\n        goodsReceiptLines: result.goodsReceiptLines,\n        stockMovements: result.stockMovements,\n        journalEntry: result.journalEntry\n      });\n    } catch (error: any) {\n      res.status(400).json({ error: error.message || \"Failed to receive goods\" });\n    }\n  });\n\n  // Bill Purchase Order - creates AP invoice\n  app.post(\"/api/companies/:companyId/purchase-orders/:orderId/bill\", async (req: CompanyRequest, res) => {\n    try {\n      const { workflowService } = await import(\"./services/workflow-service\");\n      const order = await storage.getPurchaseOrder(req.params.orderId);\n      if (!order) {\n        return res.status(404).json({ error: \"Purchase order not found\" });\n      }\n      if (order.companyId !== req.params.companyId) {\n        return res.status(403).json({ error: \"Order belongs to different company\" });\n      }\n      const result = await workflowService.createVendorInvoice(\n        req.params.orderId,\n        req.userId || \"\"\n      );\n      res.json({\n        success: true,\n        message: \"Vendor invoice created and AP updated\",\n        invoice: result.invoice,\n        invoiceLines: result.invoiceLines,\n        journalEntry: result.journalEntry,\n        apLedgerEntry: result.apLedgerEntry\n      });\n    } catch (error: any) {\n      res.status(400).json({ error: error.message || \"Failed to create vendor invoice\" });\n    }\n  });\n\n  // ============================================================================\n  // WORKFLOW ACTIONS - PAYMENTS\n  // ============================================================================\n\n  // Receive Customer Payment\n  app.post(\"/api/companies/:companyId/payments/receive\", async (req: CompanyRequest, res) => {\n    try {\n      const { workflowService } = await import(\"./services/workflow-service\");\n      const { customerId, invoiceIds, amount, paymentMethod, bankAccountId } = req.body;\n      \n      if (!customerId || !amount) {\n        return res.status(400).json({ error: \"Customer ID and amount are required\" });\n      }\n\n      const result = await workflowService.receivePayment(\n        req.params.companyId,\n        customerId,\n        invoiceIds || [],\n        parseFloat(amount),\n        paymentMethod || \"bank_transfer\",\n        bankAccountId || \"\",\n        req.userId || \"\"\n      );\n      res.json({\n        success: true,\n        message: \"Payment received and AR updated\",\n        payment: result.payment,\n        applications: result.applications,\n        journalEntry: result.journalEntry,\n        arLedgerEntry: result.arLedgerEntry\n      });\n    } catch (error: any) {\n      res.status(400).json({ error: error.message || \"Failed to receive payment\" });\n    }\n  });\n\n  // Make Vendor Payment\n  app.post(\"/api/companies/:companyId/payments/pay\", async (req: CompanyRequest, res) => {\n    try {\n      const { workflowService } = await import(\"./services/workflow-service\");\n      const { vendorId, invoiceIds, amount, paymentMethod, bankAccountId } = req.body;\n      \n      if (!vendorId || !amount) {\n        return res.status(400).json({ error: \"Vendor ID and amount are required\" });\n      }\n\n      const result = await workflowService.makeVendorPayment(\n        req.params.companyId,\n        vendorId,\n        invoiceIds || [],\n        parseFloat(amount),\n        paymentMethod || \"bank_transfer\",\n        bankAccountId || \"\",\n        req.userId || \"\"\n      );\n      res.json({\n        success: true,\n        message: \"Payment made and AP updated\",\n        payment: result.payment,\n        applications: result.applications,\n        journalEntry: result.journalEntry,\n        apLedgerEntry: result.apLedgerEntry\n      });\n    } catch (error: any) {\n      res.status(400).json({ error: error.message || \"Failed to make payment\" });\n    }\n  });\n\n  // ============================================================================\n  // STOCK LEVELS & INVENTORY QUERIES\n  // ============================================================================\n\n  // Get stock levels for a company\n  app.get(\"/api/companies/:companyId/stock-levels\", async (req: CompanyRequest, res) => {\n    try {\n      const stockLevels = await storage.getStockLevels(req.params.companyId);\n      res.json(stockLevels);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch stock levels\" });\n    }\n  });\n\n  // Get stock movements for a company\n  app.get(\"/api/companies/:companyId/stock-movements\", async (req: CompanyRequest, res) => {\n    try {\n      const movements = await storage.getStockMovements(req.params.companyId);\n      res.json(movements);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch stock movements\" });\n    }\n  });\n\n  // Get invoices for a company\n  app.get(\"/api/companies/:companyId/invoices\", async (req: CompanyRequest, res) => {\n    try {\n      const invoices = await storage.getInvoices(req.params.companyId);\n      res.json(invoices);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch invoices\" });\n    }\n  });\n\n  // Get deliveries for a company\n  app.get(\"/api/companies/:companyId/deliveries\", async (req: CompanyRequest, res) => {\n    try {\n      const deliveries = await storage.getDeliveries(req.params.companyId);\n      res.json(deliveries);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch deliveries\" });\n    }\n  });\n\n  // Get goods receipts for a company\n  app.get(\"/api/companies/:companyId/goods-receipts\", async (req: CompanyRequest, res) => {\n    try {\n      const receipts = await storage.getGoodsReceipts(req.params.companyId);\n      res.json(receipts);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch goods receipts\" });\n    }\n  });\n\n  // Get payments for a company\n  app.get(\"/api/companies/:companyId/payments\", async (req: CompanyRequest, res) => {\n    try {\n      const payments = await storage.getPayments(req.params.companyId);\n      res.json(payments);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch payments\" });\n    }\n  });\n\n  // Get AR/AP ledger entries\n  app.get(\"/api/companies/:companyId/ledger/:ledgerType\", async (req: CompanyRequest, res) => {\n    try {\n      const { ledgerType } = req.params;\n      if (![\"AR\", \"AP\"].includes(ledgerType)) {\n        return res.status(400).json({ error: \"Ledger type must be AR or AP\" });\n      }\n      const entries = await storage.getArApLedger(req.params.companyId, ledgerType);\n      res.json(entries);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch ledger entries\" });\n    }\n  });\n\n  // ============================================================================\n  // INTERCOMPANY TRANSACTIONS\n  // ============================================================================\n\n  // Get intercompany transfers\n  app.get(\"/api/companies/:companyId/intercompany-transfers\", async (req: CompanyRequest, res) => {\n    try {\n      const transfers = await storage.getIntercompanyTransfers(req.params.companyId);\n      res.json(transfers);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch intercompany transfers\" });\n    }\n  });\n\n  // Create intercompany transfer\n  app.post(\"/api/companies/:companyId/intercompany-transfers\", async (req: CompanyRequest, res) => {\n    try {\n      const transfer = await storage.createIntercompanyTransfer({\n        ...req.body,\n        sourceCompanyId: req.params.companyId,\n      });\n      res.status(201).json(transfer);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to create intercompany transfer\" });\n    }\n  });\n\n  // Update intercompany transfer status\n  app.patch(\"/api/intercompany-transfers/:id\", async (req: CompanyRequest, res) => {\n    try {\n      const transfer = await storage.updateIntercompanyTransfer(req.params.id, req.body);\n      if (!transfer) {\n        return res.status(404).json({ error: \"Transfer not found\" });\n      }\n      res.json(transfer);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update intercompany transfer\" });\n    }\n  });\n\n  // Get single intercompany transfer\n  app.get(\"/api/intercompany-transfers/:id\", async (req: CompanyRequest, res) => {\n    try {\n      const transfer = await storage.getIntercompanyTransfer(req.params.id);\n      if (!transfer) {\n        return res.status(404).json({ error: \"Transfer not found\" });\n      }\n      res.json(transfer);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch intercompany transfer\" });\n    }\n  });\n\n  // ============================================================================\n  // CONSOLIDATION ENDPOINTS\n  // ============================================================================\n\n  // Get consolidated trial balance for a company and its subsidiaries\n  app.get(\"/api/companies/:companyId/consolidation/trial-balance\", async (req: CompanyRequest, res) => {\n    try {\n      const companyId = req.params.companyId;\n      const period = req.query.period as string;\n      \n      // Get all subsidiaries of this company\n      const subsidiaries = await storage.getCompanyHierarchy(companyId);\n      \n      // Get accounts for each company\n      const accountsByCompany: Record<string, Account[]> = {};\n      \n      const company = await storage.getCompany(companyId);\n      if (company) {\n        const accounts = await storage.getAccounts(companyId);\n        accountsByCompany[companyId] = accounts;\n      }\n      \n      // Recursively collect accounts from subsidiaries\n      const collectAccounts = async (nodes: CompanyHierarchyNode[]) => {\n        for (const node of nodes) {\n          const accounts = await storage.getAccounts(node.company.id);\n          accountsByCompany[node.company.id] = accounts;\n          if (node.children && node.children.length > 0) {\n            await collectAccounts(node.children);\n          }\n        }\n      };\n      \n      await collectAccounts(subsidiaries);\n      \n      res.json({\n        period,\n        accountsByCompany,\n        companies: [company, ...subsidiaries.flatMap(s => [s.company])],\n      });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch consolidated trial balance\" });\n    }\n  });\n\n  // Get elimination entries for consolidation\n  app.get(\"/api/companies/:companyId/consolidation/eliminations\", async (req: CompanyRequest, res) => {\n    try {\n      // Get intercompany transfers that need elimination\n      const transfers = await storage.getIntercompanyTransfers(req.params.companyId);\n      \n      // Generate elimination entries based on completed stock transfers\n      const eliminations = transfers\n        .filter(t => t.status === \"completed\")\n        .map(t => ({\n          id: `elim-${t.id}`,\n          transferId: t.id,\n          type: \"stock_transfer\", // Intercompany stock transfers\n          amount: t.totalValue || \"0\",\n          sourceCompanyId: t.sourceCompanyId,\n          targetCompanyId: t.targetCompanyId,\n          description: `Eliminate IC Stock Transfer: ${t.notes || t.transferNumber}`,\n        }));\n      \n      res.json(eliminations);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch elimination entries\" });\n    }\n  });\n\n  return httpServer;\n}\n","path":null,"size_bytes":66846,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route, Redirect, useLocation } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider, useQuery } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { SidebarProvider, SidebarTrigger } from \"@/components/ui/sidebar\";\nimport { ThemeProvider } from \"@/contexts/ThemeContext\";\nimport { CompanyProvider } from \"@/contexts/CompanyContext\";\nimport { AuthProvider, useAuth } from \"@/contexts/AuthContext\";\nimport { ThemeToggle } from \"@/components/layout/ThemeToggle\";\nimport { CompanySwitcher } from \"@/components/CompanySwitcher\";\nimport { AppSidebar } from \"@/components/layout/AppSidebar\";\nimport { Login } from \"@/pages/Login\";\nimport { Setup } from \"@/pages/Setup\";\nimport { Button } from \"@/components/ui/button\";\nimport { LogOut, User } from \"lucide-react\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\n\nimport { Dashboard } from \"@/components/Dashboard\";\nimport { Reports } from \"@/components/Reports\";\nimport { ConsolidationReports } from \"@/components/reports/ConsolidationReports\";\nimport { SalesOrderList } from \"@/components/sales/SalesOrderList\";\nimport { CustomerList } from \"@/components/sales/CustomerList\";\nimport { DeliveryList } from \"@/components/sales/DeliveryList\";\nimport { InvoiceList } from \"@/components/sales/InvoiceList\";\nimport { ProductList } from \"@/components/warehouse/ProductList\";\nimport { LocationList } from \"@/components/warehouse/LocationList\";\nimport { WarehouseList } from \"@/components/warehouse/WarehouseList\";\nimport { StockLevels } from \"@/components/warehouse/StockLevels\";\nimport { MovementList } from \"@/components/warehouse/MovementList\";\nimport { PurchaseOrderList } from \"@/components/warehouse/PurchaseOrderList\";\nimport { VendorList } from \"@/components/warehouse/VendorList\";\nimport { JournalEntries } from \"@/components/financials/JournalEntries\";\nimport { ChartOfAccounts } from \"@/components/financials/ChartOfAccounts\";\nimport { AccountsReceivable } from \"@/components/financials/AccountsReceivable\";\nimport { AccountsPayable } from \"@/components/financials/AccountsPayable\";\nimport { EmployeeList } from \"@/components/hr/EmployeeList\";\nimport { AttendanceList } from \"@/components/hr/AttendanceList\";\nimport { LeaveRequests } from \"@/components/hr/LeaveRequests\";\nimport { Payroll } from \"@/components/hr/Payroll\";\nimport { CompanyManagement } from \"@/components/system/CompanyManagement\";\nimport { UserRoleManagement } from \"@/components/system/UserRoleManagement\";\nimport { InterCompanyTransactions } from \"@/components/system/InterCompanyTransactions\";\nimport { VendorPortal } from \"@/components/system/VendorPortal\";\nimport { CustomerPortal } from \"@/components/system/CustomerPortal\";\nimport { Settings } from \"@/components/system/Settings\";\n\nfunction UserMenu() {\n  const { user, logout, isLoading } = useAuth();\n  const [, setLocation] = useLocation();\n\n  const handleLogout = async () => {\n    await logout();\n    setLocation(\"/login\");\n  };\n\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild>\n        <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-user-menu\">\n          <User className=\"w-4 h-4\" />\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"end\">\n        <DropdownMenuLabel>\n          {user?.fullName || user?.username || \"User\"}\n        </DropdownMenuLabel>\n        <DropdownMenuSeparator />\n        <DropdownMenuItem \n          onClick={handleLogout} \n          disabled={isLoading}\n          data-testid=\"button-logout\"\n        >\n          <LogOut className=\"w-4 h-4 mr-2\" />\n          Sign Out\n        </DropdownMenuItem>\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n\nfunction ProtectedRoutes() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={Dashboard} />\n      <Route path=\"/reports\" component={Reports} />\n      <Route path=\"/reports/consolidation\" component={ConsolidationReports} />\n      \n      <Route path=\"/sales/orders\" component={SalesOrderList} />\n      <Route path=\"/sales/customers\" component={CustomerList} />\n      <Route path=\"/sales/deliveries\" component={DeliveryList} />\n      <Route path=\"/sales/invoices\" component={InvoiceList} />\n      \n      <Route path=\"/warehouse/products\" component={ProductList} />\n      <Route path=\"/warehouse/warehouses\" component={WarehouseList} />\n      <Route path=\"/warehouse/locations\" component={LocationList} />\n      <Route path=\"/warehouse/stock\" component={StockLevels} />\n      <Route path=\"/warehouse/movements\" component={MovementList} />\n      <Route path=\"/warehouse/purchase-orders\" component={PurchaseOrderList} />\n      <Route path=\"/warehouse/vendors\" component={VendorList} />\n      \n      <Route path=\"/financials/journal\" component={JournalEntries} />\n      <Route path=\"/financials/accounts\" component={ChartOfAccounts} />\n      <Route path=\"/financials/receivables\" component={AccountsReceivable} />\n      <Route path=\"/financials/payables\" component={AccountsPayable} />\n      \n      <Route path=\"/hr/employees\" component={EmployeeList} />\n      <Route path=\"/hr/attendance\" component={AttendanceList} />\n      <Route path=\"/hr/leave\" component={LeaveRequests} />\n      <Route path=\"/hr/payroll\" component={Payroll} />\n      \n      <Route path=\"/system/companies\" component={CompanyManagement} />\n      <Route path=\"/system/users\" component={UserRoleManagement} />\n      <Route path=\"/system/intercompany\" component={InterCompanyTransactions} />\n      <Route path=\"/system/vendors\" component={VendorPortal} />\n      <Route path=\"/system/customer-portal\" component={CustomerPortal} />\n      <Route path=\"/system/settings\" component={Settings} />\n      <Route path=\"/settings\">\n        <Redirect to=\"/system/settings\" />\n      </Route>\n      \n      <Route>\n        <div className=\"flex items-center justify-center h-full\">\n          <div className=\"text-center\">\n            <h1 className=\"text-2xl font-semibold mb-2\">Page Not Found</h1>\n            <p className=\"text-muted-foreground\">The page you're looking for doesn't exist.</p>\n          </div>\n        </div>\n      </Route>\n    </Switch>\n  );\n}\n\nfunction AuthenticatedApp() {\n  const style = {\n    \"--sidebar-width\": \"16rem\",\n    \"--sidebar-width-icon\": \"3rem\",\n  };\n\n  return (\n    <CompanyProvider>\n      <SidebarProvider style={style as React.CSSProperties}>\n        <div className=\"flex h-screen w-full\">\n          <AppSidebar />\n          <div className=\"flex flex-col flex-1 min-w-0\">\n            <header className=\"flex items-center justify-between gap-2 p-3 border-b shrink-0\">\n              <div className=\"flex items-center gap-2\">\n                <SidebarTrigger data-testid=\"button-sidebar-toggle\" />\n                <CompanySwitcher />\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <ThemeToggle />\n                <UserMenu />\n              </div>\n            </header>\n            <main className=\"flex-1 overflow-auto p-6\">\n              <ProtectedRoutes />\n            </main>\n          </div>\n        </div>\n      </SidebarProvider>\n    </CompanyProvider>\n  );\n}\n\ninterface SetupStatus {\n  isInitialized: boolean;\n  needsCompanySetup: boolean;\n  needsAdminSetup: boolean;\n}\n\nfunction AppRouter() {\n  const { isAuthenticated, isLoading } = useAuth();\n  const [location, setLocation] = useLocation();\n\n  const { data: setupStatus, isLoading: setupLoading } = useQuery<SetupStatus>({\n    queryKey: [\"/api/setup/status\"],\n    retry: false,\n    staleTime: 60000,\n  });\n\n  const needsSetup = setupStatus && (!setupStatus.isInitialized || setupStatus.needsAdminSetup);\n\n  if ((isLoading || setupLoading) && location !== \"/login\" && location !== \"/setup\") {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen bg-background\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4\" />\n          <p className=\"text-muted-foreground\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  const isSetupRoute = location === \"/setup\" || location.startsWith(\"/setup/\");\n\n  if (needsSetup && !isSetupRoute) {\n    return <Redirect to=\"/setup\" />;\n  }\n\n  return (\n    <Switch>\n      <Route path=\"/setup/company\" component={Setup} />\n      <Route path=\"/setup/admin-user\" component={Setup} />\n      <Route path=\"/setup\" component={Setup} />\n      <Route path=\"/login\" component={Login} />\n      <Route>\n        {isAuthenticated ? <AuthenticatedApp /> : <Redirect to=\"/login\" />}\n      </Route>\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <ThemeProvider>\n        <AuthProvider>\n          <TooltipProvider>\n            <AppRouter />\n            <Toaster />\n          </TooltipProvider>\n        </AuthProvider>\n      </ThemeProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":9088,"size_tokens":null},"client/src/components/sales/CustomerList.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { DataTable, type Column } from \"@/components/layout/DataTable\";\nimport { StatusBadge } from \"@/components/layout/StatusBadge\";\nimport { PageHeader } from \"@/components/layout/PageHeader\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Plus, Download, Eye, Edit, Trash2, Users, Loader2 } from \"lucide-react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { exportToCSV } from \"@/lib/export\";\nimport type { Customer } from \"@shared/schema\";\n\nexport function CustomerList() {\n  const { activeCompany } = useAuth();\n  const { toast } = useToast();\n  const companyId = activeCompany?.id;\n\n  const [isFormOpen, setIsFormOpen] = useState(false);\n  const [isDetailOpen, setIsDetailOpen] = useState(false);\n  const [editingCustomer, setEditingCustomer] = useState<Customer | null>(null);\n  const [selectedCustomer, setSelectedCustomer] = useState<Customer | null>(null);\n\n  const [formData, setFormData] = useState({\n    code: \"\",\n    name: \"\",\n    legalName: \"\",\n    email: \"\",\n    phone: \"\",\n    taxId: \"\",\n    address: \"\",\n    city: \"\",\n    state: \"\",\n    country: \"\",\n    postalCode: \"\",\n    paymentTerms: 30,\n    creditLimit: \"0\",\n    customerType: \"regular\",\n  });\n\n  const { data: customers = [], isLoading } = useQuery<Customer[]>({\n    queryKey: [\"/api/companies\", companyId, \"customers\"],\n    enabled: !!companyId,\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const response = await apiRequest(\"POST\", `/api/companies/${companyId}/customers`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", companyId, \"customers\"] });\n      toast({ title: \"Customer created successfully\" });\n      setIsFormOpen(false);\n    },\n    onError: () => {\n      toast({ title: \"Failed to create customer\", variant: \"destructive\" });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<Customer> }) => {\n      const response = await apiRequest(\"PATCH\", `/api/companies/${companyId}/customers/${id}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", companyId, \"customers\"] });\n      toast({ title: \"Customer updated successfully\" });\n      setIsFormOpen(false);\n    },\n    onError: () => {\n      toast({ title: \"Failed to update customer\", variant: \"destructive\" });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(\"DELETE\", `/api/companies/${companyId}/customers/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", companyId, \"customers\"] });\n      toast({ title: \"Customer deleted successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to delete customer\", variant: \"destructive\" });\n    },\n  });\n\n  const handleOpenForm = (customer?: Customer) => {\n    if (customer) {\n      setEditingCustomer(customer);\n      setFormData({\n        code: customer.code,\n        name: customer.name,\n        legalName: customer.legalName || \"\",\n        email: customer.email || \"\",\n        phone: customer.phone || \"\",\n        taxId: customer.taxId || \"\",\n        address: customer.address || \"\",\n        city: customer.city || \"\",\n        state: customer.state || \"\",\n        country: customer.country || \"\",\n        postalCode: customer.postalCode || \"\",\n        paymentTerms: customer.paymentTerms || 30,\n        creditLimit: customer.creditLimit || \"0\",\n        customerType: customer.customerType || \"regular\",\n      });\n    } else {\n      setEditingCustomer(null);\n      setFormData({\n        code: \"\",\n        name: \"\",\n        legalName: \"\",\n        email: \"\",\n        phone: \"\",\n        taxId: \"\",\n        address: \"\",\n        city: \"\",\n        state: \"\",\n        country: \"\",\n        postalCode: \"\",\n        paymentTerms: 30,\n        creditLimit: \"0\",\n        customerType: \"regular\",\n      });\n    }\n    setIsFormOpen(true);\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (editingCustomer) {\n      updateMutation.mutate({ id: editingCustomer.id, data: formData });\n    } else {\n      createMutation.mutate(formData);\n    }\n  };\n\n  const handleViewCustomer = (customer: Customer) => {\n    setSelectedCustomer(customer);\n    setIsDetailOpen(true);\n  };\n\n  const handleDelete = (customerId: string) => {\n    if (confirm(\"Are you sure you want to delete this customer?\")) {\n      deleteMutation.mutate(customerId);\n    }\n  };\n\n  const columns: Column<Customer>[] = [\n    { key: \"code\", header: \"Code\", sortable: true },\n    { key: \"name\", header: \"Name\", sortable: true },\n    { key: \"email\", header: \"Email\", sortable: true },\n    { key: \"phone\", header: \"Phone\" },\n    { key: \"city\", header: \"City\" },\n    { key: \"country\", header: \"Country\" },\n    {\n      key: \"customerType\",\n      header: \"Type\",\n      render: (item) => (\n        <span className=\"capitalize\">{item.customerType || \"regular\"}</span>\n      ),\n    },\n    {\n      key: \"isActive\",\n      header: \"Status\",\n      render: (item) => (\n        <StatusBadge status={item.isActive ? \"active\" : \"inactive\"} />\n      ),\n    },\n    {\n      key: \"actions\",\n      header: \"\",\n      className: \"text-right\",\n      render: (item) => (\n        <div className=\"flex justify-end gap-1\" onClick={(e) => e.stopPropagation()}>\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => handleViewCustomer(item)} data-testid={`button-view-${item.id}`}>\n            <Eye className=\"h-4 w-4\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => handleOpenForm(item)} data-testid={`button-edit-${item.id}`}>\n            <Edit className=\"h-4 w-4\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => handleDelete(item.id)} data-testid={`button-delete-${item.id}`}>\n            <Trash2 className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      ),\n    },\n  ];\n\n  const handleExport = () => {\n    if (customers.length === 0) {\n      toast({ title: \"No data to export\", variant: \"destructive\" });\n      return;\n    }\n    exportToCSV(\n      customers.map(c => ({\n        code: c.code,\n        name: c.name,\n        email: c.email || \"\",\n        phone: c.phone || \"\",\n        city: c.city || \"\",\n        country: c.country || \"\",\n        type: c.customerType,\n        paymentTerms: c.paymentTerms,\n        creditLimit: c.creditLimit,\n        status: c.isActive ? \"Active\" : \"Inactive\"\n      })),\n      [\n        { key: \"code\", label: \"Code\" },\n        { key: \"name\", label: \"Name\" },\n        { key: \"email\", label: \"Email\" },\n        { key: \"phone\", label: \"Phone\" },\n        { key: \"city\", label: \"City\" },\n        { key: \"country\", label: \"Country\" },\n        { key: \"type\", label: \"Type\" },\n        { key: \"paymentTerms\", label: \"Payment Terms\" },\n        { key: \"creditLimit\", label: \"Credit Limit (IDR)\" },\n        { key: \"status\", label: \"Status\" }\n      ],\n      \"customers\"\n    );\n    toast({ title: \"Customers exported successfully\" });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <PageHeader\n        title=\"Customers\"\n        description={`${customers.length} customer${customers.length !== 1 ? \"s\" : \"\"}`}\n        actions={\n          <>\n            <Button variant=\"outline\" onClick={handleExport} data-testid=\"button-export\">\n              <Download className=\"h-4 w-4 mr-2\" />\n              Export\n            </Button>\n            <Button onClick={() => handleOpenForm()} data-testid=\"button-new-customer\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Customer\n            </Button>\n          </>\n        }\n      />\n\n      {customers.length === 0 ? (\n        <div className=\"flex flex-col items-center justify-center py-16 text-center\">\n          <Users className=\"h-12 w-12 text-muted-foreground mb-4\" />\n          <h3 className=\"text-lg font-medium mb-2\">No customers yet</h3>\n          <p className=\"text-muted-foreground mb-4\">Create your first customer to start tracking sales.</p>\n          <Button onClick={() => handleOpenForm()} data-testid=\"button-create-first-customer\">\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Create Customer\n          </Button>\n        </div>\n      ) : (\n        <DataTable\n          data={customers}\n          columns={columns}\n          searchKey=\"name\"\n          searchPlaceholder=\"Search customers...\"\n          onRowClick={handleViewCustomer}\n        />\n      )}\n\n      <Dialog open={isFormOpen} onOpenChange={setIsFormOpen}>\n        <DialogContent className=\"max-w-lg max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>{editingCustomer ? \"Edit Customer\" : \"New Customer\"}</DialogTitle>\n          </DialogHeader>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"code\">Customer Code</Label>\n                <Input\n                  id=\"code\"\n                  value={formData.code}\n                  onChange={(e) => setFormData({ ...formData, code: e.target.value })}\n                  placeholder=\"CUST-001\"\n                  required\n                  data-testid=\"input-customer-code\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"customerType\">Type</Label>\n                <Select\n                  value={formData.customerType}\n                  onValueChange={(value) => setFormData({ ...formData, customerType: value })}\n                >\n                  <SelectTrigger data-testid=\"select-customer-type\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"regular\">Regular</SelectItem>\n                    <SelectItem value=\"wholesale\">Wholesale</SelectItem>\n                    <SelectItem value=\"retail\">Retail</SelectItem>\n                    <SelectItem value=\"corporate\">Corporate</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"name\">Customer Name</Label>\n              <Input\n                id=\"name\"\n                value={formData.name}\n                onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                placeholder=\"Customer name\"\n                required\n                data-testid=\"input-customer-name\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"legalName\">Legal Name</Label>\n              <Input\n                id=\"legalName\"\n                value={formData.legalName}\n                onChange={(e) => setFormData({ ...formData, legalName: e.target.value })}\n                placeholder=\"Legal entity name (optional)\"\n                data-testid=\"input-customer-legal-name\"\n              />\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"email\">Email</Label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  value={formData.email}\n                  onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n                  placeholder=\"email@example.com\"\n                  data-testid=\"input-customer-email\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"phone\">Phone</Label>\n                <Input\n                  id=\"phone\"\n                  value={formData.phone}\n                  onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\n                  placeholder=\"+1 (555) 000-0000\"\n                  data-testid=\"input-customer-phone\"\n                />\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"taxId\">Tax ID</Label>\n              <Input\n                id=\"taxId\"\n                value={formData.taxId}\n                onChange={(e) => setFormData({ ...formData, taxId: e.target.value })}\n                placeholder=\"Tax identification number\"\n                data-testid=\"input-customer-tax-id\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"address\">Address</Label>\n              <Textarea\n                id=\"address\"\n                value={formData.address}\n                onChange={(e) => setFormData({ ...formData, address: e.target.value })}\n                placeholder=\"Street address\"\n                rows={2}\n                data-testid=\"input-customer-address\"\n              />\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"city\">City</Label>\n                <Input\n                  id=\"city\"\n                  value={formData.city}\n                  onChange={(e) => setFormData({ ...formData, city: e.target.value })}\n                  placeholder=\"City\"\n                  data-testid=\"input-customer-city\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"state\">State/Province</Label>\n                <Input\n                  id=\"state\"\n                  value={formData.state}\n                  onChange={(e) => setFormData({ ...formData, state: e.target.value })}\n                  placeholder=\"State\"\n                  data-testid=\"input-customer-state\"\n                />\n              </div>\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"country\">Country</Label>\n                <Input\n                  id=\"country\"\n                  value={formData.country}\n                  onChange={(e) => setFormData({ ...formData, country: e.target.value })}\n                  placeholder=\"US\"\n                  maxLength={2}\n                  data-testid=\"input-customer-country\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"postalCode\">Postal Code</Label>\n                <Input\n                  id=\"postalCode\"\n                  value={formData.postalCode}\n                  onChange={(e) => setFormData({ ...formData, postalCode: e.target.value })}\n                  placeholder=\"12345\"\n                  data-testid=\"input-customer-postal-code\"\n                />\n              </div>\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"paymentTerms\">Payment Terms (days)</Label>\n                <Input\n                  id=\"paymentTerms\"\n                  type=\"number\"\n                  min=\"0\"\n                  value={formData.paymentTerms}\n                  onChange={(e) => setFormData({ ...formData, paymentTerms: parseInt(e.target.value) || 0 })}\n                  data-testid=\"input-customer-payment-terms\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"creditLimit\">Credit Limit</Label>\n                <Input\n                  id=\"creditLimit\"\n                  type=\"number\"\n                  step=\"0.01\"\n                  min=\"0\"\n                  value={formData.creditLimit}\n                  onChange={(e) => setFormData({ ...formData, creditLimit: e.target.value })}\n                  data-testid=\"input-customer-credit-limit\"\n                />\n              </div>\n            </div>\n            <div className=\"flex justify-end gap-2 pt-4\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => setIsFormOpen(false)} data-testid=\"button-cancel\">\n                Cancel\n              </Button>\n              <Button \n                type=\"submit\" \n                disabled={createMutation.isPending || updateMutation.isPending}\n                data-testid=\"button-save-customer\"\n              >\n                {(createMutation.isPending || updateMutation.isPending) && (\n                  <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                )}\n                {editingCustomer ? \"Update\" : \"Create\"}\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isDetailOpen} onOpenChange={setIsDetailOpen}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Customer Details</DialogTitle>\n          </DialogHeader>\n          {selectedCustomer && (\n            <div className=\"space-y-4\">\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-lg\">{selectedCustomer.name}</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-2\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Code</span>\n                    <span className=\"font-medium\">{selectedCustomer.code}</span>\n                  </div>\n                  {selectedCustomer.legalName && (\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Legal Name</span>\n                      <span className=\"font-medium\">{selectedCustomer.legalName}</span>\n                    </div>\n                  )}\n                  {selectedCustomer.email && (\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Email</span>\n                      <span className=\"font-medium\">{selectedCustomer.email}</span>\n                    </div>\n                  )}\n                  {selectedCustomer.phone && (\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Phone</span>\n                      <span className=\"font-medium\">{selectedCustomer.phone}</span>\n                    </div>\n                  )}\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Type</span>\n                    <span className=\"font-medium capitalize\">{selectedCustomer.customerType || \"regular\"}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Payment Terms</span>\n                    <span className=\"font-medium\">{selectedCustomer.paymentTerms || 30} days</span>\n                  </div>\n                  {selectedCustomer.creditLimit && (\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Credit Limit</span>\n                      <span className=\"font-medium\">${parseFloat(selectedCustomer.creditLimit).toLocaleString()}</span>\n                    </div>\n                  )}\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Status</span>\n                    <StatusBadge status={selectedCustomer.isActive ? \"active\" : \"inactive\"} />\n                  </div>\n                </CardContent>\n              </Card>\n              {(selectedCustomer.address || selectedCustomer.city) && (\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm\">Address</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"text-sm text-muted-foreground\">\n                    {selectedCustomer.address && <div>{selectedCustomer.address}</div>}\n                    <div>\n                      {[selectedCustomer.city, selectedCustomer.state, selectedCustomer.postalCode]\n                        .filter(Boolean)\n                        .join(\", \")}\n                    </div>\n                    {selectedCustomer.country && <div>{selectedCustomer.country}</div>}\n                  </CardContent>\n                </Card>\n              )}\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":21144,"size_tokens":null},"client/src/lib/reportData.ts":{"content":"// todo: remove mock functionality - Report data for ERP analytics\n\n// ============================================\n// SALES REPORTS DATA\n// ============================================\n\nexport const mockSalespersonPerformance = [\n  { id: \"SP001\", name: \"Sarah Johnson\", region: \"North\", quota: 150000, achieved: 168500, orders: 45, customers: 28, avgOrderValue: 3744, winRate: 72 },\n  { id: \"SP002\", name: \"Michael Chen\", region: \"South\", quota: 120000, achieved: 112000, orders: 38, customers: 22, avgOrderValue: 2947, winRate: 65 },\n  { id: \"SP003\", name: \"Emily Rodriguez\", region: \"East\", quota: 130000, achieved: 145000, orders: 52, customers: 31, avgOrderValue: 2788, winRate: 78 },\n  { id: \"SP004\", name: \"David Kim\", region: \"West\", quota: 140000, achieved: 138500, orders: 41, customers: 25, avgOrderValue: 3378, winRate: 68 },\n  { id: \"SP005\", name: \"Lisa Wang\", region: \"Central\", quota: 110000, achieved: 125000, orders: 35, customers: 20, avgOrderValue: 3571, winRate: 74 },\n];\n\nexport const mockCustomerRanking = [\n  { id: \"C001\", name: \"Acme Corporation\", revenue: 125000, orders: 45, avgOrderValue: 2778, lastOrder: \"2024-12-01\", segment: \"Enterprise\", growthRate: 15.2 },\n  { id: \"C003\", name: \"Global Supplies Ltd\", revenue: 234000, orders: 89, avgOrderValue: 2629, lastOrder: \"2024-12-03\", segment: \"Enterprise\", growthRate: 22.5 },\n  { id: \"C005\", name: \"Summit Industries\", revenue: 189000, orders: 67, avgOrderValue: 2821, lastOrder: \"2024-12-05\", segment: \"Enterprise\", growthRate: 18.3 },\n  { id: \"C002\", name: \"TechStart Inc.\", revenue: 67500, orders: 23, avgOrderValue: 2935, lastOrder: \"2024-12-02\", segment: \"SMB\", growthRate: 28.7 },\n  { id: \"C004\", name: \"Metro Retail Group\", revenue: 28900, orders: 12, avgOrderValue: 2408, lastOrder: \"2024-11-15\", segment: \"SMB\", growthRate: -5.2 },\n];\n\nexport const mockSalesForecast = [\n  { month: \"Jan 2025\", predicted: 145000, lowerBound: 130000, upperBound: 160000, confidence: 85 },\n  { month: \"Feb 2025\", predicted: 152000, lowerBound: 135000, upperBound: 169000, confidence: 82 },\n  { month: \"Mar 2025\", predicted: 168000, lowerBound: 148000, upperBound: 188000, confidence: 80 },\n  { month: \"Apr 2025\", predicted: 175000, lowerBound: 152000, upperBound: 198000, confidence: 78 },\n  { month: \"May 2025\", predicted: 182000, lowerBound: 156000, upperBound: 208000, confidence: 75 },\n  { month: \"Jun 2025\", predicted: 195000, lowerBound: 165000, upperBound: 225000, confidence: 72 },\n];\n\nexport const mockSalesPipeline = [\n  { stage: \"Lead\", count: 156, value: 780000, conversionRate: 45 },\n  { stage: \"Qualified\", count: 70, value: 420000, conversionRate: 60 },\n  { stage: \"Proposal\", count: 42, value: 315000, conversionRate: 75 },\n  { stage: \"Negotiation\", count: 32, value: 256000, conversionRate: 85 },\n  { stage: \"Closed Won\", count: 27, value: 218000, conversionRate: 100 },\n];\n\nexport const mockOrderFulfillment = [\n  { month: \"Jul 2024\", totalOrders: 145, onTime: 132, late: 10, cancelled: 3, fulfillmentRate: 91 },\n  { month: \"Aug 2024\", totalOrders: 158, onTime: 148, late: 8, cancelled: 2, fulfillmentRate: 94 },\n  { month: \"Sep 2024\", totalOrders: 162, onTime: 152, late: 7, cancelled: 3, fulfillmentRate: 94 },\n  { month: \"Oct 2024\", totalOrders: 175, onTime: 165, late: 6, cancelled: 4, fulfillmentRate: 94 },\n  { month: \"Nov 2024\", totalOrders: 189, onTime: 180, late: 5, cancelled: 4, fulfillmentRate: 95 },\n  { month: \"Dec 2024\", totalOrders: 198, onTime: 190, late: 4, cancelled: 4, fulfillmentRate: 96 },\n];\n\n// ============================================\n// INVENTORY/WAREHOUSE REPORTS DATA\n// ============================================\n\nexport const mockInventoryAging = [\n  { ageRange: \"0-30 days\", items: 145, value: 125000, percentage: 42 },\n  { ageRange: \"31-60 days\", items: 89, value: 78500, percentage: 26 },\n  { ageRange: \"61-90 days\", items: 56, value: 45000, percentage: 15 },\n  { ageRange: \"91-180 days\", items: 34, value: 28500, percentage: 10 },\n  { ageRange: \"180+ days\", items: 22, value: 18000, percentage: 6 },\n];\n\nexport const mockABCAnalysis = [\n  { category: \"A\", items: 45, percentage: 15, value: 485000, valuePercentage: 70, description: \"High-value, critical items\" },\n  { category: \"B\", items: 89, percentage: 30, value: 145000, valuePercentage: 21, description: \"Medium-value, important items\" },\n  { category: \"C\", items: 165, percentage: 55, value: 62000, valuePercentage: 9, description: \"Low-value, routine items\" },\n];\n\nexport const mockStockMovement = [\n  { month: \"Jul 2024\", inbound: 2450, outbound: 2180, adjustments: -45, netChange: 225 },\n  { month: \"Aug 2024\", inbound: 2680, outbound: 2520, adjustments: -32, netChange: 128 },\n  { month: \"Sep 2024\", inbound: 2890, outbound: 2650, adjustments: -28, netChange: 212 },\n  { month: \"Oct 2024\", inbound: 3150, outbound: 2980, adjustments: -15, netChange: 155 },\n  { month: \"Nov 2024\", inbound: 3420, outbound: 3180, adjustments: -22, netChange: 218 },\n  { month: \"Dec 2024\", inbound: 3680, outbound: 3450, adjustments: -18, netChange: 212 },\n];\n\nexport const mockReorderRecommendations = [\n  { id: \"P003\", sku: \"CPT-001\", name: \"Component Alpha\", currentStock: 12, safetyStock: 100, reorderPoint: 150, suggestedQty: 200, leadTime: 7, priority: \"critical\" },\n  { id: \"P006\", sku: \"ASM-001\", name: \"Assembly Kit Pro\", currentStock: 45, safetyStock: 50, reorderPoint: 75, suggestedQty: 100, leadTime: 14, priority: \"high\" },\n  { id: \"P002\", sku: \"WDG-002\", name: \"Industrial Widget B\", currentStock: 156, safetyStock: 100, reorderPoint: 150, suggestedQty: 150, leadTime: 5, priority: \"medium\" },\n  { id: \"P004\", sku: \"CPT-002\", name: \"Component Beta\", currentStock: 89, safetyStock: 80, reorderPoint: 100, suggestedQty: 120, leadTime: 10, priority: \"low\" },\n];\n\nexport const mockStockAccuracy = [\n  { location: \"Zone A\", systemQty: 2450, physicalQty: 2438, variance: -12, variancePercent: -0.49, lastAudit: \"2024-12-01\" },\n  { location: \"Zone B\", systemQty: 1890, physicalQty: 1895, variance: 5, variancePercent: 0.26, lastAudit: \"2024-12-01\" },\n  { location: \"Zone C\", systemQty: 3250, physicalQty: 3228, variance: -22, variancePercent: -0.68, lastAudit: \"2024-12-01\" },\n  { location: \"Zone D\", systemQty: 980, physicalQty: 982, variance: 2, variancePercent: 0.20, lastAudit: \"2024-12-01\" },\n];\n\nexport const mockSupplierPerformance = [\n  { id: \"V001\", name: \"Prime Suppliers Co.\", onTimeRate: 94, qualityScore: 98, avgLeadTime: 5, priceCompetitiveness: 92, overallScore: 96 },\n  { id: \"V002\", name: \"Quality Materials Inc.\", onTimeRate: 88, qualityScore: 95, avgLeadTime: 7, priceCompetitiveness: 88, overallScore: 90 },\n  { id: \"V003\", name: \"FastShip Logistics\", onTimeRate: 96, qualityScore: 92, avgLeadTime: 3, priceCompetitiveness: 85, overallScore: 91 },\n  { id: \"V004\", name: \"Industrial Parts Ltd\", onTimeRate: 82, qualityScore: 90, avgLeadTime: 10, priceCompetitiveness: 94, overallScore: 85 },\n];\n\n// ============================================\n// FINANCE REPORTS DATA\n// ============================================\n\nexport const mockProfitLoss = {\n  period: \"Q4 2024\",\n  revenue: {\n    productSales: 485000,\n    serviceRevenue: 125000,\n    otherIncome: 26600,\n    totalRevenue: 636600,\n  },\n  costOfSales: {\n    materials: 145000,\n    directLabor: 85000,\n    overhead: 42000,\n    totalCOGS: 272000,\n  },\n  grossProfit: 364600,\n  grossMargin: 57.3,\n  operatingExpenses: {\n    salaries: 185000,\n    rent: 36000,\n    utilities: 14500,\n    marketing: 22000,\n    depreciation: 45000,\n    other: 52000,\n    totalOpex: 354500,\n  },\n  operatingIncome: 10100,\n  otherExpenses: {\n    interest: 12500,\n    taxes: 22000,\n    totalOther: 34500,\n  },\n  netIncome: -24400,\n  netMargin: -3.8,\n};\n\nexport const mockBalanceSheet = {\n  asOfDate: \"2024-12-05\",\n  assets: {\n    current: {\n      cash: 172500,\n      accountsReceivable: 58300,\n      inventory: 283500,\n      prepaidExpenses: 25000,\n      totalCurrent: 539300,\n    },\n    fixed: {\n      land: 150000,\n      buildings: 355000,\n      equipment: 337000,\n      vehicles: 80000,\n      furniture: 47000,\n      computers: 53000,\n      totalFixed: 1022000,\n    },\n    totalAssets: 1561300,\n  },\n  liabilities: {\n    current: {\n      accountsPayable: 49400,\n      accruedExpenses: 31900,\n      taxesPayable: 37400,\n      otherCurrent: 44500,\n      totalCurrent: 163200,\n    },\n    longTerm: {\n      bankLoans: 150000,\n      mortgage: 280000,\n      equipmentLoans: 75000,\n      totalLongTerm: 505000,\n    },\n    totalLiabilities: 668200,\n  },\n  equity: {\n    commonStock: 200000,\n    preferredStock: 50000,\n    additionalPaidIn: 75000,\n    retainedEarnings: 570000,\n    currentYearEarnings: -24400,\n    ownerDrawings: -25000,\n    totalEquity: 845600,\n  },\n  totalLiabilitiesAndEquity: 1513800,\n};\n\nexport const mockCashFlow = [\n  { month: \"Jul 2024\", operating: 45000, investing: -15000, financing: -8000, netChange: 22000, endingBalance: 145000 },\n  { month: \"Aug 2024\", operating: 52000, investing: -25000, financing: -8000, netChange: 19000, endingBalance: 164000 },\n  { month: \"Sep 2024\", operating: 48000, investing: -10000, financing: -8000, netChange: 30000, endingBalance: 194000 },\n  { month: \"Oct 2024\", operating: 38000, investing: -45000, financing: -8000, netChange: -15000, endingBalance: 179000 },\n  { month: \"Nov 2024\", operating: 55000, investing: -12000, financing: -8000, netChange: 35000, endingBalance: 214000 },\n  { month: \"Dec 2024\", operating: 42000, investing: -8000, financing: -75000, netChange: -41000, endingBalance: 173000 },\n];\n\nexport const mockProductProfitability = [\n  { id: \"P001\", name: \"Industrial Widget A\", revenue: 125000, cost: 62500, profit: 62500, margin: 50, unitsSold: 2501 },\n  { id: \"P002\", name: \"Industrial Widget B\", revenue: 98000, cost: 53900, profit: 44100, margin: 45, unitsSold: 1225 },\n  { id: \"P003\", name: \"Component Alpha\", revenue: 45000, cost: 31500, profit: 13500, margin: 30, unitsSold: 1837 },\n  { id: \"P004\", name: \"Component Beta\", revenue: 78000, cost: 42900, profit: 35100, margin: 45, unitsSold: 413 },\n  { id: \"P005\", name: \"Raw Material X\", revenue: 35000, cost: 28000, profit: 7000, margin: 20, unitsSold: 2745 },\n  { id: \"P006\", name: \"Assembly Kit Pro\", revenue: 85000, cost: 42500, profit: 42500, margin: 50, unitsSold: 244 },\n];\n\nexport const mockARAgingReport = [\n  { ageRange: \"Current\", amount: 28500, count: 12, percentage: 49 },\n  { ageRange: \"1-30 days\", amount: 15200, count: 8, percentage: 26 },\n  { ageRange: \"31-60 days\", amount: 8500, count: 5, percentage: 15 },\n  { ageRange: \"61-90 days\", amount: 4200, count: 3, percentage: 7 },\n  { ageRange: \"90+ days\", amount: 1900, count: 2, percentage: 3 },\n];\n\nexport const mockAPAgingReport = [\n  { ageRange: \"Current\", amount: 22000, count: 8, percentage: 45 },\n  { ageRange: \"1-30 days\", amount: 14500, count: 6, percentage: 29 },\n  { ageRange: \"31-60 days\", amount: 8200, count: 4, percentage: 17 },\n  { ageRange: \"61-90 days\", amount: 3500, count: 2, percentage: 7 },\n  { ageRange: \"90+ days\", amount: 1200, count: 1, percentage: 2 },\n];\n\nexport const mockFinancialRatios = {\n  liquidity: {\n    currentRatio: 3.31,\n    quickRatio: 1.57,\n    cashRatio: 1.06,\n  },\n  profitability: {\n    grossMargin: 57.3,\n    operatingMargin: 1.6,\n    netMargin: -3.8,\n    roe: -2.9,\n    roa: -1.6,\n  },\n  efficiency: {\n    inventoryTurnover: 4.2,\n    receivablesTurnover: 10.9,\n    payablesTurnover: 8.5,\n    assetTurnover: 0.41,\n  },\n  leverage: {\n    debtToEquity: 0.79,\n    debtToAssets: 0.43,\n    interestCoverage: 0.81,\n  },\n};\n\nexport const mockVATReport = {\n  period: \"Q4 2024\",\n  outputVAT: {\n    sales: 636600,\n    vatRate: 10,\n    vatAmount: 63660,\n  },\n  inputVAT: {\n    purchases: 385000,\n    vatRate: 10,\n    vatAmount: 38500,\n  },\n  netVAT: 25160,\n  status: \"payable\",\n};\n\nexport const mockTrialBalance = [\n  { accountId: \"1111\", accountName: \"Cash on Hand\", debit: 15000, credit: 0 },\n  { accountId: \"1113\", accountName: \"Checking Account - Main\", debit: 85000, credit: 0 },\n  { accountId: \"1121\", accountName: \"Trade Receivables\", debit: 45600, credit: 0 },\n  { accountId: \"1131\", accountName: \"Raw Materials\", debit: 78500, credit: 0 },\n  { accountId: \"1133\", accountName: \"Finished Goods\", debit: 98000, credit: 0 },\n  { accountId: \"1220\", accountName: \"Buildings\", debit: 450000, credit: 0 },\n  { accountId: \"1221\", accountName: \"Accum. Depr. - Buildings\", debit: 0, credit: 95000 },\n  { accountId: \"2111\", accountName: \"Trade Payables\", debit: 0, credit: 28900 },\n  { accountId: \"2121\", accountName: \"Accrued Salaries\", debit: 0, credit: 18500 },\n  { accountId: \"3110\", accountName: \"Common Stock\", debit: 0, credit: 200000 },\n  { accountId: \"3210\", accountName: \"Retained Earnings\", debit: 0, credit: 185000 },\n  { accountId: \"4110\", accountName: \"Product Sales\", debit: 0, credit: 485000 },\n  { accountId: \"5110\", accountName: \"Cost of Materials\", debit: 145000, credit: 0 },\n  { accountId: \"5310\", accountName: \"Salaries & Wages\", debit: 185000, credit: 0 },\n];\n\n// ============================================\n// HR REPORTS DATA\n// ============================================\n\nexport const mockAttendanceSummary = [\n  { employeeId: \"E001\", name: \"Sarah Johnson\", department: \"Sales\", daysWorked: 22, daysAbsent: 0, lateArrivals: 2, avgHours: 8.5, overtimeHours: 12 },\n  { employeeId: \"E002\", name: \"Michael Chen\", department: \"Warehouse\", daysWorked: 22, daysAbsent: 1, lateArrivals: 0, avgHours: 8.2, overtimeHours: 8 },\n  { employeeId: \"E003\", name: \"Emily Rodriguez\", department: \"Finance\", daysWorked: 21, daysAbsent: 1, lateArrivals: 1, avgHours: 8.8, overtimeHours: 15 },\n  { employeeId: \"E004\", name: \"David Kim\", department: \"HR\", daysWorked: 22, daysAbsent: 0, lateArrivals: 0, avgHours: 8.0, overtimeHours: 4 },\n  { employeeId: \"E005\", name: \"Lisa Wang\", department: \"Operations\", daysWorked: 12, daysAbsent: 10, lateArrivals: 0, avgHours: 8.0, overtimeHours: 0 },\n];\n\nexport const mockLeaveBalance = [\n  { employeeId: \"E001\", name: \"Sarah Johnson\", department: \"Sales\", annualAllowed: 20, used: 5, remaining: 15, sickUsed: 2, sickRemaining: 8 },\n  { employeeId: \"E002\", name: \"Michael Chen\", department: \"Warehouse\", annualAllowed: 20, used: 8, remaining: 12, sickUsed: 1, sickRemaining: 9 },\n  { employeeId: \"E003\", name: \"Emily Rodriguez\", department: \"Finance\", annualAllowed: 25, used: 10, remaining: 15, sickUsed: 3, sickRemaining: 7 },\n  { employeeId: \"E004\", name: \"David Kim\", department: \"HR\", annualAllowed: 20, used: 3, remaining: 17, sickUsed: 0, sickRemaining: 10 },\n  { employeeId: \"E005\", name: \"Lisa Wang\", department: \"Operations\", annualAllowed: 20, used: 15, remaining: 5, sickUsed: 5, sickRemaining: 5 },\n];\n\nexport const mockOvertimeSummary = [\n  { department: \"Sales\", employees: 5, totalHours: 48, avgPerEmployee: 9.6, cost: 3600 },\n  { department: \"Warehouse\", employees: 8, totalHours: 72, avgPerEmployee: 9.0, cost: 4320 },\n  { department: \"Finance\", employees: 4, totalHours: 32, avgPerEmployee: 8.0, cost: 2880 },\n  { department: \"HR\", employees: 3, totalHours: 12, avgPerEmployee: 4.0, cost: 900 },\n  { department: \"Operations\", employees: 6, totalHours: 45, avgPerEmployee: 7.5, cost: 2700 },\n];\n\nexport const mockPayrollByDepartment = [\n  { department: \"Sales\", employees: 5, baseSalary: 45000, overtime: 3600, bonuses: 8500, deductions: 5700, netPayroll: 51400 },\n  { department: \"Warehouse\", employees: 8, baseSalary: 52000, overtime: 4320, bonuses: 2500, deductions: 5880, netPayroll: 52940 },\n  { department: \"Finance\", employees: 4, baseSalary: 38000, overtime: 2880, bonuses: 4200, deductions: 4508, netPayroll: 40572 },\n  { department: \"HR\", employees: 3, baseSalary: 28000, overtime: 900, bonuses: 1500, deductions: 3040, netPayroll: 27360 },\n  { department: \"Operations\", employees: 6, baseSalary: 42000, overtime: 2700, bonuses: 3000, deductions: 4770, netPayroll: 42930 },\n];\n\n// ============================================\n// CROSS-MODULE & AI REPORTS DATA\n// ============================================\n\nexport const mockVendorScorecard = [\n  { id: \"V001\", name: \"Prime Suppliers Co.\", quality: 98, delivery: 94, price: 92, service: 95, overall: 95, trend: \"up\" },\n  { id: \"V002\", name: \"Quality Materials Inc.\", quality: 95, delivery: 88, price: 88, service: 90, overall: 90, trend: \"stable\" },\n  { id: \"V003\", name: \"FastShip Logistics\", quality: 92, delivery: 96, price: 85, service: 88, overall: 90, trend: \"up\" },\n  { id: \"V004\", name: \"Industrial Parts Ltd\", quality: 90, delivery: 82, price: 94, service: 78, overall: 86, trend: \"down\" },\n];\n\nexport const mockCustomerLifetimeValue = [\n  { id: \"C001\", name: \"Acme Corporation\", acquisitionDate: \"2020-03-15\", totalRevenue: 485000, avgOrderValue: 10778, frequency: 45, clv: 645000, segment: \"high\" },\n  { id: \"C003\", name: \"Global Supplies Ltd\", acquisitionDate: \"2019-08-22\", totalRevenue: 892000, avgOrderValue: 10022, frequency: 89, clv: 1250000, segment: \"high\" },\n  { id: \"C005\", name: \"Summit Industries\", acquisitionDate: \"2021-01-10\", totalRevenue: 378000, avgOrderValue: 5642, frequency: 67, clv: 520000, segment: \"high\" },\n  { id: \"C002\", name: \"TechStart Inc.\", acquisitionDate: \"2022-06-01\", totalRevenue: 135000, avgOrderValue: 5870, frequency: 23, clv: 185000, segment: \"medium\" },\n  { id: \"C004\", name: \"Metro Retail Group\", acquisitionDate: \"2023-02-14\", totalRevenue: 28900, avgOrderValue: 2408, frequency: 12, clv: 45000, segment: \"low\" },\n];\n\nexport const mockAuditLog = [\n  { id: \"AUD001\", timestamp: \"2024-12-05 14:32:15\", user: \"admin@unanza.com\", module: \"Sales\", action: \"CREATE\", entity: \"Sales Order\", entityId: \"SO-005\", details: \"Created new sales order\" },\n  { id: \"AUD002\", timestamp: \"2024-12-05 14:28:45\", user: \"sarah.johnson@unanza.com\", module: \"Sales\", action: \"UPDATE\", entity: \"Customer\", entityId: \"C001\", details: \"Updated contact information\" },\n  { id: \"AUD003\", timestamp: \"2024-12-05 13:45:22\", user: \"michael.chen@unanza.com\", module: \"Warehouse\", action: \"CREATE\", entity: \"Stock Movement\", entityId: \"MOV-004\", details: \"Received PO-002 items\" },\n  { id: \"AUD004\", timestamp: \"2024-12-05 12:15:10\", user: \"emily.rodriguez@unanza.com\", module: \"Finance\", action: \"POST\", entity: \"Journal Entry\", entityId: \"JE-003\", details: \"Posted journal entry\" },\n  { id: \"AUD005\", timestamp: \"2024-12-05 11:30:55\", user: \"admin@unanza.com\", module: \"System\", action: \"UPDATE\", entity: \"Settings\", entityId: \"SYS-001\", details: \"Updated company settings\" },\n  { id: \"AUD006\", timestamp: \"2024-12-05 10:22:33\", user: \"david.kim@unanza.com\", module: \"HR\", action: \"APPROVE\", entity: \"Leave Request\", entityId: \"LR-001\", details: \"Approved vacation request\" },\n];\n\nexport const mockChurnProbability = [\n  { id: \"C004\", name: \"Metro Retail Group\", lastOrderDays: 20, orderFrequencyDecline: 45, revenueDecline: 32, supportTickets: 5, churnProbability: 78, riskLevel: \"high\" },\n  { id: \"C002\", name: \"TechStart Inc.\", lastOrderDays: 3, orderFrequencyDecline: 12, revenueDecline: 8, supportTickets: 1, churnProbability: 25, riskLevel: \"low\" },\n  { id: \"C005\", name: \"Summit Industries\", lastOrderDays: 0, orderFrequencyDecline: -5, revenueDecline: -15, supportTickets: 0, churnProbability: 8, riskLevel: \"low\" },\n];\n\n// ============================================\n// AI/PREDICTIVE REPORTS DATA\n// ============================================\n\nexport const mockPredictiveReorder = [\n  { id: \"P003\", sku: \"CPT-001\", name: \"Component Alpha\", currentStock: 12, predictedDemand: 180, daysUntilStockout: 2, optimalReorderDate: \"2024-12-06\", suggestedQty: 250, confidence: 92 },\n  { id: \"P006\", sku: \"ASM-001\", name: \"Assembly Kit Pro\", currentStock: 45, predictedDemand: 85, daysUntilStockout: 12, optimalReorderDate: \"2024-12-10\", suggestedQty: 100, confidence: 88 },\n  { id: \"P002\", sku: \"WDG-002\", name: \"Industrial Widget B\", currentStock: 156, predictedDemand: 120, daysUntilStockout: 28, optimalReorderDate: \"2024-12-20\", suggestedQty: 150, confidence: 85 },\n  { id: \"P001\", sku: \"WDG-001\", name: \"Industrial Widget A\", currentStock: 234, predictedDemand: 95, daysUntilStockout: 52, optimalReorderDate: \"2025-01-15\", suggestedQty: 120, confidence: 82 },\n];\n\nexport const mockDemandForecast = [\n  { productId: \"P001\", name: \"Industrial Widget A\", currentMonth: 95, month1: 102, month2: 108, month3: 115, month4: 98, month5: 88, month6: 105, seasonality: \"stable\" },\n  { productId: \"P002\", name: \"Industrial Widget B\", currentMonth: 120, month1: 135, month2: 142, month3: 128, month4: 115, month5: 108, month6: 125, seasonality: \"growing\" },\n  { productId: \"P003\", name: \"Component Alpha\", currentMonth: 180, month1: 195, month2: 210, month3: 225, month4: 198, month5: 185, month6: 205, seasonality: \"seasonal-high\" },\n  { productId: \"P004\", name: \"Component Beta\", currentMonth: 45, month1: 48, month2: 52, month3: 55, month4: 50, month5: 45, month6: 48, seasonality: \"stable\" },\n  { productId: \"P005\", name: \"Raw Material X\", currentMonth: 350, month1: 380, month2: 410, month3: 445, month4: 420, month5: 395, month6: 425, seasonality: \"growing\" },\n  { productId: \"P006\", name: \"Assembly Kit Pro\", currentMonth: 85, month1: 92, month2: 78, month3: 65, month4: 72, month5: 88, month6: 95, seasonality: \"variable\" },\n];\n\n// Historical sales data for trend analysis\nexport const mockHistoricalSales = [\n  { month: \"Jan 2024\", revenue: 125000, orders: 145, avgOrderValue: 862 },\n  { month: \"Feb 2024\", revenue: 132000, orders: 158, avgOrderValue: 835 },\n  { month: \"Mar 2024\", revenue: 148000, orders: 175, avgOrderValue: 846 },\n  { month: \"Apr 2024\", revenue: 142000, orders: 168, avgOrderValue: 845 },\n  { month: \"May 2024\", revenue: 155000, orders: 182, avgOrderValue: 852 },\n  { month: \"Jun 2024\", revenue: 168000, orders: 195, avgOrderValue: 862 },\n  { month: \"Jul 2024\", revenue: 162000, orders: 188, avgOrderValue: 862 },\n  { month: \"Aug 2024\", revenue: 175000, orders: 205, avgOrderValue: 854 },\n  { month: \"Sep 2024\", revenue: 182000, orders: 215, avgOrderValue: 847 },\n  { month: \"Oct 2024\", revenue: 195000, orders: 228, avgOrderValue: 855 },\n  { month: \"Nov 2024\", revenue: 215000, orders: 248, avgOrderValue: 867 },\n  { month: \"Dec 2024\", revenue: 235000, orders: 268, avgOrderValue: 877 },\n];\n","path":null,"size_bytes":22113,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"client/src/pages/Login.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Building2, Lock, User, AlertCircle } from \"lucide-react\";\nimport type { Company } from \"@shared/schema\";\n\nexport function Login() {\n  const [, setLocation] = useLocation();\n  const { login, isAuthenticated, isLoading: authLoading, error: authError } = useAuth();\n  const { toast } = useToast();\n  \n  const [username, setUsername] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [companyId, setCompanyId] = useState<string>(\"\");\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [showError, setShowError] = useState(false);\n\n  const { data: companies = [], isLoading: companiesLoading } = useQuery<Company[]>({\n    queryKey: [\"/api/companies\"],\n  });\n\n  useEffect(() => {\n    if (isAuthenticated) {\n      setLocation(\"/\");\n    }\n  }, [isAuthenticated, setLocation]);\n\n  useEffect(() => {\n    if (authError) {\n      setShowError(true);\n    }\n  }, [authError]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setShowError(false);\n    setIsSubmitting(true);\n\n    try {\n      const success = await login(username, password, companyId || undefined);\n      if (success) {\n        toast({\n          title: \"Welcome back\",\n          description: \"You have been logged in successfully.\",\n        });\n        setLocation(\"/\");\n      }\n    } catch (error) {\n      setShowError(true);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  if (authLoading && isAuthenticated) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen bg-background\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4\" />\n          <p className=\"text-muted-foreground\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex items-center justify-center min-h-screen bg-background p-4\">\n      <div className=\"w-full max-w-md\">\n        <div className=\"text-center mb-8\">\n          <div className=\"flex items-center justify-center gap-2 mb-4\">\n            <Building2 className=\"w-10 h-10 text-primary\" />\n            <h1 className=\"text-3xl font-bold\">Unanza</h1>\n          </div>\n          <p className=\"text-muted-foreground\">Enterprise Resource Planning</p>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Sign In</CardTitle>\n            <CardDescription>\n              Enter your credentials to access the system\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              {showError && authError && (\n                <div className=\"flex items-center gap-2 p-3 rounded-md bg-destructive/10 text-destructive text-sm\" data-testid=\"error-login\">\n                  <AlertCircle className=\"w-4 h-4 shrink-0\" />\n                  <span>{authError}</span>\n                </div>\n              )}\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"username\">Username</Label>\n                <div className=\"relative\">\n                  <User className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n                  <Input\n                    id=\"username\"\n                    type=\"text\"\n                    placeholder=\"Enter your username\"\n                    value={username}\n                    onChange={(e) => setUsername(e.target.value)}\n                    className=\"pl-10\"\n                    required\n                    disabled={isSubmitting}\n                    data-testid=\"input-username\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"password\">Password</Label>\n                <div className=\"relative\">\n                  <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n                  <Input\n                    id=\"password\"\n                    type=\"password\"\n                    placeholder=\"Enter your password\"\n                    value={password}\n                    onChange={(e) => setPassword(e.target.value)}\n                    className=\"pl-10\"\n                    required\n                    disabled={isSubmitting}\n                    data-testid=\"input-password\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"company\">Company (Optional)</Label>\n                <Select \n                  value={companyId} \n                  onValueChange={setCompanyId}\n                  disabled={companiesLoading || isSubmitting}\n                >\n                  <SelectTrigger data-testid=\"select-company\">\n                    <SelectValue placeholder=\"Select a company\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {companies.map((company) => (\n                      <SelectItem key={company.id} value={company.id} data-testid={`select-company-${company.id}`}>\n                        <div className=\"flex items-center gap-2\">\n                          <span>{company.name}</span>\n                          <span className=\"text-xs text-muted-foreground\">({company.code})</span>\n                        </div>\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <p className=\"text-xs text-muted-foreground\">\n                  Leave empty to use your default company\n                </p>\n              </div>\n\n              <Button \n                type=\"submit\" \n                className=\"w-full\" \n                disabled={isSubmitting || !username || !password}\n                data-testid=\"button-login\"\n              >\n                {isSubmitting ? (\n                  <>\n                    <span className=\"animate-spin mr-2 w-4 h-4 border-2 border-current border-t-transparent rounded-full\" />\n                    Signing in...\n                  </>\n                ) : (\n                  \"Sign In\"\n                )}\n              </Button>\n            </form>\n\n            <div className=\"mt-6 pt-4 border-t\">\n              <p className=\"text-xs text-center text-muted-foreground mb-2\">Demo Credentials</p>\n              <div className=\"text-xs text-center text-muted-foreground space-y-1\">\n                <p><strong>Admin:</strong> admin / admin123</p>\n                <p><strong>Manager:</strong> john.manager / password</p>\n                <p><strong>Accountant:</strong> jane.accountant / password</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":7300,"size_tokens":null},"client/src/components/onboarding/OnboardingChecklist.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Link } from \"wouter\";\nimport { useCompany } from \"@/contexts/CompanyContext\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { \n  CheckCircle2, \n  Building2, \n  Users, \n  FileSpreadsheet, \n  Warehouse, \n  UserCog, \n  Settings,\n  ArrowRight,\n  Sparkles,\n} from \"lucide-react\";\n\ninterface Account {\n  id: string;\n}\n\ninterface WarehouseData {\n  id: string;\n}\n\ninterface Company {\n  id: string;\n}\n\ninterface OnboardingTask {\n  id: string;\n  title: string;\n  description: string;\n  icon: React.ComponentType<{ className?: string }>;\n  link: string;\n  isComplete: boolean;\n}\n\nexport function OnboardingChecklist() {\n  const { activeCompanyId } = useCompany();\n  const { isAuthenticated, isLoading: authLoading, user } = useAuth();\n\n  const isReady = isAuthenticated && !authLoading && !!activeCompanyId && !!user;\n\n  const { data: accounts = [] } = useQuery<Account[]>({\n    queryKey: [`/api/companies/${activeCompanyId}/accounts`],\n    enabled: isReady,\n    staleTime: 30000,\n  });\n\n  const { data: warehouses = [] } = useQuery<WarehouseData[]>({\n    queryKey: [`/api/companies/${activeCompanyId}/warehouses`],\n    enabled: isReady,\n    staleTime: 30000,\n  });\n\n  const { data: companies = [] } = useQuery<Company[]>({\n    queryKey: [\"/api/companies\"],\n    enabled: isReady,\n    staleTime: 30000,\n  });\n\n  const { data: roles = [] } = useQuery<any[]>({\n    queryKey: [\"/api/roles\"],\n    enabled: isReady,\n    staleTime: 30000,\n  });\n\n  if (!isReady) {\n    return null;\n  }\n\n  const tasks: OnboardingTask[] = [\n    {\n      id: \"chart-of-accounts\",\n      title: \"Set up Chart of Accounts\",\n      description: \"Define your company's financial accounts structure\",\n      icon: FileSpreadsheet,\n      link: \"/financials/accounts\",\n      isComplete: accounts.length > 0,\n    },\n    {\n      id: \"warehouses\",\n      title: \"Create Warehouses\",\n      description: \"Set up storage locations for inventory management\",\n      icon: Warehouse,\n      link: \"/warehouse/locations\",\n      isComplete: warehouses.length > 0,\n    },\n    {\n      id: \"users\",\n      title: \"Add Team Members\",\n      description: \"Invite users and assign roles\",\n      icon: Users,\n      link: \"/system/users\",\n      isComplete: false,\n    },\n    {\n      id: \"companies\",\n      title: \"Add Subsidiaries/Branches\",\n      description: \"Expand your company hierarchy\",\n      icon: Building2,\n      link: \"/system/companies\",\n      isComplete: companies.length > 1,\n    },\n    {\n      id: \"roles\",\n      title: \"Configure User Roles\",\n      description: \"Define permissions and access levels\",\n      icon: UserCog,\n      link: \"/system/users\",\n      isComplete: roles.length > 1,\n    },\n    {\n      id: \"settings\",\n      title: \"Review Settings\",\n      description: \"Configure company preferences and defaults\",\n      icon: Settings,\n      link: \"/system/settings\",\n      isComplete: false,\n    },\n  ];\n\n  const completedCount = tasks.filter(t => t.isComplete).length;\n  const progress = (completedCount / tasks.length) * 100;\n\n  if (progress === 100) {\n    return null;\n  }\n\n  return (\n    <Card className=\"mb-6\">\n      <CardHeader>\n        <div className=\"flex items-center gap-3\">\n          <div className=\"p-2 rounded-md bg-primary/10\">\n            <Sparkles className=\"w-5 h-5 text-primary\" />\n          </div>\n          <div>\n            <CardTitle className=\"text-lg\">Getting Started</CardTitle>\n            <CardDescription>Complete these steps to set up your ERP system</CardDescription>\n          </div>\n        </div>\n        <div className=\"mt-4\">\n          <div className=\"flex items-center justify-between text-sm mb-2\">\n            <span className=\"text-muted-foreground\">{completedCount} of {tasks.length} completed</span>\n            <span className=\"font-medium\">{Math.round(progress)}%</span>\n          </div>\n          <Progress value={progress} className=\"h-2\" />\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-3\">\n          {tasks.map((task) => (\n            <Link key={task.id} href={task.link}>\n              <div \n                className={`flex items-start gap-3 p-4 border rounded-md cursor-pointer transition-colors ${\n                  task.isComplete \n                    ? \"bg-muted/50 opacity-60\" \n                    : \"hover-elevate\"\n                }`}\n                data-testid={`onboarding-task-${task.id}`}\n              >\n                <div className={`p-2 rounded-md shrink-0 ${task.isComplete ? \"bg-primary/20\" : \"bg-muted\"}`}>\n                  {task.isComplete ? (\n                    <CheckCircle2 className=\"w-4 h-4 text-primary\" />\n                  ) : (\n                    <task.icon className=\"w-4 h-4 text-muted-foreground\" />\n                  )}\n                </div>\n                <div className=\"flex-1 min-w-0\">\n                  <p className={`font-medium text-sm ${task.isComplete ? \"line-through text-muted-foreground\" : \"\"}`}>\n                    {task.title}\n                  </p>\n                  <p className=\"text-xs text-muted-foreground mt-0.5 line-clamp-1\">\n                    {task.description}\n                  </p>\n                </div>\n                {!task.isComplete && (\n                  <ArrowRight className=\"w-4 h-4 text-muted-foreground shrink-0\" />\n                )}\n              </div>\n            </Link>\n          ))}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":5616,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"client/src/components/examples/PurchaseOrderList.tsx":{"content":"import { PurchaseOrderList } from \"../warehouse/PurchaseOrderList\";\n\nexport default function PurchaseOrderListExample() {\n  return <PurchaseOrderList />;\n}\n","path":null,"size_bytes":156,"size_tokens":null},"client/src/components/reports/AdvancedReports.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Brain,\n  TrendingUp,\n  TrendingDown,\n  Users,\n  Building2,\n  Activity,\n  AlertTriangle,\n  Clock,\n  Package,\n  Sparkles,\n  LineChart,\n  BarChart3,\n} from \"lucide-react\";\nimport {\n  mockVendorScorecard,\n  mockCustomerLifetimeValue,\n  mockAuditLog,\n  mockChurnProbability,\n  mockPredictiveReorder,\n  mockDemandForecast,\n  mockHistoricalSales,\n} from \"@/lib/reportData\";\nimport { cn } from \"@/lib/utils\";\n\nexport function AdvancedReports() {\n  const [activeTab, setActiveTab] = useState(\"vendor\");\n\n  return (\n    <div className=\"space-y-6\">\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList className=\"grid grid-cols-6 w-full max-w-4xl\">\n          <TabsTrigger value=\"vendor\" data-testid=\"tab-vendor\">Vendors</TabsTrigger>\n          <TabsTrigger value=\"clv\" data-testid=\"tab-clv\">Customer LTV</TabsTrigger>\n          <TabsTrigger value=\"audit\" data-testid=\"tab-audit\">Audit Log</TabsTrigger>\n          <TabsTrigger value=\"churn\" data-testid=\"tab-churn\">Churn Risk</TabsTrigger>\n          <TabsTrigger value=\"predictive\" data-testid=\"tab-predictive\">AI Reorder</TabsTrigger>\n          <TabsTrigger value=\"demand\" data-testid=\"tab-demand\">Demand Forecast</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"vendor\" className=\"space-y-6 mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Building2 className=\"h-5 w-5\" />\n                Vendor Scorecard\n              </CardTitle>\n              <CardDescription>Comprehensive vendor performance evaluation</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6\">\n                {mockVendorScorecard.map((vendor) => (\n                  <Card key={vendor.id} className=\"border-2\">\n                    <CardHeader className=\"pb-2\">\n                      <div className=\"flex items-center justify-between\">\n                        <CardTitle className=\"text-base\">{vendor.name}</CardTitle>\n                        {vendor.trend === \"up\" ? (\n                          <TrendingUp className=\"h-4 w-4 text-green-500\" />\n                        ) : vendor.trend === \"down\" ? (\n                          <TrendingDown className=\"h-4 w-4 text-red-500\" />\n                        ) : (\n                          <Activity className=\"h-4 w-4 text-muted-foreground\" />\n                        )}\n                      </div>\n                    </CardHeader>\n                    <CardContent className=\"space-y-3\">\n                      <div className=\"text-center mb-4\">\n                        <p className={cn(\n                          \"text-3xl font-bold\",\n                          vendor.overall >= 90 ? \"text-green-600\" :\n                          vendor.overall >= 80 ? \"text-amber-600\" : \"text-red-600\"\n                        )}>\n                          {vendor.overall}%\n                        </p>\n                        <p className=\"text-sm text-muted-foreground\">Overall Score</p>\n                      </div>\n                      <div className=\"space-y-2 text-sm\">\n                        <div className=\"flex justify-between\">\n                          <span>Quality</span>\n                          <span className=\"font-medium\">{vendor.quality}%</span>\n                        </div>\n                        <div className=\"flex justify-between\">\n                          <span>Delivery</span>\n                          <span className=\"font-medium\">{vendor.delivery}%</span>\n                        </div>\n                        <div className=\"flex justify-between\">\n                          <span>Price</span>\n                          <span className=\"font-medium\">{vendor.price}%</span>\n                        </div>\n                        <div className=\"flex justify-between\">\n                          <span>Service</span>\n                          <span className=\"font-medium\">{vendor.service}%</span>\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"clv\" className=\"space-y-6 mt-6\">\n          <div className=\"grid md:grid-cols-3 gap-4\">\n            <Card data-testid=\"card-total-clv\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm text-muted-foreground\">Total CLV</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-2xl font-semibold text-green-600 dark:text-green-400\" data-testid=\"text-total-clv\">\n                  ${mockCustomerLifetimeValue.reduce((sum, c) => sum + c.clv, 0).toLocaleString()}\n                </p>\n              </CardContent>\n            </Card>\n            <Card data-testid=\"card-avg-clv\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm text-muted-foreground\">Avg CLV per Customer</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-2xl font-semibold\" data-testid=\"text-avg-clv\">\n                  ${(mockCustomerLifetimeValue.reduce((sum, c) => sum + c.clv, 0) / mockCustomerLifetimeValue.length).toLocaleString()}\n                </p>\n              </CardContent>\n            </Card>\n            <Card data-testid=\"card-high-value-customers\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm text-muted-foreground\">High-Value Customers</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-2xl font-semibold\" data-testid=\"text-high-value-count\">\n                  {mockCustomerLifetimeValue.filter(c => c.segment === \"high\").length}\n                </p>\n              </CardContent>\n            </Card>\n          </div>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Users className=\"h-5 w-5\" />\n                Customer Lifetime Value Analysis\n              </CardTitle>\n              <CardDescription>Predicted customer value based on historical behavior</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Customer</TableHead>\n                    <TableHead>Acquisition</TableHead>\n                    <TableHead className=\"text-right\">Total Revenue</TableHead>\n                    <TableHead className=\"text-right\">Avg Order</TableHead>\n                    <TableHead className=\"text-center\">Frequency</TableHead>\n                    <TableHead className=\"text-right\">Lifetime Value</TableHead>\n                    <TableHead className=\"text-center\">Segment</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {mockCustomerLifetimeValue.map((customer) => (\n                    <TableRow key={customer.id}>\n                      <TableCell className=\"font-medium\">{customer.name}</TableCell>\n                      <TableCell>{customer.acquisitionDate}</TableCell>\n                      <TableCell className=\"text-right\">${customer.totalRevenue.toLocaleString()}</TableCell>\n                      <TableCell className=\"text-right\">${customer.avgOrderValue.toLocaleString()}</TableCell>\n                      <TableCell className=\"text-center\">{customer.frequency} orders</TableCell>\n                      <TableCell className=\"text-right font-semibold text-green-600\">\n                        ${customer.clv.toLocaleString()}\n                      </TableCell>\n                      <TableCell className=\"text-center\">\n                        <Badge className={cn(\n                          customer.segment === \"high\" ? \"bg-green-500\" :\n                          customer.segment === \"medium\" ? \"bg-blue-500\" : \"bg-gray-500\"\n                        )}>\n                          {customer.segment}\n                        </Badge>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"audit\" className=\"space-y-6 mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Activity className=\"h-5 w-5\" />\n                User Activity Audit Log\n              </CardTitle>\n              <CardDescription>System activity tracking for compliance and security</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Timestamp</TableHead>\n                    <TableHead>User</TableHead>\n                    <TableHead>Module</TableHead>\n                    <TableHead>Action</TableHead>\n                    <TableHead>Entity</TableHead>\n                    <TableHead>Details</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {mockAuditLog.map((log) => (\n                    <TableRow key={log.id}>\n                      <TableCell className=\"font-mono text-sm\">{log.timestamp}</TableCell>\n                      <TableCell>{log.user}</TableCell>\n                      <TableCell>\n                        <Badge variant=\"outline\">{log.module}</Badge>\n                      </TableCell>\n                      <TableCell>\n                        <Badge className={cn(\n                          log.action === \"CREATE\" ? \"bg-green-500\" :\n                          log.action === \"UPDATE\" ? \"bg-blue-500\" :\n                          log.action === \"DELETE\" ? \"bg-red-500\" :\n                          log.action === \"POST\" ? \"bg-purple-500\" : \"bg-amber-500\"\n                        )}>\n                          {log.action}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        <span className=\"font-medium\">{log.entity}</span>\n                        <span className=\"text-muted-foreground ml-1\">({log.entityId})</span>\n                      </TableCell>\n                      <TableCell className=\"text-muted-foreground\">{log.details}</TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"churn\" className=\"space-y-6 mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <AlertTriangle className=\"h-5 w-5\" />\n                Customer Churn Probability Analysis\n              </CardTitle>\n              <CardDescription>AI-powered churn risk prediction based on customer behavior</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Customer</TableHead>\n                    <TableHead className=\"text-center\">Days Since Order</TableHead>\n                    <TableHead className=\"text-center\">Frequency Decline</TableHead>\n                    <TableHead className=\"text-center\">Revenue Decline</TableHead>\n                    <TableHead className=\"text-center\">Support Tickets</TableHead>\n                    <TableHead className=\"text-center\">Churn Probability</TableHead>\n                    <TableHead className=\"text-center\">Risk Level</TableHead>\n                    <TableHead></TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {mockChurnProbability.map((customer) => (\n                    <TableRow key={customer.id}>\n                      <TableCell className=\"font-medium\">{customer.name}</TableCell>\n                      <TableCell className=\"text-center\">{customer.lastOrderDays}</TableCell>\n                      <TableCell className={cn(\n                        \"text-center\",\n                        customer.orderFrequencyDecline > 20 && \"text-red-600\"\n                      )}>\n                        {customer.orderFrequencyDecline}%\n                      </TableCell>\n                      <TableCell className={cn(\n                        \"text-center\",\n                        customer.revenueDecline > 20 && \"text-red-600\",\n                        customer.revenueDecline < 0 && \"text-green-600\"\n                      )}>\n                        {customer.revenueDecline}%\n                      </TableCell>\n                      <TableCell className=\"text-center\">{customer.supportTickets}</TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center justify-center gap-2\">\n                          <Progress \n                            value={customer.churnProbability} \n                            className={cn(\n                              \"h-2 w-16\",\n                              customer.churnProbability > 50 && \"[&>div]:bg-red-500\"\n                            )} \n                          />\n                          <span className={cn(\n                            \"font-medium\",\n                            customer.churnProbability > 50 ? \"text-red-600\" : \"text-green-600\"\n                          )}>\n                            {customer.churnProbability}%\n                          </span>\n                        </div>\n                      </TableCell>\n                      <TableCell className=\"text-center\">\n                        <Badge className={cn(\n                          customer.riskLevel === \"high\" ? \"bg-red-500\" :\n                          customer.riskLevel === \"medium\" ? \"bg-amber-500\" : \"bg-green-500\"\n                        )}>\n                          {customer.riskLevel}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        {customer.riskLevel === \"high\" && (\n                          <Button size=\"sm\" variant=\"outline\" data-testid={`button-churn-action-${customer.id}`}>\n                            Take Action\n                          </Button>\n                        )}\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n\n              <div className=\"mt-6 p-4 bg-muted/50 rounded-md\">\n                <h4 className=\"font-medium mb-2 flex items-center gap-2\">\n                  <Sparkles className=\"h-4 w-4\" />\n                  AI Recommendations\n                </h4>\n                <ul className=\"space-y-2 text-sm\">\n                  <li className=\"flex items-start gap-2\">\n                    <AlertTriangle className=\"h-4 w-4 text-red-500 mt-0.5\" />\n                    <span><strong>Metro Retail Group:</strong> High churn risk - consider personalized outreach and special retention offer</span>\n                  </li>\n                  <li className=\"flex items-start gap-2\">\n                    <Clock className=\"h-4 w-4 text-amber-500 mt-0.5\" />\n                    <span><strong>TechStart Inc.:</strong> Monitor closely - order frequency showing slight decline</span>\n                  </li>\n                </ul>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"predictive\" className=\"space-y-6 mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Brain className=\"h-5 w-5\" />\n                AI-Powered Predictive Reorder\n              </CardTitle>\n              <CardDescription>Machine learning predictions for optimal reorder timing and quantities</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Product</TableHead>\n                    <TableHead className=\"text-center\">Current Stock</TableHead>\n                    <TableHead className=\"text-center\">Predicted Demand</TableHead>\n                    <TableHead className=\"text-center\">Days to Stockout</TableHead>\n                    <TableHead>Optimal Reorder Date</TableHead>\n                    <TableHead className=\"text-center\">Suggested Qty</TableHead>\n                    <TableHead className=\"text-center\">Confidence</TableHead>\n                    <TableHead></TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {mockPredictiveReorder.map((item) => (\n                    <TableRow key={item.id}>\n                      <TableCell>\n                        <div>\n                          <p className=\"font-medium\">{item.name}</p>\n                          <p className=\"text-sm text-muted-foreground\">{item.sku}</p>\n                        </div>\n                      </TableCell>\n                      <TableCell className={cn(\n                        \"text-center font-medium\",\n                        item.daysUntilStockout < 7 && \"text-red-600\"\n                      )}>\n                        {item.currentStock}\n                      </TableCell>\n                      <TableCell className=\"text-center\">{item.predictedDemand}/mo</TableCell>\n                      <TableCell className=\"text-center\">\n                        <Badge className={cn(\n                          item.daysUntilStockout < 7 ? \"bg-red-500\" :\n                          item.daysUntilStockout < 14 ? \"bg-amber-500\" : \"bg-green-500\"\n                        )}>\n                          {item.daysUntilStockout} days\n                        </Badge>\n                      </TableCell>\n                      <TableCell>{item.optimalReorderDate}</TableCell>\n                      <TableCell className=\"text-center font-semibold\">{item.suggestedQty}</TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center justify-center gap-2\">\n                          <Progress value={item.confidence} className=\"h-2 w-12\" />\n                          <span className=\"text-sm\">{item.confidence}%</span>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <Button size=\"sm\" data-testid={`button-create-po-${item.id}`}>\n                          Create PO\n                        </Button>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n\n              <div className=\"mt-6 grid md:grid-cols-3 gap-4\">\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm text-muted-foreground flex items-center gap-1\">\n                      <Sparkles className=\"h-4 w-4\" />\n                      Model Accuracy\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-2xl font-semibold text-green-600\">94.2%</p>\n                    <p className=\"text-sm text-muted-foreground\">Last 30 days</p>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm text-muted-foreground\">Stockouts Prevented</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-2xl font-semibold\">12</p>\n                    <p className=\"text-sm text-muted-foreground\">This month</p>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm text-muted-foreground\">Cost Savings</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-2xl font-semibold text-green-600\">$18,500</p>\n                    <p className=\"text-sm text-muted-foreground\">Reduced carrying costs</p>\n                  </CardContent>\n                </Card>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"demand\" className=\"space-y-6 mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <LineChart className=\"h-5 w-5\" />\n                AI Demand Forecasting\n              </CardTitle>\n              <CardDescription>6-month demand predictions based on historical patterns and seasonality</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Product</TableHead>\n                    <TableHead className=\"text-center\">Current</TableHead>\n                    <TableHead className=\"text-center\">+1 Mo</TableHead>\n                    <TableHead className=\"text-center\">+2 Mo</TableHead>\n                    <TableHead className=\"text-center\">+3 Mo</TableHead>\n                    <TableHead className=\"text-center\">+4 Mo</TableHead>\n                    <TableHead className=\"text-center\">+5 Mo</TableHead>\n                    <TableHead className=\"text-center\">+6 Mo</TableHead>\n                    <TableHead className=\"text-center\">Pattern</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {mockDemandForecast.map((product) => (\n                    <TableRow key={product.productId}>\n                      <TableCell className=\"font-medium\">{product.name}</TableCell>\n                      <TableCell className=\"text-center\">{product.currentMonth}</TableCell>\n                      <TableCell className={cn(\n                        \"text-center\",\n                        product.month1 > product.currentMonth ? \"text-green-600\" : \n                        product.month1 < product.currentMonth ? \"text-red-600\" : \"\"\n                      )}>\n                        {product.month1}\n                      </TableCell>\n                      <TableCell className={cn(\n                        \"text-center\",\n                        product.month2 > product.month1 ? \"text-green-600\" : \n                        product.month2 < product.month1 ? \"text-red-600\" : \"\"\n                      )}>\n                        {product.month2}\n                      </TableCell>\n                      <TableCell className={cn(\n                        \"text-center\",\n                        product.month3 > product.month2 ? \"text-green-600\" : \n                        product.month3 < product.month2 ? \"text-red-600\" : \"\"\n                      )}>\n                        {product.month3}\n                      </TableCell>\n                      <TableCell className={cn(\n                        \"text-center\",\n                        product.month4 > product.month3 ? \"text-green-600\" : \n                        product.month4 < product.month3 ? \"text-red-600\" : \"\"\n                      )}>\n                        {product.month4}\n                      </TableCell>\n                      <TableCell className={cn(\n                        \"text-center\",\n                        product.month5 > product.month4 ? \"text-green-600\" : \n                        product.month5 < product.month4 ? \"text-red-600\" : \"\"\n                      )}>\n                        {product.month5}\n                      </TableCell>\n                      <TableCell className={cn(\n                        \"text-center\",\n                        product.month6 > product.month5 ? \"text-green-600\" : \n                        product.month6 < product.month5 ? \"text-red-600\" : \"\"\n                      )}>\n                        {product.month6}\n                      </TableCell>\n                      <TableCell className=\"text-center\">\n                        <Badge variant=\"outline\" className={cn(\n                          product.seasonality === \"growing\" && \"border-green-500 text-green-600\",\n                          product.seasonality === \"seasonal-high\" && \"border-amber-500 text-amber-600\",\n                          product.seasonality === \"variable\" && \"border-purple-500 text-purple-600\"\n                        )}>\n                          {product.seasonality}\n                        </Badge>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n\n              <div className=\"mt-6\">\n                <h4 className=\"font-medium mb-4 flex items-center gap-2\">\n                  <BarChart3 className=\"h-5 w-5\" />\n                  Historical Sales Trend\n                </h4>\n                <div className=\"h-48 flex items-end gap-1\">\n                  {mockHistoricalSales.map((month, index) => {\n                    const maxRevenue = Math.max(...mockHistoricalSales.map(m => m.revenue));\n                    const height = (month.revenue / maxRevenue) * 100;\n                    return (\n                      <div key={month.month} className=\"flex-1 flex flex-col items-center\">\n                        <div\n                          className=\"w-full bg-blue-500 rounded-t transition-all hover:bg-blue-600\"\n                          style={{ height: `${height}%` }}\n                          title={`${month.month}: $${month.revenue.toLocaleString()}`}\n                        />\n                        <span className=\"text-xs text-muted-foreground mt-1 rotate-45 origin-left\">\n                          {month.month.slice(0, 3)}\n                        </span>\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":26516,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/components/layout/DataTable.tsx":{"content":"import { useState } from \"react\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { ChevronLeft, ChevronRight, Search, ArrowUpDown, ArrowUp, ArrowDown } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\nexport interface Column<T> {\n  key: keyof T | string;\n  header: string;\n  sortable?: boolean;\n  render?: (item: T) => React.ReactNode;\n  className?: string;\n}\n\ninterface DataTableProps<T extends { id: string }> {\n  data: T[];\n  columns: Column<T>[];\n  searchPlaceholder?: string;\n  searchKey?: keyof T;\n  onRowClick?: (item: T) => void;\n  selectable?: boolean;\n  selectedIds?: string[];\n  onSelectionChange?: (ids: string[]) => void;\n  pageSize?: number;\n  className?: string;\n}\n\ntype SortDirection = \"asc\" | \"desc\" | null;\n\nexport function DataTable<T extends { id: string }>({\n  data,\n  columns,\n  searchPlaceholder = \"Search...\",\n  searchKey,\n  onRowClick,\n  selectable = false,\n  selectedIds = [],\n  onSelectionChange,\n  pageSize: initialPageSize = 10,\n  className,\n}: DataTableProps<T>) {\n  const [search, setSearch] = useState(\"\");\n  const [sortKey, setSortKey] = useState<string | null>(null);\n  const [sortDirection, setSortDirection] = useState<SortDirection>(null);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [pageSize, setPageSize] = useState(initialPageSize);\n\n  // Filter data\n  const filteredData = searchKey\n    ? data.filter((item) => {\n        const value = item[searchKey];\n        if (typeof value === \"string\") {\n          return value.toLowerCase().includes(search.toLowerCase());\n        }\n        return true;\n      })\n    : data;\n\n  // Sort data\n  const sortedData = sortKey && sortDirection\n    ? [...filteredData].sort((a, b) => {\n        const aValue = (a as Record<string, unknown>)[sortKey];\n        const bValue = (b as Record<string, unknown>)[sortKey];\n        \n        if (aValue === bValue) return 0;\n        if (aValue === null || aValue === undefined) return 1;\n        if (bValue === null || bValue === undefined) return -1;\n        \n        const comparison = aValue < bValue ? -1 : 1;\n        return sortDirection === \"asc\" ? comparison : -comparison;\n      })\n    : filteredData;\n\n  // Paginate data\n  const totalPages = Math.ceil(sortedData.length / pageSize);\n  const paginatedData = sortedData.slice(\n    (currentPage - 1) * pageSize,\n    currentPage * pageSize\n  );\n\n  const handleSort = (key: string) => {\n    if (sortKey === key) {\n      if (sortDirection === \"asc\") {\n        setSortDirection(\"desc\");\n      } else if (sortDirection === \"desc\") {\n        setSortKey(null);\n        setSortDirection(null);\n      }\n    } else {\n      setSortKey(key);\n      setSortDirection(\"asc\");\n    }\n  };\n\n  const handleSelectAll = (checked: boolean) => {\n    if (onSelectionChange) {\n      onSelectionChange(checked ? paginatedData.map((item) => item.id) : []);\n    }\n  };\n\n  const handleSelectRow = (id: string, checked: boolean) => {\n    if (onSelectionChange) {\n      if (checked) {\n        onSelectionChange([...selectedIds, id]);\n      } else {\n        onSelectionChange(selectedIds.filter((selectedId) => selectedId !== id));\n      }\n    }\n  };\n\n  const allSelected = paginatedData.length > 0 && paginatedData.every((item) => selectedIds.includes(item.id));\n  const someSelected = paginatedData.some((item) => selectedIds.includes(item.id)) && !allSelected;\n\n  return (\n    <div className={cn(\"space-y-4\", className)}>\n      {searchKey && (\n        <div className=\"relative max-w-sm\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder={searchPlaceholder}\n            value={search}\n            onChange={(e) => {\n              setSearch(e.target.value);\n              setCurrentPage(1);\n            }}\n            className=\"pl-9\"\n            data-testid=\"input-search\"\n          />\n        </div>\n      )}\n\n      <div className=\"border rounded-md\">\n        <Table>\n          <TableHeader>\n            <TableRow>\n              {selectable && (\n                <TableHead className=\"w-12\">\n                  <Checkbox\n                    checked={allSelected}\n                    ref={(el) => {\n                      if (el) {\n                        (el as HTMLButtonElement & { indeterminate: boolean }).indeterminate = someSelected;\n                      }\n                    }}\n                    onCheckedChange={handleSelectAll}\n                    data-testid=\"checkbox-select-all\"\n                  />\n                </TableHead>\n              )}\n              {columns.map((column) => (\n                <TableHead\n                  key={String(column.key)}\n                  className={cn(\n                    column.sortable && \"cursor-pointer select-none\",\n                    column.className\n                  )}\n                  onClick={() => column.sortable && handleSort(String(column.key))}\n                >\n                  <div className=\"flex items-center gap-1\">\n                    {column.header}\n                    {column.sortable && (\n                      <span className=\"ml-1\">\n                        {sortKey === String(column.key) ? (\n                          sortDirection === \"asc\" ? (\n                            <ArrowUp className=\"h-3 w-3\" />\n                          ) : (\n                            <ArrowDown className=\"h-3 w-3\" />\n                          )\n                        ) : (\n                          <ArrowUpDown className=\"h-3 w-3 text-muted-foreground\" />\n                        )}\n                      </span>\n                    )}\n                  </div>\n                </TableHead>\n              ))}\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {paginatedData.length === 0 ? (\n              <TableRow>\n                <TableCell\n                  colSpan={columns.length + (selectable ? 1 : 0)}\n                  className=\"h-24 text-center text-muted-foreground\"\n                >\n                  No results found.\n                </TableCell>\n              </TableRow>\n            ) : (\n              paginatedData.map((item) => (\n                <TableRow\n                  key={item.id}\n                  className={cn(\n                    onRowClick && \"cursor-pointer\",\n                    selectedIds.includes(item.id) && \"bg-muted/50\"\n                  )}\n                  onClick={() => onRowClick?.(item)}\n                  data-testid={`row-${item.id}`}\n                >\n                  {selectable && (\n                    <TableCell onClick={(e) => e.stopPropagation()}>\n                      <Checkbox\n                        checked={selectedIds.includes(item.id)}\n                        onCheckedChange={(checked) => handleSelectRow(item.id, !!checked)}\n                        data-testid={`checkbox-${item.id}`}\n                      />\n                    </TableCell>\n                  )}\n                  {columns.map((column) => (\n                    <TableCell key={String(column.key)} className={column.className}>\n                      {column.render\n                        ? column.render(item)\n                        : String((item as Record<string, unknown>)[String(column.key)] ?? \"\")}\n                    </TableCell>\n                  ))}\n                </TableRow>\n              ))\n            )}\n          </TableBody>\n        </Table>\n      </div>\n\n      <div className=\"flex flex-wrap items-center justify-between gap-4\">\n        <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n          <span>Showing</span>\n          <Select\n            value={String(pageSize)}\n            onValueChange={(value) => {\n              setPageSize(Number(value));\n              setCurrentPage(1);\n            }}\n          >\n            <SelectTrigger className=\"w-16\" data-testid=\"select-page-size\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"5\">5</SelectItem>\n              <SelectItem value=\"10\">10</SelectItem>\n              <SelectItem value=\"25\">25</SelectItem>\n              <SelectItem value=\"50\">50</SelectItem>\n            </SelectContent>\n          </Select>\n          <span>of {sortedData.length} entries</span>\n        </div>\n\n        <div className=\"flex items-center gap-1\">\n          <Button\n            variant=\"outline\"\n            size=\"icon\"\n            onClick={() => setCurrentPage((p) => Math.max(1, p - 1))}\n            disabled={currentPage === 1}\n            data-testid=\"button-prev-page\"\n          >\n            <ChevronLeft className=\"h-4 w-4\" />\n          </Button>\n          <div className=\"flex items-center gap-1 px-2\">\n            {Array.from({ length: Math.min(5, totalPages) }, (_, i) => {\n              let pageNum: number;\n              if (totalPages <= 5) {\n                pageNum = i + 1;\n              } else if (currentPage <= 3) {\n                pageNum = i + 1;\n              } else if (currentPage >= totalPages - 2) {\n                pageNum = totalPages - 4 + i;\n              } else {\n                pageNum = currentPage - 2 + i;\n              }\n              return (\n                <Button\n                  key={pageNum}\n                  variant={currentPage === pageNum ? \"default\" : \"ghost\"}\n                  size=\"sm\"\n                  onClick={() => setCurrentPage(pageNum)}\n                  data-testid={`button-page-${pageNum}`}\n                >\n                  {pageNum}\n                </Button>\n              );\n            })}\n          </div>\n          <Button\n            variant=\"outline\"\n            size=\"icon\"\n            onClick={() => setCurrentPage((p) => Math.min(totalPages, p + 1))}\n            disabled={currentPage === totalPages || totalPages === 0}\n            data-testid=\"button-next-page\"\n          >\n            <ChevronRight className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":10251,"size_tokens":null},"client/src/components/examples/ProductList.tsx":{"content":"import { ProductList } from \"../warehouse/ProductList\";\n\nexport default function ProductListExample() {\n  return <ProductList />;\n}\n","path":null,"size_bytes":132,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/components/examples/CustomerPortal.tsx":{"content":"import { CustomerPortal } from \"../system/CustomerPortal\";\n\nexport default function CustomerPortalExample() {\n  return <CustomerPortal />;\n}\n","path":null,"size_bytes":141,"size_tokens":null},"client/src/components/hr/Payroll.tsx":{"content":"import { useState } from \"react\";\nimport { DataTable, type Column } from \"@/components/layout/DataTable\";\nimport { StatusBadge } from \"@/components/layout/StatusBadge\";\nimport { PageHeader } from \"@/components/layout/PageHeader\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Download, Eye, Printer } from \"lucide-react\";\nimport { mockEmployees } from \"@/lib/mockData\";\n\n// todo: remove mock functionality\nconst mockPayrollRuns = [\n  { id: \"PR-2024-12\", period: \"December 2024\", date: \"2024-12-31\", status: \"pending\", totalGross: 45600, totalNet: 34200, employees: 5 },\n  { id: \"PR-2024-11\", period: \"November 2024\", date: \"2024-11-30\", status: \"paid\", totalGross: 45600, totalNet: 34200, employees: 5 },\n  { id: \"PR-2024-10\", period: \"October 2024\", date: \"2024-10-31\", status: \"paid\", totalGross: 44800, totalNet: 33600, employees: 5 },\n];\n\nconst mockPayslip = {\n  employee: mockEmployees[0],\n  period: \"December 2024\",\n  basicSalary: 8500,\n  allowances: 500,\n  overtime: 200,\n  grossPay: 9200,\n  taxDeduction: 1840,\n  socialSecurity: 690,\n  healthInsurance: 230,\n  totalDeductions: 2760,\n  netPay: 6440,\n};\n\ntype PayrollRun = typeof mockPayrollRuns[0];\n\nexport function Payroll() {\n  const [payrollRuns] = useState(mockPayrollRuns);\n  const [selectedRun, setSelectedRun] = useState<PayrollRun | null>(null);\n  const [isDetailOpen, setIsDetailOpen] = useState(false);\n\n  const handleViewRun = (run: PayrollRun) => {\n    setSelectedRun(run);\n    setIsDetailOpen(true);\n  };\n\n  const handlePrint = () => {\n    window.print();\n    console.log(\"Print payslip\");\n  };\n\n  const columns: Column<PayrollRun>[] = [\n    { key: \"id\", header: \"Run ID\", sortable: true },\n    { key: \"period\", header: \"Period\", sortable: true },\n    { key: \"date\", header: \"Date\", sortable: true },\n    { key: \"employees\", header: \"Employees\", className: \"text-center\" },\n    { \n      key: \"totalGross\", \n      header: \"Gross Pay\", \n      sortable: true,\n      className: \"text-right\",\n      render: (item) => `$${item.totalGross.toLocaleString()}`\n    },\n    { \n      key: \"totalNet\", \n      header: \"Net Pay\", \n      sortable: true,\n      className: \"text-right\",\n      render: (item) => `$${item.totalNet.toLocaleString()}`\n    },\n    { \n      key: \"status\", \n      header: \"Status\",\n      render: (item) => <StatusBadge status={item.status as \"pending\" | \"paid\"} />\n    },\n    {\n      key: \"actions\",\n      header: \"\",\n      className: \"text-right\",\n      render: (item) => (\n        <div className=\"flex justify-end gap-1\" onClick={(e) => e.stopPropagation()}>\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => handleViewRun(item)} data-testid={`button-view-${item.id}`}>\n            <Eye className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      ),\n    },\n  ];\n\n  return (\n    <div>\n      <PageHeader\n        title=\"Payroll\"\n        description=\"Manage payroll runs and payslips\"\n        actions={\n          <Button variant=\"outline\" data-testid=\"button-export\">\n            <Download className=\"h-4 w-4 mr-2\" />\n            Export\n          </Button>\n        }\n      />\n\n      <DataTable\n        data={payrollRuns}\n        columns={columns}\n        searchKey=\"period\"\n        searchPlaceholder=\"Search payroll runs...\"\n        onRowClick={handleViewRun}\n      />\n\n      <Dialog open={isDetailOpen} onOpenChange={setIsDetailOpen}>\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Payslip Details</DialogTitle>\n          </DialogHeader>\n          {selectedRun && (\n            <div className=\"space-y-6\">\n              <Card className=\"print:shadow-none\">\n                <CardContent className=\"p-6\">\n                  <div className=\"flex justify-between items-start mb-6\">\n                    <div>\n                      <div className=\"flex items-center gap-2 mb-2\">\n                        <div className=\"flex items-center justify-center w-8 h-8 rounded-md bg-primary text-primary-foreground font-bold\">\n                          U\n                        </div>\n                        <span className=\"font-bold text-lg\">Unanza</span>\n                      </div>\n                      <p className=\"text-sm text-muted-foreground\">\n                        123 Business Street<br />\n                        City, State 12345\n                      </p>\n                    </div>\n                    <div className=\"text-right\">\n                      <h2 className=\"text-xl font-bold\">PAYSLIP</h2>\n                      <p className=\"text-sm text-muted-foreground\">{selectedRun.period}</p>\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-2 gap-6 mb-6 p-4 bg-muted/30 rounded-md\">\n                    <div>\n                      <p className=\"text-sm text-muted-foreground\">Employee</p>\n                      <p className=\"font-medium\">{mockPayslip.employee.name}</p>\n                      <p className=\"text-sm text-muted-foreground\">{mockPayslip.employee.position}</p>\n                    </div>\n                    <div className=\"text-right\">\n                      <p className=\"text-sm text-muted-foreground\">Employee ID</p>\n                      <p className=\"font-medium\">{mockPayslip.employee.id}</p>\n                      <p className=\"text-sm text-muted-foreground\">{mockPayslip.employee.department}</p>\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-2 gap-6\">\n                    <div>\n                      <h3 className=\"font-semibold mb-3\">Earnings</h3>\n                      <div className=\"space-y-2 text-sm\">\n                        <div className=\"flex justify-between\">\n                          <span>Basic Salary</span>\n                          <span>${mockPayslip.basicSalary.toLocaleString()}</span>\n                        </div>\n                        <div className=\"flex justify-between\">\n                          <span>Allowances</span>\n                          <span>${mockPayslip.allowances.toLocaleString()}</span>\n                        </div>\n                        <div className=\"flex justify-between\">\n                          <span>Overtime</span>\n                          <span>${mockPayslip.overtime.toLocaleString()}</span>\n                        </div>\n                        <div className=\"flex justify-between font-semibold pt-2 border-t\">\n                          <span>Gross Pay</span>\n                          <span>${mockPayslip.grossPay.toLocaleString()}</span>\n                        </div>\n                      </div>\n                    </div>\n\n                    <div>\n                      <h3 className=\"font-semibold mb-3\">Deductions</h3>\n                      <div className=\"space-y-2 text-sm\">\n                        <div className=\"flex justify-between\">\n                          <span>Income Tax</span>\n                          <span>${mockPayslip.taxDeduction.toLocaleString()}</span>\n                        </div>\n                        <div className=\"flex justify-between\">\n                          <span>Social Security</span>\n                          <span>${mockPayslip.socialSecurity.toLocaleString()}</span>\n                        </div>\n                        <div className=\"flex justify-between\">\n                          <span>Health Insurance</span>\n                          <span>${mockPayslip.healthInsurance.toLocaleString()}</span>\n                        </div>\n                        <div className=\"flex justify-between font-semibold pt-2 border-t\">\n                          <span>Total Deductions</span>\n                          <span>${mockPayslip.totalDeductions.toLocaleString()}</span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"mt-6 p-4 bg-primary/10 rounded-md\">\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"font-semibold text-lg\">Net Pay</span>\n                      <span className=\"font-bold text-2xl\" data-testid=\"text-net-pay\">\n                        ${mockPayslip.netPay.toLocaleString()}\n                      </span>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <div className=\"flex justify-end gap-2\">\n                <Button variant=\"outline\" onClick={handlePrint} data-testid=\"button-print\">\n                  <Printer className=\"h-4 w-4 mr-2\" />\n                  Print\n                </Button>\n                <Button variant=\"outline\" data-testid=\"button-download\">\n                  <Download className=\"h-4 w-4 mr-2\" />\n                  Download PDF\n                </Button>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":9024,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/system/CompanyManagement.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm, useWatch } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { \n  Building2, \n  Plus, \n  Edit, \n  Trash2, \n  ChevronRight,\n  ChevronDown,\n  Globe,\n  Building,\n  GitBranch,\n  AlertCircle\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Tabs,\n  TabsContent,\n  TabsList,\n  TabsTrigger,\n} from \"@/components/ui/tabs\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { Company, CompanyHierarchyNode } from \"@shared/schema\";\nimport { COMPANY_TYPES, COMPANY_LEVELS } from \"@shared/schema\";\nimport { cn } from \"@/lib/utils\";\n\n// Strict 3-level hierarchy: Holding (level 1) -> Subsidiary (level 2) -> Branch (level 3)\nconst companyFormSchema = z.object({\n  name: z.string().min(1, \"Company name is required\"),\n  code: z.string().min(1, \"Company code is required\").max(10, \"Max 10 characters\"),\n  companyType: z.enum([COMPANY_TYPES.HOLDING, COMPANY_TYPES.SUBSIDIARY, COMPANY_TYPES.BRANCH]),\n  parentId: z.string().nullable(),\n  taxId: z.string().optional(),\n  registrationNumber: z.string().optional(),\n  currency: z.string().min(3, \"Currency code required\").max(3, \"3-letter code\"),\n  fiscalYearEnd: z.string().optional(),\n  address: z.string().optional(),\n  city: z.string().optional(),\n  country: z.string().optional(),\n  phone: z.string().optional(),\n  email: z.string().email().optional().or(z.literal(\"\")),\n  website: z.string().url().optional().or(z.literal(\"\")),\n}).refine((data) => {\n  // Holding company must have no parent\n  if (data.companyType === COMPANY_TYPES.HOLDING && data.parentId) {\n    return false;\n  }\n  // Subsidiary and Branch must have a parent\n  if ((data.companyType === COMPANY_TYPES.SUBSIDIARY || data.companyType === COMPANY_TYPES.BRANCH) && !data.parentId) {\n    return false;\n  }\n  return true;\n}, {\n  message: \"Holding has no parent; Subsidiary/Branch must have a parent\",\n  path: [\"parentId\"],\n});\n\ntype CompanyFormValues = z.infer<typeof companyFormSchema>;\n\nconst companyTypeIcons: Record<string, typeof Building2> = {\n  holding: Globe,\n  subsidiary: Building,\n  branch: GitBranch,\n};\n\nconst companyTypeColors: Record<string, string> = {\n  holding: \"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200\",\n  subsidiary: \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\",\n  branch: \"bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200\",\n};\n\n// Company type descriptions for the UI\nconst companyTypeDescriptions: Record<string, string> = {\n  holding: \"Level 1: Top-level entity that owns subsidiaries. Can consolidate all data.\",\n  subsidiary: \"Level 2: Owned by a Holding. Can have Branches and consolidate their data.\",\n  branch: \"Level 3: Operational unit owned by a Subsidiary. Can only see its own data.\",\n};\n\ninterface HierarchyTreeProps {\n  nodes: CompanyHierarchyNode[];\n  onEdit: (company: Company) => void;\n  onDelete: (company: Company) => void;\n  depth?: number;\n}\n\nfunction HierarchyTree({ nodes, onEdit, onDelete, depth = 0 }: HierarchyTreeProps) {\n  return (\n    <div className=\"space-y-1\">\n      {nodes.map((node) => (\n        <HierarchyNode \n          key={node.company.id} \n          node={node} \n          onEdit={onEdit}\n          onDelete={onDelete}\n          depth={depth} \n        />\n      ))}\n    </div>\n  );\n}\n\ninterface HierarchyNodeProps {\n  node: CompanyHierarchyNode;\n  onEdit: (company: Company) => void;\n  onDelete: (company: Company) => void;\n  depth: number;\n}\n\nfunction HierarchyNode({ node, onEdit, onDelete, depth }: HierarchyNodeProps) {\n  const [isExpanded, setIsExpanded] = useState(true);\n  const hasChildren = node.children && node.children.length > 0;\n  const Icon = companyTypeIcons[node.company.companyType] || Building2;\n\n  return (\n    <div>\n      <div \n        className=\"flex items-center gap-2 p-2 rounded-md hover-elevate group\"\n        style={{ marginLeft: `${depth * 24}px` }}\n        data-testid={`company-node-${node.company.id}`}\n      >\n        {hasChildren ? (\n          <button\n            onClick={() => setIsExpanded(!isExpanded)}\n            className=\"p-0.5 hover:bg-accent rounded\"\n            data-testid={`button-toggle-${node.company.id}`}\n          >\n            {isExpanded ? (\n              <ChevronDown className=\"h-4 w-4\" />\n            ) : (\n              <ChevronRight className=\"h-4 w-4\" />\n            )}\n          </button>\n        ) : (\n          <span className=\"w-5\" />\n        )}\n        \n        <Icon className=\"h-5 w-5 text-muted-foreground shrink-0\" />\n        \n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2\">\n            <span className=\"font-medium truncate\" data-testid={`text-company-${node.company.id}`}>\n              {node.company.name}\n            </span>\n            <Badge variant=\"outline\" className=\"text-xs shrink-0\">\n              {node.company.code}\n            </Badge>\n            <Badge \n              variant=\"secondary\" \n              className={cn(\"text-xs shrink-0\", companyTypeColors[node.company.companyType])}\n            >\n              {node.company.companyType}\n            </Badge>\n            {node.company.currency !== \"USD\" && (\n              <Badge variant=\"outline\" className=\"text-xs shrink-0\">\n                {node.company.currency}\n              </Badge>\n            )}\n          </div>\n          {node.company.city && node.company.country && (\n            <p className=\"text-xs text-muted-foreground truncate\">\n              {node.company.city}, {node.company.country}\n            </p>\n          )}\n        </div>\n\n        <div className=\"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\n          <Button\n            size=\"icon\"\n            variant=\"ghost\"\n            onClick={() => onEdit(node.company)}\n            data-testid={`button-edit-${node.company.id}`}\n          >\n            <Edit className=\"h-4 w-4\" />\n          </Button>\n          <Button\n            size=\"icon\"\n            variant=\"ghost\"\n            onClick={() => onDelete(node.company)}\n            disabled={hasChildren}\n            data-testid={`button-delete-${node.company.id}`}\n          >\n            <Trash2 className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </div>\n\n      {hasChildren && isExpanded && (\n        <HierarchyTree \n          nodes={node.children} \n          onEdit={onEdit}\n          onDelete={onDelete}\n          depth={depth + 1} \n        />\n      )}\n    </div>\n  );\n}\n\nexport function CompanyManagement() {\n  const { toast } = useToast();\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingCompany, setEditingCompany] = useState<Company | null>(null);\n  const [deleteConfirm, setDeleteConfirm] = useState<Company | null>(null);\n\n  // Fetch all companies\n  const { data: companies = [], isLoading } = useQuery<Company[]>({\n    queryKey: [\"/api/companies\"],\n  });\n\n  // Fetch company hierarchy\n  const { data: hierarchy = [] } = useQuery<CompanyHierarchyNode[]>({\n    queryKey: [\"/api/companies/hierarchy\"],\n  });\n\n  const form = useForm<CompanyFormValues>({\n    resolver: zodResolver(companyFormSchema),\n    defaultValues: {\n      name: \"\",\n      code: \"\",\n      companyType: \"subsidiary\",\n      parentId: null,\n      currency: \"USD\",\n      taxId: \"\",\n      registrationNumber: \"\",\n      fiscalYearEnd: \"12-31\",\n      address: \"\",\n      city: \"\",\n      country: \"\",\n      phone: \"\",\n      email: \"\",\n      website: \"\",\n    },\n  });\n\n  // Create company mutation\n  const createMutation = useMutation({\n    mutationFn: async (data: CompanyFormValues) => {\n      const response = await apiRequest(\"POST\", \"/api/companies\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\"] });\n      toast({ title: \"Company created successfully\" });\n      setIsDialogOpen(false);\n      form.reset();\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  // Update company mutation\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: CompanyFormValues }) => {\n      const response = await apiRequest(\"PATCH\", `/api/companies/${id}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\"] });\n      toast({ title: \"Company updated successfully\" });\n      setIsDialogOpen(false);\n      setEditingCompany(null);\n      form.reset();\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  // Delete company mutation\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(\"DELETE\", `/api/companies/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\"] });\n      toast({ title: \"Company deleted successfully\" });\n      setDeleteConfirm(null);\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const handleEdit = (company: Company) => {\n    setEditingCompany(company);\n    form.reset({\n      name: company.name,\n      code: company.code,\n      companyType: company.companyType as \"holding\" | \"subsidiary\" | \"branch\",\n      parentId: company.parentId,\n      currency: company.currency,\n      taxId: company.taxId || \"\",\n      registrationNumber: \"\",\n      fiscalYearEnd: \"12-31\",\n      address: company.address || \"\",\n      city: company.city || \"\",\n      country: company.country || \"\",\n      phone: company.phone || \"\",\n      email: company.email || \"\",\n      website: company.website || \"\",\n    });\n    setIsDialogOpen(true);\n  };\n\n  const handleDelete = (company: Company) => {\n    setDeleteConfirm(company);\n  };\n\n  const handleSubmit = (values: CompanyFormValues) => {\n    if (editingCompany) {\n      updateMutation.mutate({ id: editingCompany.id, data: values });\n    } else {\n      createMutation.mutate(values);\n    }\n  };\n\n  const handleOpenDialog = () => {\n    setEditingCompany(null);\n    form.reset();\n    setIsDialogOpen(true);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\" data-testid=\"text-page-title\">\n            Company Management\n          </h1>\n          <p className=\"text-muted-foreground\">\n            Manage your organization's company structure and hierarchy\n          </p>\n        </div>\n        <Button onClick={handleOpenDialog} data-testid=\"button-add-company\">\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Add Company\n        </Button>\n      </div>\n\n      <Tabs defaultValue=\"hierarchy\" className=\"space-y-4\">\n        <TabsList data-testid=\"tabs-view-selector\">\n          <TabsTrigger value=\"hierarchy\" data-testid=\"tab-hierarchy\">\n            <GitBranch className=\"h-4 w-4 mr-2\" />\n            Hierarchy View\n          </TabsTrigger>\n          <TabsTrigger value=\"list\" data-testid=\"tab-list\">\n            <Building2 className=\"h-4 w-4 mr-2\" />\n            List View\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"hierarchy\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Globe className=\"h-5 w-5\" />\n                Organization Structure\n              </CardTitle>\n              <CardDescription>\n                Visual representation of your company hierarchy\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              {hierarchy.length > 0 ? (\n                <HierarchyTree \n                  nodes={hierarchy} \n                  onEdit={handleEdit}\n                  onDelete={handleDelete}\n                />\n              ) : isLoading ? (\n                <div className=\"flex items-center justify-center py-8 text-muted-foreground\">\n                  Loading...\n                </div>\n              ) : (\n                <div className=\"flex flex-col items-center justify-center py-8 text-muted-foreground\">\n                  <Building2 className=\"h-12 w-12 mb-2 opacity-50\" />\n                  <p>No companies found</p>\n                  <Button variant=\"outline\" className=\"mt-4\" onClick={handleOpenDialog}>\n                    <Plus className=\"h-4 w-4 mr-2\" />\n                    Create First Company\n                  </Button>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"list\">\n          <Card>\n            <CardHeader>\n              <CardTitle>All Companies</CardTitle>\n              <CardDescription>\n                Complete list of all companies in your organization\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Table data-testid=\"table-companies\">\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Name</TableHead>\n                    <TableHead>Code</TableHead>\n                    <TableHead>Type</TableHead>\n                    <TableHead>Currency</TableHead>\n                    <TableHead>Location</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {companies.map((company) => {\n                    const Icon = companyTypeIcons[company.companyType] || Building2;\n                    return (\n                      <TableRow key={company.id} data-testid={`row-company-${company.id}`}>\n                        <TableCell>\n                          <div className=\"flex items-center gap-2\">\n                            <Icon className=\"h-4 w-4 text-muted-foreground\" />\n                            <span className=\"font-medium\">{company.name}</span>\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <Badge variant=\"outline\">{company.code}</Badge>\n                        </TableCell>\n                        <TableCell>\n                          <Badge \n                            variant=\"secondary\"\n                            className={companyTypeColors[company.companyType]}\n                          >\n                            {company.companyType}\n                          </Badge>\n                        </TableCell>\n                        <TableCell>{company.currency}</TableCell>\n                        <TableCell>\n                          {company.city && company.country \n                            ? `${company.city}, ${company.country}`\n                            : \"-\"}\n                        </TableCell>\n                        <TableCell>\n                          <Badge variant={company.isActive ? \"default\" : \"secondary\"}>\n                            {company.isActive ? \"Active\" : \"Inactive\"}\n                          </Badge>\n                        </TableCell>\n                        <TableCell className=\"text-right\">\n                          <div className=\"flex items-center justify-end gap-1\">\n                            <Button\n                              size=\"icon\"\n                              variant=\"ghost\"\n                              onClick={() => handleEdit(company)}\n                              data-testid={`button-edit-list-${company.id}`}\n                            >\n                              <Edit className=\"h-4 w-4\" />\n                            </Button>\n                            <Button\n                              size=\"icon\"\n                              variant=\"ghost\"\n                              onClick={() => handleDelete(company)}\n                              data-testid={`button-delete-list-${company.id}`}\n                            >\n                              <Trash2 className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })}\n                  {companies.length === 0 && !isLoading && (\n                    <TableRow>\n                      <TableCell colSpan={7} className=\"text-center py-8 text-muted-foreground\">\n                        No companies found\n                      </TableCell>\n                    </TableRow>\n                  )}\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n\n      {/* Company Form Dialog */}\n      <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>\n              {editingCompany ? \"Edit Company\" : \"Add New Company\"}\n            </DialogTitle>\n            <DialogDescription>\n              {editingCompany \n                ? \"Update the company information below\"\n                : \"Fill in the details to create a new company\"}\n            </DialogDescription>\n          </DialogHeader>\n\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(handleSubmit)} className=\"space-y-6\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"name\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Company Name</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"Acme Corporation\" \n                          {...field} \n                          data-testid=\"input-company-name\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"code\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Company Code</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"ACME\" \n                          maxLength={10}\n                          {...field} \n                          data-testid=\"input-company-code\"\n                        />\n                      </FormControl>\n                      <FormDescription>Short identifier (max 10 chars)</FormDescription>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"companyType\"\n                  render={({ field }) => {\n                    // Watch company type to filter parent options\n                    const selectedType = field.value;\n                    return (\n                      <FormItem>\n                        <FormLabel>Company Type</FormLabel>\n                        <Select \n                          onValueChange={(value) => {\n                            field.onChange(value);\n                            // Reset parent when type changes\n                            if (value === COMPANY_TYPES.HOLDING) {\n                              form.setValue(\"parentId\", null);\n                            }\n                          }} \n                          value={field.value}\n                          data-testid=\"select-company-type\"\n                        >\n                          <FormControl>\n                            <SelectTrigger>\n                              <SelectValue placeholder=\"Select type\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            <SelectItem value={COMPANY_TYPES.HOLDING}>\n                              <div className=\"flex items-center gap-2\">\n                                <Globe className=\"h-4 w-4\" />\n                                Holding Company (Level 1)\n                              </div>\n                            </SelectItem>\n                            <SelectItem value={COMPANY_TYPES.SUBSIDIARY}>\n                              <div className=\"flex items-center gap-2\">\n                                <Building className=\"h-4 w-4\" />\n                                Subsidiary (Level 2)\n                              </div>\n                            </SelectItem>\n                            <SelectItem value={COMPANY_TYPES.BRANCH}>\n                              <div className=\"flex items-center gap-2\">\n                                <GitBranch className=\"h-4 w-4\" />\n                                Branch (Level 3)\n                              </div>\n                            </SelectItem>\n                          </SelectContent>\n                        </Select>\n                        <FormDescription>\n                          {selectedType && companyTypeDescriptions[selectedType]}\n                        </FormDescription>\n                        <FormMessage />\n                      </FormItem>\n                    );\n                  }}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"parentId\"\n                  render={({ field }) => {\n                    const selectedType = form.watch(\"companyType\");\n                    const isHolding = selectedType === COMPANY_TYPES.HOLDING;\n                    \n                    // Filter parent options based on company type\n                    // Subsidiary can only have Holding parent (level 1)\n                    // Branch can only have Subsidiary parent (level 2)\n                    const filteredParents = companies.filter(c => {\n                      if (c.id === editingCompany?.id) return false;\n                      if (selectedType === COMPANY_TYPES.SUBSIDIARY) {\n                        return c.companyType === COMPANY_TYPES.HOLDING;\n                      }\n                      if (selectedType === COMPANY_TYPES.BRANCH) {\n                        return c.companyType === COMPANY_TYPES.SUBSIDIARY;\n                      }\n                      return false;\n                    });\n\n                    return (\n                      <FormItem>\n                        <FormLabel>Parent Company</FormLabel>\n                        <Select \n                          onValueChange={(value) => field.onChange(value === \"__none__\" ? null : value)} \n                          value={field.value || \"__none__\"}\n                          disabled={isHolding}\n                          data-testid=\"select-parent-company\"\n                        >\n                          <FormControl>\n                            <SelectTrigger>\n                              <SelectValue placeholder={isHolding ? \"N/A for Holding\" : \"Select parent\"} />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {isHolding ? (\n                              <SelectItem value=\"__none__\">No Parent (Root)</SelectItem>\n                            ) : (\n                              <>\n                                {filteredParents.length === 0 ? (\n                                  <SelectItem value=\"__none__\" disabled>\n                                    {selectedType === COMPANY_TYPES.SUBSIDIARY \n                                      ? \"No Holdings available\" \n                                      : \"No Subsidiaries available\"}\n                                  </SelectItem>\n                                ) : (\n                                  filteredParents.map(company => (\n                                    <SelectItem key={company.id} value={company.id}>\n                                      <div className=\"flex items-center gap-2\">\n                                        {company.name}\n                                        <Badge variant=\"outline\" className=\"text-xs ml-2\">\n                                          {company.code}\n                                        </Badge>\n                                      </div>\n                                    </SelectItem>\n                                  ))\n                                )}\n                              </>\n                            )}\n                          </SelectContent>\n                        </Select>\n                        <FormDescription>\n                          {isHolding \n                            ? \"Holdings are root entities with no parent\" \n                            : selectedType === COMPANY_TYPES.SUBSIDIARY \n                              ? \"Select the Holding company that owns this subsidiary\"\n                              : \"Select the Subsidiary that owns this branch\"}\n                        </FormDescription>\n                        <FormMessage />\n                      </FormItem>\n                    );\n                  }}\n                />\n              </div>\n\n              {/* Hierarchy rules info */}\n              <Alert>\n                <AlertCircle className=\"h-4 w-4\" />\n                <AlertDescription>\n                  <strong>3-Level Hierarchy Rules:</strong> Holding (Level 1) can have Subsidiaries. \n                  Subsidiaries (Level 2) belong to a Holding and can have Branches. \n                  Branches (Level 3) belong to a Subsidiary and cannot have children.\n                </AlertDescription>\n              </Alert>\n\n              <div className=\"grid grid-cols-3 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"currency\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Currency</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"USD\" \n                          maxLength={3}\n                          {...field} \n                          data-testid=\"input-currency\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"taxId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Tax ID</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"XX-XXXXXXX\" \n                          {...field} \n                          data-testid=\"input-tax-id\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"registrationNumber\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Registration No.</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"Business reg number\" \n                          {...field} \n                          data-testid=\"input-registration\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <FormField\n                control={form.control}\n                name=\"address\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Address</FormLabel>\n                    <FormControl>\n                      <Textarea \n                        placeholder=\"Street address\" \n                        className=\"resize-none\"\n                        {...field} \n                        data-testid=\"input-address\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"city\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>City</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"City\" \n                          {...field} \n                          data-testid=\"input-city\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"country\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Country</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"Country\" \n                          {...field} \n                          data-testid=\"input-country\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <div className=\"grid grid-cols-3 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"phone\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Phone</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"+1 (555) 000-0000\" \n                          {...field} \n                          data-testid=\"input-phone\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Email</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"email\"\n                          placeholder=\"info@company.com\" \n                          {...field} \n                          data-testid=\"input-email\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"website\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Website</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"url\"\n                          placeholder=\"https://company.com\" \n                          {...field} \n                          data-testid=\"input-website\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <DialogFooter>\n                <Button \n                  type=\"button\" \n                  variant=\"outline\" \n                  onClick={() => setIsDialogOpen(false)}\n                  data-testid=\"button-cancel\"\n                >\n                  Cancel\n                </Button>\n                <Button \n                  type=\"submit\" \n                  disabled={createMutation.isPending || updateMutation.isPending}\n                  data-testid=\"button-submit\"\n                >\n                  {editingCompany ? \"Update Company\" : \"Create Company\"}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Delete Confirmation Dialog */}\n      <Dialog open={!!deleteConfirm} onOpenChange={() => setDeleteConfirm(null)}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Delete Company</DialogTitle>\n            <DialogDescription>\n              Are you sure you want to delete \"{deleteConfirm?.name}\"? \n              This action cannot be undone.\n            </DialogDescription>\n          </DialogHeader>\n          <DialogFooter>\n            <Button \n              variant=\"outline\" \n              onClick={() => setDeleteConfirm(null)}\n              data-testid=\"button-cancel-delete\"\n            >\n              Cancel\n            </Button>\n            <Button \n              variant=\"destructive\"\n              onClick={() => deleteConfirm && deleteMutation.mutate(deleteConfirm.id)}\n              disabled={deleteMutation.isPending}\n              data-testid=\"button-confirm-delete\"\n            >\n              Delete\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":34486,"size_tokens":null},"client/src/components/layout/AppSidebar.tsx":{"content":"import { useState } from \"react\";\nimport { Link, useLocation } from \"wouter\";\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarHeader,\n  SidebarFooter,\n} from \"@/components/ui/sidebar\";\nimport {\n  Collapsible,\n  CollapsibleContent,\n  CollapsibleTrigger,\n} from \"@/components/ui/collapsible\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport {\n  ShoppingCart,\n  Users,\n  Truck,\n  FileText,\n  Package,\n  MapPin,\n  BarChart3,\n  ArrowRightLeft,\n  ClipboardList,\n  BookOpen,\n  CreditCard,\n  Receipt,\n  PieChart,\n  UserCircle,\n  Clock,\n  Calendar,\n  Wallet,\n  Building2,\n  Store,\n  Settings,\n  ChevronDown,\n  LayoutDashboard,\n  Globe,\n  Shield,\n  GitMerge,\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface MenuItem {\n  title: string;\n  url: string;\n  icon: React.ElementType;\n}\n\ninterface MenuGroup {\n  label: string;\n  icon: React.ElementType;\n  items: MenuItem[];\n}\n\nconst menuGroups: MenuGroup[] = [\n  {\n    label: \"Sales\",\n    icon: ShoppingCart,\n    items: [\n      { title: \"Sales Orders\", url: \"/sales/orders\", icon: ShoppingCart },\n      { title: \"Customers\", url: \"/sales/customers\", icon: Users },\n      { title: \"Deliveries\", url: \"/sales/deliveries\", icon: Truck },\n      { title: \"Invoices\", url: \"/sales/invoices\", icon: FileText },\n    ],\n  },\n  {\n    label: \"Warehouse\",\n    icon: Package,\n    items: [\n      { title: \"Warehouses\", url: \"/warehouse/warehouses\", icon: Building2 },\n      { title: \"Products\", url: \"/warehouse/products\", icon: Package },\n      { title: \"Locations\", url: \"/warehouse/locations\", icon: MapPin },\n      { title: \"Stock Levels\", url: \"/warehouse/stock\", icon: BarChart3 },\n      { title: \"Movements\", url: \"/warehouse/movements\", icon: ArrowRightLeft },\n      { title: \"Purchase Orders\", url: \"/warehouse/purchase-orders\", icon: ClipboardList },\n      { title: \"Vendors\", url: \"/warehouse/vendors\", icon: Building2 },\n    ],\n  },\n  {\n    label: \"Financials\",\n    icon: CreditCard,\n    items: [\n      { title: \"Journal Entries\", url: \"/financials/journal\", icon: BookOpen },\n      { title: \"Chart of Accounts\", url: \"/financials/accounts\", icon: PieChart },\n      { title: \"Accounts Receivable\", url: \"/financials/receivables\", icon: Receipt },\n      { title: \"Accounts Payable\", url: \"/financials/payables\", icon: CreditCard },\n    ],\n  },\n  {\n    label: \"Human Resources\",\n    icon: UserCircle,\n    items: [\n      { title: \"Employees\", url: \"/hr/employees\", icon: UserCircle },\n      { title: \"Attendance\", url: \"/hr/attendance\", icon: Clock },\n      { title: \"Leave Requests\", url: \"/hr/leave\", icon: Calendar },\n      { title: \"Payroll\", url: \"/hr/payroll\", icon: Wallet },\n    ],\n  },\n  {\n    label: \"System\",\n    icon: Settings,\n    items: [\n      { title: \"Companies\", url: \"/system/companies\", icon: Globe },\n      { title: \"Users & Roles\", url: \"/system/users\", icon: Shield },\n      { title: \"Inter-Company\", url: \"/system/intercompany\", icon: GitMerge },\n      { title: \"Vendor Portal\", url: \"/system/vendors\", icon: Building2 },\n      { title: \"Customer Portal\", url: \"/system/customer-portal\", icon: Store },\n      { title: \"Settings\", url: \"/system/settings\", icon: Settings },\n    ],\n  },\n];\n\nexport function AppSidebar() {\n  const [location] = useLocation();\n  const [openGroups, setOpenGroups] = useState<string[]>([\"Sales\"]);\n\n  const toggleGroup = (label: string) => {\n    setOpenGroups((prev) =>\n      prev.includes(label) ? prev.filter((g) => g !== label) : [...prev, label]\n    );\n  };\n\n  return (\n    <Sidebar>\n      <SidebarHeader className=\"border-b border-sidebar-border p-4\">\n        <Link href=\"/\" className=\"flex items-center gap-3\">\n          <div className=\"flex items-center justify-center w-8 h-8 rounded-md bg-primary text-primary-foreground font-bold text-lg\">\n            U\n          </div>\n          <span className=\"font-semibold text-lg\" data-testid=\"text-app-name\">Unanza</span>\n        </Link>\n      </SidebarHeader>\n\n      <SidebarContent>\n        <SidebarGroup>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              <SidebarMenuItem>\n                <SidebarMenuButton asChild isActive={location === \"/\"}>\n                  <Link href=\"/\" data-testid=\"link-dashboard\">\n                    <LayoutDashboard className=\"h-4 w-4\" />\n                    <span>Dashboard</span>\n                  </Link>\n                </SidebarMenuButton>\n              </SidebarMenuItem>\n              <SidebarMenuItem>\n                <SidebarMenuButton asChild isActive={location === \"/reports\"}>\n                  <Link href=\"/reports\" data-testid=\"link-reports\">\n                    <PieChart className=\"h-4 w-4\" />\n                    <span>Reports</span>\n                  </Link>\n                </SidebarMenuButton>\n              </SidebarMenuItem>\n              <SidebarMenuItem>\n                <SidebarMenuButton asChild isActive={location === \"/reports/consolidation\"}>\n                  <Link href=\"/reports/consolidation\" data-testid=\"link-consolidation\">\n                    <Building2 className=\"h-4 w-4\" />\n                    <span>Consolidation</span>\n                  </Link>\n                </SidebarMenuButton>\n              </SidebarMenuItem>\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n\n        {menuGroups.map((group) => (\n          <Collapsible\n            key={group.label}\n            open={openGroups.includes(group.label)}\n            onOpenChange={() => toggleGroup(group.label)}\n          >\n            <SidebarGroup>\n              <CollapsibleTrigger asChild>\n                <SidebarGroupLabel className=\"cursor-pointer flex items-center justify-between gap-2 px-2 py-1.5 hover-elevate rounded-md\">\n                  <div className=\"flex items-center gap-2\">\n                    <group.icon className=\"h-4 w-4\" />\n                    <span>{group.label}</span>\n                  </div>\n                  <ChevronDown\n                    className={cn(\n                      \"h-4 w-4 transition-transform\",\n                      openGroups.includes(group.label) && \"rotate-180\"\n                    )}\n                  />\n                </SidebarGroupLabel>\n              </CollapsibleTrigger>\n              <CollapsibleContent>\n                <SidebarGroupContent>\n                  <SidebarMenu>\n                    {group.items.map((item) => (\n                      <SidebarMenuItem key={item.url}>\n                        <SidebarMenuButton\n                          asChild\n                          isActive={location === item.url}\n                        >\n                          <Link href={item.url} data-testid={`link-${item.title.toLowerCase().replace(/\\s+/g, \"-\")}`}>\n                            <item.icon className=\"h-4 w-4\" />\n                            <span>{item.title}</span>\n                          </Link>\n                        </SidebarMenuButton>\n                      </SidebarMenuItem>\n                    ))}\n                  </SidebarMenu>\n                </SidebarGroupContent>\n              </CollapsibleContent>\n            </SidebarGroup>\n          </Collapsible>\n        ))}\n      </SidebarContent>\n\n      <SidebarFooter className=\"border-t border-sidebar-border p-4\">\n        <div className=\"flex items-center gap-3\">\n          <Avatar className=\"h-8 w-8\">\n            <AvatarFallback className=\"bg-primary/10 text-primary text-sm\">\n              AD\n            </AvatarFallback>\n          </Avatar>\n          <div className=\"flex-1 min-w-0\">\n            <p className=\"text-sm font-medium truncate\" data-testid=\"text-user-name\">Admin User</p>\n            <p className=\"text-xs text-muted-foreground truncate\">admin@unanza.com</p>\n          </div>\n        </div>\n      </SidebarFooter>\n    </Sidebar>\n  );\n}\n","path":null,"size_bytes":7857,"size_tokens":null},"client/src/components/Reports.tsx":{"content":"import { useState } from \"react\";\nimport { PageHeader } from \"@/components/layout/PageHeader\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  ShoppingCart,\n  Package,\n  DollarSign,\n  Users,\n  Brain,\n  FileSpreadsheet,\n  Printer,\n} from \"lucide-react\";\nimport { SalesReports } from \"@/components/reports/SalesReports\";\nimport { InventoryReports } from \"@/components/reports/InventoryReports\";\nimport { FinanceReports } from \"@/components/reports/FinanceReports\";\nimport { HRReports } from \"@/components/reports/HRReports\";\nimport { AdvancedReports } from \"@/components/reports/AdvancedReports\";\nimport { cn } from \"@/lib/utils\";\n\nexport function Reports() {\n  const [activeModule, setActiveModule] = useState(\"sales\");\n\n  const modules = [\n    { id: \"sales\", label: \"Sales\", icon: ShoppingCart, color: \"text-blue-600\", description: \"Performance & Pipeline\" },\n    { id: \"inventory\", label: \"Inventory\", icon: Package, color: \"text-green-600\", description: \"Stock & Suppliers\" },\n    { id: \"finance\", label: \"Finance\", icon: DollarSign, color: \"text-purple-600\", description: \"P&L & Balance Sheet\" },\n    { id: \"hr\", label: \"HR\", icon: Users, color: \"text-amber-600\", description: \"Attendance & Payroll\" },\n    { id: \"advanced\", label: \"Advanced/AI\", icon: Brain, color: \"text-pink-600\", description: \"AI & Predictions\" },\n  ];\n\n  const handleExportAll = () => {\n    console.log(\"Exporting all reports...\");\n  };\n\n  const handlePrint = () => {\n    window.print();\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <PageHeader\n        title=\"Reports & Analytics\"\n        description=\"Comprehensive reporting across all ERP modules with AI-powered insights\"\n        actions={\n          <>\n            <Button variant=\"outline\" onClick={handleExportAll} data-testid=\"button-export-all\">\n              <FileSpreadsheet className=\"h-4 w-4 mr-2\" />\n              Export All\n            </Button>\n            <Button variant=\"outline\" onClick={handlePrint} data-testid=\"button-print\">\n              <Printer className=\"h-4 w-4 mr-2\" />\n              Print\n            </Button>\n          </>\n        }\n      />\n\n      <div className=\"grid md:grid-cols-5 gap-4 mb-6\">\n        {modules.map((module) => {\n          const Icon = module.icon;\n          const isActive = activeModule === module.id;\n          return (\n            <Card\n              key={module.id}\n              className={cn(\n                \"cursor-pointer transition-all hover-elevate\",\n                isActive && \"ring-2 ring-primary\"\n              )}\n              onClick={() => setActiveModule(module.id)}\n              data-testid={`card-module-${module.id}`}\n            >\n              <CardContent className=\"flex items-center gap-3 p-4\">\n                <div className={cn(\"p-2 rounded-md bg-muted\", module.color)}>\n                  <Icon className=\"h-5 w-5\" />\n                </div>\n                <div>\n                  <p className=\"font-medium\">{module.label}</p>\n                  <p className=\"text-xs text-muted-foreground\">{module.description}</p>\n                </div>\n              </CardContent>\n            </Card>\n          );\n        })}\n      </div>\n\n      <div className=\"min-h-[600px]\">\n        {activeModule === \"sales\" && <SalesReports />}\n        {activeModule === \"inventory\" && <InventoryReports />}\n        {activeModule === \"finance\" && <FinanceReports />}\n        {activeModule === \"hr\" && <HRReports />}\n        {activeModule === \"advanced\" && <AdvancedReports />}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":3569,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1534,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/warehouse/LocationList.tsx":{"content":"import { useState } from \"react\";\nimport { DataTable, type Column } from \"@/components/layout/DataTable\";\nimport { PageHeader } from \"@/components/layout/PageHeader\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Plus, Download, Edit, Trash2, ArrowRightLeft } from \"lucide-react\";\nimport { mockLocations, mockProducts } from \"@/lib/mockData\";\n\ntype Location = typeof mockLocations[0];\n\nexport function LocationList() {\n  const [locations, setLocations] = useState(mockLocations);\n  const [isFormOpen, setIsFormOpen] = useState(false);\n  const [isTransferOpen, setIsTransferOpen] = useState(false);\n  const [editingLocation, setEditingLocation] = useState<Location | null>(null);\n\n  const [formData, setFormData] = useState({\n    code: \"\",\n    name: \"\",\n    zone: \"\",\n    type: \"bin\",\n    capacity: 100,\n  });\n\n  const [transferData, setTransferData] = useState({\n    productId: \"\",\n    fromLocation: \"\",\n    toLocation: \"\",\n    quantity: 1,\n  });\n\n  const handleOpenForm = (location?: Location) => {\n    if (location) {\n      setEditingLocation(location);\n      setFormData({\n        code: location.code,\n        name: location.name,\n        zone: location.zone,\n        type: location.type,\n        capacity: location.capacity,\n      });\n    } else {\n      setEditingLocation(null);\n      setFormData({\n        code: \"\",\n        name: \"\",\n        zone: \"\",\n        type: \"bin\",\n        capacity: 100,\n      });\n    }\n    setIsFormOpen(true);\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (editingLocation) {\n      setLocations(locations.map(l => \n        l.id === editingLocation.id ? { ...l, ...formData } : l\n      ));\n      console.log(\"Updated location:\", editingLocation.id);\n    } else {\n      // todo: remove mock functionality\n      const newLocation: Location = {\n        id: `LOC-${String(locations.length + 1).padStart(3, \"0\")}`,\n        used: 0,\n        ...formData,\n      };\n      setLocations([...locations, newLocation]);\n      console.log(\"Created location:\", newLocation);\n    }\n    setIsFormOpen(false);\n  };\n\n  const handleTransfer = (e: React.FormEvent) => {\n    e.preventDefault();\n    console.log(\"Transfer:\", transferData);\n    setIsTransferOpen(false);\n    setTransferData({ productId: \"\", fromLocation: \"\", toLocation: \"\", quantity: 1 });\n  };\n\n  const handleDeleteLocation = (locationId: string) => {\n    setLocations(locations.filter(l => l.id !== locationId));\n    console.log(\"Deleted location:\", locationId);\n  };\n\n  const columns: Column<Location>[] = [\n    { key: \"code\", header: \"Code\", sortable: true },\n    { key: \"name\", header: \"Name\", sortable: true },\n    { key: \"zone\", header: \"Zone\", sortable: true },\n    { key: \"type\", header: \"Type\", sortable: true },\n    { \n      key: \"capacity\", \n      header: \"Capacity\", \n      sortable: true,\n      className: \"text-right\"\n    },\n    { \n      key: \"used\", \n      header: \"Utilization\",\n      render: (item) => (\n        <div className=\"flex items-center gap-2\">\n          <Progress value={(item.used / item.capacity) * 100} className=\"w-20 h-2\" />\n          <span className=\"text-sm text-muted-foreground\">{Math.round((item.used / item.capacity) * 100)}%</span>\n        </div>\n      )\n    },\n    {\n      key: \"actions\",\n      header: \"\",\n      className: \"text-right\",\n      render: (item) => (\n        <div className=\"flex justify-end gap-1\" onClick={(e) => e.stopPropagation()}>\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => handleOpenForm(item)} data-testid={`button-edit-${item.id}`}>\n            <Edit className=\"h-4 w-4\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => handleDeleteLocation(item.id)} data-testid={`button-delete-${item.id}`}>\n            <Trash2 className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      ),\n    },\n  ];\n\n  return (\n    <div>\n      <PageHeader\n        title=\"Warehouse Locations\"\n        description=\"Manage bins, racks, and storage areas\"\n        actions={\n          <>\n            <Button variant=\"outline\" onClick={() => setIsTransferOpen(true)} data-testid=\"button-transfer\">\n              <ArrowRightLeft className=\"h-4 w-4 mr-2\" />\n              Transfer Stock\n            </Button>\n            <Button variant=\"outline\" data-testid=\"button-export\">\n              <Download className=\"h-4 w-4 mr-2\" />\n              Export\n            </Button>\n            <Button onClick={() => handleOpenForm()} data-testid=\"button-new-location\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Location\n            </Button>\n          </>\n        }\n      />\n\n      <DataTable\n        data={locations}\n        columns={columns}\n        searchKey=\"name\"\n        searchPlaceholder=\"Search locations...\"\n      />\n\n      <Dialog open={isFormOpen} onOpenChange={setIsFormOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>{editingLocation ? \"Edit Location\" : \"New Location\"}</DialogTitle>\n          </DialogHeader>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"code\">Location Code *</Label>\n                <Input\n                  id=\"code\"\n                  value={formData.code}\n                  onChange={(e) => setFormData({ ...formData, code: e.target.value })}\n                  placeholder=\"e.g., A-01-01\"\n                  required\n                  data-testid=\"input-code\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"zone\">Zone</Label>\n                <Input\n                  id=\"zone\"\n                  value={formData.zone}\n                  onChange={(e) => setFormData({ ...formData, zone: e.target.value })}\n                  placeholder=\"e.g., Zone A\"\n                  data-testid=\"input-zone\"\n                />\n              </div>\n              <div className=\"col-span-2 space-y-2\">\n                <Label htmlFor=\"name\">Name *</Label>\n                <Input\n                  id=\"name\"\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  required\n                  data-testid=\"input-name\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"type\">Type</Label>\n                <Select\n                  value={formData.type}\n                  onValueChange={(value) => setFormData({ ...formData, type: value })}\n                >\n                  <SelectTrigger data-testid=\"select-type\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"bin\">Bin</SelectItem>\n                    <SelectItem value=\"rack\">Rack</SelectItem>\n                    <SelectItem value=\"shelf\">Shelf</SelectItem>\n                    <SelectItem value=\"bulk\">Bulk Storage</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"capacity\">Capacity</Label>\n                <Input\n                  id=\"capacity\"\n                  type=\"number\"\n                  min=\"1\"\n                  value={formData.capacity}\n                  onChange={(e) => setFormData({ ...formData, capacity: parseInt(e.target.value) || 1 })}\n                  data-testid=\"input-capacity\"\n                />\n              </div>\n            </div>\n            <div className=\"flex justify-end gap-2 pt-4\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => setIsFormOpen(false)} data-testid=\"button-cancel\">\n                Cancel\n              </Button>\n              <Button type=\"submit\" data-testid=\"button-save\">\n                {editingLocation ? \"Update\" : \"Create\"}\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isTransferOpen} onOpenChange={setIsTransferOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>Transfer Stock</DialogTitle>\n          </DialogHeader>\n          <form onSubmit={handleTransfer} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"product\">Product *</Label>\n              <Select\n                value={transferData.productId}\n                onValueChange={(value) => setTransferData({ ...transferData, productId: value })}\n              >\n                <SelectTrigger data-testid=\"select-transfer-product\">\n                  <SelectValue placeholder=\"Select product\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {mockProducts.map((product) => (\n                    <SelectItem key={product.id} value={product.id}>\n                      {product.name} ({product.stock} available)\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"from\">From Location *</Label>\n                <Select\n                  value={transferData.fromLocation}\n                  onValueChange={(value) => setTransferData({ ...transferData, fromLocation: value })}\n                >\n                  <SelectTrigger data-testid=\"select-from-location\">\n                    <SelectValue placeholder=\"Select\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {locations.map((loc) => (\n                      <SelectItem key={loc.id} value={loc.code}>\n                        {loc.code}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"to\">To Location *</Label>\n                <Select\n                  value={transferData.toLocation}\n                  onValueChange={(value) => setTransferData({ ...transferData, toLocation: value })}\n                >\n                  <SelectTrigger data-testid=\"select-to-location\">\n                    <SelectValue placeholder=\"Select\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {locations.map((loc) => (\n                      <SelectItem key={loc.id} value={loc.code}>\n                        {loc.code}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"quantity\">Quantity *</Label>\n              <Input\n                id=\"quantity\"\n                type=\"number\"\n                min=\"1\"\n                value={transferData.quantity}\n                onChange={(e) => setTransferData({ ...transferData, quantity: parseInt(e.target.value) || 1 })}\n                required\n                data-testid=\"input-transfer-quantity\"\n              />\n            </div>\n            <div className=\"flex justify-end gap-2 pt-4\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => setIsTransferOpen(false)} data-testid=\"button-cancel-transfer\">\n                Cancel\n              </Button>\n              <Button \n                type=\"submit\" \n                disabled={!transferData.productId || !transferData.fromLocation || !transferData.toLocation}\n                data-testid=\"button-confirm-transfer\"\n              >\n                Transfer\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":12200,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"client/src/components/examples/MovementList.tsx":{"content":"import { MovementList } from \"../warehouse/MovementList\";\n\nexport default function MovementListExample() {\n  return <MovementList />;\n}\n","path":null,"size_bytes":136,"size_tokens":null},"client/src/components/examples/StatusBadge.tsx":{"content":"import { StatusBadge } from \"../layout/StatusBadge\";\n\nexport default function StatusBadgeExample() {\n  return (\n    <div className=\"flex flex-wrap gap-2\">\n      <StatusBadge status=\"draft\" />\n      <StatusBadge status=\"confirmed\" />\n      <StatusBadge status=\"delivered\" />\n      <StatusBadge status=\"invoiced\" />\n      <StatusBadge status=\"paid\" />\n      <StatusBadge status=\"unpaid\" />\n      <StatusBadge status=\"partial\" />\n      <StatusBadge status=\"active\" />\n      <StatusBadge status=\"pending\" />\n    </div>\n  );\n}\n","path":null,"size_bytes":522,"size_tokens":null},"client/src/components/sales/SalesOrderList.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { DataTable, type Column } from \"@/components/layout/DataTable\";\nimport { StatusBadge } from \"@/components/layout/StatusBadge\";\nimport { PageHeader } from \"@/components/layout/PageHeader\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Plus, Download, Eye, Edit, Trash2 } from \"lucide-react\";\nimport { useCompany } from \"@/contexts/CompanyContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { SalesOrder, Customer, Product, InsertSalesOrder, SalesOrderLine } from \"@shared/schema\";\n\ninterface SalesOrderDisplay extends SalesOrder {\n  customerName: string;\n  itemCount: number;\n}\n\nexport function SalesOrderList() {\n  const { activeCompany } = useCompany();\n  const { toast } = useToast();\n  const [selectedOrder, setSelectedOrder] = useState<SalesOrderDisplay | null>(null);\n  const [isFormOpen, setIsFormOpen] = useState(false);\n  const [isDetailOpen, setIsDetailOpen] = useState(false);\n  const [editingOrder, setEditingOrder] = useState<SalesOrderDisplay | null>(null);\n\n  const { data: orders = [], isLoading: ordersLoading } = useQuery<SalesOrder[]>({\n    queryKey: [\"/api/companies\", activeCompany?.id, \"sales-orders\"],\n    enabled: !!activeCompany?.id,\n  });\n\n  const { data: customers = [] } = useQuery<Customer[]>({\n    queryKey: [\"/api/companies\", activeCompany?.id, \"customers\"],\n    enabled: !!activeCompany?.id,\n  });\n\n  const { data: products = [] } = useQuery<Product[]>({\n    queryKey: [\"/api/companies\", activeCompany?.id, \"products\"],\n    enabled: !!activeCompany?.id,\n  });\n\n  const ordersWithCustomers: SalesOrderDisplay[] = orders.map(order => ({\n    ...order,\n    customerName: customers.find(c => c.id === order.customerId)?.name || \"Unknown Customer\",\n    itemCount: 0,\n  }));\n\n  const createMutation = useMutation({\n    mutationFn: async (data: Partial<InsertSalesOrder>) => {\n      const orderNumber = `SO-${String(Date.now()).slice(-6)}`;\n      return apiRequest(\"POST\", `/api/companies/${activeCompany?.id}/sales-orders`, {\n        ...data,\n        orderNumber,\n        companyId: activeCompany?.id,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"sales-orders\"] });\n      toast({ title: \"Sales order created successfully\" });\n      setIsFormOpen(false);\n    },\n    onError: () => {\n      toast({ title: \"Failed to create sales order\", variant: \"destructive\" });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<SalesOrder> }) => {\n      return apiRequest(\"PATCH\", `/api/companies/${activeCompany?.id}/sales-orders/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"sales-orders\"] });\n      toast({ title: \"Sales order updated successfully\" });\n      setIsFormOpen(false);\n      setIsDetailOpen(false);\n    },\n    onError: () => {\n      toast({ title: \"Failed to update sales order\", variant: \"destructive\" });\n    },\n  });\n\n  // Workflow mutation: Confirm order (reserves stock)\n  const confirmOrderMutation = useMutation({\n    mutationFn: async (orderId: string) => {\n      const response = await apiRequest(\"POST\", `/api/companies/${activeCompany?.id}/sales-orders/${orderId}/confirm`);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"sales-orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"stock-levels\"] });\n      toast({ \n        title: \"Order Confirmed\", \n        description: `Stock reserved for ${data.reservations?.length || 0} line items` \n      });\n      setIsDetailOpen(false);\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Failed to confirm order\", \n        description: error.message || \"Check stock availability\",\n        variant: \"destructive\" \n      });\n    },\n  });\n\n  // Workflow mutation: Deliver order (reduces stock, creates delivery, COGS journal entry)\n  const deliverOrderMutation = useMutation({\n    mutationFn: async (orderId: string) => {\n      const response = await apiRequest(\"POST\", `/api/companies/${activeCompany?.id}/sales-orders/${orderId}/deliver`);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"sales-orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"stock-levels\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"stock-movements\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"deliveries\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"journal-entries\"] });\n      toast({ \n        title: \"Delivery Created\", \n        description: `Delivery ${data.delivery?.deliveryNumber || ''} created with inventory and COGS recorded` \n      });\n      setIsDetailOpen(false);\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Failed to create delivery\", \n        description: error.message,\n        variant: \"destructive\" \n      });\n    },\n  });\n\n  // Workflow mutation: Invoice order (creates invoice, AR ledger, revenue journal entry)\n  const invoiceOrderMutation = useMutation({\n    mutationFn: async (orderId: string) => {\n      const response = await apiRequest(\"POST\", `/api/companies/${activeCompany?.id}/sales-orders/${orderId}/invoice`);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"sales-orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"invoices\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"ar-ledger\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"journal-entries\"] });\n      toast({ \n        title: \"Invoice Created\", \n        description: `Invoice ${data.invoice?.invoiceNumber || ''} created and AR recorded` \n      });\n      setIsDetailOpen(false);\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Failed to create invoice\", \n        description: error.message,\n        variant: \"destructive\" \n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest(\"DELETE\", `/api/companies/${activeCompany?.id}/sales-orders/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"sales-orders\"] });\n      toast({ title: \"Sales order deleted successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to delete sales order\", variant: \"destructive\" });\n    },\n  });\n\n  const handleCreateOrder = (orderData: Partial<InsertSalesOrder>) => {\n    createMutation.mutate(orderData);\n  };\n\n  const handleViewOrder = (order: SalesOrderDisplay) => {\n    setSelectedOrder(order);\n    setIsDetailOpen(true);\n  };\n\n  const handleEditOrder = (order: SalesOrderDisplay) => {\n    setEditingOrder(order);\n    setIsFormOpen(true);\n  };\n\n  const handleDeleteOrder = (orderId: string) => {\n    deleteMutation.mutate(orderId);\n  };\n\n  const handleStatusChange = (orderId: string, newStatus: string) => {\n    // Use workflow endpoints for status transitions\n    switch (newStatus) {\n      case \"confirmed\":\n        confirmOrderMutation.mutate(orderId);\n        break;\n      case \"delivered\":\n        deliverOrderMutation.mutate(orderId);\n        break;\n      case \"invoiced\":\n        invoiceOrderMutation.mutate(orderId);\n        break;\n      default:\n        // Fallback to simple update for non-workflow status changes\n        updateMutation.mutate({ id: orderId, data: { status: newStatus } });\n    }\n  };\n\n  const isWorkflowPending = confirmOrderMutation.isPending || \n    deliverOrderMutation.isPending || \n    invoiceOrderMutation.isPending;\n\n  const handleExport = () => {\n    const csv = [\n      [\"Order Number\", \"Customer\", \"Date\", \"Status\", \"Total\"].join(\",\"),\n      ...ordersWithCustomers.map(o => [\n        o.orderNumber,\n        o.customerName,\n        new Date(o.orderDate).toLocaleDateString(),\n        o.status,\n        o.total\n      ].join(\",\"))\n    ].join(\"\\n\");\n    \n    const blob = new Blob([csv], { type: \"text/csv\" });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = \"sales_orders.csv\";\n    a.click();\n  };\n\n  const columns: Column<SalesOrderDisplay>[] = [\n    { key: \"orderNumber\", header: \"Order #\", sortable: true },\n    { key: \"customerName\", header: \"Customer\", sortable: true },\n    { \n      key: \"orderDate\", \n      header: \"Date\", \n      sortable: true,\n      render: (item) => new Date(item.orderDate).toLocaleDateString()\n    },\n    { \n      key: \"status\", \n      header: \"Status\",\n      render: (item) => <StatusBadge status={item.status as \"draft\" | \"confirmed\" | \"delivered\" | \"invoiced\"} />\n    },\n    { \n      key: \"total\", \n      header: \"Total\", \n      sortable: true,\n      className: \"text-right\",\n      render: (item) => `$${parseFloat(item.total || \"0\").toLocaleString()}`\n    },\n    {\n      key: \"actions\",\n      header: \"\",\n      className: \"text-right\",\n      render: (item) => (\n        <div className=\"flex justify-end gap-1\" onClick={(e) => e.stopPropagation()}>\n          <Button \n            variant=\"ghost\" \n            size=\"icon\" \n            onClick={() => handleViewOrder(item)}\n            data-testid={`button-view-${item.id}`}\n          >\n            <Eye className=\"h-4 w-4\" />\n          </Button>\n          <Button \n            variant=\"ghost\" \n            size=\"icon\" \n            onClick={() => handleEditOrder(item)}\n            data-testid={`button-edit-${item.id}`}\n          >\n            <Edit className=\"h-4 w-4\" />\n          </Button>\n          <Button \n            variant=\"ghost\" \n            size=\"icon\" \n            onClick={() => handleDeleteOrder(item.id)}\n            disabled={deleteMutation.isPending}\n            data-testid={`button-delete-${item.id}`}\n          >\n            <Trash2 className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      ),\n    },\n  ];\n\n  if (ordersLoading) {\n    return (\n      <div className=\"space-y-4\">\n        <PageHeader title=\"Sales Orders\" description=\"Manage and track all sales orders\" />\n        <div className=\"space-y-2\">\n          {[1, 2, 3].map((i) => (\n            <Skeleton key={i} className=\"h-12 w-full\" />\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <PageHeader\n        title=\"Sales Orders\"\n        description=\"Manage and track all sales orders\"\n        actions={\n          <>\n            <Button variant=\"outline\" onClick={handleExport} data-testid=\"button-export\">\n              <Download className=\"h-4 w-4 mr-2\" />\n              Export\n            </Button>\n            <Button onClick={() => { setEditingOrder(null); setIsFormOpen(true); }} data-testid=\"button-new-order\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Order\n            </Button>\n          </>\n        }\n      />\n\n      <DataTable\n        data={ordersWithCustomers}\n        columns={columns}\n        searchKey=\"customerName\"\n        searchPlaceholder=\"Search by customer...\"\n        onRowClick={handleViewOrder}\n      />\n\n      <Dialog open={isFormOpen} onOpenChange={setIsFormOpen}>\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>{editingOrder ? \"Edit Sales Order\" : \"New Sales Order\"}</DialogTitle>\n            <DialogDescription>\n              {editingOrder ? \"Update the sales order details below.\" : \"Create a new sales order by filling out the form below.\"}\n            </DialogDescription>\n          </DialogHeader>\n          <SalesOrderFormInline\n            order={editingOrder}\n            customers={customers}\n            products={products}\n            onSubmit={handleCreateOrder}\n            onCancel={() => setIsFormOpen(false)}\n            isPending={createMutation.isPending}\n          />\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isDetailOpen} onOpenChange={setIsDetailOpen}>\n        <DialogContent className=\"max-w-3xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Sales Order Details</DialogTitle>\n            <DialogDescription>\n              View and manage order {selectedOrder?.orderNumber}\n            </DialogDescription>\n          </DialogHeader>\n          {selectedOrder && activeCompany && (\n            <SalesOrderDetailInline\n              order={selectedOrder}\n              companyId={activeCompany.id}\n              products={products}\n              onStatusChange={handleStatusChange}\n              onClose={() => setIsDetailOpen(false)}\n              isPending={isWorkflowPending}\n            />\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n\ninterface SalesOrderFormInlineProps {\n  order?: SalesOrderDisplay | null;\n  customers: Customer[];\n  products: Product[];\n  onSubmit: (order: Partial<InsertSalesOrder>) => void;\n  onCancel: () => void;\n  isPending: boolean;\n}\n\ninterface OrderLine {\n  id: string;\n  productId: string;\n  productName: string;\n  quantity: number;\n  price: number;\n  tax: number;\n  total: number;\n}\n\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\n\nfunction SalesOrderFormInline({ order, customers, products, onSubmit, onCancel, isPending }: SalesOrderFormInlineProps) {\n  const [customerId, setCustomerId] = useState(order?.customerId || \"\");\n  const [lines, setLines] = useState<OrderLine[]>([\n    { id: \"1\", productId: \"\", productName: \"\", quantity: 1, price: 0, tax: 0, total: 0 },\n  ]);\n\n  const handleAddLine = () => {\n    const newLine: OrderLine = {\n      id: String(Date.now()),\n      productId: \"\",\n      productName: \"\",\n      quantity: 1,\n      price: 0,\n      tax: 0,\n      total: 0,\n    };\n    setLines([...lines, newLine]);\n  };\n\n  const handleRemoveLine = (id: string) => {\n    if (lines.length > 1) {\n      setLines(lines.filter((l) => l.id !== id));\n    }\n  };\n\n  const handleLineChange = (id: string, field: keyof OrderLine, value: string | number) => {\n    setLines(lines.map((line) => {\n      if (line.id !== id) return line;\n\n      const updated = { ...line, [field]: value };\n\n      if (field === \"productId\") {\n        const product = products.find((p) => p.id === value);\n        if (product) {\n          updated.productName = product.name;\n          updated.price = parseFloat(product.price || \"0\");\n        }\n      }\n\n      if (field === \"quantity\" || field === \"price\" || field === \"tax\" || field === \"productId\") {\n        const subtotal = updated.quantity * updated.price;\n        updated.total = subtotal + (subtotal * updated.tax / 100);\n      }\n\n      return updated;\n    }));\n  };\n\n  const subtotal = lines.reduce((sum, line) => sum + (line.quantity * line.price), 0);\n  const totalTax = lines.reduce((sum, line) => sum + (line.quantity * line.price * line.tax / 100), 0);\n  const grandTotal = subtotal + totalTax;\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!customerId) return;\n    onSubmit({\n      customerId,\n      subtotal: String(subtotal),\n      taxAmount: String(totalTax),\n      total: String(grandTotal),\n    });\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-6\">\n      <div className=\"grid gap-4\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"customer\">Customer *</Label>\n          <Select value={customerId} onValueChange={setCustomerId} required>\n            <SelectTrigger data-testid=\"select-customer\">\n              <SelectValue placeholder=\"Select customer\" />\n            </SelectTrigger>\n            <SelectContent>\n              {customers.map((customer) => (\n                <SelectItem key={customer.id} value={customer.id}>\n                  {customer.name}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      <div className=\"space-y-4\">\n        <div className=\"flex flex-wrap items-center justify-between gap-2\">\n          <Label>Order Lines</Label>\n          <Button type=\"button\" variant=\"outline\" size=\"sm\" onClick={handleAddLine} data-testid=\"button-add-line\">\n            <Plus className=\"h-4 w-4 mr-1\" />\n            Add Line\n          </Button>\n        </div>\n\n        <div className=\"border rounded-md divide-y\">\n          <div className=\"grid grid-cols-12 gap-2 p-3 bg-muted/50 text-sm font-medium\">\n            <div className=\"col-span-4\">Product</div>\n            <div className=\"col-span-2 text-center\">Qty</div>\n            <div className=\"col-span-2 text-right\">Price</div>\n            <div className=\"col-span-1 text-center\">Tax %</div>\n            <div className=\"col-span-2 text-right\">Total</div>\n            <div className=\"col-span-1\"></div>\n          </div>\n\n          {lines.map((line, index) => (\n            <div key={line.id} className=\"grid grid-cols-12 gap-2 p-3 items-center\">\n              <div className=\"col-span-4\">\n                <Select\n                  value={line.productId}\n                  onValueChange={(value) => handleLineChange(line.id, \"productId\", value)}\n                >\n                  <SelectTrigger data-testid={`select-product-${index}`}>\n                    <SelectValue placeholder=\"Select product\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {products.map((product) => (\n                      <SelectItem key={product.id} value={product.id}>\n                        {product.name} (${parseFloat(product.price || \"0\").toFixed(2)})\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"col-span-2\">\n                <Input\n                  type=\"number\"\n                  min=\"1\"\n                  value={line.quantity}\n                  onChange={(e) => handleLineChange(line.id, \"quantity\", parseInt(e.target.value) || 1)}\n                  className=\"text-center\"\n                  data-testid={`input-quantity-${index}`}\n                />\n              </div>\n              <div className=\"col-span-2\">\n                <Input\n                  type=\"number\"\n                  step=\"0.01\"\n                  min=\"0\"\n                  value={line.price}\n                  onChange={(e) => handleLineChange(line.id, \"price\", parseFloat(e.target.value) || 0)}\n                  className=\"text-right\"\n                  data-testid={`input-price-${index}`}\n                />\n              </div>\n              <div className=\"col-span-1\">\n                <Input\n                  type=\"number\"\n                  step=\"0.1\"\n                  min=\"0\"\n                  max=\"100\"\n                  value={line.tax}\n                  onChange={(e) => handleLineChange(line.id, \"tax\", parseFloat(e.target.value) || 0)}\n                  className=\"text-center\"\n                  data-testid={`input-tax-${index}`}\n                />\n              </div>\n              <div className=\"col-span-2 text-right font-medium\">\n                ${line.total.toFixed(2)}\n              </div>\n              <div className=\"col-span-1 text-right\">\n                <Button\n                  type=\"button\"\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={() => handleRemoveLine(line.id)}\n                  disabled={lines.length <= 1}\n                  data-testid={`button-remove-line-${index}`}\n                >\n                  <Trash2 className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      <div className=\"border rounded-md p-4 bg-muted/30\">\n        <div className=\"space-y-2 text-sm\">\n          <div className=\"flex justify-between\">\n            <span className=\"text-muted-foreground\">Subtotal</span>\n            <span>${subtotal.toFixed(2)}</span>\n          </div>\n          <div className=\"flex justify-between\">\n            <span className=\"text-muted-foreground\">Tax</span>\n            <span>${totalTax.toFixed(2)}</span>\n          </div>\n          <div className=\"flex justify-between font-semibold text-base pt-2 border-t\">\n            <span>Grand Total</span>\n            <span data-testid=\"text-grand-total\">${grandTotal.toFixed(2)}</span>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"flex justify-end gap-3\">\n        <Button type=\"button\" variant=\"outline\" onClick={onCancel} data-testid=\"button-cancel\">\n          Cancel\n        </Button>\n        <Button type=\"submit\" disabled={!customerId || isPending} data-testid=\"button-save-order\">\n          {isPending ? \"Saving...\" : (order ? \"Update Order\" : \"Create Order\")}\n        </Button>\n      </div>\n    </form>\n  );\n}\n\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { WorkflowStepper } from \"@/components/layout/WorkflowStepper\";\nimport { FileText, Truck, CheckCircle } from \"lucide-react\";\n\ninterface SalesOrderDetailInlineProps {\n  order: SalesOrderDisplay;\n  companyId: string;\n  products: Product[];\n  onStatusChange: (orderId: string, newStatus: string) => void;\n  onClose: () => void;\n  isPending: boolean;\n}\n\nconst orderSteps = [\n  { id: \"draft\", label: \"Draft\" },\n  { id: \"confirmed\", label: \"Confirmed\" },\n  { id: \"delivered\", label: \"Delivered\" },\n  { id: \"invoiced\", label: \"Invoiced\" },\n];\n\nfunction SalesOrderDetailInline({ order, companyId, products, onStatusChange, onClose, isPending }: SalesOrderDetailInlineProps) {\n  const { data: orderLines = [], isLoading: linesLoading } = useQuery<SalesOrderLine[]>({\n    queryKey: [\"/api/companies\", companyId, \"sales-orders\", order.id, \"lines\"],\n    enabled: !!companyId && !!order.id,\n  });\n\n  const getProductName = (productId: string) => {\n    return products.find(p => p.id === productId)?.name || \"Unknown Product\";\n  };\n\n  const getNextStatus = (currentStatus: string): string | null => {\n    const statusOrder = [\"draft\", \"confirmed\", \"delivered\", \"invoiced\"];\n    const currentIndex = statusOrder.indexOf(currentStatus);\n    if (currentIndex < statusOrder.length - 1) {\n      return statusOrder[currentIndex + 1];\n    }\n    return null;\n  };\n\n  const getActionButton = () => {\n    switch (order.status) {\n      case \"draft\":\n        return (\n          <Button \n            onClick={() => onStatusChange(order.id, \"confirmed\")} \n            disabled={isPending}\n            data-testid=\"button-confirm-order\"\n          >\n            <CheckCircle className=\"h-4 w-4 mr-2\" />\n            {isPending ? \"Updating...\" : \"Confirm Order\"}\n          </Button>\n        );\n      case \"confirmed\":\n        return (\n          <Button \n            onClick={() => onStatusChange(order.id, \"delivered\")} \n            disabled={isPending}\n            data-testid=\"button-create-delivery\"\n          >\n            <Truck className=\"h-4 w-4 mr-2\" />\n            {isPending ? \"Updating...\" : \"Create Delivery\"}\n          </Button>\n        );\n      case \"delivered\":\n        return (\n          <Button \n            onClick={() => onStatusChange(order.id, \"invoiced\")} \n            disabled={isPending}\n            data-testid=\"button-create-invoice\"\n          >\n            <FileText className=\"h-4 w-4 mr-2\" />\n            {isPending ? \"Updating...\" : \"Create Invoice\"}\n          </Button>\n        );\n      default:\n        return null;\n    }\n  };\n\n  const computedSubtotal = orderLines.reduce((sum, line) => {\n    const qty = line.quantity || 0;\n    const price = parseFloat(line.unitPrice || \"0\");\n    return sum + (qty * price);\n  }, 0);\n  const computedTotal = orderLines.reduce((sum, line) => sum + parseFloat(line.lineTotal || \"0\"), 0);\n  const computedTax = computedTotal - computedSubtotal;\n  \n  const subtotal = orderLines.length > 0 ? computedSubtotal : parseFloat(order.subtotal || \"0\");\n  const total = orderLines.length > 0 ? computedTotal : parseFloat(order.total || \"0\");\n  const tax = orderLines.length > 0 ? computedTax : parseFloat(order.taxAmount || \"0\");\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex flex-wrap items-start justify-between gap-4\">\n        <div>\n          <div className=\"flex items-center gap-3\">\n            <h2 className=\"text-xl font-semibold\" data-testid=\"text-order-number\">{order.orderNumber}</h2>\n            <StatusBadge status={order.status as \"draft\" | \"confirmed\" | \"delivered\" | \"invoiced\"} />\n          </div>\n          <p className=\"text-sm text-muted-foreground mt-1\" data-testid=\"text-order-customer\">\n            {order.customerName}\n          </p>\n        </div>\n        {getActionButton()}\n      </div>\n\n      <WorkflowStepper steps={orderSteps} currentStep={order.status || \"draft\"} />\n\n      <div className=\"grid md:grid-cols-2 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-base\">Order Information</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-2 text-sm\">\n            <div className=\"flex justify-between gap-2\">\n              <span className=\"text-muted-foreground\">Order Date</span>\n              <span data-testid=\"text-order-date\">{new Date(order.orderDate).toLocaleDateString()}</span>\n            </div>\n            <div className=\"flex justify-between gap-2\">\n              <span className=\"text-muted-foreground\">Customer ID</span>\n              <span>{order.customerId}</span>\n            </div>\n            {order.requiredDate && (\n              <div className=\"flex justify-between gap-2\">\n                <span className=\"text-muted-foreground\">Required Date</span>\n                <span>{new Date(order.requiredDate).toLocaleDateString()}</span>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-base\">Order Summary</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-2 text-sm\">\n            <div className=\"flex justify-between gap-2\">\n              <span className=\"text-muted-foreground\">Subtotal</span>\n              <span>${subtotal.toFixed(2)}</span>\n            </div>\n            <div className=\"flex justify-between gap-2\">\n              <span className=\"text-muted-foreground\">Tax</span>\n              <span>${tax.toFixed(2)}</span>\n            </div>\n            <div className=\"flex justify-between gap-2 font-semibold pt-2 border-t\">\n              <span>Total</span>\n              <span data-testid=\"text-order-total\">${total.toLocaleString()}</span>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader className=\"pb-3\">\n          <CardTitle className=\"text-base\">Order Lines</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {linesLoading ? (\n            <div className=\"space-y-2\">\n              <Skeleton className=\"h-8 w-full\" />\n              <Skeleton className=\"h-8 w-full\" />\n            </div>\n          ) : orderLines.length === 0 ? (\n            <p className=\"text-sm text-muted-foreground text-center py-4\">No order lines found</p>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <table className=\"w-full text-sm\">\n                <thead>\n                  <tr className=\"border-b\">\n                    <th className=\"text-left py-2 font-medium\">#</th>\n                    <th className=\"text-left py-2 font-medium\">Product</th>\n                    <th className=\"text-right py-2 font-medium\">Qty</th>\n                    <th className=\"text-right py-2 font-medium\">Unit Price</th>\n                    <th className=\"text-right py-2 font-medium\">Line Total</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {orderLines.map((line) => (\n                    <tr key={line.id} className=\"border-b last:border-b-0\" data-testid={`row-order-line-${line.id}`}>\n                      <td className=\"py-2\">{line.lineNumber}</td>\n                      <td className=\"py-2\">{getProductName(line.productId)}</td>\n                      <td className=\"text-right py-2\">{line.quantity}</td>\n                      <td className=\"text-right py-2\">IDR {parseFloat(line.unitPrice || \"0\").toLocaleString()}</td>\n                      <td className=\"text-right py-2\">IDR {parseFloat(line.lineTotal || \"0\").toLocaleString()}</td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      <div className=\"flex justify-end\">\n        <Button variant=\"outline\" onClick={onClose} data-testid=\"button-close-detail\">\n          Close\n        </Button>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":29439,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"client/src/components/layout/StatCard.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { TrendingUp, TrendingDown } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport type { LucideIcon } from \"lucide-react\";\n\ninterface StatCardProps {\n  title: string;\n  value: string | number;\n  icon: LucideIcon;\n  trend?: number;\n  subtitle?: string;\n  className?: string;\n}\n\nexport function StatCard({ title, value, icon: Icon, trend, subtitle, className }: StatCardProps) {\n  const formattedValue = typeof value === \"number\" \n    ? value.toLocaleString(\"en-US\", { \n        style: title.toLowerCase().includes(\"value\") || title.toLowerCase().includes(\"total\") || title.toLowerCase().includes(\"sales\") || title.toLowerCase().includes(\"receivable\") || title.toLowerCase().includes(\"payable\")\n          ? \"currency\" \n          : \"decimal\",\n        currency: \"USD\",\n        minimumFractionDigits: 0,\n        maximumFractionDigits: 0,\n      })\n    : value;\n\n  return (\n    <Card className={cn(\"\", className)} data-testid={`stat-card-${title.toLowerCase().replace(/\\s+/g, \"-\")}`}>\n      <CardContent className=\"p-6\">\n        <div className=\"flex items-center justify-between gap-4\">\n          <div className=\"flex-1 min-w-0\">\n            <p className=\"text-sm font-medium text-muted-foreground truncate\">{title}</p>\n            <p className=\"text-2xl font-semibold mt-1\">{formattedValue}</p>\n            {(trend !== undefined || subtitle) && (\n              <div className=\"flex items-center gap-1 mt-1\">\n                {trend !== undefined && (\n                  <>\n                    {trend >= 0 ? (\n                      <TrendingUp className=\"h-3 w-3 text-green-600 dark:text-green-400\" />\n                    ) : (\n                      <TrendingDown className=\"h-3 w-3 text-red-600 dark:text-red-400\" />\n                    )}\n                    <span className={cn(\n                      \"text-xs font-medium\",\n                      trend >= 0 ? \"text-green-600 dark:text-green-400\" : \"text-red-600 dark:text-red-400\"\n                    )}>\n                      {trend >= 0 ? \"+\" : \"\"}{trend.toFixed(1)}%\n                    </span>\n                  </>\n                )}\n                {subtitle && (\n                  <span className=\"text-xs text-muted-foreground ml-1\">{subtitle}</span>\n                )}\n              </div>\n            )}\n          </div>\n          <div className=\"p-3 rounded-md bg-primary/10\">\n            <Icon className=\"h-5 w-5 text-primary\" />\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":2531,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nconst TOKEN_STORAGE_KEY = \"unanza_access_token\";\n\nfunction getAuthHeaders(): Record<string, string> {\n  const token = localStorage.getItem(TOKEN_STORAGE_KEY);\n  if (token) {\n    return {\n      \"Authorization\": `Bearer ${token}`,\n    };\n  }\n  return {};\n}\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const headers: Record<string, string> = {\n    ...getAuthHeaders(),\n  };\n  \n  if (data) {\n    headers[\"Content-Type\"] = \"application/json\";\n  }\n\n  const res = await fetch(url, {\n    method,\n    headers,\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey, meta }) => {\n    const headers: Record<string, string> = {\n      ...getAuthHeaders(),\n      ...(meta?.headers as Record<string, string> || {}),\n    };\n    \n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n      headers,\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1897,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/components/sales/SalesOrderForm.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Plus, Trash2 } from \"lucide-react\";\nimport type { mockCustomers, mockProducts, mockSalesOrders } from \"@/lib/mockData\";\n\ntype Customer = typeof mockCustomers[0];\ntype Product = typeof mockProducts[0];\ntype SalesOrder = typeof mockSalesOrders[0];\n\ninterface OrderLine {\n  id: string;\n  productId: string;\n  productName: string;\n  quantity: number;\n  price: number;\n  tax: number;\n  total: number;\n}\n\ninterface SalesOrderFormProps {\n  order?: SalesOrder | null;\n  customers: Customer[];\n  products: Product[];\n  onSubmit: (order: Partial<SalesOrder>) => void;\n  onCancel: () => void;\n}\n\nexport function SalesOrderForm({ order, customers, products, onSubmit, onCancel }: SalesOrderFormProps) {\n  const [customerId, setCustomerId] = useState(order?.customerId || \"\");\n  const [lines, setLines] = useState<OrderLine[]>([\n    // todo: remove mock functionality - initial empty line\n    { id: \"1\", productId: \"\", productName: \"\", quantity: 1, price: 0, tax: 0, total: 0 },\n  ]);\n\n  const handleAddLine = () => {\n    const newLine: OrderLine = {\n      id: String(Date.now()),\n      productId: \"\",\n      productName: \"\",\n      quantity: 1,\n      price: 0,\n      tax: 0,\n      total: 0,\n    };\n    setLines([...lines, newLine]);\n  };\n\n  const handleRemoveLine = (id: string) => {\n    if (lines.length > 1) {\n      setLines(lines.filter((l) => l.id !== id));\n    }\n  };\n\n  const handleLineChange = (id: string, field: keyof OrderLine, value: string | number) => {\n    setLines(lines.map((line) => {\n      if (line.id !== id) return line;\n\n      const updated = { ...line, [field]: value };\n\n      if (field === \"productId\") {\n        const product = products.find((p) => p.id === value);\n        if (product) {\n          updated.productName = product.name;\n          updated.price = product.price;\n        }\n      }\n\n      if (field === \"quantity\" || field === \"price\" || field === \"tax\" || field === \"productId\") {\n        const subtotal = updated.quantity * updated.price;\n        updated.total = subtotal + (subtotal * updated.tax / 100);\n      }\n\n      return updated;\n    }));\n  };\n\n  const subtotal = lines.reduce((sum, line) => sum + (line.quantity * line.price), 0);\n  const totalTax = lines.reduce((sum, line) => sum + (line.quantity * line.price * line.tax / 100), 0);\n  const grandTotal = subtotal + totalTax;\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    onSubmit({\n      customerId,\n      total: grandTotal,\n      items: lines.filter(l => l.productId).length,\n    });\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-6\">\n      <div className=\"grid gap-4\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"customer\">Customer *</Label>\n          <Select value={customerId} onValueChange={setCustomerId} required>\n            <SelectTrigger data-testid=\"select-customer\">\n              <SelectValue placeholder=\"Select customer\" />\n            </SelectTrigger>\n            <SelectContent>\n              {customers.map((customer) => (\n                <SelectItem key={customer.id} value={customer.id}>\n                  {customer.name}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      <div className=\"space-y-4\">\n        <div className=\"flex items-center justify-between\">\n          <Label>Order Lines</Label>\n          <Button type=\"button\" variant=\"outline\" size=\"sm\" onClick={handleAddLine} data-testid=\"button-add-line\">\n            <Plus className=\"h-4 w-4 mr-1\" />\n            Add Line\n          </Button>\n        </div>\n\n        <div className=\"border rounded-md divide-y\">\n          <div className=\"grid grid-cols-12 gap-2 p-3 bg-muted/50 text-sm font-medium\">\n            <div className=\"col-span-4\">Product</div>\n            <div className=\"col-span-2 text-center\">Qty</div>\n            <div className=\"col-span-2 text-right\">Price</div>\n            <div className=\"col-span-1 text-center\">Tax %</div>\n            <div className=\"col-span-2 text-right\">Total</div>\n            <div className=\"col-span-1\"></div>\n          </div>\n\n          {lines.map((line, index) => (\n            <div key={line.id} className=\"grid grid-cols-12 gap-2 p-3 items-center\">\n              <div className=\"col-span-4\">\n                <Select\n                  value={line.productId}\n                  onValueChange={(value) => handleLineChange(line.id, \"productId\", value)}\n                >\n                  <SelectTrigger data-testid={`select-product-${index}`}>\n                    <SelectValue placeholder=\"Select product\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {products.map((product) => (\n                      <SelectItem key={product.id} value={product.id}>\n                        {product.name} (${product.price})\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"col-span-2\">\n                <Input\n                  type=\"number\"\n                  min=\"1\"\n                  value={line.quantity}\n                  onChange={(e) => handleLineChange(line.id, \"quantity\", parseInt(e.target.value) || 1)}\n                  className=\"text-center\"\n                  data-testid={`input-quantity-${index}`}\n                />\n              </div>\n              <div className=\"col-span-2\">\n                <Input\n                  type=\"number\"\n                  step=\"0.01\"\n                  min=\"0\"\n                  value={line.price}\n                  onChange={(e) => handleLineChange(line.id, \"price\", parseFloat(e.target.value) || 0)}\n                  className=\"text-right\"\n                  data-testid={`input-price-${index}`}\n                />\n              </div>\n              <div className=\"col-span-1\">\n                <Input\n                  type=\"number\"\n                  min=\"0\"\n                  max=\"100\"\n                  value={line.tax}\n                  onChange={(e) => handleLineChange(line.id, \"tax\", parseFloat(e.target.value) || 0)}\n                  className=\"text-center\"\n                  data-testid={`input-tax-${index}`}\n                />\n              </div>\n              <div className=\"col-span-2 text-right font-medium\">\n                ${line.total.toFixed(2)}\n              </div>\n              <div className=\"col-span-1 text-right\">\n                <Button\n                  type=\"button\"\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={() => handleRemoveLine(line.id)}\n                  disabled={lines.length === 1}\n                  data-testid={`button-remove-line-${index}`}\n                >\n                  <Trash2 className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      <div className=\"flex justify-end\">\n        <div className=\"w-64 space-y-2 text-sm\">\n          <div className=\"flex justify-between\">\n            <span className=\"text-muted-foreground\">Subtotal</span>\n            <span>${subtotal.toFixed(2)}</span>\n          </div>\n          <div className=\"flex justify-between\">\n            <span className=\"text-muted-foreground\">Tax</span>\n            <span>${totalTax.toFixed(2)}</span>\n          </div>\n          <div className=\"flex justify-between text-base font-semibold pt-2 border-t\">\n            <span>Total</span>\n            <span>${grandTotal.toFixed(2)}</span>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"flex justify-end gap-2 pt-4 border-t\">\n        <Button type=\"button\" variant=\"outline\" onClick={onCancel} data-testid=\"button-cancel\">\n          Cancel\n        </Button>\n        <Button type=\"submit\" disabled={!customerId} data-testid=\"button-save-order\">\n          {order ? \"Update Order\" : \"Create Order\"}\n        </Button>\n      </div>\n    </form>\n  );\n}\n","path":null,"size_bytes":8213,"size_tokens":null},"client/src/components/examples/InvoiceList.tsx":{"content":"import { InvoiceList } from \"../sales/InvoiceList\";\n\nexport default function InvoiceListExample() {\n  return <InvoiceList />;\n}\n","path":null,"size_bytes":128,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n  --opaque-button-border-intensity: -8;\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n  --background: 0 0% 100%;\n  --foreground: 222 47% 11%;\n  --border: 220 13% 91%;\n  --card: 0 0% 98%;\n  --card-foreground: 222 47% 11%;\n  --card-border: 220 13% 94%;\n  --sidebar: 220 14% 96%;\n  --sidebar-foreground: 222 47% 11%;\n  --sidebar-border: 220 13% 91%;\n  --sidebar-primary: 217 91% 60%;\n  --sidebar-primary-foreground: 0 0% 98%;\n  --sidebar-accent: 220 14% 91%;\n  --sidebar-accent-foreground: 222 47% 11%;\n  --sidebar-ring: 217 91% 60%;\n  --popover: 0 0% 96%;\n  --popover-foreground: 222 47% 11%;\n  --popover-border: 220 13% 91%;\n  --primary: 217 91% 60%;\n  --primary-foreground: 0 0% 98%;\n  --secondary: 220 14% 91%;\n  --secondary-foreground: 222 47% 11%;\n  --muted: 220 13% 94%;\n  --muted-foreground: 215 16% 47%;\n  --accent: 217 19% 92%;\n  --accent-foreground: 222 47% 11%;\n  --destructive: 0 84% 60%;\n  --destructive-foreground: 0 0% 98%;\n  --input: 220 13% 85%;\n  --ring: 217 91% 60%;\n  --chart-1: 217 91% 60%;\n  --chart-2: 142 76% 36%;\n  --chart-3: 280 65% 60%;\n  --chart-4: 27 87% 67%;\n  --chart-5: 340 82% 52%;\n  --font-sans: 'IBM Plex Sans', sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --radius: .5rem;\n  --shadow-2xs: 0px 2px 0px 0px hsl(220 13% 85% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(220 13% 85% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(220 13% 85% / 0.00), 0px 1px 2px -1px hsl(220 13% 85% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(220 13% 85% / 0.00), 0px 1px 2px -1px hsl(220 13% 85% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(220 13% 85% / 0.00), 0px 2px 4px -1px hsl(220 13% 85% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(220 13% 85% / 0.00), 0px 4px 6px -1px hsl(220 13% 85% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(220 13% 85% / 0.00), 0px 8px 10px -1px hsl(220 13% 85% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(220 13% 85% / 0.00);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n  --opaque-button-border-intensity: 9;\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n  --background: 222 47% 11%;\n  --foreground: 0 0% 98%;\n  --border: 217 19% 27%;\n  --card: 220 18% 14%;\n  --card-foreground: 0 0% 98%;\n  --card-border: 217 19% 20%;\n  --sidebar: 220 17% 17%;\n  --sidebar-foreground: 0 0% 98%;\n  --sidebar-border: 217 19% 24%;\n  --sidebar-primary: 217 91% 60%;\n  --sidebar-primary-foreground: 0 0% 98%;\n  --sidebar-accent: 217 19% 24%;\n  --sidebar-accent-foreground: 0 0% 98%;\n  --sidebar-ring: 217 91% 60%;\n  --popover: 220 17% 20%;\n  --popover-foreground: 0 0% 98%;\n  --popover-border: 217 19% 27%;\n  --primary: 217 91% 60%;\n  --primary-foreground: 0 0% 98%;\n  --secondary: 217 19% 27%;\n  --secondary-foreground: 0 0% 98%;\n  --muted: 217 19% 24%;\n  --muted-foreground: 215 20% 65%;\n  --accent: 217 19% 27%;\n  --accent-foreground: 0 0% 98%;\n  --destructive: 0 84% 60%;\n  --destructive-foreground: 0 0% 98%;\n  --input: 217 19% 35%;\n  --ring: 217 91% 60%;\n  --chart-1: 220 70% 70%;\n  --chart-2: 160 60% 55%;\n  --chart-3: 280 65% 70%;\n  --chart-4: 27 87% 75%;\n  --chart-5: 340 75% 65%;\n  --shadow-2xs: 0px 2px 0px 0px hsl(217 19% 20% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(217 19% 20% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(217 19% 20% / 0.00), 0px 1px 2px -1px hsl(217 19% 20% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(217 19% 20% / 0.00), 0px 1px 2px -1px hsl(217 19% 20% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(217 19% 20% / 0.00), 0px 2px 4px -1px hsl(217 19% 20% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(217 19% 20% / 0.00), 0px 4px 6px -1px hsl(217 19% 20% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(217 19% 20% / 0.00), 0px 8px 10px -1px hsl(217 19% 20% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(217 19% 20% / 0.00);\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n","path":null,"size_bytes":10740,"size_tokens":null},"client/src/components/layout/StatusBadge.tsx":{"content":"import { Badge } from \"@/components/ui/badge\";\nimport { cn } from \"@/lib/utils\";\n\ntype StatusType = \n  | \"draft\" | \"confirmed\" | \"delivered\" | \"invoiced\" \n  | \"paid\" | \"unpaid\" | \"partial\" \n  | \"ordered\" | \"received\"\n  | \"picking\" | \"packing\" | \"shipped\"\n  | \"active\" | \"inactive\" | \"pending\" | \"on-leave\"\n  | \"approved\" | \"rejected\"\n  | \"asset\" | \"liability\" | \"equity\" | \"revenue\" | \"expense\"\n  | \"posted\" | \"IN\" | \"OUT\" | \"TRANSFER\"\n  | \"vacation\" | \"sick\" | \"personal\"\n  | \"present\" | \"absent\"\n  | \"standard\" | \"transit\" | \"virtual\"\n  | \"regular\" | \"wholesale\" | \"distributor\";\n\ninterface StatusBadgeProps {\n  status: StatusType;\n  className?: string;\n}\n\nconst statusStyles: Record<StatusType, string> = {\n  draft: \"bg-muted text-muted-foreground\",\n  confirmed: \"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400\",\n  delivered: \"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400\",\n  invoiced: \"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400\",\n  paid: \"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400\",\n  unpaid: \"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\",\n  partial: \"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400\",\n  ordered: \"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400\",\n  received: \"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400\",\n  picking: \"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400\",\n  packing: \"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400\",\n  shipped: \"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400\",\n  active: \"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400\",\n  inactive: \"bg-muted text-muted-foreground\",\n  pending: \"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400\",\n  \"on-leave\": \"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400\",\n  approved: \"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400\",\n  rejected: \"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\",\n  asset: \"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400\",\n  liability: \"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\",\n  equity: \"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400\",\n  revenue: \"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400\",\n  expense: \"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400\",\n  posted: \"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400\",\n  IN: \"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400\",\n  OUT: \"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\",\n  TRANSFER: \"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400\",\n  vacation: \"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400\",\n  sick: \"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\",\n  personal: \"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400\",\n  present: \"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400\",\n  absent: \"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\",\n  standard: \"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400\",\n  transit: \"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400\",\n  virtual: \"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400\",\n  regular: \"bg-muted text-muted-foreground\",\n  wholesale: \"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400\",\n  distributor: \"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400\",\n};\n\nexport function StatusBadge({ status, className }: StatusBadgeProps) {\n  const displayText = status.charAt(0).toUpperCase() + status.slice(1).replace(\"-\", \" \");\n  \n  return (\n    <Badge \n      variant=\"secondary\"\n      className={cn(\"font-medium\", statusStyles[status], className)}\n    >\n      {displayText}\n    </Badge>\n  );\n}\n","path":null,"size_bytes":4030,"size_tokens":null},"client/src/components/reports/InventoryReports.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Package,\n  AlertTriangle,\n  TrendingUp,\n  TrendingDown,\n  ArrowDownToLine,\n  ArrowUpFromLine,\n  RefreshCw,\n  CheckCircle,\n  Clock,\n  Star,\n} from \"lucide-react\";\nimport {\n  mockInventoryAging,\n  mockABCAnalysis,\n  mockStockMovement,\n  mockReorderRecommendations,\n  mockStockAccuracy,\n  mockSupplierPerformance,\n} from \"@/lib/reportData\";\nimport { cn } from \"@/lib/utils\";\n\nexport function InventoryReports() {\n  const [activeTab, setActiveTab] = useState(\"aging\");\n\n  const totalAgingValue = mockInventoryAging.reduce((sum, a) => sum + a.value, 0);\n  const oldStockValue = mockInventoryAging.filter(a => a.ageRange.includes(\"90\") || a.ageRange.includes(\"180\")).reduce((sum, a) => sum + a.value, 0);\n\n  return (\n    <div className=\"space-y-6\">\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList className=\"grid grid-cols-6 w-full max-w-4xl\">\n          <TabsTrigger value=\"aging\" data-testid=\"tab-aging\">Aging</TabsTrigger>\n          <TabsTrigger value=\"abc\" data-testid=\"tab-abc\">ABC Analysis</TabsTrigger>\n          <TabsTrigger value=\"movement\" data-testid=\"tab-movement\">Movement</TabsTrigger>\n          <TabsTrigger value=\"reorder\" data-testid=\"tab-reorder\">Reorder</TabsTrigger>\n          <TabsTrigger value=\"accuracy\" data-testid=\"tab-accuracy\">Accuracy</TabsTrigger>\n          <TabsTrigger value=\"suppliers\" data-testid=\"tab-suppliers\">Suppliers</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"aging\" className=\"space-y-6 mt-6\">\n          <div className=\"grid md:grid-cols-3 gap-4\">\n            <Card data-testid=\"card-inventory-value\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm text-muted-foreground\">Total Inventory Value</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-2xl font-semibold\" data-testid=\"text-inventory-value\">${totalAgingValue.toLocaleString()}</p>\n              </CardContent>\n            </Card>\n            <Card data-testid=\"card-fresh-stock\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm text-muted-foreground\">Fresh Stock (0-60 days)</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-2xl font-semibold text-green-600 dark:text-green-400\" data-testid=\"text-fresh-stock\">68%</p>\n              </CardContent>\n            </Card>\n            <Card data-testid=\"card-old-stock\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm text-muted-foreground\">Old/Dead Stock (90+ days)</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-2xl font-semibold text-red-600 dark:text-red-400\" data-testid=\"text-old-stock\">\n                  ${oldStockValue.toLocaleString()}\n                </p>\n              </CardContent>\n            </Card>\n          </div>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Clock className=\"h-5 w-5\" />\n                Inventory Aging Report\n              </CardTitle>\n              <CardDescription>Stock age distribution to identify slow-moving inventory</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                {mockInventoryAging.map((aging) => {\n                  const isOld = aging.ageRange.includes(\"90\") || aging.ageRange.includes(\"180\");\n                  return (\n                    <div key={aging.ageRange} className=\"space-y-2\">\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"font-medium\">{aging.ageRange}</span>\n                          {isOld && <AlertTriangle className=\"h-4 w-4 text-amber-500\" />}\n                        </div>\n                        <div className=\"flex items-center gap-4\">\n                          <span className=\"text-sm text-muted-foreground\">{aging.items} items</span>\n                          <span className=\"font-semibold\">${aging.value.toLocaleString()}</span>\n                        </div>\n                      </div>\n                      <div className=\"h-6 bg-muted rounded-md overflow-hidden\">\n                        <div\n                          className={cn(\n                            \"h-full flex items-center px-2 text-xs font-medium text-white\",\n                            isOld ? \"bg-red-500\" : aging.ageRange.includes(\"60\") ? \"bg-amber-500\" : \"bg-green-500\"\n                          )}\n                          style={{ width: `${aging.percentage}%` }}\n                        >\n                          {aging.percentage}%\n                        </div>\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"abc\" className=\"space-y-6 mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Package className=\"h-5 w-5\" />\n                ABC Analysis\n              </CardTitle>\n              <CardDescription>Inventory classification by value contribution</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid md:grid-cols-3 gap-6 mb-6\">\n                {mockABCAnalysis.map((category) => (\n                  <Card key={category.category} className={cn(\n                    \"border-2\",\n                    category.category === \"A\" ? \"border-green-500\" :\n                    category.category === \"B\" ? \"border-amber-500\" : \"border-blue-500\"\n                  )}>\n                    <CardHeader className=\"pb-2\">\n                      <div className=\"flex items-center justify-between\">\n                        <CardTitle className=\"text-2xl\">Category {category.category}</CardTitle>\n                        <Badge className={cn(\n                          category.category === \"A\" ? \"bg-green-500\" :\n                          category.category === \"B\" ? \"bg-amber-500\" : \"bg-blue-500\"\n                        )}>\n                          {category.valuePercentage}% value\n                        </Badge>\n                      </div>\n                      <CardDescription>{category.description}</CardDescription>\n                    </CardHeader>\n                    <CardContent className=\"space-y-3\">\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-muted-foreground\">Items</span>\n                        <span className=\"font-medium\">{category.items} ({category.percentage}%)</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-muted-foreground\">Total Value</span>\n                        <span className=\"font-medium\">${category.value.toLocaleString()}</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-muted-foreground\">Value Share</span>\n                        <span className=\"font-medium\">{category.valuePercentage}%</span>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n\n              <div className=\"p-4 bg-muted/50 rounded-md\">\n                <h4 className=\"font-medium mb-2\">ABC Analysis Recommendations</h4>\n                <ul className=\"space-y-2 text-sm text-muted-foreground\">\n                  <li className=\"flex items-start gap-2\">\n                    <CheckCircle className=\"h-4 w-4 text-green-500 mt-0.5\" />\n                    <span><strong>Category A:</strong> Implement tight inventory control, frequent cycle counts, and maintain safety stock</span>\n                  </li>\n                  <li className=\"flex items-start gap-2\">\n                    <CheckCircle className=\"h-4 w-4 text-amber-500 mt-0.5\" />\n                    <span><strong>Category B:</strong> Use moderate controls, regular review cycles, and economic order quantities</span>\n                  </li>\n                  <li className=\"flex items-start gap-2\">\n                    <CheckCircle className=\"h-4 w-4 text-blue-500 mt-0.5\" />\n                    <span><strong>Category C:</strong> Apply simple controls, bulk ordering, and periodic review system</span>\n                  </li>\n                </ul>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"movement\" className=\"space-y-6 mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <RefreshCw className=\"h-5 w-5\" />\n                Stock Movement Summary\n              </CardTitle>\n              <CardDescription>Monthly inbound, outbound, and net stock changes</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Month</TableHead>\n                    <TableHead className=\"text-right\">\n                      <div className=\"flex items-center justify-end gap-1\">\n                        <ArrowDownToLine className=\"h-4 w-4 text-green-600\" />\n                        Inbound\n                      </div>\n                    </TableHead>\n                    <TableHead className=\"text-right\">\n                      <div className=\"flex items-center justify-end gap-1\">\n                        <ArrowUpFromLine className=\"h-4 w-4 text-blue-600\" />\n                        Outbound\n                      </div>\n                    </TableHead>\n                    <TableHead className=\"text-right\">Adjustments</TableHead>\n                    <TableHead className=\"text-right\">Net Change</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {mockStockMovement.map((month) => (\n                    <TableRow key={month.month}>\n                      <TableCell className=\"font-medium\">{month.month}</TableCell>\n                      <TableCell className=\"text-right text-green-600\">+{month.inbound.toLocaleString()}</TableCell>\n                      <TableCell className=\"text-right text-blue-600\">-{month.outbound.toLocaleString()}</TableCell>\n                      <TableCell className=\"text-right text-muted-foreground\">{month.adjustments}</TableCell>\n                      <TableCell className={cn(\n                        \"text-right font-medium\",\n                        month.netChange >= 0 ? \"text-green-600\" : \"text-red-600\"\n                      )}>\n                        {month.netChange >= 0 ? \"+\" : \"\"}{month.netChange.toLocaleString()}\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n\n              <div className=\"mt-6 grid md:grid-cols-4 gap-4\">\n                <div className=\"p-4 border rounded-md\">\n                  <p className=\"text-sm text-muted-foreground\">Total Inbound</p>\n                  <p className=\"text-xl font-semibold text-green-600\">\n                    +{mockStockMovement.reduce((sum, m) => sum + m.inbound, 0).toLocaleString()}\n                  </p>\n                </div>\n                <div className=\"p-4 border rounded-md\">\n                  <p className=\"text-sm text-muted-foreground\">Total Outbound</p>\n                  <p className=\"text-xl font-semibold text-blue-600\">\n                    -{mockStockMovement.reduce((sum, m) => sum + m.outbound, 0).toLocaleString()}\n                  </p>\n                </div>\n                <div className=\"p-4 border rounded-md\">\n                  <p className=\"text-sm text-muted-foreground\">Total Adjustments</p>\n                  <p className=\"text-xl font-semibold text-muted-foreground\">\n                    {mockStockMovement.reduce((sum, m) => sum + m.adjustments, 0)}\n                  </p>\n                </div>\n                <div className=\"p-4 border rounded-md\">\n                  <p className=\"text-sm text-muted-foreground\">Net Change</p>\n                  <p className=\"text-xl font-semibold text-green-600\">\n                    +{mockStockMovement.reduce((sum, m) => sum + m.netChange, 0).toLocaleString()}\n                  </p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"reorder\" className=\"space-y-6 mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <AlertTriangle className=\"h-5 w-5\" />\n                Reorder Recommendations\n              </CardTitle>\n              <CardDescription>AI-based suggestions for stock replenishment based on safety stock levels</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Priority</TableHead>\n                    <TableHead>Product</TableHead>\n                    <TableHead className=\"text-right\">Current Stock</TableHead>\n                    <TableHead className=\"text-right\">Safety Stock</TableHead>\n                    <TableHead className=\"text-right\">Reorder Point</TableHead>\n                    <TableHead className=\"text-right\">Suggested Qty</TableHead>\n                    <TableHead className=\"text-center\">Lead Time</TableHead>\n                    <TableHead></TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {mockReorderRecommendations.map((item) => (\n                    <TableRow key={item.id}>\n                      <TableCell>\n                        <Badge className={cn(\n                          item.priority === \"critical\" ? \"bg-red-500\" :\n                          item.priority === \"high\" ? \"bg-amber-500\" :\n                          item.priority === \"medium\" ? \"bg-blue-500\" : \"bg-gray-500\"\n                        )}>\n                          {item.priority}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        <div>\n                          <p className=\"font-medium\">{item.name}</p>\n                          <p className=\"text-sm text-muted-foreground\">{item.sku}</p>\n                        </div>\n                      </TableCell>\n                      <TableCell className={cn(\n                        \"text-right font-medium\",\n                        item.currentStock < item.safetyStock ? \"text-red-600\" : \"\"\n                      )}>\n                        {item.currentStock}\n                      </TableCell>\n                      <TableCell className=\"text-right\">{item.safetyStock}</TableCell>\n                      <TableCell className=\"text-right\">{item.reorderPoint}</TableCell>\n                      <TableCell className=\"text-right font-semibold\">{item.suggestedQty}</TableCell>\n                      <TableCell className=\"text-center\">{item.leadTime} days</TableCell>\n                      <TableCell>\n                        <Button size=\"sm\" data-testid={`button-reorder-${item.id}`}>\n                          Create PO\n                        </Button>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"accuracy\" className=\"space-y-6 mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <CheckCircle className=\"h-5 w-5\" />\n                Stock Accuracy Report\n              </CardTitle>\n              <CardDescription>Comparison between system records and physical counts</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Location</TableHead>\n                    <TableHead className=\"text-right\">System Qty</TableHead>\n                    <TableHead className=\"text-right\">Physical Qty</TableHead>\n                    <TableHead className=\"text-right\">Variance</TableHead>\n                    <TableHead className=\"text-right\">Variance %</TableHead>\n                    <TableHead>Last Audit</TableHead>\n                    <TableHead className=\"text-center\">Status</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {mockStockAccuracy.map((location) => (\n                    <TableRow key={location.location}>\n                      <TableCell className=\"font-medium\">{location.location}</TableCell>\n                      <TableCell className=\"text-right\">{location.systemQty.toLocaleString()}</TableCell>\n                      <TableCell className=\"text-right\">{location.physicalQty.toLocaleString()}</TableCell>\n                      <TableCell className={cn(\n                        \"text-right\",\n                        location.variance !== 0 ? \"text-amber-600\" : \"text-green-600\"\n                      )}>\n                        {location.variance > 0 ? \"+\" : \"\"}{location.variance}\n                      </TableCell>\n                      <TableCell className={cn(\n                        \"text-right\",\n                        Math.abs(location.variancePercent) > 0.5 ? \"text-amber-600\" : \"text-green-600\"\n                      )}>\n                        {location.variancePercent > 0 ? \"+\" : \"\"}{location.variancePercent.toFixed(2)}%\n                      </TableCell>\n                      <TableCell>{location.lastAudit}</TableCell>\n                      <TableCell className=\"text-center\">\n                        {Math.abs(location.variancePercent) < 1 ? (\n                          <Badge className=\"bg-green-500\">Accurate</Badge>\n                        ) : (\n                          <Badge className=\"bg-amber-500\">Review</Badge>\n                        )}\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n\n              <div className=\"mt-6 p-4 bg-muted/50 rounded-md\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"font-medium\">Overall Stock Accuracy</p>\n                    <p className=\"text-sm text-muted-foreground\">Based on latest cycle count audit</p>\n                  </div>\n                  <div className=\"text-right\">\n                    <p className=\"text-3xl font-semibold text-green-600\">99.7%</p>\n                    <p className=\"text-sm text-muted-foreground\">Target: 99.5%</p>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"suppliers\" className=\"space-y-6 mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Star className=\"h-5 w-5\" />\n                Supplier Performance\n              </CardTitle>\n              <CardDescription>Vendor evaluation based on delivery, quality, and pricing</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Supplier</TableHead>\n                    <TableHead className=\"text-center\">On-Time Rate</TableHead>\n                    <TableHead className=\"text-center\">Quality Score</TableHead>\n                    <TableHead className=\"text-center\">Avg Lead Time</TableHead>\n                    <TableHead className=\"text-center\">Price Score</TableHead>\n                    <TableHead className=\"text-center\">Overall Score</TableHead>\n                    <TableHead className=\"text-center\">Rating</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {mockSupplierPerformance.map((supplier) => (\n                    <TableRow key={supplier.id}>\n                      <TableCell className=\"font-medium\">{supplier.name}</TableCell>\n                      <TableCell className=\"text-center\">\n                        <div className=\"flex items-center justify-center gap-2\">\n                          <Progress value={supplier.onTimeRate} className=\"h-2 w-12\" />\n                          <span>{supplier.onTimeRate}%</span>\n                        </div>\n                      </TableCell>\n                      <TableCell className=\"text-center\">\n                        <div className=\"flex items-center justify-center gap-2\">\n                          <Progress value={supplier.qualityScore} className=\"h-2 w-12\" />\n                          <span>{supplier.qualityScore}%</span>\n                        </div>\n                      </TableCell>\n                      <TableCell className=\"text-center\">{supplier.avgLeadTime} days</TableCell>\n                      <TableCell className=\"text-center\">\n                        <div className=\"flex items-center justify-center gap-2\">\n                          <Progress value={supplier.priceCompetitiveness} className=\"h-2 w-12\" />\n                          <span>{supplier.priceCompetitiveness}%</span>\n                        </div>\n                      </TableCell>\n                      <TableCell className=\"text-center\">\n                        <span className={cn(\n                          \"font-semibold\",\n                          supplier.overallScore >= 90 ? \"text-green-600\" :\n                          supplier.overallScore >= 80 ? \"text-amber-600\" : \"text-red-600\"\n                        )}>\n                          {supplier.overallScore}%\n                        </span>\n                      </TableCell>\n                      <TableCell className=\"text-center\">\n                        <div className=\"flex justify-center\">\n                          {[...Array(5)].map((_, i) => (\n                            <Star\n                              key={i}\n                              className={cn(\n                                \"h-4 w-4\",\n                                i < Math.round(supplier.overallScore / 20) ? \"fill-amber-400 text-amber-400\" : \"text-muted\"\n                              )}\n                            />\n                          ))}\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":23378,"size_tokens":null},"client/src/components/examples/SalesOrderList.tsx":{"content":"import { SalesOrderList } from \"../sales/SalesOrderList\";\n\nexport default function SalesOrderListExample() {\n  return <SalesOrderList />;\n}\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, integer, boolean, timestamp, decimal, jsonb, unique, index } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// ============================================================================\n// COMPANY HIERARCHY CONSTANTS (defined first for use in schema validation)\n// ============================================================================\n\n// Strict 3-level hierarchy: Holding (level 1)  Subsidiary (level 2)  Branch (level 3)\nexport const COMPANY_LEVELS = {\n  HOLDING: 1,\n  SUBSIDIARY: 2,\n  BRANCH: 3,\n} as const;\n\nexport const COMPANY_TYPES = {\n  HOLDING: \"holding\",\n  SUBSIDIARY: \"subsidiary\", \n  BRANCH: \"branch\",\n} as const;\n\nexport type CompanyLevel = typeof COMPANY_LEVELS[keyof typeof COMPANY_LEVELS];\nexport type CompanyType = typeof COMPANY_TYPES[keyof typeof COMPANY_TYPES];\n\n// ============================================================================\n// MULTI-COMPANY CORE TABLES\n// ============================================================================\n\n// Companies table - strict 3-level hierarchy: Holding (1)  Subsidiary (2)  Branch (3)\nexport const companies = pgTable(\"companies\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  code: varchar(\"code\", { length: 20 }).notNull().unique(),\n  name: text(\"name\").notNull(),\n  legalName: text(\"legal_name\"),\n  taxId: varchar(\"tax_id\", { length: 50 }),\n  parentId: varchar(\"parent_id\").references((): any => companies.id),\n  path: text(\"path\").notNull(), // Materialized path for hierarchy (e.g., \"HOLDING/SUBSIDIARY/BRANCH\")\n  level: integer(\"level\").notNull().default(1), // 1=Holding, 2=Subsidiary, 3=Branch (max depth)\n  companyType: varchar(\"company_type\", { length: 50 }).notNull().default(\"holding\"), // holding, subsidiary, branch only\n  currency: varchar(\"currency\", { length: 3 }).notNull().default(\"IDR\"),\n  locale: varchar(\"locale\", { length: 10 }).default(\"en-US\"),\n  timezone: varchar(\"timezone\", { length: 50 }).default(\"UTC\"),\n  address: text(\"address\"),\n  city: text(\"city\"),\n  state: text(\"state\"),\n  country: varchar(\"country\", { length: 2 }),\n  postalCode: varchar(\"postal_code\", { length: 20 }),\n  phone: varchar(\"phone\", { length: 30 }),\n  email: text(\"email\"),\n  website: text(\"website\"),\n  logoUrl: text(\"logo_url\"),\n  consolidationEnabled: boolean(\"consolidation_enabled\").default(false),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => ({\n  pathIdx: index(\"companies_path_idx\").on(table.path),\n  parentIdx: index(\"companies_parent_idx\").on(table.parentId),\n}));\n\n// Company settings - fiscal and operational settings per company\nexport const companySettings = pgTable(\"company_settings\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  companyId: varchar(\"company_id\").notNull().references(() => companies.id).unique(),\n  fiscalYearStart: integer(\"fiscal_year_start\").default(1), // Month (1-12)\n  fiscalYearEnd: integer(\"fiscal_year_end\").default(12),\n  taxRegime: varchar(\"tax_regime\", { length: 50 }),\n  defaultPaymentTerms: integer(\"default_payment_terms\").default(30), // Days\n  inventoryCostingMethod: varchar(\"inventory_costing_method\", { length: 20 }).default(\"fifo\"), // fifo, lifo, average\n  defaultWarehouseId: varchar(\"default_warehouse_id\"),\n  multiCurrencyEnabled: boolean(\"multi_currency_enabled\").default(false),\n  intercompanyEnabled: boolean(\"intercompany_enabled\").default(true),\n  autoPostIntercompany: boolean(\"auto_post_intercompany\").default(false),\n  consolidationRules: jsonb(\"consolidation_rules\"), // JSON with elimination rules\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Fiscal periods per company\nexport const companyFiscalPeriods = pgTable(\"company_fiscal_periods\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  companyId: varchar(\"company_id\").notNull().references(() => companies.id),\n  periodCode: varchar(\"period_code\", { length: 20 }).notNull(), // e.g., \"2024-01\", \"2024-Q1\"\n  periodName: text(\"period_name\").notNull(),\n  periodType: varchar(\"period_type\", { length: 20 }).notNull().default(\"month\"), // month, quarter, year\n  startDate: timestamp(\"start_date\").notNull(),\n  endDate: timestamp(\"end_date\").notNull(),\n  status: varchar(\"status\", { length: 20 }).default(\"open\"), // open, closed, locked\n  isClosed: boolean(\"is_closed\").default(false),\n  closedAt: timestamp(\"closed_at\"),\n  closedBy: varchar(\"closed_by\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => ({\n  companyPeriodUnique: unique().on(table.companyId, table.periodCode),\n  companyIdx: index(\"fiscal_periods_company_idx\").on(table.companyId),\n}));\n\n// ============================================================================\n// ROLES & PERMISSIONS\n// ============================================================================\n\n// System roles\nexport const roles = pgTable(\"roles\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  code: varchar(\"code\", { length: 50 }).notNull().unique(),\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  isSystemRole: boolean(\"is_system_role\").default(false),\n  permissions: jsonb(\"permissions\").notNull().default([]), // Array of permission codes\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Users table (extended)\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  email: text(\"email\"),\n  fullName: text(\"full_name\"),\n  avatarUrl: text(\"avatar_url\"),\n  defaultCompanyId: varchar(\"default_company_id\").references(() => companies.id),\n  isActive: boolean(\"is_active\").default(true),\n  lastLoginAt: timestamp(\"last_login_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// User-Company role assignments\nexport const userCompanyRoles = pgTable(\"user_company_roles\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  companyId: varchar(\"company_id\").notNull().references(() => companies.id),\n  roleId: varchar(\"role_id\").notNull().references(() => roles.id),\n  isDefault: boolean(\"is_default\").default(false),\n  grantedAt: timestamp(\"granted_at\").defaultNow(),\n  grantedBy: varchar(\"granted_by\").references(() => users.id),\n  expiresAt: timestamp(\"expires_at\"),\n  isActive: boolean(\"is_active\").default(true),\n}, (table) => ({\n  userCompanyRoleUnique: unique().on(table.userId, table.companyId, table.roleId),\n  userIdx: index(\"user_company_roles_user_idx\").on(table.userId),\n  companyIdx: index(\"user_company_roles_company_idx\").on(table.companyId),\n}));\n\n// ============================================================================\n// AUTHENTICATION - JWT & REFRESH TOKENS\n// ============================================================================\n\n// Refresh tokens for JWT authentication\nexport const refreshTokens = pgTable(\"refresh_tokens\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  tokenHash: text(\"token_hash\").notNull().unique(), // Hashed refresh token\n  activeCompanyId: varchar(\"active_company_id\").references(() => companies.id),\n  deviceInfo: text(\"device_info\"), // User agent or device identifier\n  ipAddress: varchar(\"ip_address\", { length: 45 }), // IPv4 or IPv6\n  issuedAt: timestamp(\"issued_at\").defaultNow(),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  revokedAt: timestamp(\"revoked_at\"), // Null if not revoked\n  revokedReason: varchar(\"revoked_reason\", { length: 100 }), // logout, rotation, security\n  tokenVersion: integer(\"token_version\").default(1), // For token rotation\n}, (table) => ({\n  userIdx: index(\"refresh_tokens_user_idx\").on(table.userId),\n  tokenHashIdx: index(\"refresh_tokens_hash_idx\").on(table.tokenHash),\n  expiresIdx: index(\"refresh_tokens_expires_idx\").on(table.expiresAt),\n}));\n\n// Audit log for authentication events\nexport const authAuditLog = pgTable(\"auth_audit_log\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id),\n  eventType: varchar(\"event_type\", { length: 50 }).notNull(), // login, logout, refresh, failed_login, token_revoked\n  companyId: varchar(\"company_id\").references(() => companies.id),\n  ipAddress: varchar(\"ip_address\", { length: 45 }),\n  deviceInfo: text(\"device_info\"),\n  success: boolean(\"success\").default(true),\n  failureReason: text(\"failure_reason\"),\n  metadata: jsonb(\"metadata\"), // Additional context\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => ({\n  userIdx: index(\"auth_audit_user_idx\").on(table.userId),\n  eventTypeIdx: index(\"auth_audit_event_idx\").on(table.eventType),\n  createdIdx: index(\"auth_audit_created_idx\").on(table.createdAt),\n}));\n\n// ============================================================================\n// MASTER DATA - COMPANY SCOPED\n// ============================================================================\n\n// Chart of Accounts (company-scoped)\nexport const chartOfAccounts = pgTable(\"chart_of_accounts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  companyId: varchar(\"company_id\").notNull().references(() => companies.id),\n  accountCode: varchar(\"account_code\", { length: 20 }).notNull(),\n  name: text(\"name\").notNull(),\n  accountType: varchar(\"account_type\", { length: 20 }).notNull(), // asset, liability, equity, revenue, expense\n  level: integer(\"level\").notNull().default(1),\n  parentId: varchar(\"parent_id\"),\n  balance: decimal(\"balance\", { precision: 18, scale: 2 }).default(\"0\"),\n  isPostable: boolean(\"is_postable\").default(true),\n  isActive: boolean(\"is_active\").default(true),\n  consolidationAccountId: varchar(\"consolidation_account_id\"), // Maps to parent company account for consolidation\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => ({\n  companyAccountUnique: unique().on(table.companyId, table.accountCode),\n  companyIdx: index(\"coa_company_idx\").on(table.companyId),\n}));\n\n// Warehouses (company-scoped)\nexport const warehouses = pgTable(\"warehouses\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  companyId: varchar(\"company_id\").notNull().references(() => companies.id),\n  code: varchar(\"code\", { length: 20 }).notNull(),\n  name: text(\"name\").notNull(),\n  warehouseType: varchar(\"warehouse_type\", { length: 20 }).default(\"standard\"), // standard, transit, virtual\n  address: text(\"address\"),\n  city: text(\"city\"),\n  state: text(\"state\"),\n  country: varchar(\"country\", { length: 2 }),\n  managerId: varchar(\"manager_id\"),\n  isActive: boolean(\"is_active\").default(true),\n  allowNegativeStock: boolean(\"allow_negative_stock\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => ({\n  companyCodeUnique: unique().on(table.companyId, table.code),\n  companyIdx: index(\"warehouses_company_idx\").on(table.companyId),\n}));\n\n// Products (company-scoped)\nexport const products = pgTable(\"products\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  companyId: varchar(\"company_id\").notNull().references(() => companies.id),\n  sku: varchar(\"sku\", { length: 50 }).notNull(),\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  category: varchar(\"category\", { length: 100 }),\n  uom: varchar(\"uom\", { length: 20 }).default(\"EA\"),\n  price: decimal(\"price\", { precision: 18, scale: 2 }).default(\"0\"),\n  cost: decimal(\"cost\", { precision: 18, scale: 2 }).default(\"0\"),\n  minStockLevel: integer(\"min_stock_level\").default(0),\n  maxStockLevel: integer(\"max_stock_level\"),\n  reorderPoint: integer(\"reorder_point\"),\n  isActive: boolean(\"is_active\").default(true),\n  isSellable: boolean(\"is_sellable\").default(true),\n  isPurchasable: boolean(\"is_purchasable\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => ({\n  companySkuUnique: unique().on(table.companyId, table.sku),\n  companyIdx: index(\"products_company_idx\").on(table.companyId),\n}));\n\n// Customers (company-scoped)\nexport const customers = pgTable(\"customers\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  companyId: varchar(\"company_id\").notNull().references(() => companies.id),\n  code: varchar(\"code\", { length: 20 }).notNull(),\n  name: text(\"name\").notNull(),\n  legalName: text(\"legal_name\"),\n  taxId: varchar(\"tax_id\", { length: 50 }),\n  email: text(\"email\"),\n  phone: varchar(\"phone\", { length: 30 }),\n  address: text(\"address\"),\n  city: text(\"city\"),\n  state: text(\"state\"),\n  country: varchar(\"country\", { length: 2 }),\n  postalCode: varchar(\"postal_code\", { length: 20 }),\n  paymentTerms: integer(\"payment_terms\").default(30),\n  creditLimit: decimal(\"credit_limit\", { precision: 18, scale: 2 }),\n  currentBalance: decimal(\"current_balance\", { precision: 18, scale: 2 }).default(\"0\"),\n  customerType: varchar(\"customer_type\", { length: 20 }).default(\"regular\"),\n  isActive: boolean(\"is_active\").default(true),\n  isIntercompany: boolean(\"is_intercompany\").default(false),\n  linkedCompanyId: varchar(\"linked_company_id\").references(() => companies.id), // For IC customers\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => ({\n  companyCodeUnique: unique().on(table.companyId, table.code),\n  companyIdx: index(\"customers_company_idx\").on(table.companyId),\n}));\n\n// Vendors (company-scoped)\nexport const vendors = pgTable(\"vendors\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  companyId: varchar(\"company_id\").notNull().references(() => companies.id),\n  code: varchar(\"code\", { length: 20 }).notNull(),\n  name: text(\"name\").notNull(),\n  legalName: text(\"legal_name\"),\n  taxId: varchar(\"tax_id\", { length: 50 }),\n  email: text(\"email\"),\n  phone: varchar(\"phone\", { length: 30 }),\n  address: text(\"address\"),\n  city: text(\"city\"),\n  state: text(\"state\"),\n  country: varchar(\"country\", { length: 2 }),\n  postalCode: varchar(\"postal_code\", { length: 20 }),\n  paymentTerms: integer(\"payment_terms\").default(30),\n  vendorType: varchar(\"vendor_type\", { length: 20 }).default(\"regular\"),\n  isActive: boolean(\"is_active\").default(true),\n  isIntercompany: boolean(\"is_intercompany\").default(false),\n  linkedCompanyId: varchar(\"linked_company_id\").references(() => companies.id), // For IC vendors\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => ({\n  companyCodeUnique: unique().on(table.companyId, table.code),\n  companyIdx: index(\"vendors_company_idx\").on(table.companyId),\n}));\n\n// Employees (company-scoped)\nexport const employees = pgTable(\"employees\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  companyId: varchar(\"company_id\").notNull().references(() => companies.id),\n  employeeCode: varchar(\"employee_code\", { length: 20 }).notNull(),\n  name: text(\"name\").notNull(),\n  email: text(\"email\"),\n  phone: varchar(\"phone\", { length: 30 }),\n  department: varchar(\"department\", { length: 100 }),\n  position: varchar(\"position\", { length: 100 }),\n  hireDate: timestamp(\"hire_date\").defaultNow(),\n  terminationDate: timestamp(\"termination_date\"),\n  status: varchar(\"status\", { length: 20 }).default(\"active\"),\n  managerId: varchar(\"manager_id\"),\n  address: text(\"address\"),\n  city: text(\"city\"),\n  state: text(\"state\"),\n  country: varchar(\"country\", { length: 2 }),\n  salary: decimal(\"salary\", { precision: 18, scale: 2 }),\n  salaryFrequency: varchar(\"salary_frequency\", { length: 20 }).default(\"monthly\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => ({\n  companyCodeUnique: unique().on(table.companyId, table.employeeCode),\n  companyIdx: index(\"employees_company_idx\").on(table.companyId),\n}));\n\n// Tax configurations (company-scoped)\nexport const taxes = pgTable(\"taxes\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  companyId: varchar(\"company_id\").notNull().references(() => companies.id),\n  code: varchar(\"code\", { length: 20 }).notNull(),\n  name: text(\"name\").notNull(),\n  rate: decimal(\"rate\", { precision: 8, scale: 4 }).notNull(),\n  taxType: varchar(\"tax_type\", { length: 20 }).default(\"sales\"), // sales, purchase, withholding\n  isDefault: boolean(\"is_default\").default(false),\n  isActive: boolean(\"is_active\").default(true),\n  accountId: varchar(\"account_id\").references(() => chartOfAccounts.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => ({\n  companyCodeUnique: unique().on(table.companyId, table.code),\n  companyIdx: index(\"taxes_company_idx\").on(table.companyId),\n}));\n\n// ============================================================================\n// SHARED ACCESS CONTROL\n// ============================================================================\n\n// Shared access between companies for master data\nexport const sharedAccess = pgTable(\"shared_access\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  entityType: varchar(\"entity_type\", { length: 50 }).notNull(), // product, customer, vendor, account\n  entityId: varchar(\"entity_id\").notNull(),\n  ownerCompanyId: varchar(\"owner_company_id\").notNull().references(() => companies.id),\n  granteeCompanyId: varchar(\"grantee_company_id\").notNull().references(() => companies.id),\n  accessLevel: varchar(\"access_level\", { length: 20 }).default(\"read\"), // read, write, full\n  grantedAt: timestamp(\"granted_at\").defaultNow(),\n  grantedBy: varchar(\"granted_by\").references(() => users.id),\n  expiresAt: timestamp(\"expires_at\"),\n  isActive: boolean(\"is_active\").default(true),\n}, (table) => ({\n  entityUnique: unique().on(table.entityType, table.entityId, table.granteeCompanyId),\n  ownerIdx: index(\"shared_access_owner_idx\").on(table.ownerCompanyId),\n  granteeIdx: index(\"shared_access_grantee_idx\").on(table.granteeCompanyId),\n}));\n\n// ============================================================================\n// TRANSACTIONS - COMPANY SCOPED\n// ============================================================================\n\n// Sales Orders\nexport const salesOrders = pgTable(\"sales_orders\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  companyId: varchar(\"company_id\").notNull().references(() => companies.id),\n  orderNumber: varchar(\"order_number\", { length: 30 }).notNull(),\n  customerId: varchar(\"customer_id\").notNull().references(() => customers.id),\n  orderDate: timestamp(\"order_date\").notNull().defaultNow(),\n  requiredDate: timestamp(\"required_date\"),\n  status: varchar(\"status\", { length: 20 }).default(\"draft\"), // draft, confirmed, delivered, invoiced, cancelled\n  subtotal: decimal(\"subtotal\", { precision: 18, scale: 2 }).default(\"0\"),\n  taxAmount: decimal(\"tax_amount\", { precision: 18, scale: 2 }).default(\"0\"),\n  total: decimal(\"total\", { precision: 18, scale: 2 }).default(\"0\"),\n  fiscalPeriodId: varchar(\"fiscal_period_id\").references(() => companyFiscalPeriods.id),\n  warehouseId: varchar(\"warehouse_id\").references(() => warehouses.id),\n  isIntercompany: boolean(\"is_intercompany\").default(false),\n  counterpartyCompanyId: varchar(\"counterparty_company_id\").references(() => companies.id),\n  linkedPurchaseOrderId: varchar(\"linked_purchase_order_id\"),\n  notes: text(\"notes\"),\n  createdBy: varchar(\"created_by\").references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => ({\n  companyOrderUnique: unique().on(table.companyId, table.orderNumber),\n  companyIdx: index(\"sales_orders_company_idx\").on(table.companyId),\n  customerIdx: index(\"sales_orders_customer_idx\").on(table.customerId),\n}));\n\nexport const salesOrderLines = pgTable(\"sales_order_lines\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  salesOrderId: varchar(\"sales_order_id\").notNull().references(() => salesOrders.id),\n  lineNumber: integer(\"line_number\").notNull(),\n  productId: varchar(\"product_id\").notNull().references(() => products.id),\n  description: text(\"description\"),\n  quantity: decimal(\"quantity\", { precision: 18, scale: 4 }).notNull(),\n  unitPrice: decimal(\"unit_price\", { precision: 18, scale: 4 }).notNull(),\n  discountPercent: decimal(\"discount_percent\", { precision: 5, scale: 2 }).default(\"0\"),\n  taxRate: decimal(\"tax_rate\", { precision: 5, scale: 2 }).default(\"0\"),\n  lineTotal: decimal(\"line_total\", { precision: 18, scale: 2 }).default(\"0\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => ({\n  orderIdx: index(\"sales_order_lines_order_idx\").on(table.salesOrderId),\n}));\n\n// Purchase Orders\nexport const purchaseOrders = pgTable(\"purchase_orders\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  companyId: varchar(\"company_id\").notNull().references(() => companies.id),\n  orderNumber: varchar(\"order_number\", { length: 30 }).notNull(),\n  vendorId: varchar(\"vendor_id\").notNull().references(() => vendors.id),\n  orderDate: timestamp(\"order_date\").notNull().defaultNow(),\n  expectedDate: timestamp(\"expected_date\"),\n  status: varchar(\"status\", { length: 20 }).default(\"draft\"), // draft, ordered, received, billed, cancelled\n  subtotal: decimal(\"subtotal\", { precision: 18, scale: 2 }).default(\"0\"),\n  taxAmount: decimal(\"tax_amount\", { precision: 18, scale: 2 }).default(\"0\"),\n  total: decimal(\"total\", { precision: 18, scale: 2 }).default(\"0\"),\n  fiscalPeriodId: varchar(\"fiscal_period_id\").references(() => companyFiscalPeriods.id),\n  warehouseId: varchar(\"warehouse_id\").references(() => warehouses.id),\n  isIntercompany: boolean(\"is_intercompany\").default(false),\n  counterpartyCompanyId: varchar(\"counterparty_company_id\").references(() => companies.id),\n  linkedSalesOrderId: varchar(\"linked_sales_order_id\"),\n  notes: text(\"notes\"),\n  createdBy: varchar(\"created_by\").references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => ({\n  companyOrderUnique: unique().on(table.companyId, table.orderNumber),\n  companyIdx: index(\"purchase_orders_company_idx\").on(table.companyId),\n  vendorIdx: index(\"purchase_orders_vendor_idx\").on(table.vendorId),\n}));\n\nexport const purchaseOrderLines = pgTable(\"purchase_order_lines\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  purchaseOrderId: varchar(\"purchase_order_id\").notNull().references(() => purchaseOrders.id),\n  lineNumber: integer(\"line_number\").notNull(),\n  productId: varchar(\"product_id\").notNull().references(() => products.id),\n  description: text(\"description\"),\n  quantity: decimal(\"quantity\", { precision: 18, scale: 4 }).notNull(),\n  unitPrice: decimal(\"unit_price\", { precision: 18, scale: 4 }).notNull(),\n  taxRate: decimal(\"tax_rate\", { precision: 5, scale: 2 }).default(\"0\"),\n  lineTotal: decimal(\"line_total\", { precision: 18, scale: 2 }).default(\"0\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => ({\n  orderIdx: index(\"purchase_order_lines_order_idx\").on(table.purchaseOrderId),\n}));\n\n// ============================================================================\n// INTER-COMPANY TRANSACTIONS\n// ============================================================================\n\n// Inter-company stock transfers\nexport const intercompanyTransfers = pgTable(\"intercompany_transfers\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  transferNumber: varchar(\"transfer_number\", { length: 30 }).notNull().unique(),\n  sourceCompanyId: varchar(\"source_company_id\").notNull().references(() => companies.id),\n  targetCompanyId: varchar(\"target_company_id\").notNull().references(() => companies.id),\n  sourceWarehouseId: varchar(\"source_warehouse_id\").notNull().references(() => warehouses.id),\n  targetWarehouseId: varchar(\"target_warehouse_id\").notNull().references(() => warehouses.id),\n  transferDate: timestamp(\"transfer_date\").notNull().defaultNow(),\n  status: varchar(\"status\", { length: 20 }).default(\"draft\"), // draft, in_transit, received, completed, cancelled\n  totalValue: decimal(\"total_value\", { precision: 18, scale: 2 }).default(\"0\"),\n  sourceSalesOrderId: varchar(\"source_sales_order_id\").references(() => salesOrders.id),\n  targetPurchaseOrderId: varchar(\"target_purchase_order_id\").references(() => purchaseOrders.id),\n  notes: text(\"notes\"),\n  createdBy: varchar(\"created_by\").references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => ({\n  sourceCompanyIdx: index(\"ic_transfers_source_idx\").on(table.sourceCompanyId),\n  targetCompanyIdx: index(\"ic_transfers_target_idx\").on(table.targetCompanyId),\n}));\n\n// Journal entries (company-scoped with IC support)\nexport const journalEntries = pgTable(\"journal_entries\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  companyId: varchar(\"company_id\").notNull().references(() => companies.id),\n  entryNumber: varchar(\"entry_number\", { length: 30 }).notNull(),\n  entryDate: timestamp(\"entry_date\").notNull().defaultNow(),\n  fiscalPeriodId: varchar(\"fiscal_period_id\").references(() => companyFiscalPeriods.id),\n  description: text(\"description\"),\n  reference: text(\"reference\"),\n  sourceDocument: varchar(\"source_document\", { length: 50 }),\n  sourceDocumentId: varchar(\"source_document_id\"),\n  status: varchar(\"status\", { length: 20 }).default(\"draft\"), // draft, posted, reversed\n  totalDebit: decimal(\"total_debit\", { precision: 18, scale: 2 }).default(\"0\"),\n  totalCredit: decimal(\"total_credit\", { precision: 18, scale: 2 }).default(\"0\"),\n  isIntercompany: boolean(\"is_intercompany\").default(false),\n  counterpartyCompanyId: varchar(\"counterparty_company_id\").references(() => companies.id),\n  eliminationGroupId: varchar(\"elimination_group_id\"), // For consolidation elimination\n  postedBy: varchar(\"posted_by\").references(() => users.id),\n  postedAt: timestamp(\"posted_at\"),\n  createdBy: varchar(\"created_by\").references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => ({\n  companyEntryUnique: unique().on(table.companyId, table.entryNumber),\n  companyIdx: index(\"journal_entries_company_idx\").on(table.companyId),\n  periodIdx: index(\"journal_entries_period_idx\").on(table.fiscalPeriodId),\n}));\n\n// Journal entry lines\nexport const journalEntryLines = pgTable(\"journal_entry_lines\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  journalEntryId: varchar(\"journal_entry_id\").notNull().references(() => journalEntries.id),\n  lineNumber: integer(\"line_number\").notNull(),\n  accountId: varchar(\"account_id\").notNull().references(() => chartOfAccounts.id),\n  description: text(\"description\"),\n  debit: decimal(\"debit\", { precision: 18, scale: 2 }).default(\"0\"),\n  credit: decimal(\"credit\", { precision: 18, scale: 2 }).default(\"0\"),\n  isIntercompany: boolean(\"is_intercompany\").default(false),\n  counterpartyCompanyId: varchar(\"counterparty_company_id\").references(() => companies.id),\n  counterpartyAccountId: varchar(\"counterparty_account_id\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => ({\n  entryIdx: index(\"journal_lines_entry_idx\").on(table.journalEntryId),\n}));\n\n// ============================================================================\n// INVENTORY MANAGEMENT\n// ============================================================================\n\n// Stock levels per product/warehouse\nexport const stockLevels = pgTable(\"stock_levels\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  companyId: varchar(\"company_id\").notNull().references(() => companies.id),\n  productId: varchar(\"product_id\").notNull().references(() => products.id),\n  warehouseId: varchar(\"warehouse_id\").notNull().references(() => warehouses.id),\n  quantityOnHand: decimal(\"quantity_on_hand\", { precision: 18, scale: 4 }).default(\"0\"),\n  quantityReserved: decimal(\"quantity_reserved\", { precision: 18, scale: 4 }).default(\"0\"),\n  quantityAvailable: decimal(\"quantity_available\", { precision: 18, scale: 4 }).default(\"0\"),\n  quantityOnOrder: decimal(\"quantity_on_order\", { precision: 18, scale: 4 }).default(\"0\"),\n  averageCost: decimal(\"average_cost\", { precision: 18, scale: 4 }).default(\"0\"),\n  lastMovementDate: timestamp(\"last_movement_date\"),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => ({\n  productWarehouseUnique: unique().on(table.companyId, table.productId, table.warehouseId),\n  companyIdx: index(\"stock_levels_company_idx\").on(table.companyId),\n  productIdx: index(\"stock_levels_product_idx\").on(table.productId),\n  warehouseIdx: index(\"stock_levels_warehouse_idx\").on(table.warehouseId),\n}));\n\n// Stock movements for audit trail\nexport const stockMovements = pgTable(\"stock_movements\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  companyId: varchar(\"company_id\").notNull().references(() => companies.id),\n  movementNumber: varchar(\"movement_number\", { length: 30 }).notNull(),\n  productId: varchar(\"product_id\").notNull().references(() => products.id),\n  warehouseId: varchar(\"warehouse_id\").notNull().references(() => warehouses.id),\n  movementType: varchar(\"movement_type\", { length: 20 }).notNull(), // receipt, issue, transfer_in, transfer_out, adjustment\n  movementDate: timestamp(\"movement_date\").notNull().defaultNow(),\n  quantity: decimal(\"quantity\", { precision: 18, scale: 4 }).notNull(),\n  unitCost: decimal(\"unit_cost\", { precision: 18, scale: 4 }).default(\"0\"),\n  totalCost: decimal(\"total_cost\", { precision: 18, scale: 4 }).default(\"0\"),\n  sourceDocument: varchar(\"source_document\", { length: 50 }), // sales_order, purchase_order, delivery, goods_receipt, adjustment\n  sourceDocumentId: varchar(\"source_document_id\"),\n  sourceDocumentNumber: varchar(\"source_document_number\", { length: 30 }),\n  reference: text(\"reference\"),\n  journalEntryId: varchar(\"journal_entry_id\").references(() => journalEntries.id),\n  createdBy: varchar(\"created_by\").references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => ({\n  companyMovementUnique: unique().on(table.companyId, table.movementNumber),\n  companyIdx: index(\"stock_movements_company_idx\").on(table.companyId),\n  productIdx: index(\"stock_movements_product_idx\").on(table.productId),\n  warehouseIdx: index(\"stock_movements_warehouse_idx\").on(table.warehouseId),\n  sourceIdx: index(\"stock_movements_source_idx\").on(table.sourceDocument, table.sourceDocumentId),\n}));\n\n// Stock reservations for sales orders\nexport const stockReservations = pgTable(\"stock_reservations\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  companyId: varchar(\"company_id\").notNull().references(() => companies.id),\n  salesOrderId: varchar(\"sales_order_id\").notNull().references(() => salesOrders.id),\n  salesOrderLineId: varchar(\"sales_order_line_id\"),\n  productId: varchar(\"product_id\").notNull().references(() => products.id),\n  warehouseId: varchar(\"warehouse_id\").notNull().references(() => warehouses.id),\n  quantityReserved: decimal(\"quantity_reserved\", { precision: 18, scale: 4 }).notNull(),\n  quantityFulfilled: decimal(\"quantity_fulfilled\", { precision: 18, scale: 4 }).default(\"0\"),\n  status: varchar(\"status\", { length: 20 }).default(\"active\"), // active, fulfilled, cancelled\n  reservedAt: timestamp(\"reserved_at\").defaultNow(),\n  fulfilledAt: timestamp(\"fulfilled_at\"),\n  createdBy: varchar(\"created_by\").references(() => users.id),\n}, (table) => ({\n  salesOrderProductUnique: unique().on(table.salesOrderId, table.productId, table.warehouseId),\n  companyIdx: index(\"stock_reservations_company_idx\").on(table.companyId),\n  salesOrderIdx: index(\"stock_reservations_so_idx\").on(table.salesOrderId),\n  productIdx: index(\"stock_reservations_product_idx\").on(table.productId),\n}));\n\n// ============================================================================\n// DELIVERIES / SHIPPING\n// ============================================================================\n\n// Delivery notes / Shipping documents\nexport const deliveries = pgTable(\"deliveries\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  companyId: varchar(\"company_id\").notNull().references(() => companies.id),\n  deliveryNumber: varchar(\"delivery_number\", { length: 30 }).notNull(),\n  salesOrderId: varchar(\"sales_order_id\").notNull().references(() => salesOrders.id),\n  customerId: varchar(\"customer_id\").notNull().references(() => customers.id),\n  warehouseId: varchar(\"warehouse_id\").notNull().references(() => warehouses.id),\n  deliveryDate: timestamp(\"delivery_date\").notNull().defaultNow(),\n  status: varchar(\"status\", { length: 20 }).default(\"draft\"), // draft, shipped, delivered, cancelled\n  shippingAddress: text(\"shipping_address\"),\n  shippingMethod: varchar(\"shipping_method\", { length: 50 }),\n  trackingNumber: varchar(\"tracking_number\", { length: 100 }),\n  notes: text(\"notes\"),\n  journalEntryId: varchar(\"journal_entry_id\").references(() => journalEntries.id),\n  createdBy: varchar(\"created_by\").references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => ({\n  companyDeliveryUnique: unique().on(table.companyId, table.deliveryNumber),\n  companyIdx: index(\"deliveries_company_idx\").on(table.companyId),\n  salesOrderIdx: index(\"deliveries_so_idx\").on(table.salesOrderId),\n  customerIdx: index(\"deliveries_customer_idx\").on(table.customerId),\n}));\n\n// Delivery line items\nexport const deliveryLines = pgTable(\"delivery_lines\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  deliveryId: varchar(\"delivery_id\").notNull().references(() => deliveries.id),\n  lineNumber: integer(\"line_number\").notNull(),\n  productId: varchar(\"product_id\").notNull().references(() => products.id),\n  description: text(\"description\"),\n  quantityOrdered: decimal(\"quantity_ordered\", { precision: 18, scale: 4 }).notNull(),\n  quantityDelivered: decimal(\"quantity_delivered\", { precision: 18, scale: 4 }).notNull(),\n  unitCost: decimal(\"unit_cost\", { precision: 18, scale: 4 }).default(\"0\"),\n  totalCost: decimal(\"total_cost\", { precision: 18, scale: 4 }).default(\"0\"),\n  stockMovementId: varchar(\"stock_movement_id\").references(() => stockMovements.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => ({\n  deliveryIdx: index(\"delivery_lines_delivery_idx\").on(table.deliveryId),\n}));\n\n// ============================================================================\n// GOODS RECEIPTS (Purchase receiving)\n// ============================================================================\n\nexport const goodsReceipts = pgTable(\"goods_receipts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  companyId: varchar(\"company_id\").notNull().references(() => companies.id),\n  receiptNumber: varchar(\"receipt_number\", { length: 30 }).notNull(),\n  purchaseOrderId: varchar(\"purchase_order_id\").notNull().references(() => purchaseOrders.id),\n  vendorId: varchar(\"vendor_id\").notNull().references(() => vendors.id),\n  warehouseId: varchar(\"warehouse_id\").notNull().references(() => warehouses.id),\n  receiptDate: timestamp(\"receipt_date\").notNull().defaultNow(),\n  status: varchar(\"status\", { length: 20 }).default(\"draft\"), // draft, received, cancelled\n  notes: text(\"notes\"),\n  journalEntryId: varchar(\"journal_entry_id\").references(() => journalEntries.id),\n  createdBy: varchar(\"created_by\").references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => ({\n  companyReceiptUnique: unique().on(table.companyId, table.receiptNumber),\n  companyIdx: index(\"goods_receipts_company_idx\").on(table.companyId),\n  purchaseOrderIdx: index(\"goods_receipts_po_idx\").on(table.purchaseOrderId),\n  vendorIdx: index(\"goods_receipts_vendor_idx\").on(table.vendorId),\n}));\n\nexport const goodsReceiptLines = pgTable(\"goods_receipt_lines\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  goodsReceiptId: varchar(\"goods_receipt_id\").notNull().references(() => goodsReceipts.id),\n  lineNumber: integer(\"line_number\").notNull(),\n  productId: varchar(\"product_id\").notNull().references(() => products.id),\n  description: text(\"description\"),\n  quantityOrdered: decimal(\"quantity_ordered\", { precision: 18, scale: 4 }).notNull(),\n  quantityReceived: decimal(\"quantity_received\", { precision: 18, scale: 4 }).notNull(),\n  unitCost: decimal(\"unit_cost\", { precision: 18, scale: 4 }).default(\"0\"),\n  totalCost: decimal(\"total_cost\", { precision: 18, scale: 4 }).default(\"0\"),\n  stockMovementId: varchar(\"stock_movement_id\").references(() => stockMovements.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => ({\n  receiptIdx: index(\"goods_receipt_lines_receipt_idx\").on(table.goodsReceiptId),\n}));\n\n// ============================================================================\n// INVOICES (AR/AP)\n// ============================================================================\n\nexport const invoices = pgTable(\"invoices\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  companyId: varchar(\"company_id\").notNull().references(() => companies.id),\n  invoiceNumber: varchar(\"invoice_number\", { length: 30 }).notNull(),\n  invoiceType: varchar(\"invoice_type\", { length: 20 }).notNull(), // customer (AR), vendor (AP)\n  customerId: varchar(\"customer_id\").references(() => customers.id),\n  vendorId: varchar(\"vendor_id\").references(() => vendors.id),\n  salesOrderId: varchar(\"sales_order_id\").references(() => salesOrders.id),\n  purchaseOrderId: varchar(\"purchase_order_id\").references(() => purchaseOrders.id),\n  deliveryId: varchar(\"delivery_id\").references(() => deliveries.id),\n  goodsReceiptId: varchar(\"goods_receipt_id\").references(() => goodsReceipts.id),\n  invoiceDate: timestamp(\"invoice_date\").notNull().defaultNow(),\n  dueDate: timestamp(\"due_date\"),\n  fiscalPeriodId: varchar(\"fiscal_period_id\").references(() => companyFiscalPeriods.id),\n  status: varchar(\"status\", { length: 20 }).default(\"draft\"), // draft, posted, partially_paid, paid, cancelled\n  subtotal: decimal(\"subtotal\", { precision: 18, scale: 2 }).default(\"0\"),\n  taxAmount: decimal(\"tax_amount\", { precision: 18, scale: 2 }).default(\"0\"),\n  total: decimal(\"total\", { precision: 18, scale: 2 }).default(\"0\"),\n  amountPaid: decimal(\"amount_paid\", { precision: 18, scale: 2 }).default(\"0\"),\n  amountDue: decimal(\"amount_due\", { precision: 18, scale: 2 }).default(\"0\"),\n  currency: varchar(\"currency\", { length: 3 }).default(\"IDR\"),\n  notes: text(\"notes\"),\n  journalEntryId: varchar(\"journal_entry_id\").references(() => journalEntries.id),\n  createdBy: varchar(\"created_by\").references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => ({\n  companyInvoiceUnique: unique().on(table.companyId, table.invoiceNumber),\n  companyIdx: index(\"invoices_company_idx\").on(table.companyId),\n  customerIdx: index(\"invoices_customer_idx\").on(table.customerId),\n  vendorIdx: index(\"invoices_vendor_idx\").on(table.vendorId),\n  salesOrderIdx: index(\"invoices_so_idx\").on(table.salesOrderId),\n  purchaseOrderIdx: index(\"invoices_po_idx\").on(table.purchaseOrderId),\n}));\n\nexport const invoiceLines = pgTable(\"invoice_lines\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  invoiceId: varchar(\"invoice_id\").notNull().references(() => invoices.id),\n  lineNumber: integer(\"line_number\").notNull(),\n  productId: varchar(\"product_id\").references(() => products.id),\n  description: text(\"description\"),\n  quantity: decimal(\"quantity\", { precision: 18, scale: 4 }).default(\"1\"),\n  unitPrice: decimal(\"unit_price\", { precision: 18, scale: 4 }).default(\"0\"),\n  discountPercent: decimal(\"discount_percent\", { precision: 5, scale: 2 }).default(\"0\"),\n  taxRate: decimal(\"tax_rate\", { precision: 5, scale: 2 }).default(\"0\"),\n  lineTotal: decimal(\"line_total\", { precision: 18, scale: 2 }).default(\"0\"),\n  accountId: varchar(\"account_id\").references(() => chartOfAccounts.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => ({\n  invoiceIdx: index(\"invoice_lines_invoice_idx\").on(table.invoiceId),\n}));\n\n// ============================================================================\n// PAYMENTS\n// ============================================================================\n\nexport const payments = pgTable(\"payments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  companyId: varchar(\"company_id\").notNull().references(() => companies.id),\n  paymentNumber: varchar(\"payment_number\", { length: 30 }).notNull(),\n  paymentType: varchar(\"payment_type\", { length: 20 }).notNull(), // receipt (from customer), payment (to vendor)\n  customerId: varchar(\"customer_id\").references(() => customers.id),\n  vendorId: varchar(\"vendor_id\").references(() => vendors.id),\n  paymentDate: timestamp(\"payment_date\").notNull().defaultNow(),\n  fiscalPeriodId: varchar(\"fiscal_period_id\").references(() => companyFiscalPeriods.id),\n  paymentMethod: varchar(\"payment_method\", { length: 30 }), // cash, bank_transfer, check, credit_card\n  bankAccountId: varchar(\"bank_account_id\").references(() => chartOfAccounts.id),\n  amount: decimal(\"amount\", { precision: 18, scale: 2 }).notNull(),\n  currency: varchar(\"currency\", { length: 3 }).default(\"IDR\"),\n  exchangeRate: decimal(\"exchange_rate\", { precision: 18, scale: 8 }).default(\"1\"),\n  reference: varchar(\"reference\", { length: 100 }),\n  notes: text(\"notes\"),\n  status: varchar(\"status\", { length: 20 }).default(\"draft\"), // draft, posted, cancelled\n  journalEntryId: varchar(\"journal_entry_id\").references(() => journalEntries.id),\n  createdBy: varchar(\"created_by\").references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => ({\n  companyPaymentUnique: unique().on(table.companyId, table.paymentNumber),\n  companyIdx: index(\"payments_company_idx\").on(table.companyId),\n  customerIdx: index(\"payments_customer_idx\").on(table.customerId),\n  vendorIdx: index(\"payments_vendor_idx\").on(table.vendorId),\n}));\n\n// Payment applications to invoices\nexport const paymentApplications = pgTable(\"payment_applications\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  paymentId: varchar(\"payment_id\").notNull().references(() => payments.id),\n  invoiceId: varchar(\"invoice_id\").notNull().references(() => invoices.id),\n  amountApplied: decimal(\"amount_applied\", { precision: 18, scale: 2 }).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => ({\n  paymentIdx: index(\"payment_applications_payment_idx\").on(table.paymentId),\n  invoiceIdx: index(\"payment_applications_invoice_idx\").on(table.invoiceId),\n}));\n\n// ============================================================================\n// AR/AP LEDGER\n// ============================================================================\n\nexport const arApLedger = pgTable(\"ar_ap_ledger\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  companyId: varchar(\"company_id\").notNull().references(() => companies.id),\n  ledgerType: varchar(\"ledger_type\", { length: 10 }).notNull(), // AR, AP\n  customerId: varchar(\"customer_id\").references(() => customers.id),\n  vendorId: varchar(\"vendor_id\").references(() => vendors.id),\n  transactionDate: timestamp(\"transaction_date\").notNull().defaultNow(),\n  transactionType: varchar(\"transaction_type\", { length: 20 }).notNull(), // invoice, payment, credit_memo, debit_memo\n  documentId: varchar(\"document_id\").notNull(),\n  documentNumber: varchar(\"document_number\", { length: 30 }).notNull(),\n  description: text(\"description\"),\n  debitAmount: decimal(\"debit_amount\", { precision: 18, scale: 2 }).default(\"0\"),\n  creditAmount: decimal(\"credit_amount\", { precision: 18, scale: 2 }).default(\"0\"),\n  runningBalance: decimal(\"running_balance\", { precision: 18, scale: 2 }).default(\"0\"),\n  currency: varchar(\"currency\", { length: 3 }).default(\"IDR\"),\n  journalEntryId: varchar(\"journal_entry_id\").references(() => journalEntries.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => ({\n  companyIdx: index(\"ar_ap_ledger_company_idx\").on(table.companyId),\n  customerIdx: index(\"ar_ap_ledger_customer_idx\").on(table.customerId),\n  vendorIdx: index(\"ar_ap_ledger_vendor_idx\").on(table.vendorId),\n  dateIdx: index(\"ar_ap_ledger_date_idx\").on(table.transactionDate),\n}));\n\n// ============================================================================\n// DOCUMENT SEQUENCES\n// ============================================================================\n\nexport const documentSequences = pgTable(\"document_sequences\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  companyId: varchar(\"company_id\").notNull().references(() => companies.id),\n  documentType: varchar(\"document_type\", { length: 30 }).notNull(), // SO, PO, INV, PAY, DEL, GR, JE, SM\n  prefix: varchar(\"prefix\", { length: 10 }),\n  suffix: varchar(\"suffix\", { length: 10 }),\n  currentNumber: integer(\"current_number\").notNull().default(0),\n  numberLength: integer(\"number_length\").default(6),\n  fiscalYear: integer(\"fiscal_year\"),\n  resetAnnually: boolean(\"reset_annually\").default(false),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => ({\n  companyDocTypeUnique: unique().on(table.companyId, table.documentType, table.fiscalYear),\n  companyIdx: index(\"document_sequences_company_idx\").on(table.companyId),\n}));\n\n// ============================================================================\n// CONSOLIDATION\n// ============================================================================\n\n// Currency exchange rates for consolidation\nexport const exchangeRates = pgTable(\"exchange_rates\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  fromCurrency: varchar(\"from_currency\", { length: 3 }).notNull(),\n  toCurrency: varchar(\"to_currency\", { length: 3 }).notNull(),\n  rate: decimal(\"rate\", { precision: 18, scale: 8 }).notNull(),\n  rateType: varchar(\"rate_type\", { length: 20 }).default(\"spot\"), // spot, average, closing\n  effectiveDate: timestamp(\"effective_date\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => ({\n  currencyDateUnique: unique().on(table.fromCurrency, table.toCurrency, table.rateType, table.effectiveDate),\n}));\n\n// Consolidation runs/snapshots\nexport const consolidationRuns = pgTable(\"consolidation_runs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  parentCompanyId: varchar(\"parent_company_id\").notNull().references(() => companies.id),\n  runDate: timestamp(\"run_date\").notNull().defaultNow(),\n  asOfDate: timestamp(\"as_of_date\").notNull(),\n  fiscalPeriodId: varchar(\"fiscal_period_id\"),\n  includedCompanyIds: jsonb(\"included_company_ids\").notNull(), // Array of company IDs\n  rateSetId: varchar(\"rate_set_id\"),\n  status: varchar(\"status\", { length: 20 }).default(\"draft\"), // draft, completed, approved\n  consolidatedData: jsonb(\"consolidated_data\"), // Snapshot of consolidated TB/FS\n  eliminationEntries: jsonb(\"elimination_entries\"),\n  createdBy: varchar(\"created_by\").references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  approvedBy: varchar(\"approved_by\").references(() => users.id),\n  approvedAt: timestamp(\"approved_at\"),\n});\n\n// ============================================================================\n// INSERT SCHEMAS & TYPES\n// ============================================================================\n\n// Company schemas\n// Insert schema with strict validation for 3-level hierarchy\nconst baseInsertCompanySchema = createInsertSchema(companies).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n  // Level and path are auto-calculated based on parent, don't allow client to set\n  level: true,\n  path: true,\n});\n\n// Enforce only valid company types\nexport const insertCompanySchema = baseInsertCompanySchema.extend({\n  companyType: z.enum([COMPANY_TYPES.HOLDING, COMPANY_TYPES.SUBSIDIARY, COMPANY_TYPES.BRANCH]),\n  // Path is optional - will be auto-calculated if not provided\n  path: z.string().optional(),\n});\nexport type InsertCompany = z.infer<typeof insertCompanySchema>;\nexport type Company = typeof companies.$inferSelect;\n\n// Company Settings schemas\nexport const insertCompanySettingsSchema = createInsertSchema(companySettings).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\nexport type InsertCompanySettings = z.infer<typeof insertCompanySettingsSchema>;\nexport type CompanySettings = typeof companySettings.$inferSelect;\n\n// Fiscal Period schemas\nexport const insertFiscalPeriodSchema = createInsertSchema(companyFiscalPeriods).omit({\n  id: true,\n  createdAt: true,\n});\nexport type InsertFiscalPeriod = z.infer<typeof insertFiscalPeriodSchema>;\nexport type FiscalPeriod = typeof companyFiscalPeriods.$inferSelect;\n\n// Role schemas\nexport const insertRoleSchema = createInsertSchema(roles).omit({\n  id: true,\n  createdAt: true,\n});\nexport type InsertRole = z.infer<typeof insertRoleSchema>;\nexport type Role = typeof roles.$inferSelect;\n\n// User schemas\nexport const insertUserSchema = createInsertSchema(users).pick({\n  username: true,\n  password: true,\n  email: true,\n  fullName: true,\n});\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\n\n// User Company Role schemas\nexport const insertUserCompanyRoleSchema = createInsertSchema(userCompanyRoles).omit({\n  id: true,\n  grantedAt: true,\n});\nexport type InsertUserCompanyRole = z.infer<typeof insertUserCompanyRoleSchema>;\nexport type UserCompanyRole = typeof userCompanyRoles.$inferSelect;\n\n// Refresh Token schemas\nexport const insertRefreshTokenSchema = createInsertSchema(refreshTokens).omit({\n  id: true,\n  issuedAt: true,\n});\nexport type InsertRefreshToken = z.infer<typeof insertRefreshTokenSchema>;\nexport type RefreshToken = typeof refreshTokens.$inferSelect;\n\n// Auth Audit Log schemas\nexport const insertAuthAuditLogSchema = createInsertSchema(authAuditLog).omit({\n  id: true,\n  createdAt: true,\n});\nexport type InsertAuthAuditLog = z.infer<typeof insertAuthAuditLogSchema>;\nexport type AuthAuditLog = typeof authAuditLog.$inferSelect;\n\n// Chart of Accounts schemas\nexport const insertAccountSchema = createInsertSchema(chartOfAccounts).omit({\n  id: true,\n  createdAt: true,\n});\nexport type InsertAccount = z.infer<typeof insertAccountSchema>;\nexport type Account = typeof chartOfAccounts.$inferSelect;\n\n// Warehouse schemas\nexport const insertWarehouseSchema = createInsertSchema(warehouses).omit({\n  id: true,\n  createdAt: true,\n});\nexport type InsertWarehouse = z.infer<typeof insertWarehouseSchema>;\nexport type Warehouse = typeof warehouses.$inferSelect;\n\n// Product schemas\nexport const insertProductSchema = createInsertSchema(products).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\nexport type InsertProduct = z.infer<typeof insertProductSchema>;\nexport type Product = typeof products.$inferSelect;\n\n// Customer schemas\nexport const insertCustomerSchema = createInsertSchema(customers).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\nexport type InsertCustomer = z.infer<typeof insertCustomerSchema>;\nexport type Customer = typeof customers.$inferSelect;\n\n// Vendor schemas\nexport const insertVendorSchema = createInsertSchema(vendors).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\nexport type InsertVendor = z.infer<typeof insertVendorSchema>;\nexport type Vendor = typeof vendors.$inferSelect;\n\n// Employee schemas\nexport const insertEmployeeSchema = createInsertSchema(employees).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\nexport type InsertEmployee = z.infer<typeof insertEmployeeSchema>;\nexport type Employee = typeof employees.$inferSelect;\n\n// Tax schemas\nexport const insertTaxSchema = createInsertSchema(taxes).omit({\n  id: true,\n  createdAt: true,\n});\nexport type InsertTax = z.infer<typeof insertTaxSchema>;\nexport type Tax = typeof taxes.$inferSelect;\n\n// Sales Order schemas\nexport const insertSalesOrderSchema = createInsertSchema(salesOrders).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\nexport type InsertSalesOrder = z.infer<typeof insertSalesOrderSchema>;\nexport type SalesOrder = typeof salesOrders.$inferSelect;\n\n// Sales Order Line schemas\nexport const insertSalesOrderLineSchema = createInsertSchema(salesOrderLines).omit({\n  id: true,\n  createdAt: true,\n});\nexport type InsertSalesOrderLine = z.infer<typeof insertSalesOrderLineSchema>;\nexport type SalesOrderLine = typeof salesOrderLines.$inferSelect;\n\n// Purchase Order schemas\nexport const insertPurchaseOrderSchema = createInsertSchema(purchaseOrders).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\nexport type InsertPurchaseOrder = z.infer<typeof insertPurchaseOrderSchema>;\nexport type PurchaseOrder = typeof purchaseOrders.$inferSelect;\n\n// Purchase Order Line schemas\nexport const insertPurchaseOrderLineSchema = createInsertSchema(purchaseOrderLines).omit({\n  id: true,\n  createdAt: true,\n});\nexport type InsertPurchaseOrderLine = z.infer<typeof insertPurchaseOrderLineSchema>;\nexport type PurchaseOrderLine = typeof purchaseOrderLines.$inferSelect;\n\n// Intercompany Transfer schemas\nexport const insertIntercompanyTransferSchema = createInsertSchema(intercompanyTransfers).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\nexport type InsertIntercompanyTransfer = z.infer<typeof insertIntercompanyTransferSchema>;\nexport type IntercompanyTransfer = typeof intercompanyTransfers.$inferSelect;\n\n// Journal Entry schemas\nexport const insertJournalEntrySchema = createInsertSchema(journalEntries).omit({\n  id: true,\n  createdAt: true,\n});\nexport type InsertJournalEntry = z.infer<typeof insertJournalEntrySchema>;\nexport type JournalEntry = typeof journalEntries.$inferSelect;\n\n// Journal Entry Line schemas\nexport const insertJournalEntryLineSchema = createInsertSchema(journalEntryLines).omit({\n  id: true,\n  createdAt: true,\n});\nexport type InsertJournalEntryLine = z.infer<typeof insertJournalEntryLineSchema>;\nexport type JournalEntryLine = typeof journalEntryLines.$inferSelect;\n\n// Stock Level schemas\nexport const insertStockLevelSchema = createInsertSchema(stockLevels).omit({\n  id: true,\n  updatedAt: true,\n});\nexport type InsertStockLevel = z.infer<typeof insertStockLevelSchema>;\nexport type StockLevel = typeof stockLevels.$inferSelect;\n\n// Stock Movement schemas\nexport const insertStockMovementSchema = createInsertSchema(stockMovements).omit({\n  id: true,\n  createdAt: true,\n});\nexport type InsertStockMovement = z.infer<typeof insertStockMovementSchema>;\nexport type StockMovement = typeof stockMovements.$inferSelect;\n\n// Stock Reservation schemas\nexport const insertStockReservationSchema = createInsertSchema(stockReservations).omit({\n  id: true,\n  reservedAt: true,\n});\nexport type InsertStockReservation = z.infer<typeof insertStockReservationSchema>;\nexport type StockReservation = typeof stockReservations.$inferSelect;\n\n// Delivery schemas\nexport const insertDeliverySchema = createInsertSchema(deliveries).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\nexport type InsertDelivery = z.infer<typeof insertDeliverySchema>;\nexport type Delivery = typeof deliveries.$inferSelect;\n\n// Delivery Line schemas\nexport const insertDeliveryLineSchema = createInsertSchema(deliveryLines).omit({\n  id: true,\n  createdAt: true,\n});\nexport type InsertDeliveryLine = z.infer<typeof insertDeliveryLineSchema>;\nexport type DeliveryLine = typeof deliveryLines.$inferSelect;\n\n// Goods Receipt schemas\nexport const insertGoodsReceiptSchema = createInsertSchema(goodsReceipts).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\nexport type InsertGoodsReceipt = z.infer<typeof insertGoodsReceiptSchema>;\nexport type GoodsReceipt = typeof goodsReceipts.$inferSelect;\n\n// Goods Receipt Line schemas\nexport const insertGoodsReceiptLineSchema = createInsertSchema(goodsReceiptLines).omit({\n  id: true,\n  createdAt: true,\n});\nexport type InsertGoodsReceiptLine = z.infer<typeof insertGoodsReceiptLineSchema>;\nexport type GoodsReceiptLine = typeof goodsReceiptLines.$inferSelect;\n\n// Invoice schemas\nexport const insertInvoiceSchema = createInsertSchema(invoices).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\nexport type InsertInvoice = z.infer<typeof insertInvoiceSchema>;\nexport type Invoice = typeof invoices.$inferSelect;\n\n// Invoice Line schemas\nexport const insertInvoiceLineSchema = createInsertSchema(invoiceLines).omit({\n  id: true,\n  createdAt: true,\n});\nexport type InsertInvoiceLine = z.infer<typeof insertInvoiceLineSchema>;\nexport type InvoiceLine = typeof invoiceLines.$inferSelect;\n\n// Payment schemas\nexport const insertPaymentSchema = createInsertSchema(payments).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\nexport type InsertPayment = z.infer<typeof insertPaymentSchema>;\nexport type Payment = typeof payments.$inferSelect;\n\n// Payment Application schemas\nexport const insertPaymentApplicationSchema = createInsertSchema(paymentApplications).omit({\n  id: true,\n  createdAt: true,\n});\nexport type InsertPaymentApplication = z.infer<typeof insertPaymentApplicationSchema>;\nexport type PaymentApplication = typeof paymentApplications.$inferSelect;\n\n// AR/AP Ledger schemas\nexport const insertArApLedgerSchema = createInsertSchema(arApLedger).omit({\n  id: true,\n  createdAt: true,\n});\nexport type InsertArApLedger = z.infer<typeof insertArApLedgerSchema>;\nexport type ArApLedger = typeof arApLedger.$inferSelect;\n\n// Document Sequence schemas\nexport const insertDocumentSequenceSchema = createInsertSchema(documentSequences).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\nexport type InsertDocumentSequence = z.infer<typeof insertDocumentSequenceSchema>;\nexport type DocumentSequence = typeof documentSequences.$inferSelect;\n\n// Exchange Rate schemas\nexport const insertExchangeRateSchema = createInsertSchema(exchangeRates).omit({\n  id: true,\n  createdAt: true,\n});\nexport type InsertExchangeRate = z.infer<typeof insertExchangeRateSchema>;\nexport type ExchangeRate = typeof exchangeRates.$inferSelect;\n\n// Consolidation Run schemas\nexport const insertConsolidationRunSchema = createInsertSchema(consolidationRuns).omit({\n  id: true,\n  createdAt: true,\n});\nexport type InsertConsolidationRun = z.infer<typeof insertConsolidationRunSchema>;\nexport type ConsolidationRun = typeof consolidationRuns.$inferSelect;\n\n// Shared Access schemas\nexport const insertSharedAccessSchema = createInsertSchema(sharedAccess).omit({\n  id: true,\n  grantedAt: true,\n});\nexport type InsertSharedAccess = z.infer<typeof insertSharedAccessSchema>;\nexport type SharedAccess = typeof sharedAccess.$inferSelect;\n\n// ============================================================================\n// HELPER TYPES FOR MULTI-COMPANY CONTEXT\n// ============================================================================\n\n// Access rules based on company level\nexport interface HierarchyAccessRules {\n  // Branch (level 3): Can only see its own data\n  // Subsidiary (level 2): Can see its own data + all its Branches\n  // Holding (level 1): Can see all Subsidiaries and their Branches for consolidation\n  canViewCompanyData(viewerCompanyId: string, targetCompanyId: string): boolean;\n  getAccessibleCompanyIds(): string[];\n  canPerformConsolidation(): boolean;\n  canPerformIntercompanyTransaction(targetCompanyId: string): boolean;\n}\n\nexport interface CompanyContext {\n  activeCompanyId: string;\n  activeCompany: Company;\n  userCompanies: Company[];\n  permissions: string[];\n  role: Role | null;\n  // Hierarchy-aware access\n  companyLevel: CompanyLevel;\n  accessibleCompanyIds: string[]; // IDs of companies this user can view data for\n  canConsolidate: boolean; // Only Holding and Subsidiary can consolidate\n  parentCompany: Company | null; // Parent in hierarchy\n  childCompanies: Company[]; // Direct children in hierarchy\n}\n\nexport interface CompanyHierarchyNode {\n  company: Company;\n  children: CompanyHierarchyNode[];\n  level: number;\n}\n\n// Helper to validate company type matches level\nexport function getCompanyTypeForLevel(level: number): CompanyType {\n  switch (level) {\n    case 1: return COMPANY_TYPES.HOLDING;\n    case 2: return COMPANY_TYPES.SUBSIDIARY;\n    case 3: return COMPANY_TYPES.BRANCH;\n    default: throw new Error(`Invalid company level: ${level}. Must be 1 (Holding), 2 (Subsidiary), or 3 (Branch)`);\n  }\n}\n\n// Helper to get level for company type\nexport function getLevelForCompanyType(type: string): CompanyLevel {\n  switch (type) {\n    case COMPANY_TYPES.HOLDING: return COMPANY_LEVELS.HOLDING;\n    case COMPANY_TYPES.SUBSIDIARY: return COMPANY_LEVELS.SUBSIDIARY;\n    case COMPANY_TYPES.BRANCH: return COMPANY_LEVELS.BRANCH;\n    default: throw new Error(`Invalid company type: ${type}. Must be holding, subsidiary, or branch`);\n  }\n}\n\n// ============================================================================\n// JWT AUTHENTICATION TYPES\n// ============================================================================\n\n// JWT Access Token Payload (short-lived, 15 min)\nexport interface JWTAccessTokenPayload {\n  userId: string;\n  username: string;\n  activeCompanyId: string;\n  roleId: string | null;\n  allowedCompanyIds: string[]; // Hierarchy-derived accessible companies\n  companyLevel: CompanyLevel;\n  permissions: string[];\n  iat?: number;  // Issued at\n  exp?: number;  // Expiration\n  jti?: string;  // JWT ID for tracking\n}\n\n// JWT Refresh Token Payload (long-lived, 7 days)\nexport interface JWTRefreshTokenPayload {\n  userId: string;\n  tokenId: string; // Links to refreshTokens table\n  tokenVersion: number; // For rotation\n  iat?: number;\n  exp?: number;\n}\n\n// Auth request context attached to Express request\nexport interface AuthContext {\n  user: User;\n  role: Role | null;\n  activeCompanyId: string;\n  activeCompany: Company;\n  allowedCompanyIds: string[]; // Hierarchy-derived\n  companyLevel: CompanyLevel;\n  permissions: string[];\n  canConsolidate: boolean;\n  isAuthenticated: true;\n}\n\n// Login request schema\nexport const loginSchema = z.object({\n  username: z.string().min(1, \"Username is required\"),\n  password: z.string().min(1, \"Password is required\"),\n  companyId: z.string().optional(), // Optional: specific company to log into\n});\nexport type LoginRequest = z.infer<typeof loginSchema>;\n\n// Login response\nexport interface LoginResponse {\n  accessToken: string;\n  expiresIn: number; // seconds\n  user: {\n    id: string;\n    username: string;\n    email: string | null;\n    fullName: string | null;\n  };\n  activeCompany: {\n    id: string;\n    code: string;\n    name: string;\n    companyType: string;\n    level: number;\n  };\n  role: {\n    id: string;\n    name: string;\n    permissions: string[];\n  } | null;\n  allowedCompanyIds: string[];\n  companyLevel: CompanyLevel;\n  canConsolidate: boolean;\n}\n\n// Token refresh response\nexport interface RefreshResponse {\n  accessToken: string;\n  expiresIn: number;\n}\n\n// Auth event types for audit logging\nexport const AUTH_EVENTS = {\n  LOGIN: \"login\",\n  LOGIN_FAILED: \"login_failed\",\n  LOGOUT: \"logout\",\n  REFRESH: \"refresh\",\n  REFRESH_FAILED: \"refresh_failed\",\n  TOKEN_REVOKED: \"token_revoked\",\n  COMPANY_SWITCHED: \"company_switched\",\n  PASSWORD_CHANGED: \"password_changed\",\n} as const;\nexport type AuthEventType = typeof AUTH_EVENTS[keyof typeof AUTH_EVENTS];\n","path":null,"size_bytes":63759,"size_tokens":null},"client/src/components/examples/LeaveRequests.tsx":{"content":"import { LeaveRequests } from \"../hr/LeaveRequests\";\n\nexport default function LeaveRequestsExample() {\n  return <LeaveRequests />;\n}\n","path":null,"size_bytes":133,"size_tokens":null},"client/src/components/examples/AppSidebar.tsx":{"content":"import { SidebarProvider } from \"@/components/ui/sidebar\";\nimport { AppSidebar } from \"../layout/AppSidebar\";\n\nexport default function AppSidebarExample() {\n  const style = {\n    \"--sidebar-width\": \"16rem\",\n    \"--sidebar-width-icon\": \"3rem\",\n  };\n\n  return (\n    <SidebarProvider style={style as React.CSSProperties}>\n      <div className=\"flex h-[400px] w-full\">\n        <AppSidebar />\n        <div className=\"flex-1 p-6 bg-background\">\n          <p className=\"text-muted-foreground\">Main content area</p>\n        </div>\n      </div>\n    </SidebarProvider>\n  );\n}\n","path":null,"size_bytes":566,"size_tokens":null},"client/src/lib/mockData.ts":{"content":"// todo: remove mock functionality - this file contains all mock data for the ERP prototype\n\nexport const mockCustomers = [\n  { id: \"C001\", name: \"Acme Corporation\", email: \"orders@acme.com\", phone: \"+1 555-0100\", status: \"active\", totalOrders: 45, totalSpent: 125000 },\n  { id: \"C002\", name: \"TechStart Inc.\", email: \"purchasing@techstart.io\", phone: \"+1 555-0101\", status: \"active\", totalOrders: 23, totalSpent: 67500 },\n  { id: \"C003\", name: \"Global Supplies Ltd\", email: \"procurement@globalsupplies.com\", phone: \"+1 555-0102\", status: \"active\", totalOrders: 89, totalSpent: 234000 },\n  { id: \"C004\", name: \"Metro Retail Group\", email: \"buying@metroretail.com\", phone: \"+1 555-0103\", status: \"inactive\", totalOrders: 12, totalSpent: 28900 },\n  { id: \"C005\", name: \"Summit Industries\", email: \"orders@summitind.com\", phone: \"+1 555-0104\", status: \"active\", totalOrders: 67, totalSpent: 189000 },\n];\n\nexport const mockVendors = [\n  { id: \"V001\", name: \"Prime Suppliers Co.\", email: \"sales@primesuppliers.com\", phone: \"+1 555-0200\", status: \"active\", activePOs: 5, totalValue: 45000 },\n  { id: \"V002\", name: \"Quality Materials Inc.\", email: \"orders@qualitymaterials.com\", phone: \"+1 555-0201\", status: \"active\", activePOs: 3, totalValue: 32000 },\n  { id: \"V003\", name: \"FastShip Logistics\", email: \"partners@fastship.com\", phone: \"+1 555-0202\", status: \"active\", activePOs: 2, totalValue: 18500 },\n  { id: \"V004\", name: \"Industrial Parts Ltd\", email: \"sales@industrialparts.co\", phone: \"+1 555-0203\", status: \"pending\", activePOs: 0, totalValue: 0 },\n];\n\nexport const mockProducts = [\n  { id: \"P001\", sku: \"WDG-001\", name: \"Industrial Widget A\", category: \"Widgets\", uom: \"EA\", price: 49.99, stock: 234, minLevel: 50, maxLevel: 500, location: \"A-01-01\" },\n  { id: \"P002\", sku: \"WDG-002\", name: \"Industrial Widget B\", category: \"Widgets\", uom: \"EA\", price: 79.99, stock: 156, minLevel: 30, maxLevel: 300, location: \"A-01-02\" },\n  { id: \"P003\", sku: \"CPT-001\", name: \"Component Alpha\", category: \"Components\", uom: \"EA\", price: 24.50, stock: 12, minLevel: 100, maxLevel: 1000, location: \"B-02-01\" },\n  { id: \"P004\", sku: \"CPT-002\", name: \"Component Beta\", category: \"Components\", uom: \"BOX\", price: 189.00, stock: 89, minLevel: 20, maxLevel: 200, location: \"B-02-02\" },\n  { id: \"P005\", sku: \"MAT-001\", name: \"Raw Material X\", category: \"Materials\", uom: \"KG\", price: 12.75, stock: 2450, minLevel: 500, maxLevel: 5000, location: \"C-03-01\" },\n  { id: \"P006\", sku: \"ASM-001\", name: \"Assembly Kit Pro\", category: \"Assemblies\", uom: \"KIT\", price: 349.00, stock: 45, minLevel: 10, maxLevel: 100, location: \"D-01-01\" },\n];\n\nexport const mockSalesOrders = [\n  { id: \"SO-001\", customerId: \"C001\", customerName: \"Acme Corporation\", date: \"2024-12-01\", status: \"invoiced\", total: 4599.50, items: 3 },\n  { id: \"SO-002\", customerId: \"C002\", customerName: \"TechStart Inc.\", date: \"2024-12-02\", status: \"delivered\", total: 2340.00, items: 2 },\n  { id: \"SO-003\", customerId: \"C003\", customerName: \"Global Supplies Ltd\", date: \"2024-12-03\", status: \"confirmed\", total: 8750.00, items: 5 },\n  { id: \"SO-004\", customerId: \"C001\", customerName: \"Acme Corporation\", date: \"2024-12-04\", status: \"draft\", total: 1250.00, items: 1 },\n  { id: \"SO-005\", customerId: \"C005\", customerName: \"Summit Industries\", date: \"2024-12-05\", status: \"confirmed\", total: 15600.00, items: 8 },\n];\n\nexport const mockPurchaseOrders = [\n  { id: \"PO-001\", vendorId: \"V001\", vendorName: \"Prime Suppliers Co.\", date: \"2024-12-01\", status: \"received\", total: 12500.00, items: 4 },\n  { id: \"PO-002\", vendorId: \"V002\", vendorName: \"Quality Materials Inc.\", date: \"2024-12-02\", status: \"ordered\", total: 8900.00, items: 3 },\n  { id: \"PO-003\", vendorId: \"V001\", vendorName: \"Prime Suppliers Co.\", date: \"2024-12-03\", status: \"draft\", total: 5600.00, items: 2 },\n  { id: \"PO-004\", vendorId: \"V003\", vendorName: \"FastShip Logistics\", date: \"2024-12-04\", status: \"ordered\", total: 3400.00, items: 2 },\n];\n\nexport const mockDeliveries = [\n  { id: \"DEL-001\", orderId: \"SO-001\", customerName: \"Acme Corporation\", date: \"2024-12-03\", status: \"shipped\", items: 3 },\n  { id: \"DEL-002\", orderId: \"SO-002\", customerName: \"TechStart Inc.\", date: \"2024-12-04\", status: \"delivered\", items: 2 },\n  { id: \"DEL-003\", orderId: \"SO-003\", customerName: \"Global Supplies Ltd\", date: \"2024-12-05\", status: \"picking\", items: 5 },\n  { id: \"DEL-004\", orderId: \"SO-005\", customerName: \"Summit Industries\", date: \"2024-12-06\", status: \"packing\", items: 8 },\n];\n\nexport const mockInvoices = [\n  { id: \"INV-001\", orderId: \"SO-001\", customerName: \"Acme Corporation\", date: \"2024-12-03\", dueDate: \"2024-12-18\", status: \"paid\", total: 4599.50 },\n  { id: \"INV-002\", orderId: \"SO-002\", customerName: \"TechStart Inc.\", date: \"2024-12-04\", dueDate: \"2024-12-19\", status: \"unpaid\", total: 2340.00 },\n  { id: \"INV-003\", orderId: \"SO-003\", customerName: \"Global Supplies Ltd\", date: \"2024-12-05\", dueDate: \"2024-12-20\", status: \"partial\", total: 8750.00, paid: 4000.00 },\n];\n\nexport const mockEmployees = [\n  { id: \"E001\", name: \"Sarah Johnson\", email: \"sarah.johnson@unanza.com\", department: \"Sales\", position: \"Sales Manager\", status: \"active\", hireDate: \"2022-03-15\" },\n  { id: \"E002\", name: \"Michael Chen\", email: \"michael.chen@unanza.com\", department: \"Warehouse\", position: \"Warehouse Supervisor\", status: \"active\", hireDate: \"2021-08-01\" },\n  { id: \"E003\", name: \"Emily Rodriguez\", email: \"emily.rodriguez@unanza.com\", department: \"Finance\", position: \"Senior Accountant\", status: \"active\", hireDate: \"2020-01-10\" },\n  { id: \"E004\", name: \"David Kim\", email: \"david.kim@unanza.com\", department: \"HR\", position: \"HR Coordinator\", status: \"active\", hireDate: \"2023-05-20\" },\n  { id: \"E005\", name: \"Lisa Wang\", email: \"lisa.wang@unanza.com\", department: \"Operations\", position: \"Operations Analyst\", status: \"on-leave\", hireDate: \"2022-11-01\" },\n];\n\nexport const mockLeaveRequests = [\n  { id: \"LR-001\", employeeId: \"E001\", employeeName: \"Sarah Johnson\", type: \"vacation\", startDate: \"2024-12-20\", endDate: \"2024-12-27\", status: \"approved\", days: 5 },\n  { id: \"LR-002\", employeeId: \"E003\", employeeName: \"Emily Rodriguez\", type: \"sick\", startDate: \"2024-12-10\", endDate: \"2024-12-11\", status: \"approved\", days: 2 },\n  { id: \"LR-003\", employeeId: \"E002\", employeeName: \"Michael Chen\", type: \"personal\", startDate: \"2024-12-15\", endDate: \"2024-12-15\", status: \"pending\", days: 1 },\n  { id: \"LR-004\", employeeId: \"E005\", employeeName: \"Lisa Wang\", type: \"vacation\", startDate: \"2024-12-01\", endDate: \"2024-12-14\", status: \"approved\", days: 10 },\n];\n\nexport const mockAttendance = [\n  { id: \"ATT-001\", employeeId: \"E001\", employeeName: \"Sarah Johnson\", date: \"2024-12-05\", checkIn: \"08:45\", checkOut: \"17:30\", hours: 8.75, status: \"present\" },\n  { id: \"ATT-002\", employeeId: \"E002\", employeeName: \"Michael Chen\", date: \"2024-12-05\", checkIn: \"07:00\", checkOut: \"15:30\", hours: 8.5, status: \"present\" },\n  { id: \"ATT-003\", employeeId: \"E003\", employeeName: \"Emily Rodriguez\", date: \"2024-12-05\", checkIn: \"09:00\", checkOut: \"18:00\", hours: 9, status: \"present\" },\n  { id: \"ATT-004\", employeeId: \"E004\", employeeName: \"David Kim\", date: \"2024-12-05\", checkIn: \"08:30\", checkOut: \"17:00\", hours: 8.5, status: \"present\" },\n  { id: \"ATT-005\", employeeId: \"E005\", employeeName: \"Lisa Wang\", date: \"2024-12-05\", checkIn: null, checkOut: null, hours: 0, status: \"on-leave\" },\n];\n\n// todo: remove mock functionality - Complete Chart of Accounts with hierarchy\nexport interface ChartOfAccountsEntry {\n  id: string;\n  name: string;\n  type: \"asset\" | \"liability\" | \"equity\" | \"revenue\" | \"expense\";\n  level: 1 | 2 | 3;\n  parentId: string | null;\n  balance: number;\n  isPostable: boolean;\n}\n\nexport const mockAccounts: ChartOfAccountsEntry[] = [\n  // ASSETS (1000-1999)\n  { id: \"1000\", name: \"Assets\", type: \"asset\", level: 1, parentId: null, balance: 0, isPostable: false },\n  \n  // Current Assets (1100-1199)\n  { id: \"1100\", name: \"Current Assets\", type: \"asset\", level: 2, parentId: \"1000\", balance: 0, isPostable: false },\n  \n  // Cash & Bank (1110-1119)\n  { id: \"1110\", name: \"Cash & Bank\", type: \"asset\", level: 2, parentId: \"1100\", balance: 0, isPostable: false },\n  { id: \"1111\", name: \"Cash on Hand\", type: \"asset\", level: 3, parentId: \"1110\", balance: 15000, isPostable: true },\n  { id: \"1112\", name: \"Petty Cash\", type: \"asset\", level: 3, parentId: \"1110\", balance: 2500, isPostable: true },\n  { id: \"1113\", name: \"Checking Account - Main\", type: \"asset\", level: 3, parentId: \"1110\", balance: 85000, isPostable: true },\n  { id: \"1114\", name: \"Savings Account\", type: \"asset\", level: 3, parentId: \"1110\", balance: 45000, isPostable: true },\n  { id: \"1115\", name: \"Money Market Account\", type: \"asset\", level: 3, parentId: \"1110\", balance: 25000, isPostable: true },\n  \n  // Accounts Receivable (1120-1129)\n  { id: \"1120\", name: \"Accounts Receivable\", type: \"asset\", level: 2, parentId: \"1100\", balance: 0, isPostable: false },\n  { id: \"1121\", name: \"Trade Receivables\", type: \"asset\", level: 3, parentId: \"1120\", balance: 45600, isPostable: true },\n  { id: \"1122\", name: \"Employee Receivables\", type: \"asset\", level: 3, parentId: \"1120\", balance: 3200, isPostable: true },\n  { id: \"1123\", name: \"Allowance for Doubtful Accounts\", type: \"asset\", level: 3, parentId: \"1120\", balance: -2500, isPostable: true },\n  { id: \"1124\", name: \"Notes Receivable - Short Term\", type: \"asset\", level: 3, parentId: \"1120\", balance: 12000, isPostable: true },\n  \n  // Inventory (1130-1139)\n  { id: \"1130\", name: \"Inventory\", type: \"asset\", level: 2, parentId: \"1100\", balance: 0, isPostable: false },\n  { id: \"1131\", name: \"Raw Materials\", type: \"asset\", level: 3, parentId: \"1130\", balance: 78500, isPostable: true },\n  { id: \"1132\", name: \"Work in Progress\", type: \"asset\", level: 3, parentId: \"1130\", balance: 45000, isPostable: true },\n  { id: \"1133\", name: \"Finished Goods\", type: \"asset\", level: 3, parentId: \"1130\", balance: 98000, isPostable: true },\n  { id: \"1134\", name: \"Merchandise Inventory\", type: \"asset\", level: 3, parentId: \"1130\", balance: 67000, isPostable: true },\n  { id: \"1135\", name: \"Inventory Reserve\", type: \"asset\", level: 3, parentId: \"1130\", balance: -5000, isPostable: true },\n  \n  // Other Current Assets (1140-1149)\n  { id: \"1140\", name: \"Other Current Assets\", type: \"asset\", level: 2, parentId: \"1100\", balance: 0, isPostable: false },\n  { id: \"1141\", name: \"Prepaid Insurance\", type: \"asset\", level: 3, parentId: \"1140\", balance: 8500, isPostable: true },\n  { id: \"1142\", name: \"Prepaid Rent\", type: \"asset\", level: 3, parentId: \"1140\", balance: 12000, isPostable: true },\n  { id: \"1143\", name: \"Prepaid Expenses - Other\", type: \"asset\", level: 3, parentId: \"1140\", balance: 4500, isPostable: true },\n  \n  // Fixed Assets (1200-1299)\n  { id: \"1200\", name: \"Fixed Assets\", type: \"asset\", level: 2, parentId: \"1000\", balance: 0, isPostable: false },\n  { id: \"1210\", name: \"Land\", type: \"asset\", level: 3, parentId: \"1200\", balance: 150000, isPostable: true },\n  { id: \"1220\", name: \"Buildings\", type: \"asset\", level: 3, parentId: \"1200\", balance: 450000, isPostable: true },\n  { id: \"1221\", name: \"Accumulated Depreciation - Buildings\", type: \"asset\", level: 3, parentId: \"1200\", balance: -95000, isPostable: true },\n  { id: \"1230\", name: \"Machinery & Equipment\", type: \"asset\", level: 3, parentId: \"1200\", balance: 285000, isPostable: true },\n  { id: \"1231\", name: \"Accumulated Depreciation - Machinery\", type: \"asset\", level: 3, parentId: \"1200\", balance: -78000, isPostable: true },\n  { id: \"1240\", name: \"Vehicles\", type: \"asset\", level: 3, parentId: \"1200\", balance: 125000, isPostable: true },\n  { id: \"1241\", name: \"Accumulated Depreciation - Vehicles\", type: \"asset\", level: 3, parentId: \"1200\", balance: -45000, isPostable: true },\n  { id: \"1250\", name: \"Furniture & Fixtures\", type: \"asset\", level: 3, parentId: \"1200\", balance: 65000, isPostable: true },\n  { id: \"1251\", name: \"Accumulated Depreciation - Furniture\", type: \"asset\", level: 3, parentId: \"1200\", balance: -18000, isPostable: true },\n  { id: \"1260\", name: \"Computer Equipment\", type: \"asset\", level: 3, parentId: \"1200\", balance: 85000, isPostable: true },\n  { id: \"1261\", name: \"Accumulated Depreciation - Computers\", type: \"asset\", level: 3, parentId: \"1200\", balance: -32000, isPostable: true },\n  \n  // LIABILITIES (2000-2999)\n  { id: \"2000\", name: \"Liabilities\", type: \"liability\", level: 1, parentId: null, balance: 0, isPostable: false },\n  \n  // Current Liabilities (2100-2199)\n  { id: \"2100\", name: \"Current Liabilities\", type: \"liability\", level: 2, parentId: \"2000\", balance: 0, isPostable: false },\n  \n  // Accounts Payable (2110-2119)\n  { id: \"2110\", name: \"Accounts Payable\", type: \"liability\", level: 2, parentId: \"2100\", balance: 0, isPostable: false },\n  { id: \"2111\", name: \"Trade Payables\", type: \"liability\", level: 3, parentId: \"2110\", balance: 28900, isPostable: true },\n  { id: \"2112\", name: \"Vendor Advances\", type: \"liability\", level: 3, parentId: \"2110\", balance: 5500, isPostable: true },\n  { id: \"2113\", name: \"Notes Payable - Short Term\", type: \"liability\", level: 3, parentId: \"2110\", balance: 15000, isPostable: true },\n  \n  // Accrued Expenses (2120-2129)\n  { id: \"2120\", name: \"Accrued Expenses\", type: \"liability\", level: 2, parentId: \"2100\", balance: 0, isPostable: false },\n  { id: \"2121\", name: \"Accrued Salaries & Wages\", type: \"liability\", level: 3, parentId: \"2120\", balance: 18500, isPostable: true },\n  { id: \"2122\", name: \"Accrued Payroll Taxes\", type: \"liability\", level: 3, parentId: \"2120\", balance: 7200, isPostable: true },\n  { id: \"2123\", name: \"Accrued Interest\", type: \"liability\", level: 3, parentId: \"2120\", balance: 3400, isPostable: true },\n  { id: \"2124\", name: \"Accrued Utilities\", type: \"liability\", level: 3, parentId: \"2120\", balance: 2800, isPostable: true },\n  \n  // Taxes Payable (2130-2139)\n  { id: \"2130\", name: \"Taxes Payable\", type: \"liability\", level: 2, parentId: \"2100\", balance: 0, isPostable: false },\n  { id: \"2131\", name: \"Sales Tax Payable\", type: \"liability\", level: 3, parentId: \"2130\", balance: 8900, isPostable: true },\n  { id: \"2132\", name: \"Income Tax Payable\", type: \"liability\", level: 3, parentId: \"2130\", balance: 22000, isPostable: true },\n  { id: \"2133\", name: \"Payroll Tax Payable\", type: \"liability\", level: 3, parentId: \"2130\", balance: 6500, isPostable: true },\n  \n  // Other Current Liabilities (2140-2149)\n  { id: \"2140\", name: \"Other Current Liabilities\", type: \"liability\", level: 2, parentId: \"2100\", balance: 0, isPostable: false },\n  { id: \"2141\", name: \"Customer Deposits\", type: \"liability\", level: 3, parentId: \"2140\", balance: 12500, isPostable: true },\n  { id: \"2142\", name: \"Unearned Revenue\", type: \"liability\", level: 3, parentId: \"2140\", balance: 8000, isPostable: true },\n  { id: \"2143\", name: \"Current Portion - Long Term Debt\", type: \"liability\", level: 3, parentId: \"2140\", balance: 24000, isPostable: true },\n  \n  // Long-Term Liabilities (2200-2299)\n  { id: \"2200\", name: \"Long-Term Liabilities\", type: \"liability\", level: 2, parentId: \"2000\", balance: 0, isPostable: false },\n  { id: \"2210\", name: \"Bank Loans - Long Term\", type: \"liability\", level: 3, parentId: \"2200\", balance: 150000, isPostable: true },\n  { id: \"2220\", name: \"Mortgage Payable\", type: \"liability\", level: 3, parentId: \"2200\", balance: 280000, isPostable: true },\n  { id: \"2230\", name: \"Equipment Loans\", type: \"liability\", level: 3, parentId: \"2200\", balance: 75000, isPostable: true },\n  \n  // EQUITY (3000-3999)\n  { id: \"3000\", name: \"Equity\", type: \"equity\", level: 1, parentId: null, balance: 0, isPostable: false },\n  \n  // Owner's Equity (3100-3199)\n  { id: \"3100\", name: \"Owner's Equity\", type: \"equity\", level: 2, parentId: \"3000\", balance: 0, isPostable: false },\n  { id: \"3110\", name: \"Common Stock\", type: \"equity\", level: 3, parentId: \"3100\", balance: 200000, isPostable: true },\n  { id: \"3120\", name: \"Preferred Stock\", type: \"equity\", level: 3, parentId: \"3100\", balance: 50000, isPostable: true },\n  { id: \"3130\", name: \"Additional Paid-in Capital\", type: \"equity\", level: 3, parentId: \"3100\", balance: 75000, isPostable: true },\n  { id: \"3140\", name: \"Owner's Contributions\", type: \"equity\", level: 3, parentId: \"3100\", balance: 100000, isPostable: true },\n  { id: \"3150\", name: \"Owner's Drawings\", type: \"equity\", level: 3, parentId: \"3100\", balance: -25000, isPostable: true },\n  \n  // Retained Earnings (3200-3299)\n  { id: \"3200\", name: \"Retained Earnings\", type: \"equity\", level: 2, parentId: \"3000\", balance: 0, isPostable: false },\n  { id: \"3210\", name: \"Retained Earnings - Prior Years\", type: \"equity\", level: 3, parentId: \"3200\", balance: 185000, isPostable: true },\n  { id: \"3220\", name: \"Current Year Earnings\", type: \"equity\", level: 3, parentId: \"3200\", balance: 0, isPostable: true },\n  { id: \"3230\", name: \"Dividends Paid\", type: \"equity\", level: 3, parentId: \"3200\", balance: -15000, isPostable: true },\n  \n  // REVENUE (4000-4999)\n  { id: \"4000\", name: \"Revenue\", type: \"revenue\", level: 1, parentId: null, balance: 0, isPostable: false },\n  \n  // Sales Revenue (4100-4199)\n  { id: \"4100\", name: \"Sales Revenue\", type: \"revenue\", level: 2, parentId: \"4000\", balance: 0, isPostable: false },\n  { id: \"4110\", name: \"Product Sales\", type: \"revenue\", level: 3, parentId: \"4100\", balance: 485000, isPostable: true },\n  { id: \"4120\", name: \"Service Revenue\", type: \"revenue\", level: 3, parentId: \"4100\", balance: 125000, isPostable: true },\n  { id: \"4130\", name: \"Shipping & Handling Revenue\", type: \"revenue\", level: 3, parentId: \"4100\", balance: 18500, isPostable: true },\n  { id: \"4140\", name: \"Sales Returns & Allowances\", type: \"revenue\", level: 3, parentId: \"4100\", balance: -12500, isPostable: true },\n  { id: \"4150\", name: \"Sales Discounts\", type: \"revenue\", level: 3, parentId: \"4100\", balance: -8200, isPostable: true },\n  \n  // Other Income (4200-4299)\n  { id: \"4200\", name: \"Other Income\", type: \"revenue\", level: 2, parentId: \"4000\", balance: 0, isPostable: false },\n  { id: \"4210\", name: \"Interest Income\", type: \"revenue\", level: 3, parentId: \"4200\", balance: 5500, isPostable: true },\n  { id: \"4220\", name: \"Dividend Income\", type: \"revenue\", level: 3, parentId: \"4200\", balance: 2800, isPostable: true },\n  { id: \"4230\", name: \"Rental Income\", type: \"revenue\", level: 3, parentId: \"4200\", balance: 12000, isPostable: true },\n  { id: \"4240\", name: \"Gain on Asset Sale\", type: \"revenue\", level: 3, parentId: \"4200\", balance: 4500, isPostable: true },\n  { id: \"4250\", name: \"Miscellaneous Income\", type: \"revenue\", level: 3, parentId: \"4200\", balance: 1800, isPostable: true },\n  \n  // EXPENSES (5000-5999)\n  { id: \"5000\", name: \"Expenses\", type: \"expense\", level: 1, parentId: null, balance: 0, isPostable: false },\n  \n  // Cost of Goods Sold (5100-5199)\n  { id: \"5100\", name: \"Cost of Goods Sold\", type: \"expense\", level: 2, parentId: \"5000\", balance: 0, isPostable: false },\n  { id: \"5110\", name: \"Cost of Materials\", type: \"expense\", level: 3, parentId: \"5100\", balance: 145000, isPostable: true },\n  { id: \"5120\", name: \"Direct Labor\", type: \"expense\", level: 3, parentId: \"5100\", balance: 85000, isPostable: true },\n  { id: \"5130\", name: \"Manufacturing Overhead\", type: \"expense\", level: 3, parentId: \"5100\", balance: 42000, isPostable: true },\n  { id: \"5140\", name: \"Freight In\", type: \"expense\", level: 3, parentId: \"5100\", balance: 12500, isPostable: true },\n  { id: \"5150\", name: \"Purchase Discounts\", type: \"expense\", level: 3, parentId: \"5100\", balance: -5800, isPostable: true },\n  \n  // Operating Expenses (5200-5299)\n  { id: \"5200\", name: \"Operating Expenses\", type: \"expense\", level: 2, parentId: \"5000\", balance: 0, isPostable: false },\n  { id: \"5210\", name: \"Rent Expense\", type: \"expense\", level: 3, parentId: \"5200\", balance: 36000, isPostable: true },\n  { id: \"5220\", name: \"Utilities Expense\", type: \"expense\", level: 3, parentId: \"5200\", balance: 14500, isPostable: true },\n  { id: \"5230\", name: \"Insurance Expense\", type: \"expense\", level: 3, parentId: \"5200\", balance: 18000, isPostable: true },\n  { id: \"5240\", name: \"Depreciation Expense\", type: \"expense\", level: 3, parentId: \"5200\", balance: 45000, isPostable: true },\n  { id: \"5250\", name: \"Repairs & Maintenance\", type: \"expense\", level: 3, parentId: \"5200\", balance: 12800, isPostable: true },\n  { id: \"5260\", name: \"Office Supplies\", type: \"expense\", level: 3, parentId: \"5200\", balance: 4500, isPostable: true },\n  { id: \"5270\", name: \"Telephone & Internet\", type: \"expense\", level: 3, parentId: \"5200\", balance: 6200, isPostable: true },\n  { id: \"5280\", name: \"Professional Fees\", type: \"expense\", level: 3, parentId: \"5200\", balance: 15000, isPostable: true },\n  \n  // Payroll Expenses (5300-5399)\n  { id: \"5300\", name: \"Payroll Expenses\", type: \"expense\", level: 2, parentId: \"5000\", balance: 0, isPostable: false },\n  { id: \"5310\", name: \"Salaries & Wages\", type: \"expense\", level: 3, parentId: \"5300\", balance: 185000, isPostable: true },\n  { id: \"5320\", name: \"Payroll Taxes\", type: \"expense\", level: 3, parentId: \"5300\", balance: 28500, isPostable: true },\n  { id: \"5330\", name: \"Employee Benefits\", type: \"expense\", level: 3, parentId: \"5300\", balance: 32000, isPostable: true },\n  { id: \"5340\", name: \"Workers Compensation\", type: \"expense\", level: 3, parentId: \"5300\", balance: 8500, isPostable: true },\n  { id: \"5350\", name: \"Training & Development\", type: \"expense\", level: 3, parentId: \"5300\", balance: 5500, isPostable: true },\n  \n  // Marketing & Admin (5400-5499)\n  { id: \"5400\", name: \"Marketing & Administrative\", type: \"expense\", level: 2, parentId: \"5000\", balance: 0, isPostable: false },\n  { id: \"5410\", name: \"Advertising & Promotion\", type: \"expense\", level: 3, parentId: \"5400\", balance: 22000, isPostable: true },\n  { id: \"5420\", name: \"Travel & Entertainment\", type: \"expense\", level: 3, parentId: \"5400\", balance: 14500, isPostable: true },\n  { id: \"5430\", name: \"Shipping & Freight Out\", type: \"expense\", level: 3, parentId: \"5400\", balance: 18000, isPostable: true },\n  { id: \"5440\", name: \"Bad Debt Expense\", type: \"expense\", level: 3, parentId: \"5400\", balance: 3500, isPostable: true },\n  { id: \"5450\", name: \"Bank Charges & Fees\", type: \"expense\", level: 3, parentId: \"5400\", balance: 2800, isPostable: true },\n  { id: \"5460\", name: \"Interest Expense\", type: \"expense\", level: 3, parentId: \"5400\", balance: 12500, isPostable: true },\n  { id: \"5470\", name: \"Licenses & Permits\", type: \"expense\", level: 3, parentId: \"5400\", balance: 3200, isPostable: true },\n  { id: \"5480\", name: \"Miscellaneous Expense\", type: \"expense\", level: 3, parentId: \"5400\", balance: 4800, isPostable: true },\n];\n\nexport const mockJournalEntries = [\n  { id: \"JE-001\", date: \"2024-12-01\", description: \"Sales Revenue Recognition\", debitAccount: \"1100\", creditAccount: \"4000\", amount: 4599.50, status: \"posted\" },\n  { id: \"JE-002\", date: \"2024-12-02\", description: \"Inventory Purchase\", debitAccount: \"1200\", creditAccount: \"2000\", amount: 12500.00, status: \"posted\" },\n  { id: \"JE-003\", date: \"2024-12-03\", description: \"Payment Received\", debitAccount: \"1000\", creditAccount: \"1100\", amount: 2340.00, status: \"posted\" },\n  { id: \"JE-004\", date: \"2024-12-04\", description: \"Operating Expense Payment\", debitAccount: \"5100\", creditAccount: \"1000\", amount: 1500.00, status: \"draft\" },\n];\n\nexport const mockLocations = [\n  { id: \"LOC-001\", code: \"A-01-01\", name: \"Rack A, Shelf 1, Bin 1\", zone: \"Zone A\", type: \"bin\", capacity: 100, used: 45 },\n  { id: \"LOC-002\", code: \"A-01-02\", name: \"Rack A, Shelf 1, Bin 2\", zone: \"Zone A\", type: \"bin\", capacity: 100, used: 78 },\n  { id: \"LOC-003\", code: \"B-02-01\", name: \"Rack B, Shelf 2, Bin 1\", zone: \"Zone B\", type: \"bin\", capacity: 200, used: 12 },\n  { id: \"LOC-004\", code: \"B-02-02\", name: \"Rack B, Shelf 2, Bin 2\", zone: \"Zone B\", type: \"bin\", capacity: 200, used: 156 },\n  { id: \"LOC-005\", code: \"C-03-01\", name: \"Bulk Storage C, Area 1\", zone: \"Zone C\", type: \"bulk\", capacity: 5000, used: 2450 },\n];\n\nexport const mockMovements = [\n  { id: \"MOV-001\", type: \"IN\", productId: \"P001\", productName: \"Industrial Widget A\", quantity: 100, fromLocation: null, toLocation: \"A-01-01\", date: \"2024-12-01\", reference: \"PO-001\" },\n  { id: \"MOV-002\", type: \"OUT\", productId: \"P002\", productName: \"Industrial Widget B\", quantity: 25, fromLocation: \"A-01-02\", toLocation: null, date: \"2024-12-02\", reference: \"SO-001\" },\n  { id: \"MOV-003\", type: \"TRANSFER\", productId: \"P003\", productName: \"Component Alpha\", quantity: 50, fromLocation: \"B-02-01\", toLocation: \"D-01-01\", date: \"2024-12-03\", reference: \"INT-001\" },\n  { id: \"MOV-004\", type: \"IN\", productId: \"P005\", productName: \"Raw Material X\", quantity: 500, fromLocation: null, toLocation: \"C-03-01\", date: \"2024-12-04\", reference: \"PO-002\" },\n];\n\nexport const mockDashboardStats = {\n  sales: { today: 12500, month: 156000, pending: 8, trend: 12.5 },\n  inventory: { totalValue: 234500, lowStock: 3, movements: 24, trend: -2.3 },\n  receivables: { total: 45600, overdue: 8900, collected: 23400, trend: 5.8 },\n  payables: { total: 28900, dueThisWeek: 12500, paid: 45000, trend: -8.2 },\n};\n","path":null,"size_bytes":25081,"size_tokens":null},"client/src/components/examples/StockLevels.tsx":{"content":"import { StockLevels } from \"../warehouse/StockLevels\";\n\nexport default function StockLevelsExample() {\n  return <StockLevels />;\n}\n","path":null,"size_bytes":132,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"replit.md":{"content":"# Unanza ERP System\n\n## Overview\nUnanza is a comprehensive, multi-tenant enterprise ERP system designed with a hierarchical multi-company architecture. It aims to provide a robust solution for managing various business operations across complex organizational structures, offering strict data segregation and supporting inter-company transactions. The system encompasses modules for Sales, Warehouse, Financials, HR, and System administration, alongside granular Role-Based Access Control. Its core purpose is to streamline business processes, enhance financial oversight, and improve operational efficiency for organizations with multiple entities.\n\n## User Preferences\n- Carbon Design System styling\n- Enterprise-focused UI/UX\n- Professional, clean aesthetics\n- Accessibility compliant\n\n## System Architecture\n\n### UI/UX Decisions\nThe front-end is built with React, leveraging the IBM Plex Sans font family and drawing inspiration from the Carbon Design System. It supports both dark and light modes with a primary blue accent, destructive red for errors, and muted gray tones for secondary content. UI components utilize Shadcn/ui, Radix UI primitives, and Lucide React icons for a consistent and modern user experience.\n\n### Technical Implementations\nThe system employs a full-stack architecture with React on the client-side and Express.js with TypeScript on the server. Data persistence is managed by PostgreSQL, integrated via Drizzle ORM. Key architectural patterns include:\n- **Multi-Company Architecture**: Supports unlimited depth hierarchical company structures (Holding, Subsidiary, Branch, Division) using a path/ltree pattern in the database.\n- **Data Segregation**: Strict isolation of data per company through `company_id` filtering on all entities.\n- **Role-Based Access Control**: Granular permissions based on user-company-role assignments.\n- **Authentication**: JWT-based authentication with access and refresh tokens, implementing hierarchy-based access control.\n- **Interconnected ERP Workflows**: A workflow orchestration layer (`server/services/workflow-service.ts`) manages transaction lifecycles (e.g., Sales Order, Purchase Order), automatically generating journal entries for financial integrity.\n- **ACID Transaction Safety**: All workflow methods use `db.transaction()` wrappers to ensure atomicity. Partial failures automatically roll back all changes. Row-level locking (`FOR UPDATE`) prevents race conditions and duplicate document numbers.\n- **First-Time Setup Flow**: A guided setup wizard for initial company registration and super admin creation, which locks after completion to prevent reconfiguration.\n- **API Design**: Consistent company-scoped API endpoints for all master data and transactional modules, ensuring data integrity and security.\n\n### Workflow Service Architecture\nThe WorkflowService (`server/services/workflow-service.ts`) implements fully transactional ERP workflows:\n- **Sales Order Flow**: confirmSalesOrder  deliverSalesOrder  createCustomerInvoice  receiveCustomerPayment\n- **Purchase Order Flow**: confirmPurchaseOrder  receiveGoodsFromPurchaseOrder  createVendorInvoice  makeVendorPayment\n- **Transaction Helpers (Tx versions)**: getSalesOrderLinesTx, getPurchaseOrderLinesTx, getOrCreateStockLevelTx, getAccountByCodeTx, createCOGSJournalEntryTx, createARInvoiceJournalEntryTx, createARLedgerEntryTx, createPaymentReceiptJournalEntryTx, createARPaymentLedgerEntryTx, createGoodsReceiptJournalEntryTx, createAPInvoiceJournalEntryTx, createAPLedgerEntryTx, createVendorPaymentJournalEntryTx, createAPPaymentLedgerEntryTx\n- **Document Numbering**: Uses `getNextDocumentNumberTx()` with SELECT...FOR UPDATE to prevent duplicate codes under concurrency\n\n### Feature Specifications\n- **Modules**: Sales (Orders, Customers, Deliveries, Invoices), Warehouse (Products, Locations, Stock, POs), Financials (Journal Entries, COA, AR/AP), HR (Employees, Attendance, Payroll), System (Companies, Users, Roles, Portals, Settings).\n- **Inter-Company Functionality**: Support for IC sales/purchase orders, stock transfers, and consolidation reporting.\n- **Workflow Automation**: Automated stock reservation, inventory adjustments, and journal entry generation linked to operational transactions (e.g., sales order delivery, goods receipt).\n- **Security**: Robust security measures including PATCH route sanitization and strict company ownership validation to prevent cross-company data tampering.\n\n## External Dependencies\n- **Database**: PostgreSQL\n- **ORM**: Drizzle ORM\n- **Front-end Framework**: React\n- **Back-end Framework**: Express.js\n- **UI Component Libraries**: Shadcn/ui, Radix UI\n- **Icons**: Lucide React\n- **State Management/Data Fetching**: TanStack Query\n- **Authentication**: JWT (JSON Web Tokens)\n- **Password Hashing**: bcrypt\n\n## Data Integrity Policy\n\n### No Dummy Data\nThe ERP system operates with a **zero pre-populated data policy**:\n- No mock companies, users, or master data are seeded in the database\n- All operational records must be created organically by users through proper workflows\n- The first-time setup flow is the only entry point to initialize the system\n- **Exception**: System roles (ADMIN, MANAGER, USER) are auto-provisioned on first API access as they are required for the setup flow\n\n### First-Time Setup Flow\n1. **Company Creation**: User creates their first company (Holding level)\n2. **Admin Account**: User creates the super admin account\n3. **Master Data**: After login, users must create:\n   - Chart of Accounts (COA) for financial tracking\n   - Warehouses for inventory management\n   - Customers for sales transactions\n   - Vendors for purchase transactions\n   - Products with pricing and costing\n\n### Workflow Dependencies\nAll transactional flows enforce realistic dependencies:\n- **Sales Orders**: Require existing customers and products\n- **Purchase Orders**: Require existing vendors and products\n- **Deliveries**: Originate from confirmed sales orders with reserved stock\n- **Goods Receipts**: Originate from confirmed purchase orders\n- **Invoices**: Generated from deliveries (AR) or goods receipts (AP)\n- **Payments**: Applied against outstanding invoices\n- **Journal Entries**: Auto-generated by operational events (COGS, AR/AP, etc.)\n\n### Currency\n- Default currency: Indonesian Rupiah (IDR)\n- Multi-currency support with exchange rate management per company\n\n## Frontend Workflow Integration\n\n### Sales Order Workflow (SalesOrderList.tsx)\nFrontend actions trigger complete backend workflows with ACID guarantees:\n- **Confirm Order**: POST `/sales-orders/:id/confirm`  reserves stock\n- **Deliver Order**: POST `/sales-orders/:id/deliver`  creates delivery, COGS journal entry\n- **Create Invoice**: POST `/sales-orders/:id/invoice`  creates AR invoice, revenue journal entry\n\n### Purchase Order Workflow (PurchaseOrderList.tsx)\n- **Confirm PO**: POST `/purchase-orders/:id/confirm`  confirms purchase order\n- **Receive Goods**: POST `/purchase-orders/:id/receive`  creates goods receipt, inventory journal entry\n- **Create Bill**: POST `/purchase-orders/:id/bill`  creates AP invoice\n\n### Payment Workflows\n- **Receive Customer Payment** (InvoiceList.tsx): POST `/payments/receive`  updates AR, creates payment receipt\n- **Make Vendor Payment** (AccountsPayable.tsx): POST `/payments/pay`  updates AP, creates payment record\n\n### Invoice Types\n- **Customer invoices** (AR): `invoiceType === \"customer\"`\n- **Vendor invoices** (AP): `invoiceType === \"vendor\"`\n\n### Cache Invalidation\nAfter each workflow action, the frontend invalidates all affected caches:\n- Orders (sales-orders, purchase-orders)\n- Stock levels\n- Deliveries, goods receipts\n- Invoices, payments\n- Journal entries\n- AR/AP ledgers","path":null,"size_bytes":7746,"size_tokens":null},"client/src/components/sales/DeliveryList.tsx":{"content":"import { useState } from \"react\";\nimport { DataTable, type Column } from \"@/components/layout/DataTable\";\nimport { StatusBadge } from \"@/components/layout/StatusBadge\";\nimport { PageHeader } from \"@/components/layout/PageHeader\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { WorkflowStepper } from \"@/components/layout/WorkflowStepper\";\nimport { Download, Eye, Package, Truck, CheckCircle } from \"lucide-react\";\nimport { mockDeliveries } from \"@/lib/mockData\";\n\ntype Delivery = typeof mockDeliveries[0];\n\nconst deliverySteps = [\n  { id: \"picking\", label: \"Picking\" },\n  { id: \"packing\", label: \"Packing\" },\n  { id: \"shipped\", label: \"Shipped\" },\n  { id: \"delivered\", label: \"Delivered\" },\n];\n\n// todo: remove mock functionality\nconst mockDeliveryLines = [\n  { productName: \"Industrial Widget A\", ordered: 5, picked: 5, packed: 5, shipped: 5 },\n  { productName: \"Industrial Widget B\", ordered: 3, picked: 3, packed: 3, shipped: 0 },\n  { productName: \"Component Beta\", ordered: 2, picked: 2, packed: 0, shipped: 0 },\n];\n\nexport function DeliveryList() {\n  const [deliveries, setDeliveries] = useState(mockDeliveries);\n  const [selectedDelivery, setSelectedDelivery] = useState<Delivery | null>(null);\n  const [isDetailOpen, setIsDetailOpen] = useState(false);\n\n  const handleViewDelivery = (delivery: Delivery) => {\n    setSelectedDelivery(delivery);\n    setIsDetailOpen(true);\n  };\n\n  const handleStatusChange = (deliveryId: string, newStatus: string) => {\n    setDeliveries(deliveries.map(d => \n      d.id === deliveryId ? { ...d, status: newStatus } : d\n    ));\n    console.log(\"Delivery status changed:\", deliveryId, newStatus);\n  };\n\n  const getActionButton = (delivery: Delivery) => {\n    switch (delivery.status) {\n      case \"picking\":\n        return (\n          <Button \n            size=\"sm\" \n            onClick={(e) => { e.stopPropagation(); handleStatusChange(delivery.id, \"packing\"); }}\n            data-testid={`button-pack-${delivery.id}`}\n          >\n            <Package className=\"h-3 w-3 mr-1\" />\n            Pack\n          </Button>\n        );\n      case \"packing\":\n        return (\n          <Button \n            size=\"sm\" \n            onClick={(e) => { e.stopPropagation(); handleStatusChange(delivery.id, \"shipped\"); }}\n            data-testid={`button-ship-${delivery.id}`}\n          >\n            <Truck className=\"h-3 w-3 mr-1\" />\n            Ship\n          </Button>\n        );\n      case \"shipped\":\n        return (\n          <Button \n            size=\"sm\" \n            onClick={(e) => { e.stopPropagation(); handleStatusChange(delivery.id, \"delivered\"); }}\n            data-testid={`button-deliver-${delivery.id}`}\n          >\n            <CheckCircle className=\"h-3 w-3 mr-1\" />\n            Delivered\n          </Button>\n        );\n      default:\n        return null;\n    }\n  };\n\n  const columns: Column<Delivery>[] = [\n    { key: \"id\", header: \"Delivery ID\", sortable: true },\n    { key: \"orderId\", header: \"Order\", sortable: true },\n    { key: \"customerName\", header: \"Customer\", sortable: true },\n    { key: \"date\", header: \"Date\", sortable: true },\n    { \n      key: \"status\", \n      header: \"Status\",\n      render: (item) => <StatusBadge status={item.status as \"picking\" | \"packing\" | \"shipped\" | \"delivered\"} />\n    },\n    { key: \"items\", header: \"Items\", className: \"text-center\" },\n    {\n      key: \"actions\",\n      header: \"\",\n      className: \"text-right\",\n      render: (item) => (\n        <div className=\"flex justify-end gap-2\" onClick={(e) => e.stopPropagation()}>\n          {getActionButton(item)}\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => handleViewDelivery(item)} data-testid={`button-view-${item.id}`}>\n            <Eye className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      ),\n    },\n  ];\n\n  return (\n    <div>\n      <PageHeader\n        title=\"Deliveries\"\n        description=\"Track and manage order deliveries\"\n        actions={\n          <Button variant=\"outline\" data-testid=\"button-export\">\n            <Download className=\"h-4 w-4 mr-2\" />\n            Export\n          </Button>\n        }\n      />\n\n      <DataTable\n        data={deliveries}\n        columns={columns}\n        searchKey=\"customerName\"\n        searchPlaceholder=\"Search deliveries...\"\n        onRowClick={handleViewDelivery}\n      />\n\n      <Dialog open={isDetailOpen} onOpenChange={setIsDetailOpen}>\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Delivery Details</DialogTitle>\n          </DialogHeader>\n          {selectedDelivery && (\n            <div className=\"space-y-6\">\n              <div className=\"flex flex-wrap items-start justify-between gap-4\">\n                <div>\n                  <div className=\"flex items-center gap-3\">\n                    <h2 className=\"text-xl font-semibold\" data-testid=\"text-delivery-id\">{selectedDelivery.id}</h2>\n                    <StatusBadge status={selectedDelivery.status as \"picking\" | \"packing\" | \"shipped\" | \"delivered\"} />\n                  </div>\n                  <p className=\"text-sm text-muted-foreground mt-1\">\n                    Order: {selectedDelivery.orderId} - {selectedDelivery.customerName}\n                  </p>\n                </div>\n                {getActionButton(selectedDelivery)}\n              </div>\n\n              <WorkflowStepper steps={deliverySteps} currentStep={selectedDelivery.status} />\n\n              <Card>\n                <CardHeader className=\"pb-3\">\n                  <CardTitle className=\"text-base\">Delivery Lines</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"border rounded-md divide-y\">\n                    <div className=\"grid grid-cols-5 gap-2 p-3 bg-muted/50 text-sm font-medium\">\n                      <div className=\"col-span-2\">Product</div>\n                      <div className=\"text-center\">Ordered</div>\n                      <div className=\"text-center\">Picked</div>\n                      <div className=\"text-center\">Shipped</div>\n                    </div>\n                    {mockDeliveryLines.map((line, index) => (\n                      <div key={index} className=\"grid grid-cols-5 gap-2 p-3 text-sm\">\n                        <div className=\"col-span-2\">{line.productName}</div>\n                        <div className=\"text-center\">{line.ordered}</div>\n                        <div className=\"text-center\">{line.picked}</div>\n                        <div className=\"text-center\">{line.shipped}</div>\n                      </div>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":6911,"size_tokens":null},"client/src/components/sales/SalesOrderDetail.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { StatusBadge } from \"@/components/layout/StatusBadge\";\nimport { WorkflowStepper } from \"@/components/layout/WorkflowStepper\";\nimport { FileText, Truck, CheckCircle } from \"lucide-react\";\nimport type { mockSalesOrders, mockProducts } from \"@/lib/mockData\";\n\ntype SalesOrder = typeof mockSalesOrders[0];\n\ninterface SalesOrderDetailProps {\n  order: SalesOrder;\n  onStatusChange: (orderId: string, newStatus: string) => void;\n  onClose: () => void;\n}\n\n// todo: remove mock functionality\nconst mockOrderLines = [\n  { productId: \"P001\", productName: \"Industrial Widget A\", quantity: 5, price: 49.99, total: 249.95 },\n  { productId: \"P002\", productName: \"Industrial Widget B\", quantity: 3, price: 79.99, total: 239.97 },\n  { productId: \"P004\", productName: \"Component Beta\", quantity: 2, price: 189.00, total: 378.00 },\n];\n\nconst orderSteps = [\n  { id: \"draft\", label: \"Draft\" },\n  { id: \"confirmed\", label: \"Confirmed\" },\n  { id: \"delivered\", label: \"Delivered\" },\n  { id: \"invoiced\", label: \"Invoiced\" },\n];\n\nexport function SalesOrderDetail({ order, onStatusChange, onClose }: SalesOrderDetailProps) {\n  const getNextStatus = (currentStatus: string): string | null => {\n    const statusOrder = [\"draft\", \"confirmed\", \"delivered\", \"invoiced\"];\n    const currentIndex = statusOrder.indexOf(currentStatus);\n    if (currentIndex < statusOrder.length - 1) {\n      return statusOrder[currentIndex + 1];\n    }\n    return null;\n  };\n\n  const nextStatus = getNextStatus(order.status);\n\n  const getActionButton = () => {\n    switch (order.status) {\n      case \"draft\":\n        return (\n          <Button onClick={() => onStatusChange(order.id, \"confirmed\")} data-testid=\"button-confirm-order\">\n            <CheckCircle className=\"h-4 w-4 mr-2\" />\n            Confirm Order\n          </Button>\n        );\n      case \"confirmed\":\n        return (\n          <Button onClick={() => onStatusChange(order.id, \"delivered\")} data-testid=\"button-create-delivery\">\n            <Truck className=\"h-4 w-4 mr-2\" />\n            Create Delivery\n          </Button>\n        );\n      case \"delivered\":\n        return (\n          <Button onClick={() => onStatusChange(order.id, \"invoiced\")} data-testid=\"button-create-invoice\">\n            <FileText className=\"h-4 w-4 mr-2\" />\n            Create Invoice\n          </Button>\n        );\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex flex-wrap items-start justify-between gap-4\">\n        <div>\n          <div className=\"flex items-center gap-3\">\n            <h2 className=\"text-xl font-semibold\" data-testid=\"text-order-id\">{order.id}</h2>\n            <StatusBadge status={order.status as \"draft\" | \"confirmed\" | \"delivered\" | \"invoiced\"} />\n          </div>\n          <p className=\"text-sm text-muted-foreground mt-1\" data-testid=\"text-order-customer\">\n            {order.customerName}\n          </p>\n        </div>\n        {getActionButton()}\n      </div>\n\n      <WorkflowStepper steps={orderSteps} currentStep={order.status} />\n\n      <div className=\"grid md:grid-cols-2 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-base\">Order Information</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-2 text-sm\">\n            <div className=\"flex justify-between\">\n              <span className=\"text-muted-foreground\">Order Date</span>\n              <span data-testid=\"text-order-date\">{order.date}</span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-muted-foreground\">Customer ID</span>\n              <span>{order.customerId}</span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-muted-foreground\">Items</span>\n              <span>{order.items}</span>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-base\">Order Summary</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-2 text-sm\">\n            <div className=\"flex justify-between\">\n              <span className=\"text-muted-foreground\">Subtotal</span>\n              <span>${(order.total * 0.9).toFixed(2)}</span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-muted-foreground\">Tax (10%)</span>\n              <span>${(order.total * 0.1).toFixed(2)}</span>\n            </div>\n            <div className=\"flex justify-between font-semibold pt-2 border-t\">\n              <span>Total</span>\n              <span data-testid=\"text-order-total\">${order.total.toLocaleString()}</span>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader className=\"pb-3\">\n          <CardTitle className=\"text-base\">Order Lines</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"border rounded-md divide-y\">\n            <div className=\"grid grid-cols-12 gap-2 p-3 bg-muted/50 text-sm font-medium\">\n              <div className=\"col-span-5\">Product</div>\n              <div className=\"col-span-2 text-center\">Qty</div>\n              <div className=\"col-span-2 text-right\">Price</div>\n              <div className=\"col-span-3 text-right\">Total</div>\n            </div>\n            {mockOrderLines.map((line, index) => (\n              <div key={index} className=\"grid grid-cols-12 gap-2 p-3 text-sm\">\n                <div className=\"col-span-5\">{line.productName}</div>\n                <div className=\"col-span-2 text-center\">{line.quantity}</div>\n                <div className=\"col-span-2 text-right\">${line.price.toFixed(2)}</div>\n                <div className=\"col-span-3 text-right font-medium\">${line.total.toFixed(2)}</div>\n              </div>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"flex justify-end gap-2 pt-4 border-t\">\n        <Button variant=\"outline\" onClick={onClose} data-testid=\"button-close-detail\">\n          Close\n        </Button>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":6263,"size_tokens":null},"client/src/components/CompanySwitcher.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Building2, ChevronDown, Check, ChevronRight, Globe, Building, GitBranch } from \"lucide-react\";\nimport { useCompany } from \"@/contexts/CompanyContext\";\nimport type { Company, CompanyHierarchyNode } from \"@shared/schema\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { cn } from \"@/lib/utils\";\n\nconst companyTypeIcons: Record<string, typeof Building2> = {\n  holding: Globe,\n  subsidiary: Building,\n  branch: GitBranch,\n  division: Building2,\n};\n\nconst companyTypeColors: Record<string, string> = {\n  holding: \"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200\",\n  subsidiary: \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\",\n  branch: \"bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200\",\n  division: \"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200\",\n};\n\ninterface HierarchyItemProps {\n  node: CompanyHierarchyNode;\n  onSelect: (company: Company) => void;\n  activeCompanyId: string | null;\n  depth?: number;\n}\n\nfunction HierarchyItem({ node, onSelect, activeCompanyId, depth = 0 }: HierarchyItemProps) {\n  const [isExpanded, setIsExpanded] = useState(true);\n  const hasChildren = node.children && node.children.length > 0;\n  const isActive = node.company.id === activeCompanyId;\n  const Icon = companyTypeIcons[node.company.companyType] || Building2;\n\n  return (\n    <div className=\"w-full\">\n      <DropdownMenuItem\n        className={cn(\n          \"flex items-center gap-2 cursor-pointer w-full\",\n          isActive && \"bg-accent\"\n        )}\n        style={{ paddingLeft: `${(depth * 16) + 8}px` }}\n        onClick={() => onSelect(node.company)}\n        data-testid={`dropdown-company-${node.company.id}`}\n      >\n        {hasChildren ? (\n          <button\n            onClick={(e) => {\n              e.stopPropagation();\n              setIsExpanded(!isExpanded);\n            }}\n            className=\"p-0.5 hover:bg-accent rounded\"\n            data-testid={`button-expand-${node.company.id}`}\n          >\n            <ChevronRight \n              className={cn(\n                \"h-3 w-3 transition-transform\",\n                isExpanded && \"rotate-90\"\n              )} \n            />\n          </button>\n        ) : (\n          <span className=\"w-4\" />\n        )}\n        <Icon className=\"h-4 w-4 text-muted-foreground\" />\n        <div className=\"flex-1 flex items-center gap-2 min-w-0\">\n          <span className=\"truncate font-medium\" data-testid={`text-company-name-${node.company.id}`}>\n            {node.company.name}\n          </span>\n          <Badge \n            variant=\"secondary\" \n            className={cn(\"text-xs shrink-0\", companyTypeColors[node.company.companyType])}\n          >\n            {node.company.companyType}\n          </Badge>\n          <Badge variant=\"outline\" className=\"text-xs shrink-0\">\n            {node.company.currency}\n          </Badge>\n        </div>\n        {isActive && <Check className=\"h-4 w-4 text-primary shrink-0\" />}\n      </DropdownMenuItem>\n      \n      {hasChildren && isExpanded && (\n        <div>\n          {node.children.map((child) => (\n            <HierarchyItem\n              key={child.company.id}\n              node={child}\n              onSelect={onSelect}\n              activeCompanyId={activeCompanyId}\n              depth={depth + 1}\n            />\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport function CompanySwitcher() {\n  const { activeCompany, activeCompanyId, userCompanies, switchCompany, isLoading } = useCompany();\n  const [open, setOpen] = useState(false);\n\n  // Fetch company hierarchy\n  const { data: hierarchy = [] } = useQuery<CompanyHierarchyNode[]>({\n    queryKey: [\"/api/companies/hierarchy\"],\n  });\n\n  const handleSelect = async (company: Company) => {\n    if (company.id !== activeCompanyId) {\n      await switchCompany(company.id);\n    }\n    setOpen(false);\n  };\n\n  const ActiveIcon = activeCompany?.companyType \n    ? companyTypeIcons[activeCompany.companyType] || Building2\n    : Building2;\n\n  return (\n    <DropdownMenu open={open} onOpenChange={setOpen}>\n      <DropdownMenuTrigger asChild>\n        <Button \n          variant=\"outline\" \n          className=\"min-w-[200px] justify-between gap-2\"\n          disabled={isLoading}\n          data-testid=\"button-company-switcher\"\n        >\n          <div className=\"flex items-center gap-2 min-w-0\">\n            <ActiveIcon className=\"h-4 w-4 shrink-0\" />\n            <span className=\"truncate\" data-testid=\"text-active-company\">\n              {activeCompany?.name || \"Select Company\"}\n            </span>\n          </div>\n          <ChevronDown className=\"h-4 w-4 shrink-0 opacity-50\" />\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent \n        align=\"start\" \n        className=\"w-[350px] max-h-[400px] overflow-y-auto\"\n        data-testid=\"dropdown-company-list\"\n      >\n        <DropdownMenuLabel className=\"flex items-center gap-2\">\n          <Building2 className=\"h-4 w-4\" />\n          Switch Company\n        </DropdownMenuLabel>\n        <DropdownMenuSeparator />\n        \n        {hierarchy.length > 0 ? (\n          hierarchy.map((node) => (\n            <HierarchyItem\n              key={node.company.id}\n              node={node}\n              onSelect={handleSelect}\n              activeCompanyId={activeCompanyId}\n            />\n          ))\n        ) : (\n          userCompanies.map((company) => {\n            const Icon = companyTypeIcons[company.companyType] || Building2;\n            const isActive = company.id === activeCompanyId;\n            \n            return (\n              <DropdownMenuItem\n                key={company.id}\n                className={cn(\n                  \"flex items-center gap-2 cursor-pointer\",\n                  isActive && \"bg-accent\"\n                )}\n                onClick={() => handleSelect(company)}\n                data-testid={`dropdown-company-${company.id}`}\n              >\n                <Icon className=\"h-4 w-4 text-muted-foreground\" />\n                <span className=\"flex-1 truncate\">{company.name}</span>\n                <Badge \n                  variant=\"secondary\" \n                  className={cn(\"text-xs\", companyTypeColors[company.companyType])}\n                >\n                  {company.companyType}\n                </Badge>\n                {isActive && <Check className=\"h-4 w-4 text-primary\" />}\n              </DropdownMenuItem>\n            );\n          })\n        )}\n        \n        {userCompanies.length === 0 && hierarchy.length === 0 && (\n          <div className=\"p-4 text-center text-sm text-muted-foreground\">\n            No companies available\n          </div>\n        )}\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n\n// Compact version for sidebar\nexport function CompanySwitcherCompact() {\n  const { activeCompany, activeCompanyId, userCompanies, switchCompany, isLoading } = useCompany();\n  const [open, setOpen] = useState(false);\n\n  const handleSelect = async (company: Company) => {\n    if (company.id !== activeCompanyId) {\n      await switchCompany(company.id);\n    }\n    setOpen(false);\n  };\n\n  const ActiveIcon = activeCompany?.companyType \n    ? companyTypeIcons[activeCompany.companyType] || Building2\n    : Building2;\n\n  return (\n    <DropdownMenu open={open} onOpenChange={setOpen}>\n      <DropdownMenuTrigger asChild>\n        <Button \n          variant=\"ghost\" \n          size=\"icon\"\n          disabled={isLoading}\n          data-testid=\"button-company-switcher-compact\"\n        >\n          <ActiveIcon className=\"h-5 w-5\" />\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent \n        align=\"start\" \n        side=\"right\"\n        className=\"w-[280px]\"\n        data-testid=\"dropdown-company-list-compact\"\n      >\n        <DropdownMenuLabel>Switch Company</DropdownMenuLabel>\n        <DropdownMenuSeparator />\n        {userCompanies.map((company) => {\n          const Icon = companyTypeIcons[company.companyType] || Building2;\n          const isActive = company.id === activeCompanyId;\n          \n          return (\n            <DropdownMenuItem\n              key={company.id}\n              className={cn(\"flex items-center gap-2\", isActive && \"bg-accent\")}\n              onClick={() => handleSelect(company)}\n              data-testid={`dropdown-company-compact-${company.id}`}\n            >\n              <Icon className=\"h-4 w-4\" />\n              <span className=\"flex-1 truncate\">{company.name}</span>\n              {isActive && <Check className=\"h-4 w-4 text-primary\" />}\n            </DropdownMenuItem>\n          );\n        })}\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n","path":null,"size_bytes":8894,"size_tokens":null},"client/src/components/examples/Payroll.tsx":{"content":"import { Payroll } from \"../hr/Payroll\";\n\nexport default function PayrollExample() {\n  return <Payroll />;\n}\n","path":null,"size_bytes":109,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"design_guidelines.md":{"content":"# Unanza ERP System - Design Guidelines\n\n## Design Approach: Carbon Design System\n\n**Rationale:** Carbon Design System (IBM) is purpose-built for enterprise applications with complex data workflows, multiple user roles, and information-dense interfaces - perfectly aligned with Unanza's requirements.\n\n**Core Principles:**\n- Data clarity and scanability over visual decoration\n- Consistent, predictable interactions across all modules\n- Efficient task completion through familiar patterns\n- Professional, trustworthy aesthetic for business users\n\n---\n\n## Typography System\n\n**Font Stack:** IBM Plex Sans (via Google Fonts CDN)\n- **Display/Headers:** 600 weight, 2xl-4xl sizes for module titles\n- **Section Headers:** 600 weight, xl-2xl for card/table headers\n- **Body Text:** 400 weight, base-lg for forms, descriptions\n- **Data Tables:** 400 weight, sm-base for dense information\n- **Labels/Metadata:** 500 weight, xs-sm for field labels, badges\n\n**Hierarchy:**\n- Module page titles: text-3xl font-semibold\n- Section headers: text-xl font-semibold\n- Table headers: text-sm font-medium uppercase tracking-wide\n- Form labels: text-sm font-medium\n- Body content: text-base\n- Helper text/metadata: text-sm\n\n---\n\n## Layout System\n\n**Spacing Primitives:** Tailwind units of **2, 4, 6, 8, 12, 16**\n- Component padding: p-4, p-6\n- Card spacing: p-6, p-8\n- Section margins: mb-6, mb-8\n- Table cell padding: px-4 py-3\n- Form field spacing: space-y-4\n- Grid gaps: gap-4, gap-6\n\n**Grid Structure:**\n- Main container: max-w-7xl mx-auto px-4\n- Dashboard cards: grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\n- Two-column forms: grid-cols-1 md:grid-cols-2 gap-6\n- Data tables: full-width within containers\n\n**Layout Patterns:**\n- **Sidebar Navigation:** Fixed left sidebar (240px) with collapsible module sections\n- **Top Bar:** Fixed header (64px) with breadcrumbs, search, notifications, user menu\n- **Content Area:** Scrollable main content with consistent padding (p-6 lg:p-8)\n- **Module Pages:** Header with title/actions, then content cards/tables below\n\n---\n\n## Component Library\n\n### Navigation & Structure\n\n**Sidebar:**\n- Fixed left navigation with module groups (Sales, Warehouse, Financials, HR, System)\n- Icon + label for each menu item\n- Active state: subtle background with border-left accent\n- Collapsible sub-menus for module sections\n- Company logo at top, user profile at bottom\n\n**Top Bar:**\n- Breadcrumb navigation (Home / Sales / Orders / SO-001)\n- Global search bar (right side)\n- Notification bell icon\n- User avatar with dropdown menu\n\n**Page Header:**\n- Module/page title (left)\n- Action buttons (right) - primary actions like \"New Order\", \"Export\"\n- Optional tabs for multi-view pages\n\n### Data Display\n\n**Tables:**\n- Striped rows with hover state for scanability\n- Sortable column headers with sort indicators\n- Fixed header on scroll for long tables\n- Action column (right-aligned) with icon buttons or dropdown\n- Pagination footer with rows per page selector\n- Checkbox column (left) for bulk actions\n- Status badges in dedicated columns\n\n**Cards:**\n- White background with subtle border\n- Consistent padding (p-6)\n- Header with title and optional actions\n- Section dividers for grouped content\n- Stat cards: Large number, label below, optional trend indicator\n\n**Status Badges:**\n- Rounded pill shape with subtle background\n- Draft: gray, Confirmed: blue, Delivered: purple, Invoiced: green, Paid: green\n- Unpaid: red, Partial: yellow/orange\n- Small size (px-3 py-1), medium weight text\n\n**Data Lists:**\n- Label-value pairs in grid layout (grid-cols-2 gap-4)\n- Clear visual hierarchy between label and value\n- Dividers between major sections\n\n### Forms & Input\n\n**Form Layout:**\n- Two-column grid on desktop, single column on mobile\n- Consistent field spacing (space-y-4)\n- Field groups with subtle borders/backgrounds\n- Required field indicators (asterisk)\n\n**Input Fields:**\n- Standard text inputs with border, focus ring\n- Select dropdowns with search capability for long lists (customers, products)\n- Date pickers for order dates, delivery dates\n- Number inputs with steppers for quantities\n- Textarea for notes/descriptions\n\n**Form Actions:**\n- Right-aligned button group at form bottom\n- Primary action button + secondary/cancel\n- Disabled state for invalid forms\n- Loading state on submission\n\n**Search & Filters:**\n- Search bar with magnifying glass icon\n- Filter sidebar or dropdown with checkboxes, date ranges\n- Clear all filters option\n- Active filter chips showing current selections\n\n### Modals & Overlays\n\n**Modals:**\n- Centered overlay with dark backdrop\n- Max-width constraints (max-w-2xl, max-w-4xl for complex forms)\n- Header with title and close button\n- Scrollable body content\n- Footer with action buttons\n\n**Slide-out Panels:**\n- Right-side panel for detail views (order details, customer info)\n- Full height, 400-600px width\n- Close button and navigation within panel\n\n**Toasts/Notifications:**\n- Top-right corner position\n- Success (green), Error (red), Warning (yellow), Info (blue)\n- Auto-dismiss after 5 seconds with manual close option\n\n### Workflow Components\n\n**Status Workflow Indicators:**\n- Horizontal stepper showing Draft  Confirmed  Delivered  Invoiced\n- Completed steps: filled circles, current: outlined, pending: gray\n- Connecting lines between steps\n\n**Approval Flows:**\n- Card showing request details\n- Approve/Reject buttons with optional comment field\n- History timeline of approval actions\n\n### Dashboard Components\n\n**KPI Cards:**\n- Large number with label\n- Trend indicator (arrow + percentage)\n- Mini chart or sparkline optional\n- Click to drill-down\n\n**Charts:**\n- Use Chart.js or similar library\n- Bar charts for sales/inventory comparisons\n- Line charts for trends over time\n- Pie charts for category breakdowns\n- Consistent color palette from design system\n\n---\n\n## Portal-Specific Design\n\n### Vendor Portal\n- Simplified navigation (only vendor-relevant sections)\n- Purchase orders view with status filtering\n- Document download functionality\n- Restricted access indicators\n\n### Customer Portal\n- Customer-branded header area\n- Order history table with search\n- Invoice viewing/download\n- Support contact information\n- Simple, consumer-friendly interface (less dense than internal ERP)\n\n---\n\n## Responsive Behavior\n\n**Breakpoints:**\n- Mobile: < 768px - Single column layouts, hamburger menu, stacked tables\n- Tablet: 768px - 1024px - Two-column where appropriate, simplified sidebar\n- Desktop: > 1024px - Full layout with sidebar, multi-column grids\n\n**Mobile Adaptations:**\n- Tables convert to card-based lists\n- Sidebar becomes slide-out drawer\n- Form fields stack vertically\n- Reduced padding/spacing\n\n---\n\n## Animations & Micro-interactions\n\n**Minimal, Purposeful Only:**\n- Smooth transitions on hover states (150ms)\n- Loading spinners for data fetching\n- Slide-in animations for modals/panels (200ms)\n- Fade-in for toasts/notifications\n- No decorative animations - focus on feedback and state changes\n\n---\n\n## Images\n\n**Product Images:**\n- Square thumbnails (80px) in product lists\n- Larger preview (300px) on product detail pages\n- Placeholder image for products without photos\n\n**Employee Photos:**\n- Circular avatars (40px small, 80px medium, 120px large)\n- Fallback to initials in colored circle\n\n**No Hero Images:** This is an enterprise application, not a marketing site - no decorative hero sections needed. Focus on efficient data presentation.\n\n---\n\n## Implementation Notes\n\n- Use Heroicons for all interface icons (via CDN)\n- Maintain strict consistency across all 5 modules\n- Prioritize keyboard navigation and accessibility\n- Design for multi-role usage (admin, vendor, customer views)\n- Every table should be sortable, filterable, and paginated\n- All forms should have clear validation states and error messages","path":null,"size_bytes":7807,"size_tokens":null},"client/src/components/examples/StatCard.tsx":{"content":"import { StatCard } from \"../layout/StatCard\";\nimport { DollarSign } from \"lucide-react\";\n\nexport default function StatCardExample() {\n  return (\n    <StatCard \n      title=\"Total Sales\" \n      value={156000} \n      icon={DollarSign} \n      trend={12.5}\n      subtitle=\"vs last month\"\n    />\n  );\n}\n","path":null,"size_bytes":299,"size_tokens":null},"client/src/components/examples/DeliveryList.tsx":{"content":"import { DeliveryList } from \"../sales/DeliveryList\";\n\nexport default function DeliveryListExample() {\n  return <DeliveryList />;\n}\n","path":null,"size_bytes":132,"size_tokens":null},"client/src/components/examples/LocationList.tsx":{"content":"import { LocationList } from \"../warehouse/LocationList\";\n\nexport default function LocationListExample() {\n  return <LocationList />;\n}\n","path":null,"size_bytes":136,"size_tokens":null},"client/src/components/system/UserRoleManagement.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport {\n  Users,\n  Plus,\n  Edit,\n  Trash2,\n  Shield,\n  Building2,\n  Key,\n  UserCheck,\n  Search,\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Tabs,\n  TabsContent,\n  TabsList,\n  TabsTrigger,\n} from \"@/components/ui/tabs\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { Company, UserCompanyRole } from \"@shared/schema\";\n\ninterface Role {\n  id: string;\n  code: string;\n  name: string;\n  description: string | null;\n  isSystemRole: boolean | null;\n  permissions: string[];\n  createdAt: Date | null;\n}\n\nconst roleFormSchema = z.object({\n  name: z.string().min(1, \"Role name is required\"),\n  description: z.string().optional(),\n  permissions: z.array(z.string()),\n});\n\ntype RoleFormValues = z.infer<typeof roleFormSchema>;\n\nconst assignmentFormSchema = z.object({\n  userId: z.string().min(1, \"User is required\"),\n  companyId: z.string().min(1, \"Company is required\"),\n  roleId: z.string().min(1, \"Role is required\"),\n});\n\ntype AssignmentFormValues = z.infer<typeof assignmentFormSchema>;\n\nconst availablePermissions = [\n  { id: \"read:customers\", label: \"Read Customers\", category: \"Sales\" },\n  { id: \"write:customers\", label: \"Write Customers\", category: \"Sales\" },\n  { id: \"read:sales_orders\", label: \"Read Sales Orders\", category: \"Sales\" },\n  { id: \"write:sales_orders\", label: \"Write Sales Orders\", category: \"Sales\" },\n  { id: \"read:invoices\", label: \"Read Invoices\", category: \"Sales\" },\n  { id: \"write:invoices\", label: \"Write Invoices\", category: \"Sales\" },\n  \n  { id: \"read:products\", label: \"Read Products\", category: \"Warehouse\" },\n  { id: \"write:products\", label: \"Write Products\", category: \"Warehouse\" },\n  { id: \"read:stock\", label: \"Read Stock Levels\", category: \"Warehouse\" },\n  { id: \"write:stock\", label: \"Manage Stock\", category: \"Warehouse\" },\n  { id: \"read:movements\", label: \"Read Movements\", category: \"Warehouse\" },\n  { id: \"write:movements\", label: \"Write Movements\", category: \"Warehouse\" },\n  \n  { id: \"read:accounts\", label: \"Read Chart of Accounts\", category: \"Financials\" },\n  { id: \"write:accounts\", label: \"Write Chart of Accounts\", category: \"Financials\" },\n  { id: \"read:journal\", label: \"Read Journal Entries\", category: \"Financials\" },\n  { id: \"write:journal\", label: \"Write Journal Entries\", category: \"Financials\" },\n  { id: \"read:payables\", label: \"Read Payables\", category: \"Financials\" },\n  { id: \"write:payables\", label: \"Write Payables\", category: \"Financials\" },\n  { id: \"read:receivables\", label: \"Read Receivables\", category: \"Financials\" },\n  { id: \"write:receivables\", label: \"Write Receivables\", category: \"Financials\" },\n  \n  { id: \"read:employees\", label: \"Read Employees\", category: \"HR\" },\n  { id: \"write:employees\", label: \"Write Employees\", category: \"HR\" },\n  { id: \"read:payroll\", label: \"Read Payroll\", category: \"HR\" },\n  { id: \"write:payroll\", label: \"Write Payroll\", category: \"HR\" },\n  \n  { id: \"admin:companies\", label: \"Manage Companies\", category: \"System\" },\n  { id: \"admin:users\", label: \"Manage Users\", category: \"System\" },\n  { id: \"admin:roles\", label: \"Manage Roles\", category: \"System\" },\n  { id: \"*\", label: \"All Permissions (Super Admin)\", category: \"System\" },\n];\n\nconst permissionCategories = [\"Sales\", \"Warehouse\", \"Financials\", \"HR\", \"System\"];\n\ninterface User {\n  id: string;\n  email: string;\n  displayName: string;\n}\n\nexport function UserRoleManagement() {\n  const { toast } = useToast();\n  const [isRoleDialogOpen, setIsRoleDialogOpen] = useState(false);\n  const [isAssignmentDialogOpen, setIsAssignmentDialogOpen] = useState(false);\n  const [editingRole, setEditingRole] = useState<Role | null>(null);\n  const [deleteConfirm, setDeleteConfirm] = useState<Role | UserCompanyRole | null>(null);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n\n  // Fetch roles\n  const { data: roles = [], isLoading: rolesLoading } = useQuery<Role[]>({\n    queryKey: [\"/api/roles\"],\n  });\n\n  // Fetch companies\n  const { data: companies = [] } = useQuery<Company[]>({\n    queryKey: [\"/api/companies\"],\n  });\n\n  // Fetch user-company assignments\n  const { data: assignments = [], isLoading: assignmentsLoading } = useQuery<UserCompanyRole[]>({\n    queryKey: [\"/api/user-company-roles\"],\n  });\n\n  // Mock users for demo\n  const users: User[] = [\n    { id: \"user-admin\", email: \"admin@unanza.com\", displayName: \"Admin User\" },\n    { id: \"user-sales\", email: \"sales@unanza.com\", displayName: \"Sales Manager\" },\n    { id: \"user-warehouse\", email: \"warehouse@unanza.com\", displayName: \"Warehouse Lead\" },\n    { id: \"user-finance\", email: \"finance@unanza.com\", displayName: \"Finance Officer\" },\n  ];\n\n  const roleForm = useForm<RoleFormValues>({\n    resolver: zodResolver(roleFormSchema),\n    defaultValues: {\n      name: \"\",\n      description: \"\",\n      permissions: [],\n    },\n  });\n\n  const assignmentForm = useForm<AssignmentFormValues>({\n    resolver: zodResolver(assignmentFormSchema),\n    defaultValues: {\n      userId: \"\",\n      companyId: \"\",\n      roleId: \"\",\n    },\n  });\n\n  // Create role mutation\n  const createRoleMutation = useMutation({\n    mutationFn: async (data: RoleFormValues) => {\n      const response = await apiRequest(\"POST\", \"/api/roles\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/roles\"] });\n      toast({ title: \"Role created successfully\" });\n      setIsRoleDialogOpen(false);\n      roleForm.reset();\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  // Update role mutation\n  const updateRoleMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: RoleFormValues }) => {\n      const response = await apiRequest(\"PATCH\", `/api/roles/${id}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/roles\"] });\n      toast({ title: \"Role updated successfully\" });\n      setIsRoleDialogOpen(false);\n      setEditingRole(null);\n      roleForm.reset();\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  // Delete role mutation\n  const deleteRoleMutation = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(\"DELETE\", `/api/roles/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/roles\"] });\n      toast({ title: \"Role deleted successfully\" });\n      setDeleteConfirm(null);\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  // Create assignment mutation\n  const createAssignmentMutation = useMutation({\n    mutationFn: async (data: AssignmentFormValues) => {\n      const response = await apiRequest(\"POST\", \"/api/user-company-roles\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/user-company-roles\"] });\n      toast({ title: \"Role assigned successfully\" });\n      setIsAssignmentDialogOpen(false);\n      assignmentForm.reset();\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  // Delete assignment mutation\n  const deleteAssignmentMutation = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(\"DELETE\", `/api/user-company-roles/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/user-company-roles\"] });\n      toast({ title: \"Assignment removed successfully\" });\n      setDeleteConfirm(null);\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const handleEditRole = (role: Role) => {\n    setEditingRole(role);\n    roleForm.reset({\n      name: role.name,\n      description: role.description || \"\",\n      permissions: role.permissions || [],\n    });\n    setIsRoleDialogOpen(true);\n  };\n\n  const handleSubmitRole = (values: RoleFormValues) => {\n    if (editingRole) {\n      updateRoleMutation.mutate({ id: editingRole.id, data: values });\n    } else {\n      createRoleMutation.mutate(values);\n    }\n  };\n\n  const handleSubmitAssignment = (values: AssignmentFormValues) => {\n    createAssignmentMutation.mutate(values);\n  };\n\n  const handleOpenRoleDialog = () => {\n    setEditingRole(null);\n    roleForm.reset();\n    setIsRoleDialogOpen(true);\n  };\n\n  const handleOpenAssignmentDialog = () => {\n    assignmentForm.reset();\n    setIsAssignmentDialogOpen(true);\n  };\n\n  const filteredAssignments = assignments.filter((assignment) => {\n    if (!searchTerm) return true;\n    const user = users.find((u) => u.id === assignment.userId);\n    const company = companies.find((c) => c.id === assignment.companyId);\n    const role = roles.find((r) => r.id === assignment.roleId);\n    const searchLower = searchTerm.toLowerCase();\n    return (\n      user?.displayName.toLowerCase().includes(searchLower) ||\n      user?.email.toLowerCase().includes(searchLower) ||\n      company?.name.toLowerCase().includes(searchLower) ||\n      role?.name.toLowerCase().includes(searchLower)\n    );\n  });\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\" data-testid=\"text-page-title\">\n            User & Role Management\n          </h1>\n          <p className=\"text-muted-foreground\">\n            Manage roles, permissions, and user-company access assignments\n          </p>\n        </div>\n      </div>\n\n      <Tabs defaultValue=\"assignments\" className=\"space-y-4\">\n        <TabsList data-testid=\"tabs-view-selector\">\n          <TabsTrigger value=\"assignments\" data-testid=\"tab-assignments\">\n            <UserCheck className=\"h-4 w-4 mr-2\" />\n            User Assignments\n          </TabsTrigger>\n          <TabsTrigger value=\"roles\" data-testid=\"tab-roles\">\n            <Shield className=\"h-4 w-4 mr-2\" />\n            Roles & Permissions\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"assignments\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between gap-4 flex-wrap\">\n              <div>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Users className=\"h-5 w-5\" />\n                  User-Company Role Assignments\n                </CardTitle>\n                <CardDescription>\n                  Assign roles to users for specific companies\n                </CardDescription>\n              </div>\n              <div className=\"flex items-center gap-2 flex-wrap\">\n                <div className=\"relative\">\n                  <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    placeholder=\"Search assignments...\"\n                    value={searchTerm}\n                    onChange={(e) => setSearchTerm(e.target.value)}\n                    className=\"pl-8 w-[200px]\"\n                    data-testid=\"input-search-assignments\"\n                  />\n                </div>\n                <Button onClick={handleOpenAssignmentDialog} data-testid=\"button-add-assignment\">\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Assign Role\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <Table data-testid=\"table-assignments\">\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>User</TableHead>\n                    <TableHead>Company</TableHead>\n                    <TableHead>Role</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredAssignments.map((assignment) => {\n                    const user = users.find((u) => u.id === assignment.userId);\n                    const company = companies.find((c) => c.id === assignment.companyId);\n                    const role = roles.find((r) => r.id === assignment.roleId);\n\n                    return (\n                      <TableRow key={assignment.id} data-testid={`row-assignment-${assignment.id}`}>\n                        <TableCell>\n                          <div className=\"flex items-center gap-2\">\n                            <div className=\"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-sm font-medium\">\n                              {user?.displayName?.charAt(0) || \"U\"}\n                            </div>\n                            <div>\n                              <p className=\"font-medium\">{user?.displayName || assignment.userId}</p>\n                              <p className=\"text-xs text-muted-foreground\">{user?.email}</p>\n                            </div>\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex items-center gap-2\">\n                            <Building2 className=\"h-4 w-4 text-muted-foreground\" />\n                            <span>{company?.name || assignment.companyId}</span>\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <Badge variant=\"outline\">\n                            <Shield className=\"h-3 w-3 mr-1\" />\n                            {role?.name || assignment.roleId}\n                          </Badge>\n                        </TableCell>\n                        <TableCell>\n                          <Badge variant={assignment.isActive === true ? \"default\" : \"secondary\"}>\n                            {assignment.isActive ? \"Active\" : \"Inactive\"}\n                          </Badge>\n                        </TableCell>\n                        <TableCell className=\"text-right\">\n                          <Button\n                            size=\"icon\"\n                            variant=\"ghost\"\n                            onClick={() => setDeleteConfirm(assignment)}\n                            data-testid={`button-delete-assignment-${assignment.id}`}\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })}\n                  {filteredAssignments.length === 0 && !assignmentsLoading && (\n                    <TableRow>\n                      <TableCell colSpan={5} className=\"text-center py-8 text-muted-foreground\">\n                        {searchTerm ? \"No matching assignments found\" : \"No role assignments yet\"}\n                      </TableCell>\n                    </TableRow>\n                  )}\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"roles\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between gap-4 flex-wrap\">\n              <div>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Key className=\"h-5 w-5\" />\n                  Roles & Permissions\n                </CardTitle>\n                <CardDescription>\n                  Define roles with specific permission sets\n                </CardDescription>\n              </div>\n              <Button onClick={handleOpenRoleDialog} data-testid=\"button-add-role\">\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Create Role\n              </Button>\n            </CardHeader>\n            <CardContent>\n              <Table data-testid=\"table-roles\">\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Role Name</TableHead>\n                    <TableHead>Description</TableHead>\n                    <TableHead>Permissions</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {roles.map((role) => (\n                    <TableRow key={role.id} data-testid={`row-role-${role.id}`}>\n                      <TableCell>\n                        <div className=\"flex items-center gap-2\">\n                          <Shield className=\"h-4 w-4 text-muted-foreground\" />\n                          <span className=\"font-medium\">{role.name}</span>\n                        </div>\n                      </TableCell>\n                      <TableCell className=\"text-muted-foreground\">\n                        {role.description || \"-\"}\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-1 flex-wrap\">\n                          {role.permissions?.slice(0, 3).map((perm) => (\n                            <Badge key={perm} variant=\"secondary\" className=\"text-xs\">\n                              {perm === \"*\" ? \"All\" : perm}\n                            </Badge>\n                          ))}\n                          {role.permissions && role.permissions.length > 3 && (\n                            <Badge variant=\"outline\" className=\"text-xs\">\n                              +{role.permissions.length - 3} more\n                            </Badge>\n                          )}\n                        </div>\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <div className=\"flex items-center justify-end gap-1\">\n                          <Button\n                            size=\"icon\"\n                            variant=\"ghost\"\n                            onClick={() => handleEditRole(role)}\n                            data-testid={`button-edit-role-${role.id}`}\n                          >\n                            <Edit className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            size=\"icon\"\n                            variant=\"ghost\"\n                            onClick={() => setDeleteConfirm(role)}\n                            disabled={role.isSystemRole === true}\n                            data-testid={`button-delete-role-${role.id}`}\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                  {roles.length === 0 && !rolesLoading && (\n                    <TableRow>\n                      <TableCell colSpan={4} className=\"text-center py-8 text-muted-foreground\">\n                        No roles defined yet\n                      </TableCell>\n                    </TableRow>\n                  )}\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n\n      {/* Role Form Dialog */}\n      <Dialog open={isRoleDialogOpen} onOpenChange={setIsRoleDialogOpen}>\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>\n              {editingRole ? \"Edit Role\" : \"Create New Role\"}\n            </DialogTitle>\n            <DialogDescription>\n              {editingRole\n                ? \"Update the role details and permissions\"\n                : \"Define a new role with specific permissions\"}\n            </DialogDescription>\n          </DialogHeader>\n\n          <Form {...roleForm}>\n            <form onSubmit={roleForm.handleSubmit(handleSubmitRole)} className=\"space-y-6\">\n              <FormField\n                control={roleForm.control}\n                name=\"name\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Role Name</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"e.g., Sales Manager\"\n                        {...field}\n                        data-testid=\"input-role-name\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={roleForm.control}\n                name=\"description\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Description</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"Brief description of this role\"\n                        {...field}\n                        data-testid=\"input-role-description\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={roleForm.control}\n                name=\"permissions\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Permissions</FormLabel>\n                    <FormDescription>\n                      Select the permissions for this role\n                    </FormDescription>\n                    <div className=\"space-y-4 border rounded-md p-4 max-h-[300px] overflow-y-auto\">\n                      {permissionCategories.map((category) => (\n                        <div key={category}>\n                          <h4 className=\"font-medium text-sm mb-2\">{category}</h4>\n                          <div className=\"grid grid-cols-2 gap-2\">\n                            {availablePermissions\n                              .filter((p) => p.category === category)\n                              .map((permission) => (\n                                <div\n                                  key={permission.id}\n                                  className=\"flex items-center space-x-2\"\n                                >\n                                  <Checkbox\n                                    id={permission.id}\n                                    checked={field.value?.includes(permission.id)}\n                                    onCheckedChange={(checked) => {\n                                      const current = field.value || [];\n                                      if (checked) {\n                                        field.onChange([...current, permission.id]);\n                                      } else {\n                                        field.onChange(\n                                          current.filter((p) => p !== permission.id)\n                                        );\n                                      }\n                                    }}\n                                    data-testid={`checkbox-permission-${permission.id}`}\n                                  />\n                                  <label\n                                    htmlFor={permission.id}\n                                    className=\"text-sm cursor-pointer\"\n                                  >\n                                    {permission.label}\n                                  </label>\n                                </div>\n                              ))}\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <DialogFooter>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setIsRoleDialogOpen(false)}\n                  data-testid=\"button-cancel-role\"\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={createRoleMutation.isPending || updateRoleMutation.isPending}\n                  data-testid=\"button-submit-role\"\n                >\n                  {editingRole ? \"Update Role\" : \"Create Role\"}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Assignment Form Dialog */}\n      <Dialog open={isAssignmentDialogOpen} onOpenChange={setIsAssignmentDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Assign Role to User</DialogTitle>\n            <DialogDescription>\n              Grant a user access to a company with a specific role\n            </DialogDescription>\n          </DialogHeader>\n\n          <Form {...assignmentForm}>\n            <form onSubmit={assignmentForm.handleSubmit(handleSubmitAssignment)} className=\"space-y-4\">\n              <FormField\n                control={assignmentForm.control}\n                name=\"userId\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>User</FormLabel>\n                    <Select onValueChange={field.onChange} defaultValue={field.value}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-user\">\n                          <SelectValue placeholder=\"Select a user\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {users.map((user) => (\n                          <SelectItem key={user.id} value={user.id}>\n                            {user.displayName} ({user.email})\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={assignmentForm.control}\n                name=\"companyId\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Company</FormLabel>\n                    <Select onValueChange={field.onChange} defaultValue={field.value}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-company\">\n                          <SelectValue placeholder=\"Select a company\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {companies.map((company) => (\n                          <SelectItem key={company.id} value={company.id}>\n                            {company.name} ({company.code})\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={assignmentForm.control}\n                name=\"roleId\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Role</FormLabel>\n                    <Select onValueChange={field.onChange} defaultValue={field.value}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-role\">\n                          <SelectValue placeholder=\"Select a role\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {roles.map((role) => (\n                          <SelectItem key={role.id} value={role.id}>\n                            {role.name}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <DialogFooter>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setIsAssignmentDialogOpen(false)}\n                  data-testid=\"button-cancel-assignment\"\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={createAssignmentMutation.isPending}\n                  data-testid=\"button-submit-assignment\"\n                >\n                  Assign Role\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Delete Confirmation Dialog */}\n      <Dialog open={!!deleteConfirm} onOpenChange={() => setDeleteConfirm(null)}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Confirm Deletion</DialogTitle>\n            <DialogDescription>\n              Are you sure you want to delete this{\" \"}\n              {\"name\" in (deleteConfirm || {}) ? \"role\" : \"assignment\"}? This action\n              cannot be undone.\n            </DialogDescription>\n          </DialogHeader>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => setDeleteConfirm(null)}\n              data-testid=\"button-cancel-delete\"\n            >\n              Cancel\n            </Button>\n            <Button\n              variant=\"destructive\"\n              onClick={() => {\n                if (deleteConfirm) {\n                  if (\"name\" in deleteConfirm) {\n                    deleteRoleMutation.mutate(deleteConfirm.id);\n                  } else {\n                    deleteAssignmentMutation.mutate(deleteConfirm.id);\n                  }\n                }\n              }}\n              disabled={deleteRoleMutation.isPending || deleteAssignmentMutation.isPending}\n              data-testid=\"button-confirm-delete\"\n            >\n              Delete\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":31023,"size_tokens":null},"client/src/components/system/VendorPortal.tsx":{"content":"import { useState } from \"react\";\nimport { DataTable, type Column } from \"@/components/layout/DataTable\";\nimport { StatusBadge } from \"@/components/layout/StatusBadge\";\nimport { PageHeader } from \"@/components/layout/PageHeader\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Plus, Download, Eye, Edit, Trash2, Building2 } from \"lucide-react\";\nimport { mockVendors, mockPurchaseOrders } from \"@/lib/mockData\";\n\ntype Vendor = typeof mockVendors[0];\n\nexport function VendorPortal() {\n  const [vendors, setVendors] = useState(mockVendors);\n  const [selectedVendor, setSelectedVendor] = useState<Vendor | null>(null);\n  const [isFormOpen, setIsFormOpen] = useState(false);\n  const [isDetailOpen, setIsDetailOpen] = useState(false);\n  const [editingVendor, setEditingVendor] = useState<Vendor | null>(null);\n\n  const [formData, setFormData] = useState({\n    name: \"\",\n    email: \"\",\n    phone: \"\",\n    status: \"active\",\n  });\n\n  const handleOpenForm = (vendor?: Vendor) => {\n    if (vendor) {\n      setEditingVendor(vendor);\n      setFormData({\n        name: vendor.name,\n        email: vendor.email,\n        phone: vendor.phone,\n        status: vendor.status,\n      });\n    } else {\n      setEditingVendor(null);\n      setFormData({ name: \"\", email: \"\", phone: \"\", status: \"active\" });\n    }\n    setIsFormOpen(true);\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (editingVendor) {\n      setVendors(vendors.map(v => \n        v.id === editingVendor.id ? { ...v, ...formData } : v\n      ));\n      console.log(\"Updated vendor:\", editingVendor.id);\n    } else {\n      // todo: remove mock functionality\n      const newVendor: Vendor = {\n        id: `V${String(vendors.length + 1).padStart(3, \"0\")}`,\n        activePOs: 0,\n        totalValue: 0,\n        ...formData,\n      } as Vendor;\n      setVendors([...vendors, newVendor]);\n      console.log(\"Created vendor:\", newVendor);\n    }\n    setIsFormOpen(false);\n  };\n\n  const handleViewVendor = (vendor: Vendor) => {\n    setSelectedVendor(vendor);\n    setIsDetailOpen(true);\n  };\n\n  const handleDeleteVendor = (vendorId: string) => {\n    setVendors(vendors.filter(v => v.id !== vendorId));\n    console.log(\"Deleted vendor:\", vendorId);\n  };\n\n  const vendorPOs = selectedVendor \n    ? mockPurchaseOrders.filter(po => po.vendorId === selectedVendor.id)\n    : [];\n\n  const columns: Column<Vendor>[] = [\n    { key: \"id\", header: \"ID\", sortable: true },\n    { \n      key: \"name\", \n      header: \"Vendor\", \n      sortable: true,\n      render: (item) => (\n        <div className=\"flex items-center gap-3\">\n          <div className=\"flex items-center justify-center w-8 h-8 rounded-md bg-muted\">\n            <Building2 className=\"h-4 w-4 text-muted-foreground\" />\n          </div>\n          <div>\n            <p className=\"font-medium\">{item.name}</p>\n            <p className=\"text-sm text-muted-foreground\">{item.email}</p>\n          </div>\n        </div>\n      )\n    },\n    { key: \"phone\", header: \"Phone\" },\n    { \n      key: \"status\", \n      header: \"Status\",\n      render: (item) => <StatusBadge status={item.status as \"active\" | \"pending\" | \"inactive\"} />\n    },\n    { key: \"activePOs\", header: \"Active POs\", className: \"text-center\" },\n    { \n      key: \"totalValue\", \n      header: \"Total Value\", \n      sortable: true,\n      className: \"text-right\",\n      render: (item) => `$${item.totalValue.toLocaleString()}`\n    },\n    {\n      key: \"actions\",\n      header: \"\",\n      className: \"text-right\",\n      render: (item) => (\n        <div className=\"flex justify-end gap-1\" onClick={(e) => e.stopPropagation()}>\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => handleViewVendor(item)} data-testid={`button-view-${item.id}`}>\n            <Eye className=\"h-4 w-4\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => handleOpenForm(item)} data-testid={`button-edit-${item.id}`}>\n            <Edit className=\"h-4 w-4\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => handleDeleteVendor(item.id)} data-testid={`button-delete-${item.id}`}>\n            <Trash2 className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      ),\n    },\n  ];\n\n  return (\n    <div>\n      <PageHeader\n        title=\"Vendor Portal\"\n        description=\"Manage vendor relationships and access\"\n        actions={\n          <>\n            <Button variant=\"outline\" data-testid=\"button-export\">\n              <Download className=\"h-4 w-4 mr-2\" />\n              Export\n            </Button>\n            <Button onClick={() => handleOpenForm()} data-testid=\"button-new-vendor\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Vendor\n            </Button>\n          </>\n        }\n      />\n\n      <DataTable\n        data={vendors}\n        columns={columns}\n        searchKey=\"name\"\n        searchPlaceholder=\"Search vendors...\"\n        onRowClick={handleViewVendor}\n      />\n\n      <Dialog open={isFormOpen} onOpenChange={setIsFormOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>{editingVendor ? \"Edit Vendor\" : \"New Vendor\"}</DialogTitle>\n          </DialogHeader>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"name\">Company Name *</Label>\n              <Input\n                id=\"name\"\n                value={formData.name}\n                onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                required\n                data-testid=\"input-name\"\n              />\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"email\">Email *</Label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  value={formData.email}\n                  onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n                  required\n                  data-testid=\"input-email\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"phone\">Phone</Label>\n                <Input\n                  id=\"phone\"\n                  value={formData.phone}\n                  onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\n                  data-testid=\"input-phone\"\n                />\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"status\">Status</Label>\n              <Select\n                value={formData.status}\n                onValueChange={(value) => setFormData({ ...formData, status: value })}\n              >\n                <SelectTrigger data-testid=\"select-status\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"active\">Active</SelectItem>\n                  <SelectItem value=\"pending\">Pending</SelectItem>\n                  <SelectItem value=\"inactive\">Inactive</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"flex justify-end gap-2 pt-4\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => setIsFormOpen(false)} data-testid=\"button-cancel\">\n                Cancel\n              </Button>\n              <Button type=\"submit\" data-testid=\"button-save\">\n                {editingVendor ? \"Update\" : \"Create\"}\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isDetailOpen} onOpenChange={setIsDetailOpen}>\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Vendor Profile</DialogTitle>\n          </DialogHeader>\n          {selectedVendor && (\n            <div className=\"space-y-6\">\n              <div className=\"flex items-start gap-4\">\n                <div className=\"flex items-center justify-center w-16 h-16 rounded-md bg-muted\">\n                  <Building2 className=\"h-8 w-8 text-muted-foreground\" />\n                </div>\n                <div>\n                  <h2 className=\"text-xl font-semibold\" data-testid=\"text-vendor-name\">{selectedVendor.name}</h2>\n                  <p className=\"text-muted-foreground\">{selectedVendor.email}</p>\n                  <StatusBadge status={selectedVendor.status as \"active\" | \"pending\" | \"inactive\"} className=\"mt-2\" />\n                </div>\n              </div>\n\n              <div className=\"grid md:grid-cols-2 gap-4\">\n                <Card>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-base\">Contact Information</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-2 text-sm\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Email</span>\n                      <span>{selectedVendor.email}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Phone</span>\n                      <span>{selectedVendor.phone}</span>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-base\">Statistics</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-2 text-sm\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Active POs</span>\n                      <span>{selectedVendor.activePOs}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Total Value</span>\n                      <span className=\"font-semibold\">${selectedVendor.totalValue.toLocaleString()}</span>\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n\n              <Card>\n                <CardHeader className=\"pb-3\">\n                  <CardTitle className=\"text-base\">Purchase Orders</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  {vendorPOs.length > 0 ? (\n                    <div className=\"border rounded-md divide-y\">\n                      {vendorPOs.map((po) => (\n                        <div key={po.id} className=\"flex items-center justify-between p-3 text-sm\">\n                          <div>\n                            <span className=\"font-medium\">{po.id}</span>\n                            <span className=\"text-muted-foreground ml-2\">{po.date}</span>\n                          </div>\n                          <div className=\"flex items-center gap-3\">\n                            <StatusBadge status={po.status as \"draft\" | \"ordered\" | \"received\"} />\n                            <span className=\"font-medium\">${po.total.toLocaleString()}</span>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  ) : (\n                    <p className=\"text-sm text-muted-foreground\">No purchase orders found</p>\n                  )}\n                </CardContent>\n              </Card>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":11909,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"client/src/components/reports/FinanceReports.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  DollarSign,\n  TrendingUp,\n  TrendingDown,\n  BarChart3,\n  PieChart,\n  FileText,\n  ArrowUp,\n  ArrowDown,\n  Minus,\n} from \"lucide-react\";\nimport {\n  mockProfitLoss,\n  mockBalanceSheet,\n  mockCashFlow,\n  mockProductProfitability,\n  mockARAgingReport,\n  mockAPAgingReport,\n  mockFinancialRatios,\n  mockVATReport,\n  mockTrialBalance,\n} from \"@/lib/reportData\";\nimport { cn } from \"@/lib/utils\";\n\nexport function FinanceReports() {\n  const [activeTab, setActiveTab] = useState(\"pnl\");\n\n  return (\n    <div className=\"space-y-6\">\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList className=\"grid grid-cols-5 w-full max-w-3xl\">\n          <TabsTrigger value=\"pnl\" data-testid=\"tab-pnl\">P&L</TabsTrigger>\n          <TabsTrigger value=\"balance\" data-testid=\"tab-balance\">Balance Sheet</TabsTrigger>\n          <TabsTrigger value=\"cashflow\" data-testid=\"tab-cashflow\">Cash Flow</TabsTrigger>\n          <TabsTrigger value=\"aging\" data-testid=\"tab-aging\">AR/AP Aging</TabsTrigger>\n          <TabsTrigger value=\"ratios\" data-testid=\"tab-ratios\">Ratios</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"pnl\" className=\"space-y-6 mt-6\">\n          <div className=\"grid md:grid-cols-4 gap-4\">\n            <Card data-testid=\"card-total-revenue\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm text-muted-foreground\">Total Revenue</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-2xl font-semibold text-green-600 dark:text-green-400\" data-testid=\"text-total-revenue\">\n                  ${mockProfitLoss.revenue.totalRevenue.toLocaleString()}\n                </p>\n              </CardContent>\n            </Card>\n            <Card data-testid=\"card-gross-profit\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm text-muted-foreground\">Gross Profit</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-2xl font-semibold\" data-testid=\"text-gross-profit\">\n                  ${mockProfitLoss.grossProfit.toLocaleString()}\n                </p>\n                <p className=\"text-sm text-muted-foreground\">{mockProfitLoss.grossMargin}% margin</p>\n              </CardContent>\n            </Card>\n            <Card data-testid=\"card-operating-income\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm text-muted-foreground\">Operating Income</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-2xl font-semibold\" data-testid=\"text-operating-income\">\n                  ${mockProfitLoss.operatingIncome.toLocaleString()}\n                </p>\n              </CardContent>\n            </Card>\n            <Card data-testid=\"card-net-income\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm text-muted-foreground\">Net Income</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className={cn(\n                  \"text-2xl font-semibold\",\n                  mockProfitLoss.netIncome >= 0 ? \"text-green-600\" : \"text-red-600\"\n                )} data-testid=\"text-net-income\">\n                  ${mockProfitLoss.netIncome.toLocaleString()}\n                </p>\n                <p className=\"text-sm text-muted-foreground\">{mockProfitLoss.netMargin}% margin</p>\n              </CardContent>\n            </Card>\n          </div>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <FileText className=\"h-5 w-5\" />\n                Profit & Loss Statement\n              </CardTitle>\n              <CardDescription>{mockProfitLoss.period}</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-1\">\n                <div className=\"font-semibold py-2 border-b\">Revenue</div>\n                <div className=\"flex justify-between py-1 pl-4\">\n                  <span>Product Sales</span>\n                  <span>${mockProfitLoss.revenue.productSales.toLocaleString()}</span>\n                </div>\n                <div className=\"flex justify-between py-1 pl-4\">\n                  <span>Service Revenue</span>\n                  <span>${mockProfitLoss.revenue.serviceRevenue.toLocaleString()}</span>\n                </div>\n                <div className=\"flex justify-between py-1 pl-4\">\n                  <span>Other Income</span>\n                  <span>${mockProfitLoss.revenue.otherIncome.toLocaleString()}</span>\n                </div>\n                <div className=\"flex justify-between py-2 font-semibold border-t bg-muted/50 px-2 rounded\">\n                  <span>Total Revenue</span>\n                  <span>${mockProfitLoss.revenue.totalRevenue.toLocaleString()}</span>\n                </div>\n\n                <div className=\"font-semibold py-2 border-b mt-4\">Cost of Sales</div>\n                <div className=\"flex justify-between py-1 pl-4\">\n                  <span>Materials</span>\n                  <span>${mockProfitLoss.costOfSales.materials.toLocaleString()}</span>\n                </div>\n                <div className=\"flex justify-between py-1 pl-4\">\n                  <span>Direct Labor</span>\n                  <span>${mockProfitLoss.costOfSales.directLabor.toLocaleString()}</span>\n                </div>\n                <div className=\"flex justify-between py-1 pl-4\">\n                  <span>Overhead</span>\n                  <span>${mockProfitLoss.costOfSales.overhead.toLocaleString()}</span>\n                </div>\n                <div className=\"flex justify-between py-2 font-semibold border-t bg-muted/50 px-2 rounded\">\n                  <span>Total COGS</span>\n                  <span>${mockProfitLoss.costOfSales.totalCOGS.toLocaleString()}</span>\n                </div>\n\n                <div className=\"flex justify-between py-3 font-bold text-lg border-y mt-4 bg-green-50 dark:bg-green-900/20 px-2 rounded\">\n                  <span>Gross Profit</span>\n                  <span>${mockProfitLoss.grossProfit.toLocaleString()} ({mockProfitLoss.grossMargin}%)</span>\n                </div>\n\n                <div className=\"font-semibold py-2 border-b mt-4\">Operating Expenses</div>\n                <div className=\"flex justify-between py-1 pl-4\">\n                  <span>Salaries & Wages</span>\n                  <span>${mockProfitLoss.operatingExpenses.salaries.toLocaleString()}</span>\n                </div>\n                <div className=\"flex justify-between py-1 pl-4\">\n                  <span>Rent</span>\n                  <span>${mockProfitLoss.operatingExpenses.rent.toLocaleString()}</span>\n                </div>\n                <div className=\"flex justify-between py-1 pl-4\">\n                  <span>Utilities</span>\n                  <span>${mockProfitLoss.operatingExpenses.utilities.toLocaleString()}</span>\n                </div>\n                <div className=\"flex justify-between py-1 pl-4\">\n                  <span>Marketing</span>\n                  <span>${mockProfitLoss.operatingExpenses.marketing.toLocaleString()}</span>\n                </div>\n                <div className=\"flex justify-between py-1 pl-4\">\n                  <span>Depreciation</span>\n                  <span>${mockProfitLoss.operatingExpenses.depreciation.toLocaleString()}</span>\n                </div>\n                <div className=\"flex justify-between py-1 pl-4\">\n                  <span>Other Expenses</span>\n                  <span>${mockProfitLoss.operatingExpenses.other.toLocaleString()}</span>\n                </div>\n                <div className=\"flex justify-between py-2 font-semibold border-t bg-muted/50 px-2 rounded\">\n                  <span>Total Operating Expenses</span>\n                  <span>${mockProfitLoss.operatingExpenses.totalOpex.toLocaleString()}</span>\n                </div>\n\n                <div className=\"flex justify-between py-3 font-bold text-lg border-y mt-4 bg-blue-50 dark:bg-blue-900/20 px-2 rounded\">\n                  <span>Operating Income</span>\n                  <span>${mockProfitLoss.operatingIncome.toLocaleString()}</span>\n                </div>\n\n                <div className=\"flex justify-between py-1 pl-4 mt-4\">\n                  <span>Interest Expense</span>\n                  <span>(${mockProfitLoss.otherExpenses.interest.toLocaleString()})</span>\n                </div>\n                <div className=\"flex justify-between py-1 pl-4\">\n                  <span>Income Taxes</span>\n                  <span>(${mockProfitLoss.otherExpenses.taxes.toLocaleString()})</span>\n                </div>\n\n                <div className={cn(\n                  \"flex justify-between py-3 font-bold text-lg border-y mt-4 px-2 rounded\",\n                  mockProfitLoss.netIncome >= 0 ? \"bg-green-50 dark:bg-green-900/20\" : \"bg-red-50 dark:bg-red-900/20\"\n                )}>\n                  <span>Net Income</span>\n                  <span className={mockProfitLoss.netIncome >= 0 ? \"text-green-600\" : \"text-red-600\"}>\n                    ${mockProfitLoss.netIncome.toLocaleString()} ({mockProfitLoss.netMargin}%)\n                  </span>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"balance\" className=\"space-y-6 mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <BarChart3 className=\"h-5 w-5\" />\n                Balance Sheet\n              </CardTitle>\n              <CardDescription>As of {mockBalanceSheet.asOfDate}</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid md:grid-cols-2 gap-8\">\n                <div>\n                  <h3 className=\"font-bold text-lg mb-4 pb-2 border-b\">ASSETS</h3>\n                  \n                  <div className=\"font-semibold py-2\">Current Assets</div>\n                  <div className=\"flex justify-between py-1 pl-4\">\n                    <span>Cash & Bank</span>\n                    <span>${mockBalanceSheet.assets.current.cash.toLocaleString()}</span>\n                  </div>\n                  <div className=\"flex justify-between py-1 pl-4\">\n                    <span>Accounts Receivable</span>\n                    <span>${mockBalanceSheet.assets.current.accountsReceivable.toLocaleString()}</span>\n                  </div>\n                  <div className=\"flex justify-between py-1 pl-4\">\n                    <span>Inventory</span>\n                    <span>${mockBalanceSheet.assets.current.inventory.toLocaleString()}</span>\n                  </div>\n                  <div className=\"flex justify-between py-1 pl-4\">\n                    <span>Prepaid Expenses</span>\n                    <span>${mockBalanceSheet.assets.current.prepaidExpenses.toLocaleString()}</span>\n                  </div>\n                  <div className=\"flex justify-between py-2 font-medium bg-muted/50 px-2 rounded\">\n                    <span>Total Current Assets</span>\n                    <span>${mockBalanceSheet.assets.current.totalCurrent.toLocaleString()}</span>\n                  </div>\n\n                  <div className=\"font-semibold py-2 mt-4\">Fixed Assets</div>\n                  <div className=\"flex justify-between py-1 pl-4\">\n                    <span>Land</span>\n                    <span>${mockBalanceSheet.assets.fixed.land.toLocaleString()}</span>\n                  </div>\n                  <div className=\"flex justify-between py-1 pl-4\">\n                    <span>Buildings (net)</span>\n                    <span>${mockBalanceSheet.assets.fixed.buildings.toLocaleString()}</span>\n                  </div>\n                  <div className=\"flex justify-between py-1 pl-4\">\n                    <span>Equipment (net)</span>\n                    <span>${mockBalanceSheet.assets.fixed.equipment.toLocaleString()}</span>\n                  </div>\n                  <div className=\"flex justify-between py-1 pl-4\">\n                    <span>Vehicles (net)</span>\n                    <span>${mockBalanceSheet.assets.fixed.vehicles.toLocaleString()}</span>\n                  </div>\n                  <div className=\"flex justify-between py-1 pl-4\">\n                    <span>Furniture (net)</span>\n                    <span>${mockBalanceSheet.assets.fixed.furniture.toLocaleString()}</span>\n                  </div>\n                  <div className=\"flex justify-between py-1 pl-4\">\n                    <span>Computers (net)</span>\n                    <span>${mockBalanceSheet.assets.fixed.computers.toLocaleString()}</span>\n                  </div>\n                  <div className=\"flex justify-between py-2 font-medium bg-muted/50 px-2 rounded\">\n                    <span>Total Fixed Assets</span>\n                    <span>${mockBalanceSheet.assets.fixed.totalFixed.toLocaleString()}</span>\n                  </div>\n\n                  <div className=\"flex justify-between py-3 font-bold text-lg border-t mt-4 bg-blue-50 dark:bg-blue-900/20 px-2 rounded\">\n                    <span>TOTAL ASSETS</span>\n                    <span>${mockBalanceSheet.assets.totalAssets.toLocaleString()}</span>\n                  </div>\n                </div>\n\n                <div>\n                  <h3 className=\"font-bold text-lg mb-4 pb-2 border-b\">LIABILITIES & EQUITY</h3>\n                  \n                  <div className=\"font-semibold py-2\">Current Liabilities</div>\n                  <div className=\"flex justify-between py-1 pl-4\">\n                    <span>Accounts Payable</span>\n                    <span>${mockBalanceSheet.liabilities.current.accountsPayable.toLocaleString()}</span>\n                  </div>\n                  <div className=\"flex justify-between py-1 pl-4\">\n                    <span>Accrued Expenses</span>\n                    <span>${mockBalanceSheet.liabilities.current.accruedExpenses.toLocaleString()}</span>\n                  </div>\n                  <div className=\"flex justify-between py-1 pl-4\">\n                    <span>Taxes Payable</span>\n                    <span>${mockBalanceSheet.liabilities.current.taxesPayable.toLocaleString()}</span>\n                  </div>\n                  <div className=\"flex justify-between py-1 pl-4\">\n                    <span>Other Current</span>\n                    <span>${mockBalanceSheet.liabilities.current.otherCurrent.toLocaleString()}</span>\n                  </div>\n                  <div className=\"flex justify-between py-2 font-medium bg-muted/50 px-2 rounded\">\n                    <span>Total Current Liabilities</span>\n                    <span>${mockBalanceSheet.liabilities.current.totalCurrent.toLocaleString()}</span>\n                  </div>\n\n                  <div className=\"font-semibold py-2 mt-4\">Long-Term Liabilities</div>\n                  <div className=\"flex justify-between py-1 pl-4\">\n                    <span>Bank Loans</span>\n                    <span>${mockBalanceSheet.liabilities.longTerm.bankLoans.toLocaleString()}</span>\n                  </div>\n                  <div className=\"flex justify-between py-1 pl-4\">\n                    <span>Mortgage</span>\n                    <span>${mockBalanceSheet.liabilities.longTerm.mortgage.toLocaleString()}</span>\n                  </div>\n                  <div className=\"flex justify-between py-1 pl-4\">\n                    <span>Equipment Loans</span>\n                    <span>${mockBalanceSheet.liabilities.longTerm.equipmentLoans.toLocaleString()}</span>\n                  </div>\n                  <div className=\"flex justify-between py-2 font-medium bg-muted/50 px-2 rounded\">\n                    <span>Total Long-Term</span>\n                    <span>${mockBalanceSheet.liabilities.longTerm.totalLongTerm.toLocaleString()}</span>\n                  </div>\n\n                  <div className=\"flex justify-between py-2 font-semibold border-t mt-2\">\n                    <span>TOTAL LIABILITIES</span>\n                    <span>${mockBalanceSheet.liabilities.totalLiabilities.toLocaleString()}</span>\n                  </div>\n\n                  <div className=\"font-semibold py-2 mt-4\">Equity</div>\n                  <div className=\"flex justify-between py-1 pl-4\">\n                    <span>Common Stock</span>\n                    <span>${mockBalanceSheet.equity.commonStock.toLocaleString()}</span>\n                  </div>\n                  <div className=\"flex justify-between py-1 pl-4\">\n                    <span>Additional Paid-in</span>\n                    <span>${mockBalanceSheet.equity.additionalPaidIn.toLocaleString()}</span>\n                  </div>\n                  <div className=\"flex justify-between py-1 pl-4\">\n                    <span>Retained Earnings</span>\n                    <span>${mockBalanceSheet.equity.retainedEarnings.toLocaleString()}</span>\n                  </div>\n                  <div className=\"flex justify-between py-1 pl-4\">\n                    <span>Current Year</span>\n                    <span className={mockBalanceSheet.equity.currentYearEarnings >= 0 ? \"\" : \"text-red-600\"}>\n                      ${mockBalanceSheet.equity.currentYearEarnings.toLocaleString()}\n                    </span>\n                  </div>\n                  <div className=\"flex justify-between py-2 font-medium bg-muted/50 px-2 rounded\">\n                    <span>Total Equity</span>\n                    <span>${mockBalanceSheet.equity.totalEquity.toLocaleString()}</span>\n                  </div>\n\n                  <div className=\"flex justify-between py-3 font-bold text-lg border-t mt-4 bg-purple-50 dark:bg-purple-900/20 px-2 rounded\">\n                    <span>TOTAL LIAB & EQUITY</span>\n                    <span>${mockBalanceSheet.totalLiabilitiesAndEquity.toLocaleString()}</span>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"cashflow\" className=\"space-y-6 mt-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <DollarSign className=\"h-5 w-5\" />\n                Cash Flow Statement\n              </CardTitle>\n              <CardDescription>Monthly cash flow by activity type</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Month</TableHead>\n                    <TableHead className=\"text-right\">Operating</TableHead>\n                    <TableHead className=\"text-right\">Investing</TableHead>\n                    <TableHead className=\"text-right\">Financing</TableHead>\n                    <TableHead className=\"text-right\">Net Change</TableHead>\n                    <TableHead className=\"text-right\">Ending Balance</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {mockCashFlow.map((month) => (\n                    <TableRow key={month.month}>\n                      <TableCell className=\"font-medium\">{month.month}</TableCell>\n                      <TableCell className=\"text-right text-green-600\">\n                        +${month.operating.toLocaleString()}\n                      </TableCell>\n                      <TableCell className={cn(\n                        \"text-right\",\n                        month.investing >= 0 ? \"text-green-600\" : \"text-red-600\"\n                      )}>\n                        {month.investing >= 0 ? \"+\" : \"\"}${month.investing.toLocaleString()}\n                      </TableCell>\n                      <TableCell className={cn(\n                        \"text-right\",\n                        month.financing >= 0 ? \"text-green-600\" : \"text-red-600\"\n                      )}>\n                        {month.financing >= 0 ? \"+\" : \"\"}${month.financing.toLocaleString()}\n                      </TableCell>\n                      <TableCell className={cn(\n                        \"text-right font-medium\",\n                        month.netChange >= 0 ? \"text-green-600\" : \"text-red-600\"\n                      )}>\n                        {month.netChange >= 0 ? \"+\" : \"\"}${month.netChange.toLocaleString()}\n                      </TableCell>\n                      <TableCell className=\"text-right font-semibold\">\n                        ${month.endingBalance.toLocaleString()}\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"aging\" className=\"space-y-6 mt-6\">\n          <div className=\"grid md:grid-cols-2 gap-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2 text-green-600\">\n                  <ArrowDown className=\"h-5 w-5\" />\n                  Accounts Receivable Aging\n                </CardTitle>\n                <CardDescription>Outstanding customer invoices by age</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  {mockARAgingReport.map((aging) => (\n                    <div key={aging.ageRange} className=\"space-y-1\">\n                      <div className=\"flex justify-between text-sm\">\n                        <span>{aging.ageRange}</span>\n                        <span className=\"font-medium\">${aging.amount.toLocaleString()} ({aging.count})</span>\n                      </div>\n                      <div className=\"h-4 bg-muted rounded-md overflow-hidden\">\n                        <div\n                          className=\"h-full bg-green-500\"\n                          style={{ width: `${aging.percentage}%` }}\n                        />\n                      </div>\n                    </div>\n                  ))}\n                </div>\n                <div className=\"mt-4 pt-4 border-t flex justify-between font-semibold\">\n                  <span>Total AR</span>\n                  <span>${mockARAgingReport.reduce((sum, a) => sum + a.amount, 0).toLocaleString()}</span>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2 text-red-600\">\n                  <ArrowUp className=\"h-5 w-5\" />\n                  Accounts Payable Aging\n                </CardTitle>\n                <CardDescription>Outstanding vendor invoices by age</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  {mockAPAgingReport.map((aging) => (\n                    <div key={aging.ageRange} className=\"space-y-1\">\n                      <div className=\"flex justify-between text-sm\">\n                        <span>{aging.ageRange}</span>\n                        <span className=\"font-medium\">${aging.amount.toLocaleString()} ({aging.count})</span>\n                      </div>\n                      <div className=\"h-4 bg-muted rounded-md overflow-hidden\">\n                        <div\n                          className=\"h-full bg-red-500\"\n                          style={{ width: `${aging.percentage}%` }}\n                        />\n                      </div>\n                    </div>\n                  ))}\n                </div>\n                <div className=\"mt-4 pt-4 border-t flex justify-between font-semibold\">\n                  <span>Total AP</span>\n                  <span>${mockAPAgingReport.reduce((sum, a) => sum + a.amount, 0).toLocaleString()}</span>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"ratios\" className=\"space-y-6 mt-6\">\n          <div className=\"grid md:grid-cols-2 lg:grid-cols-4 gap-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-sm\">Liquidity Ratios</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Current Ratio</span>\n                  <span className=\"font-medium\">{mockFinancialRatios.liquidity.currentRatio}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Quick Ratio</span>\n                  <span className=\"font-medium\">{mockFinancialRatios.liquidity.quickRatio}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Cash Ratio</span>\n                  <span className=\"font-medium\">{mockFinancialRatios.liquidity.cashRatio}</span>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-sm\">Profitability Ratios</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Gross Margin</span>\n                  <span className=\"font-medium\">{mockFinancialRatios.profitability.grossMargin}%</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Operating Margin</span>\n                  <span className=\"font-medium\">{mockFinancialRatios.profitability.operatingMargin}%</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Net Margin</span>\n                  <span className={cn(\"font-medium\", mockFinancialRatios.profitability.netMargin < 0 && \"text-red-600\")}>\n                    {mockFinancialRatios.profitability.netMargin}%\n                  </span>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-sm\">Efficiency Ratios</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Inventory Turnover</span>\n                  <span className=\"font-medium\">{mockFinancialRatios.efficiency.inventoryTurnover}x</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">AR Turnover</span>\n                  <span className=\"font-medium\">{mockFinancialRatios.efficiency.receivablesTurnover}x</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Asset Turnover</span>\n                  <span className=\"font-medium\">{mockFinancialRatios.efficiency.assetTurnover}x</span>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-sm\">Leverage Ratios</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Debt/Equity</span>\n                  <span className=\"font-medium\">{mockFinancialRatios.leverage.debtToEquity}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Debt/Assets</span>\n                  <span className=\"font-medium\">{mockFinancialRatios.leverage.debtToAssets}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Interest Coverage</span>\n                  <span className=\"font-medium\">{mockFinancialRatios.leverage.interestCoverage}x</span>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":28603,"size_tokens":null},"client/src/components/warehouse/StockLevels.tsx":{"content":"import { useState } from \"react\";\nimport { DataTable, type Column } from \"@/components/layout/DataTable\";\nimport { PageHeader } from \"@/components/layout/PageHeader\";\nimport { StatCard } from \"@/components/layout/StatCard\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Download, Package, AlertTriangle, DollarSign, ArrowUpDown } from \"lucide-react\";\nimport { mockProducts } from \"@/lib/mockData\";\nimport { cn } from \"@/lib/utils\";\n\ntype Product = typeof mockProducts[0];\n\nexport function StockLevels() {\n  const [products] = useState(mockProducts);\n  const [activeTab, setActiveTab] = useState(\"all\");\n\n  const lowStockProducts = products.filter(p => p.stock < p.minLevel);\n  const totalValue = products.reduce((sum, p) => sum + (p.stock * p.price), 0);\n  const totalItems = products.reduce((sum, p) => sum + p.stock, 0);\n\n  const getFilteredProducts = () => {\n    switch (activeTab) {\n      case \"low\":\n        return lowStockProducts;\n      case \"optimal\":\n        return products.filter(p => p.stock >= p.minLevel && p.stock <= p.maxLevel);\n      case \"overstock\":\n        return products.filter(p => p.stock > p.maxLevel);\n      default:\n        return products;\n    }\n  };\n\n  const columns: Column<Product>[] = [\n    { key: \"sku\", header: \"SKU\", sortable: true },\n    { key: \"name\", header: \"Product\", sortable: true },\n    { key: \"category\", header: \"Category\", sortable: true },\n    { \n      key: \"stock\", \n      header: \"Current Stock\", \n      sortable: true,\n      className: \"text-right\",\n      render: (item) => (\n        <span className={cn(\n          item.stock < item.minLevel && \"text-red-600 dark:text-red-400 font-medium\"\n        )}>\n          {item.stock} {item.uom}\n        </span>\n      )\n    },\n    { \n      key: \"minLevel\", \n      header: \"Min\", \n      sortable: true,\n      className: \"text-right\"\n    },\n    { \n      key: \"maxLevel\", \n      header: \"Max\", \n      sortable: true,\n      className: \"text-right\"\n    },\n    { \n      key: \"value\", \n      header: \"Value\", \n      sortable: true,\n      className: \"text-right\",\n      render: (item) => `$${(item.stock * item.price).toLocaleString(undefined, { minimumFractionDigits: 2 })}`\n    },\n    { \n      key: \"status\", \n      header: \"Status\",\n      render: (item) => {\n        if (item.stock < item.minLevel) {\n          return (\n            <div className=\"flex items-center gap-1 text-red-600 dark:text-red-400\">\n              <AlertTriangle className=\"h-3 w-3\" />\n              <span className=\"text-sm\">Low Stock</span>\n            </div>\n          );\n        }\n        if (item.stock > item.maxLevel) {\n          return <span className=\"text-sm text-amber-600 dark:text-amber-400\">Overstock</span>;\n        }\n        return <span className=\"text-sm text-green-600 dark:text-green-400\">Optimal</span>;\n      }\n    },\n  ];\n\n  return (\n    <div>\n      <PageHeader\n        title=\"Stock Levels\"\n        description=\"Real-time inventory overview and alerts\"\n        actions={\n          <Button variant=\"outline\" data-testid=\"button-export\">\n            <Download className=\"h-4 w-4 mr-2\" />\n            Export\n          </Button>\n        }\n      />\n\n      <div className=\"grid md:grid-cols-4 gap-4 mb-6\">\n        <StatCard\n          title=\"Total Products\"\n          value={products.length}\n          icon={Package}\n        />\n        <StatCard\n          title=\"Total Items\"\n          value={totalItems}\n          icon={ArrowUpDown}\n        />\n        <StatCard\n          title=\"Low Stock Alerts\"\n          value={lowStockProducts.length}\n          icon={AlertTriangle}\n        />\n        <StatCard\n          title=\"Total Value\"\n          value={`$${totalValue.toLocaleString(undefined, { minimumFractionDigits: 0 })}`}\n          icon={DollarSign}\n        />\n      </div>\n\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList className=\"mb-4\">\n          <TabsTrigger value=\"all\" data-testid=\"tab-all\">\n            All ({products.length})\n          </TabsTrigger>\n          <TabsTrigger value=\"low\" data-testid=\"tab-low\">\n            Low Stock ({lowStockProducts.length})\n          </TabsTrigger>\n          <TabsTrigger value=\"optimal\" data-testid=\"tab-optimal\">\n            Optimal ({products.filter(p => p.stock >= p.minLevel && p.stock <= p.maxLevel).length})\n          </TabsTrigger>\n          <TabsTrigger value=\"overstock\" data-testid=\"tab-overstock\">\n            Overstock ({products.filter(p => p.stock > p.maxLevel).length})\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value={activeTab}>\n          <DataTable\n            data={getFilteredProducts()}\n            columns={columns}\n            searchKey=\"name\"\n            searchPlaceholder=\"Search products...\"\n          />\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":4850,"size_tokens":null},"client/src/components/financials/AccountsPayable.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { DataTable, type Column } from \"@/components/layout/DataTable\";\nimport { StatusBadge } from \"@/components/layout/StatusBadge\";\nimport { PageHeader } from \"@/components/layout/PageHeader\";\nimport { StatCard } from \"@/components/layout/StatCard\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Download, DollarSign, Clock, AlertTriangle, Send, Loader2 } from \"lucide-react\";\nimport { useCompany } from \"@/contexts/CompanyContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { exportToCSV } from \"@/lib/export\";\nimport type { Invoice, Vendor } from \"@shared/schema\";\n\ninterface VendorInvoiceDisplay extends Invoice {\n  vendorName: string;\n}\n\nexport function AccountsPayable() {\n  const { activeCompany } = useCompany();\n  const { toast } = useToast();\n  const [selectedInvoice, setSelectedInvoice] = useState<VendorInvoiceDisplay | null>(null);\n  const [isPaymentOpen, setIsPaymentOpen] = useState(false);\n  const [paymentAmount, setPaymentAmount] = useState(\"\");\n\n  const { data: invoices = [], isLoading } = useQuery<Invoice[]>({\n    queryKey: [\"/api/companies\", activeCompany?.id, \"invoices\"],\n    enabled: !!activeCompany?.id,\n  });\n\n  const { data: vendors = [] } = useQuery<Vendor[]>({\n    queryKey: [\"/api/companies\", activeCompany?.id, \"vendors\"],\n    enabled: !!activeCompany?.id,\n  });\n\n  // Filter for vendor (AP) invoices - backend uses \"vendor\" type\n  const vendorInvoices: VendorInvoiceDisplay[] = invoices\n    .filter(inv => inv.invoiceType === \"vendor\")\n    .map(invoice => ({\n      ...invoice,\n      vendorName: vendors.find(v => v.id === invoice.vendorId)?.name || \"Unknown Vendor\",\n    }));\n\n  const unpaidInvoices = vendorInvoices.filter(inv => inv.status !== \"paid\");\n  \n  const totalPayable = unpaidInvoices.reduce((sum, inv) => {\n    return sum + Number(inv.amountDue ?? 0);\n  }, 0);\n\n  // Workflow mutation: Make vendor payment\n  const makePaymentMutation = useMutation({\n    mutationFn: async ({ vendorId, invoiceIds, amount }: { vendorId: string; invoiceIds: string[]; amount: number }) => {\n      const response = await apiRequest(\"POST\", `/api/companies/${activeCompany?.id}/payments/pay`, {\n        vendorId,\n        invoiceIds,\n        amount,\n        paymentMethod: \"bank_transfer\",\n      });\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"invoices\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"ap-ledger\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"payments\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"journal-entries\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"purchase-orders\"] });\n      toast({ \n        title: \"Payment Sent\", \n        description: `Payment ${data.payment?.paymentNumber || ''} recorded and AP updated` \n      });\n      setIsPaymentOpen(false);\n      setSelectedInvoice(null);\n      setPaymentAmount(\"\");\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Failed to make payment\", \n        description: error.message,\n        variant: \"destructive\" \n      });\n    },\n  });\n\n  const handleOpenPayment = (invoice: VendorInvoiceDisplay) => {\n    setSelectedInvoice(invoice);\n    // Normalize to string since schema may return numbers\n    const balance = invoice.amountDue ?? invoice.total ?? 0;\n    setPaymentAmount(String(balance));\n    setIsPaymentOpen(true);\n  };\n\n  const handleMakePayment = () => {\n    if (!selectedInvoice || !paymentAmount) return;\n    if (!selectedInvoice.vendorId) {\n      toast({ \n        title: \"Cannot make payment\", \n        description: \"Invoice is missing vendor information\",\n        variant: \"destructive\" \n      });\n      return;\n    }\n    const amount = parseFloat(paymentAmount);\n    if (isNaN(amount) || amount <= 0) {\n      toast({ \n        title: \"Invalid amount\", \n        description: \"Please enter a valid payment amount greater than zero\",\n        variant: \"destructive\" \n      });\n      return;\n    }\n    const balanceDue = Number(selectedInvoice.amountDue ?? selectedInvoice.total ?? 0);\n    if (amount > balanceDue) {\n      toast({ \n        title: \"Invalid amount\", \n        description: `Payment cannot exceed balance due (Rp ${balanceDue.toLocaleString()})`,\n        variant: \"destructive\" \n      });\n      return;\n    }\n    makePaymentMutation.mutate({\n      vendorId: selectedInvoice.vendorId,\n      invoiceIds: [selectedInvoice.id],\n      amount,\n    });\n  };\n\n  const columns: Column<VendorInvoiceDisplay>[] = [\n    { key: \"invoiceNumber\", header: \"Invoice #\", sortable: true },\n    { key: \"vendorName\", header: \"Vendor\", sortable: true },\n    { \n      key: \"invoiceDate\", \n      header: \"Invoice Date\", \n      sortable: true,\n      render: (item) => item.invoiceDate ? new Date(item.invoiceDate).toLocaleDateString() : \"-\"\n    },\n    { \n      key: \"dueDate\", \n      header: \"Due Date\", \n      sortable: true,\n      render: (item) => item.dueDate ? new Date(item.dueDate).toLocaleDateString() : \"-\"\n    },\n    { \n      key: \"status\", \n      header: \"Status\",\n      render: (item) => <StatusBadge status={item.status as \"paid\" | \"unpaid\" | \"partial\"} />\n    },\n    { \n      key: \"total\", \n      header: \"Amount\", \n      sortable: true,\n      className: \"text-right\",\n      render: (item) => `Rp ${Number(item.total ?? 0).toLocaleString()}`\n    },\n    { \n      key: \"amountDue\", \n      header: \"Balance\", \n      sortable: true,\n      className: \"text-right\",\n      render: (item) => `Rp ${Number(item.amountDue ?? 0).toLocaleString()}`\n    },\n    {\n      key: \"actions\",\n      header: \"\",\n      className: \"text-right\",\n      render: (item) => (\n        <div className=\"flex justify-end gap-1\" onClick={(e) => e.stopPropagation()}>\n          {item.status !== \"paid\" && (\n            <Button \n              variant=\"ghost\" \n              size=\"sm\" \n              onClick={() => handleOpenPayment(item)}\n              disabled={makePaymentMutation.isPending}\n              data-testid={`button-pay-${item.id}`}\n            >\n              <Send className=\"h-4 w-4 mr-1\" />\n              Pay\n            </Button>\n          )}\n        </div>\n      ),\n    },\n  ];\n\n  const handleExport = () => {\n    if (vendorInvoices.length === 0) {\n      toast({ title: \"No data to export\", variant: \"destructive\" });\n      return;\n    }\n    exportToCSV(\n      vendorInvoices.map(inv => ({\n        invoiceNumber: inv.invoiceNumber,\n        vendor: inv.vendorName,\n        invoiceDate: new Date(inv.invoiceDate).toLocaleDateString(\"id-ID\"),\n        dueDate: inv.dueDate ? new Date(inv.dueDate).toLocaleDateString(\"id-ID\") : \"\",\n        total: inv.total,\n        paid: inv.amountPaid,\n        due: inv.amountDue,\n        status: inv.status\n      })),\n      [\n        { key: \"invoiceNumber\", label: \"Invoice Number\" },\n        { key: \"vendor\", label: \"Vendor\" },\n        { key: \"invoiceDate\", label: \"Invoice Date\" },\n        { key: \"dueDate\", label: \"Due Date\" },\n        { key: \"total\", label: \"Total (IDR)\" },\n        { key: \"paid\", label: \"Amount Paid (IDR)\" },\n        { key: \"due\", label: \"Amount Due (IDR)\" },\n        { key: \"status\", label: \"Status\" }\n      ],\n      \"accounts_payable\"\n    );\n    toast({ title: \"Accounts Payable exported successfully\" });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <PageHeader\n        title=\"Accounts Payable\"\n        description=\"Track vendor invoices and payments\"\n        actions={\n          <Button variant=\"outline\" onClick={handleExport} data-testid=\"button-export\">\n            <Download className=\"h-4 w-4 mr-2\" />\n            Export\n          </Button>\n        }\n      />\n\n      <div className=\"grid md:grid-cols-4 gap-4 mb-6\">\n        <StatCard\n          title=\"Total Payable\"\n          value={`Rp ${totalPayable.toLocaleString()}`}\n          icon={DollarSign}\n        />\n        <StatCard\n          title=\"Invoices Pending\"\n          value={unpaidInvoices.length}\n          icon={Clock}\n        />\n        <StatCard\n          title=\"Vendors\"\n          value={vendors.length}\n          icon={AlertTriangle}\n        />\n        <StatCard\n          title=\"This Month\"\n          value={vendorInvoices.filter(inv => {\n            const date = new Date(inv.invoiceDate || \"\");\n            const now = new Date();\n            return date.getMonth() === now.getMonth() && date.getFullYear() === now.getFullYear();\n          }).length}\n          icon={Send}\n          subtitle=\"invoices\"\n        />\n      </div>\n\n      <Card className=\"mb-6\">\n        <CardHeader>\n          <CardTitle className=\"text-base\">Summary by Vendor</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-3\">\n            {Array.from(new Set(unpaidInvoices.map(inv => inv.vendorId))).slice(0, 5).map(vendorId => {\n              const vendorInvs = unpaidInvoices.filter(inv => inv.vendorId === vendorId);\n              const vendorTotal = vendorInvs.reduce((sum, inv) => sum + Number(inv.amountDue ?? 0), 0);\n              const vendorName = vendorInvs[0]?.vendorName || \"Unknown\";\n              return (\n                <div key={vendorId} className=\"flex items-center justify-between p-3 border rounded-md\">\n                  <div>\n                    <p className=\"font-medium\">{vendorName}</p>\n                    <p className=\"text-sm text-muted-foreground\">{vendorInvs.length} invoice(s)</p>\n                  </div>\n                  <p className=\"font-semibold\">Rp {vendorTotal.toLocaleString()}</p>\n                </div>\n              );\n            })}\n            {unpaidInvoices.length === 0 && (\n              <p className=\"text-sm text-muted-foreground text-center py-4\">No unpaid invoices</p>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n\n      <DataTable\n        data={unpaidInvoices}\n        columns={columns}\n        searchKey=\"vendorName\"\n        searchPlaceholder=\"Search invoices...\"\n      />\n\n      {/* Payment Dialog */}\n      <Dialog open={isPaymentOpen} onOpenChange={setIsPaymentOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Make Payment</DialogTitle>\n            <DialogDescription>\n              Record payment for invoice {selectedInvoice?.invoiceNumber}\n            </DialogDescription>\n          </DialogHeader>\n          {selectedInvoice && (\n            <div className=\"space-y-4\">\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-muted-foreground\">Vendor:</span>\n                <span>{selectedInvoice.vendorName}</span>\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-muted-foreground\">Invoice Total:</span>\n                <span>Rp {Number(selectedInvoice.total ?? 0).toLocaleString()}</span>\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-muted-foreground\">Balance Due:</span>\n                <span className=\"font-semibold\">Rp {Number(selectedInvoice.amountDue ?? 0).toLocaleString()}</span>\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"amount\">Payment Amount</Label>\n                <Input\n                  id=\"amount\"\n                  type=\"number\"\n                  value={paymentAmount}\n                  onChange={(e) => setPaymentAmount(e.target.value)}\n                  placeholder=\"Enter payment amount\"\n                  data-testid=\"input-payment-amount\"\n                />\n              </div>\n              <div className=\"flex justify-end gap-2\">\n                <Button variant=\"outline\" onClick={() => setIsPaymentOpen(false)}>\n                  Cancel\n                </Button>\n                <Button \n                  onClick={handleMakePayment} \n                  disabled={makePaymentMutation.isPending || !paymentAmount}\n                  data-testid=\"button-confirm-payment\"\n                >\n                  {makePaymentMutation.isPending ? (\n                    <>\n                      <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      Processing...\n                    </>\n                  ) : (\n                    <>\n                      <Send className=\"h-4 w-4 mr-2\" />\n                      Send Payment\n                    </>\n                  )}\n                </Button>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":13201,"size_tokens":null},"client/src/components/system/CustomerPortal.tsx":{"content":"import { useState } from \"react\";\nimport { PageHeader } from \"@/components/layout/PageHeader\";\nimport { DataTable, type Column } from \"@/components/layout/DataTable\";\nimport { StatusBadge } from \"@/components/layout/StatusBadge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Download, Eye, FileText, ShoppingCart, Printer } from \"lucide-react\";\nimport { mockCustomers, mockSalesOrders, mockInvoices } from \"@/lib/mockData\";\n\ntype SalesOrder = typeof mockSalesOrders[0];\ntype Invoice = typeof mockInvoices[0];\n\n// Simulating customer portal view\nexport function CustomerPortal() {\n  // todo: remove mock functionality - simulated logged in customer\n  const [currentCustomer] = useState(mockCustomers[0]);\n  const [selectedOrder, setSelectedOrder] = useState<SalesOrder | null>(null);\n  const [selectedInvoice, setSelectedInvoice] = useState<Invoice | null>(null);\n  const [isOrderDetailOpen, setIsOrderDetailOpen] = useState(false);\n  const [isInvoiceOpen, setIsInvoiceOpen] = useState(false);\n\n  const customerOrders = mockSalesOrders.filter(o => o.customerId === currentCustomer.id);\n  const customerInvoices = mockInvoices.filter(inv => \n    customerOrders.some(o => o.id === inv.orderId)\n  );\n\n  const handleViewOrder = (order: SalesOrder) => {\n    setSelectedOrder(order);\n    setIsOrderDetailOpen(true);\n  };\n\n  const handleViewInvoice = (invoice: Invoice) => {\n    setSelectedInvoice(invoice);\n    setIsInvoiceOpen(true);\n  };\n\n  const orderColumns: Column<SalesOrder>[] = [\n    { key: \"id\", header: \"Order #\", sortable: true },\n    { key: \"date\", header: \"Date\", sortable: true },\n    { \n      key: \"status\", \n      header: \"Status\",\n      render: (item) => <StatusBadge status={item.status as \"draft\" | \"confirmed\" | \"delivered\" | \"invoiced\"} />\n    },\n    { key: \"items\", header: \"Items\", className: \"text-center\" },\n    { \n      key: \"total\", \n      header: \"Total\", \n      sortable: true,\n      className: \"text-right\",\n      render: (item) => `$${item.total.toLocaleString()}`\n    },\n    {\n      key: \"actions\",\n      header: \"\",\n      className: \"text-right\",\n      render: (item) => (\n        <Button variant=\"ghost\" size=\"icon\" onClick={() => handleViewOrder(item)} data-testid={`button-view-order-${item.id}`}>\n          <Eye className=\"h-4 w-4\" />\n        </Button>\n      ),\n    },\n  ];\n\n  const invoiceColumns: Column<Invoice>[] = [\n    { key: \"id\", header: \"Invoice #\", sortable: true },\n    { key: \"date\", header: \"Date\", sortable: true },\n    { key: \"dueDate\", header: \"Due Date\", sortable: true },\n    { \n      key: \"status\", \n      header: \"Status\",\n      render: (item) => <StatusBadge status={item.status as \"paid\" | \"unpaid\" | \"partial\"} />\n    },\n    { \n      key: \"total\", \n      header: \"Amount\", \n      sortable: true,\n      className: \"text-right\",\n      render: (item) => `$${item.total.toLocaleString()}`\n    },\n    {\n      key: \"actions\",\n      header: \"\",\n      className: \"text-right\",\n      render: (item) => (\n        <Button variant=\"ghost\" size=\"icon\" onClick={() => handleViewInvoice(item)} data-testid={`button-view-invoice-${item.id}`}>\n          <Download className=\"h-4 w-4\" />\n        </Button>\n      ),\n    },\n  ];\n\n  return (\n    <div>\n      <PageHeader\n        title=\"Customer Portal\"\n        description=\"View your orders and invoices\"\n      />\n\n      <Card className=\"mb-6\">\n        <CardContent className=\"p-6\">\n          <div className=\"flex flex-wrap items-center justify-between gap-4\">\n            <div className=\"flex items-center gap-4\">\n              <Avatar className=\"h-12 w-12\">\n                <AvatarFallback className=\"bg-primary/10 text-primary text-lg\">\n                  {currentCustomer.name.split(\" \").map(n => n[0]).join(\"\").slice(0, 2)}\n                </AvatarFallback>\n              </Avatar>\n              <div>\n                <h2 className=\"font-semibold\" data-testid=\"text-customer-name\">{currentCustomer.name}</h2>\n                <p className=\"text-sm text-muted-foreground\">{currentCustomer.email}</p>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-6 text-sm\">\n              <div className=\"text-center\">\n                <p className=\"text-2xl font-semibold\">{currentCustomer.totalOrders}</p>\n                <p className=\"text-muted-foreground\">Total Orders</p>\n              </div>\n              <div className=\"text-center\">\n                <p className=\"text-2xl font-semibold\">${currentCustomer.totalSpent.toLocaleString()}</p>\n                <p className=\"text-muted-foreground\">Total Spent</p>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"grid md:grid-cols-2 gap-6 mb-6\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2\">\n            <CardTitle className=\"text-base flex items-center gap-2\">\n              <ShoppingCart className=\"h-4 w-4\" />\n              Recent Orders\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <DataTable\n              data={customerOrders.slice(0, 5)}\n              columns={orderColumns}\n              pageSize={5}\n            />\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2\">\n            <CardTitle className=\"text-base flex items-center gap-2\">\n              <FileText className=\"h-4 w-4\" />\n              Recent Invoices\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <DataTable\n              data={customerInvoices.slice(0, 5)}\n              columns={invoiceColumns}\n              pageSize={5}\n            />\n          </CardContent>\n        </Card>\n      </div>\n\n      <Dialog open={isOrderDetailOpen} onOpenChange={setIsOrderDetailOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>Order Details</DialogTitle>\n          </DialogHeader>\n          {selectedOrder && (\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <h3 className=\"font-semibold\">{selectedOrder.id}</h3>\n                  <p className=\"text-sm text-muted-foreground\">{selectedOrder.date}</p>\n                </div>\n                <StatusBadge status={selectedOrder.status as \"draft\" | \"confirmed\" | \"delivered\" | \"invoiced\"} />\n              </div>\n              <div className=\"border rounded-md p-4 space-y-2\">\n                <div className=\"flex justify-between text-sm\">\n                  <span className=\"text-muted-foreground\">Items</span>\n                  <span>{selectedOrder.items}</span>\n                </div>\n                <div className=\"flex justify-between font-semibold\">\n                  <span>Total</span>\n                  <span>${selectedOrder.total.toLocaleString()}</span>\n                </div>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isInvoiceOpen} onOpenChange={setIsInvoiceOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>Invoice</DialogTitle>\n          </DialogHeader>\n          {selectedInvoice && (\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <h3 className=\"font-semibold\">{selectedInvoice.id}</h3>\n                  <p className=\"text-sm text-muted-foreground\">Due: {selectedInvoice.dueDate}</p>\n                </div>\n                <StatusBadge status={selectedInvoice.status as \"paid\" | \"unpaid\" | \"partial\"} />\n              </div>\n              <div className=\"border rounded-md p-4 space-y-2\">\n                <div className=\"flex justify-between text-sm\">\n                  <span className=\"text-muted-foreground\">Invoice Date</span>\n                  <span>{selectedInvoice.date}</span>\n                </div>\n                <div className=\"flex justify-between text-sm\">\n                  <span className=\"text-muted-foreground\">Order</span>\n                  <span>{selectedInvoice.orderId}</span>\n                </div>\n                <div className=\"flex justify-between font-semibold pt-2 border-t\">\n                  <span>Amount Due</span>\n                  <span>${selectedInvoice.total.toLocaleString()}</span>\n                </div>\n              </div>\n              <div className=\"flex justify-end gap-2\">\n                <Button variant=\"outline\" data-testid=\"button-print-invoice\">\n                  <Printer className=\"h-4 w-4 mr-2\" />\n                  Print\n                </Button>\n                <Button data-testid=\"button-download-invoice\">\n                  <Download className=\"h-4 w-4 mr-2\" />\n                  Download PDF\n                </Button>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":9194,"size_tokens":null},"client/src/components/examples/AccountsPayable.tsx":{"content":"import { AccountsPayable } from \"../financials/AccountsPayable\";\n\nexport default function AccountsPayableExample() {\n  return <AccountsPayable />;\n}\n","path":null,"size_bytes":149,"size_tokens":null},"client/src/components/examples/Reports.tsx":{"content":"import { Reports } from \"../Reports\";\n\nexport default function ReportsExample() {\n  return <Reports />;\n}\n","path":null,"size_bytes":106,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/warehouse/PurchaseOrderList.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { DataTable, type Column } from \"@/components/layout/DataTable\";\nimport { StatusBadge } from \"@/components/layout/StatusBadge\";\nimport { PageHeader } from \"@/components/layout/PageHeader\";\nimport { WorkflowStepper } from \"@/components/layout/WorkflowStepper\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Plus, Download, Eye, Trash2, Send, PackageCheck } from \"lucide-react\";\nimport { useCompany } from \"@/contexts/CompanyContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { PurchaseOrder, Vendor, Product, InsertPurchaseOrder } from \"@shared/schema\";\n\ninterface PurchaseOrderDisplay extends PurchaseOrder {\n  vendorName: string;\n}\n\nconst poSteps = [\n  { id: \"draft\", label: \"Draft\" },\n  { id: \"ordered\", label: \"Ordered\" },\n  { id: \"received\", label: \"Received\" },\n];\n\nexport function PurchaseOrderList() {\n  const { activeCompany } = useCompany();\n  const { toast } = useToast();\n  const [selectedOrder, setSelectedOrder] = useState<PurchaseOrderDisplay | null>(null);\n  const [isFormOpen, setIsFormOpen] = useState(false);\n  const [isDetailOpen, setIsDetailOpen] = useState(false);\n  const [formData, setFormData] = useState({ vendorId: \"\" });\n\n  const { data: orders = [], isLoading: ordersLoading } = useQuery<PurchaseOrder[]>({\n    queryKey: [\"/api/companies\", activeCompany?.id, \"purchase-orders\"],\n    enabled: !!activeCompany?.id,\n  });\n\n  const { data: vendors = [] } = useQuery<Vendor[]>({\n    queryKey: [\"/api/companies\", activeCompany?.id, \"vendors\"],\n    enabled: !!activeCompany?.id,\n  });\n\n  const { data: products = [] } = useQuery<Product[]>({\n    queryKey: [\"/api/companies\", activeCompany?.id, \"products\"],\n    enabled: !!activeCompany?.id,\n  });\n\n  const ordersWithVendors: PurchaseOrderDisplay[] = orders.map(order => ({\n    ...order,\n    vendorName: vendors.find(v => v.id === order.vendorId)?.name || \"Unknown Vendor\",\n  }));\n\n  const createMutation = useMutation({\n    mutationFn: async (data: Partial<InsertPurchaseOrder>) => {\n      const orderNumber = `PO-${String(Date.now()).slice(-6)}`;\n      return apiRequest(\"POST\", `/api/companies/${activeCompany?.id}/purchase-orders`, {\n        ...data,\n        orderNumber,\n        companyId: activeCompany?.id,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"purchase-orders\"] });\n      toast({ title: \"Purchase order created successfully\" });\n      setIsFormOpen(false);\n      setFormData({ vendorId: \"\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to create purchase order\", variant: \"destructive\" });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<PurchaseOrder> }) => {\n      return apiRequest(\"PATCH\", `/api/companies/${activeCompany?.id}/purchase-orders/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"purchase-orders\"] });\n      toast({ title: \"Purchase order updated successfully\" });\n      setIsDetailOpen(false);\n    },\n    onError: () => {\n      toast({ title: \"Failed to update purchase order\", variant: \"destructive\" });\n    },\n  });\n\n  // Workflow mutation: Confirm/Send PO to vendor\n  const confirmPOMutation = useMutation({\n    mutationFn: async (orderId: string) => {\n      const response = await apiRequest(\"POST\", `/api/companies/${activeCompany?.id}/purchase-orders/${orderId}/confirm`);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"purchase-orders\"] });\n      toast({ \n        title: \"Purchase Order Sent\", \n        description: \"Order has been confirmed and sent to vendor\" \n      });\n      setIsDetailOpen(false);\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Failed to confirm PO\", \n        description: error.message,\n        variant: \"destructive\" \n      });\n    },\n  });\n\n  // Workflow mutation: Receive goods (creates goods receipt, updates stock, inventory journal)\n  const receiveGoodsMutation = useMutation({\n    mutationFn: async (orderId: string) => {\n      const response = await apiRequest(\"POST\", `/api/companies/${activeCompany?.id}/purchase-orders/${orderId}/receive`);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"purchase-orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"stock-levels\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"stock-movements\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"goods-receipts\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"journal-entries\"] });\n      toast({ \n        title: \"Goods Received\", \n        description: `Receipt ${data.goodsReceipt?.receiptNumber || ''} created and inventory updated` \n      });\n      setIsDetailOpen(false);\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Failed to receive goods\", \n        description: error.message,\n        variant: \"destructive\" \n      });\n    },\n  });\n\n  // Workflow mutation: Create vendor invoice/bill (creates AP invoice, AP ledger, journal entry)\n  const createBillMutation = useMutation({\n    mutationFn: async (orderId: string) => {\n      const response = await apiRequest(\"POST\", `/api/companies/${activeCompany?.id}/purchase-orders/${orderId}/bill`);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"purchase-orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"invoices\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"ap-ledger\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"journal-entries\"] });\n      toast({ \n        title: \"Vendor Bill Created\", \n        description: `Bill ${data.invoice?.invoiceNumber || ''} created and AP recorded` \n      });\n      setIsDetailOpen(false);\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Failed to create bill\", \n        description: error.message,\n        variant: \"destructive\" \n      });\n    },\n  });\n\n  const isWorkflowPending = confirmPOMutation.isPending || \n    receiveGoodsMutation.isPending || \n    createBillMutation.isPending;\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest(\"DELETE\", `/api/companies/${activeCompany?.id}/purchase-orders/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"purchase-orders\"] });\n      toast({ title: \"Purchase order deleted successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to delete purchase order\", variant: \"destructive\" });\n    },\n  });\n\n  const handleViewOrder = (order: PurchaseOrderDisplay) => {\n    setSelectedOrder(order);\n    setIsDetailOpen(true);\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!formData.vendorId) return;\n    createMutation.mutate({ vendorId: formData.vendorId });\n  };\n\n  const handleStatusChange = (orderId: string, newStatus: string) => {\n    // Use workflow endpoints for status transitions\n    switch (newStatus) {\n      case \"ordered\":\n        confirmPOMutation.mutate(orderId);\n        break;\n      case \"received\":\n        receiveGoodsMutation.mutate(orderId);\n        break;\n      case \"billed\":\n        createBillMutation.mutate(orderId);\n        break;\n      default:\n        // Fallback to simple update for non-workflow status changes\n        updateMutation.mutate({ id: orderId, data: { status: newStatus } });\n    }\n    if (selectedOrder?.id === orderId) {\n      setSelectedOrder({ ...selectedOrder, status: newStatus });\n    }\n  };\n\n  const handleDeleteOrder = (orderId: string) => {\n    deleteMutation.mutate(orderId);\n  };\n\n  const handleExport = () => {\n    const csv = [\n      [\"PO #\", \"Vendor\", \"Date\", \"Status\", \"Total\"].join(\",\"),\n      ...ordersWithVendors.map(o => [\n        o.orderNumber,\n        o.vendorName,\n        new Date(o.orderDate).toLocaleDateString(),\n        o.status,\n        o.total\n      ].join(\",\"))\n    ].join(\"\\n\");\n    \n    const blob = new Blob([csv], { type: \"text/csv\" });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = \"purchase_orders.csv\";\n    a.click();\n  };\n\n  const getActionButton = (order: PurchaseOrderDisplay) => {\n    switch (order.status) {\n      case \"draft\":\n        return (\n          <Button \n            size=\"sm\" \n            onClick={(e) => { e.stopPropagation(); handleStatusChange(order.id, \"ordered\"); }}\n            disabled={isWorkflowPending}\n            data-testid={`button-send-${order.id}`}\n          >\n            <Send className=\"h-3 w-3 mr-1\" />\n            {confirmPOMutation.isPending ? \"...\" : \"Send\"}\n          </Button>\n        );\n      case \"ordered\":\n        return (\n          <Button \n            size=\"sm\" \n            onClick={(e) => { e.stopPropagation(); handleStatusChange(order.id, \"received\"); }}\n            disabled={isWorkflowPending}\n            data-testid={`button-receive-${order.id}`}\n          >\n            <PackageCheck className=\"h-3 w-3 mr-1\" />\n            {receiveGoodsMutation.isPending ? \"...\" : \"Receive\"}\n          </Button>\n        );\n      default:\n        return null;\n    }\n  };\n\n  const columns: Column<PurchaseOrderDisplay>[] = [\n    { key: \"orderNumber\", header: \"PO #\", sortable: true },\n    { key: \"vendorName\", header: \"Vendor\", sortable: true },\n    { \n      key: \"orderDate\", \n      header: \"Date\", \n      sortable: true,\n      render: (item) => new Date(item.orderDate).toLocaleDateString()\n    },\n    { \n      key: \"status\", \n      header: \"Status\",\n      render: (item) => <StatusBadge status={item.status as \"draft\" | \"ordered\" | \"received\"} />\n    },\n    { \n      key: \"total\", \n      header: \"Total\", \n      sortable: true,\n      className: \"text-right\",\n      render: (item) => `$${parseFloat(item.total || \"0\").toLocaleString()}`\n    },\n    {\n      key: \"actions\",\n      header: \"\",\n      className: \"text-right\",\n      render: (item) => (\n        <div className=\"flex justify-end gap-2\" onClick={(e) => e.stopPropagation()}>\n          {getActionButton(item)}\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => handleViewOrder(item)} data-testid={`button-view-${item.id}`}>\n            <Eye className=\"h-4 w-4\" />\n          </Button>\n          {item.status === \"draft\" && (\n            <Button \n              variant=\"ghost\" \n              size=\"icon\" \n              onClick={() => handleDeleteOrder(item.id)} \n              disabled={deleteMutation.isPending}\n              data-testid={`button-delete-${item.id}`}\n            >\n              <Trash2 className=\"h-4 w-4\" />\n            </Button>\n          )}\n        </div>\n      ),\n    },\n  ];\n\n  if (ordersLoading) {\n    return (\n      <div className=\"space-y-4\">\n        <PageHeader title=\"Purchase Orders\" description=\"Manage supplier purchase orders\" />\n        <div className=\"space-y-2\">\n          {[1, 2, 3].map((i) => (\n            <Skeleton key={i} className=\"h-12 w-full\" />\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <PageHeader\n        title=\"Purchase Orders\"\n        description=\"Manage supplier purchase orders\"\n        actions={\n          <>\n            <Button variant=\"outline\" onClick={handleExport} data-testid=\"button-export\">\n              <Download className=\"h-4 w-4 mr-2\" />\n              Export\n            </Button>\n            <Button onClick={() => setIsFormOpen(true)} data-testid=\"button-new-po\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New PO\n            </Button>\n          </>\n        }\n      />\n\n      <DataTable\n        data={ordersWithVendors}\n        columns={columns}\n        searchKey=\"vendorName\"\n        searchPlaceholder=\"Search purchase orders...\"\n        onRowClick={handleViewOrder}\n      />\n\n      <Dialog open={isFormOpen} onOpenChange={setIsFormOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>New Purchase Order</DialogTitle>\n            <DialogDescription>\n              Create a new purchase order by selecting a vendor.\n            </DialogDescription>\n          </DialogHeader>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"vendor\">Vendor *</Label>\n              <Select\n                value={formData.vendorId}\n                onValueChange={(value) => setFormData({ vendorId: value })}\n              >\n                <SelectTrigger data-testid=\"select-vendor\">\n                  <SelectValue placeholder=\"Select vendor\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {vendors.map((vendor) => (\n                    <SelectItem key={vendor.id} value={vendor.id}>\n                      {vendor.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"flex justify-end gap-2 pt-4\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => setIsFormOpen(false)} data-testid=\"button-cancel\">\n                Cancel\n              </Button>\n              <Button type=\"submit\" disabled={!formData.vendorId || createMutation.isPending} data-testid=\"button-create-po\">\n                {createMutation.isPending ? \"Creating...\" : \"Create PO\"}\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isDetailOpen} onOpenChange={setIsDetailOpen}>\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Purchase Order Details</DialogTitle>\n            <DialogDescription>\n              View and manage order {selectedOrder?.orderNumber}\n            </DialogDescription>\n          </DialogHeader>\n          {selectedOrder && (\n            <div className=\"space-y-6\">\n              <div className=\"flex flex-wrap items-start justify-between gap-4\">\n                <div>\n                  <div className=\"flex items-center gap-3\">\n                    <h2 className=\"text-xl font-semibold\" data-testid=\"text-po-number\">{selectedOrder.orderNumber}</h2>\n                    <StatusBadge status={selectedOrder.status as \"draft\" | \"ordered\" | \"received\"} />\n                  </div>\n                  <p className=\"text-sm text-muted-foreground mt-1\">\n                    {selectedOrder.vendorName}\n                  </p>\n                </div>\n                {getActionButton(selectedOrder)}\n              </div>\n\n              <WorkflowStepper steps={poSteps} currentStep={selectedOrder.status || \"draft\"} />\n\n              <div className=\"grid md:grid-cols-2 gap-4\">\n                <Card>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-base\">Order Information</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-2 text-sm\">\n                    <div className=\"flex justify-between gap-2\">\n                      <span className=\"text-muted-foreground\">Order Date</span>\n                      <span>{new Date(selectedOrder.orderDate).toLocaleDateString()}</span>\n                    </div>\n                    <div className=\"flex justify-between gap-2\">\n                      <span className=\"text-muted-foreground\">Vendor ID</span>\n                      <span>{selectedOrder.vendorId}</span>\n                    </div>\n                    {selectedOrder.expectedDate && (\n                      <div className=\"flex justify-between gap-2\">\n                        <span className=\"text-muted-foreground\">Expected Date</span>\n                        <span>{new Date(selectedOrder.expectedDate).toLocaleDateString()}</span>\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-base\">Order Summary</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-2 text-sm\">\n                    <div className=\"flex justify-between gap-2\">\n                      <span className=\"text-muted-foreground\">Subtotal</span>\n                      <span>${parseFloat(selectedOrder.subtotal || \"0\").toFixed(2)}</span>\n                    </div>\n                    <div className=\"flex justify-between gap-2\">\n                      <span className=\"text-muted-foreground\">Tax</span>\n                      <span>${parseFloat(selectedOrder.taxAmount || \"0\").toFixed(2)}</span>\n                    </div>\n                    <div className=\"flex justify-between gap-2 font-semibold pt-2 border-t\">\n                      <span>Total</span>\n                      <span data-testid=\"text-po-total\">${parseFloat(selectedOrder.total || \"0\").toLocaleString()}</span>\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n\n              <div className=\"flex justify-end\">\n                <Button variant=\"outline\" onClick={() => setIsDetailOpen(false)} data-testid=\"button-close-detail\">\n                  Close\n                </Button>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":18411,"size_tokens":null},"client/src/components/financials/ChartOfAccounts.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { PageHeader } from \"@/components/layout/PageHeader\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport {\n  Plus,\n  Download,\n  Edit,\n  Trash2,\n  ChevronRight,\n  ChevronDown,\n  FileText,\n  Layers,\n  Loader2,\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Account } from \"@shared/schema\";\n\nconst accountTypeColors: Record<string, string> = {\n  asset: \"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400\",\n  liability: \"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400\",\n  equity: \"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400\",\n  revenue: \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\",\n  expense: \"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400\",\n};\n\nexport function ChartOfAccounts() {\n  const { activeCompany } = useAuth();\n  const { toast } = useToast();\n  const companyId = activeCompany?.id;\n\n  const [isFormOpen, setIsFormOpen] = useState(false);\n  const [editingAccount, setEditingAccount] = useState<Account | null>(null);\n  const [expandedAccounts, setExpandedAccounts] = useState<Set<string>>(new Set());\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [filterType, setFilterType] = useState<string>(\"all\");\n\n  const [formData, setFormData] = useState({\n    accountCode: \"\",\n    name: \"\",\n    accountType: \"asset\" as \"asset\" | \"liability\" | \"equity\" | \"revenue\" | \"expense\",\n    level: 3 as 1 | 2 | 3,\n    parentId: \"__none__\",\n    isPostable: true,\n  });\n\n  const { data: accounts = [], isLoading } = useQuery<Account[]>({\n    queryKey: [\"/api/companies\", companyId, \"accounts\"],\n    enabled: !!companyId,\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: Omit<typeof formData, \"parentId\"> & { parentId: string | null }) => {\n      const response = await apiRequest(\"POST\", `/api/companies/${companyId}/accounts`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", companyId, \"accounts\"] });\n      toast({ title: \"Account created successfully\" });\n      setIsFormOpen(false);\n    },\n    onError: () => {\n      toast({ title: \"Failed to create account\", variant: \"destructive\" });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<Account> }) => {\n      const response = await apiRequest(\"PATCH\", `/api/companies/${companyId}/accounts/${id}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", companyId, \"accounts\"] });\n      toast({ title: \"Account updated successfully\" });\n      setIsFormOpen(false);\n    },\n    onError: () => {\n      toast({ title: \"Failed to update account\", variant: \"destructive\" });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(\"DELETE\", `/api/companies/${companyId}/accounts/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", companyId, \"accounts\"] });\n      toast({ title: \"Account deleted successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Cannot delete account with child accounts\", variant: \"destructive\" });\n    },\n  });\n\n  const toggleExpand = (accountId: string) => {\n    setExpandedAccounts((prev) => {\n      const next = new Set(prev);\n      if (next.has(accountId)) {\n        next.delete(accountId);\n      } else {\n        next.add(accountId);\n      }\n      return next;\n    });\n  };\n\n  const expandAll = () => {\n    const allParentIds = accounts.filter(a => !a.isPostable).map(a => a.id);\n    setExpandedAccounts(new Set(allParentIds));\n  };\n\n  const collapseAll = () => {\n    setExpandedAccounts(new Set());\n  };\n\n  const handleOpenForm = (account?: Account) => {\n    if (account) {\n      setEditingAccount(account);\n      setFormData({\n        accountCode: account.accountCode,\n        name: account.name,\n        accountType: account.accountType as typeof formData.accountType,\n        level: account.level as 1 | 2 | 3,\n        parentId: account.parentId || \"__none__\",\n        isPostable: account.isPostable ?? true,\n      });\n    } else {\n      setEditingAccount(null);\n      setFormData({ accountCode: \"\", name: \"\", accountType: \"asset\", level: 3, parentId: \"__none__\", isPostable: true });\n    }\n    setIsFormOpen(true);\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    const submitData = {\n      ...formData,\n      parentId: formData.parentId === \"__none__\" ? null : formData.parentId,\n    };\n    \n    if (editingAccount) {\n      updateMutation.mutate({ id: editingAccount.id, data: submitData });\n    } else {\n      createMutation.mutate(submitData);\n    }\n  };\n\n  const handleDeleteAccount = (accountId: string) => {\n    const hasChildren = accounts.some(a => a.parentId === accountId);\n    if (hasChildren) {\n      toast({ title: \"Cannot delete account with child accounts\", variant: \"destructive\" });\n      return;\n    }\n    deleteMutation.mutate(accountId);\n  };\n\n  const getChildAccounts = (parentId: string | null): Account[] => {\n    return accounts.filter(a => a.parentId === parentId);\n  };\n\n  const calculateBalance = (account: Account): number => {\n    if (account.isPostable) {\n      return parseFloat(account.balance || \"0\");\n    }\n    const children = accounts.filter(a => a.parentId === account.id);\n    return children.reduce((sum, child) => sum + calculateBalance(child), 0);\n  };\n\n  const filteredAccounts = useMemo(() => {\n    let filtered = accounts;\n    if (searchTerm) {\n      filtered = filtered.filter(a =>\n        a.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        a.accountCode.includes(searchTerm)\n      );\n    }\n    if (filterType !== \"all\") {\n      filtered = filtered.filter(a => a.accountType === filterType);\n    }\n    return filtered;\n  }, [accounts, searchTerm, filterType]);\n\n  const rootAccounts = useMemo(() => {\n    if (searchTerm || filterType !== \"all\") {\n      return filteredAccounts;\n    }\n    return accounts.filter(a => a.parentId === null);\n  }, [accounts, filteredAccounts, searchTerm, filterType]);\n\n  const parentAccountOptions = useMemo(() => {\n    return accounts.filter(a => !a.isPostable);\n  }, [accounts]);\n\n  const totalAssets = useMemo(() =>\n    accounts.filter(a => a.accountType === \"asset\" && a.isPostable).reduce((sum, a) => sum + parseFloat(a.balance || \"0\"), 0),\n    [accounts]\n  );\n  const totalLiabilities = useMemo(() =>\n    accounts.filter(a => a.accountType === \"liability\" && a.isPostable).reduce((sum, a) => sum + parseFloat(a.balance || \"0\"), 0),\n    [accounts]\n  );\n  const totalEquity = useMemo(() =>\n    accounts.filter(a => a.accountType === \"equity\" && a.isPostable).reduce((sum, a) => sum + parseFloat(a.balance || \"0\"), 0),\n    [accounts]\n  );\n  const totalRevenue = useMemo(() =>\n    accounts.filter(a => a.accountType === \"revenue\" && a.isPostable).reduce((sum, a) => sum + parseFloat(a.balance || \"0\"), 0),\n    [accounts]\n  );\n  const totalExpenses = useMemo(() =>\n    accounts.filter(a => a.accountType === \"expense\" && a.isPostable).reduce((sum, a) => sum + parseFloat(a.balance || \"0\"), 0),\n    [accounts]\n  );\n\n  const renderAccountRow = (account: Account, depth: number = 0) => {\n    const children = getChildAccounts(account.id);\n    const hasChildren = children.length > 0;\n    const isExpanded = expandedAccounts.has(account.id);\n    const calculatedBalance = calculateBalance(account);\n\n    return (\n      <div key={account.id}>\n        <div\n          className={cn(\n            \"flex items-center gap-2 px-3 py-2 border-b hover-elevate cursor-pointer\",\n            account.level === 1 && \"bg-muted/50 font-semibold\",\n            account.level === 2 && \"font-medium\",\n          )}\n          style={{ paddingLeft: `${depth * 24 + 12}px` }}\n          onClick={() => hasChildren && toggleExpand(account.id)}\n          data-testid={`row-account-${account.id}`}\n        >\n          <div className=\"w-5 flex justify-center\">\n            {hasChildren ? (\n              isExpanded ? (\n                <ChevronDown className=\"h-4 w-4 text-muted-foreground\" />\n              ) : (\n                <ChevronRight className=\"h-4 w-4 text-muted-foreground\" />\n              )\n            ) : (\n              <span className=\"w-4\" />\n            )}\n          </div>\n\n          <div className=\"flex-1 min-w-0 flex items-center gap-3\">\n            <span className=\"font-mono text-sm w-14 shrink-0\">{account.accountCode}</span>\n            <span className=\"truncate\">{account.name}</span>\n            {account.isPostable && (\n              <Badge variant=\"outline\" className=\"text-xs shrink-0\">Postable</Badge>\n            )}\n          </div>\n\n          <div className=\"flex items-center gap-3\">\n            <Badge className={cn(\"text-xs capitalize\", accountTypeColors[account.accountType])}>\n              {account.accountType}\n            </Badge>\n            <span className=\"text-xs text-muted-foreground w-8 text-center\">L{account.level}</span>\n            <span className={cn(\n              \"w-28 text-right font-mono text-sm\",\n              calculatedBalance < 0 && \"text-red-600 dark:text-red-400\"\n            )}>\n              ${calculatedBalance.toLocaleString()}\n            </span>\n            <div className=\"flex gap-1\" onClick={(e) => e.stopPropagation()}>\n              <Button variant=\"ghost\" size=\"icon\" onClick={() => handleOpenForm(account)} data-testid={`button-edit-${account.id}`}>\n                <Edit className=\"h-4 w-4\" />\n              </Button>\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={() => handleDeleteAccount(account.id)}\n                disabled={hasChildren || deleteMutation.isPending}\n                data-testid={`button-delete-${account.id}`}\n              >\n                <Trash2 className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n        </div>\n\n        {hasChildren && isExpanded && (\n          <div>\n            {children.map(child => renderAccountRow(child, depth + 1))}\n          </div>\n        )}\n      </div>\n    );\n  };\n\n  const handleExportCSV = () => {\n    const headers = [\"Account Code\", \"Account Name\", \"Type\", \"Level\", \"Parent Account\", \"Balance\", \"Postable\"];\n    const rows = accounts.map(a => [\n      a.accountCode,\n      a.name,\n      a.accountType.charAt(0).toUpperCase() + a.accountType.slice(1),\n      a.level,\n      a.parentId || \"\",\n      calculateBalance(a),\n      a.isPostable ? \"Yes\" : \"No\"\n    ]);\n\n    const csv = [headers.join(\",\"), ...rows.map(r => r.join(\",\"))].join(\"\\n\");\n    const blob = new Blob([csv], { type: \"text/csv\" });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement(\"a\");\n    link.href = url;\n    link.download = \"chart_of_accounts.csv\";\n    link.click();\n  };\n\n  const handleExportJSON = () => {\n    const jsonData = accounts.map(a => ({\n      accountCode: a.accountCode,\n      accountName: a.name,\n      accountType: a.accountType.charAt(0).toUpperCase() + a.accountType.slice(1),\n      level: a.level,\n      parentAccountCode: a.parentId,\n      balance: calculateBalance(a),\n      isPostable: a.isPostable\n    }));\n\n    const blob = new Blob([JSON.stringify(jsonData, null, 2)], { type: \"application/json\" });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement(\"a\");\n    link.href = url;\n    link.download = \"chart_of_accounts.json\";\n    link.click();\n  };\n\n  if (!companyId) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <p className=\"text-muted-foreground\">Please select a company to view Chart of Accounts</p>\n      </div>\n    );\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <PageHeader\n        title=\"Chart of Accounts\"\n        description={`${accounts.length} accounts across ${accounts.filter(a => a.level === 1).length} categories`}\n        actions={\n          <>\n            <Button variant=\"outline\" onClick={handleExportCSV} data-testid=\"button-export-csv\">\n              <Download className=\"h-4 w-4 mr-2\" />\n              Export CSV\n            </Button>\n            <Button variant=\"outline\" onClick={handleExportJSON} data-testid=\"button-export-json\">\n              <FileText className=\"h-4 w-4 mr-2\" />\n              Export JSON\n            </Button>\n            <Button onClick={() => handleOpenForm()} data-testid=\"button-new-account\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Account\n            </Button>\n          </>\n        }\n      />\n\n      <div className=\"grid md:grid-cols-5 gap-4 mb-6\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm text-muted-foreground\">Total Assets</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-2xl font-semibold text-blue-600 dark:text-blue-400\" data-testid=\"text-total-assets\">\n              ${totalAssets.toLocaleString()}\n            </p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm text-muted-foreground\">Total Liabilities</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-2xl font-semibold text-red-600 dark:text-red-400\" data-testid=\"text-total-liabilities\">\n              ${totalLiabilities.toLocaleString()}\n            </p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm text-muted-foreground\">Total Equity</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-2xl font-semibold text-purple-600 dark:text-purple-400\" data-testid=\"text-total-equity\">\n              ${totalEquity.toLocaleString()}\n            </p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm text-muted-foreground\">Total Revenue</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-2xl font-semibold text-green-600 dark:text-green-400\" data-testid=\"text-total-revenue\">\n              ${totalRevenue.toLocaleString()}\n            </p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm text-muted-foreground\">Total Expenses</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-2xl font-semibold text-orange-600 dark:text-orange-400\" data-testid=\"text-total-expenses\">\n              ${totalExpenses.toLocaleString()}\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card className=\"mb-6\">\n        <CardHeader className=\"pb-3\">\n          <div className=\"flex flex-wrap items-center justify-between gap-4\">\n            <CardTitle className=\"flex items-center gap-2\">\n              <Layers className=\"h-5 w-5\" />\n              Account Hierarchy\n            </CardTitle>\n            <div className=\"flex flex-wrap items-center gap-2\">\n              <Input\n                placeholder=\"Search accounts...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"w-64\"\n                data-testid=\"input-search\"\n              />\n              <Select value={filterType} onValueChange={setFilterType}>\n                <SelectTrigger className=\"w-32\" data-testid=\"select-filter-type\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Types</SelectItem>\n                  <SelectItem value=\"asset\">Assets</SelectItem>\n                  <SelectItem value=\"liability\">Liabilities</SelectItem>\n                  <SelectItem value=\"equity\">Equity</SelectItem>\n                  <SelectItem value=\"revenue\">Revenue</SelectItem>\n                  <SelectItem value=\"expense\">Expenses</SelectItem>\n                </SelectContent>\n              </Select>\n              <Button variant=\"outline\" size=\"sm\" onClick={expandAll} data-testid=\"button-expand-all\">\n                Expand All\n              </Button>\n              <Button variant=\"outline\" size=\"sm\" onClick={collapseAll} data-testid=\"button-collapse-all\">\n                Collapse All\n              </Button>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent className=\"p-0\">\n          <div className=\"border rounded-md overflow-hidden\">\n            <div className=\"grid grid-cols-12 gap-2 px-3 py-2 bg-muted/50 text-sm font-medium border-b\">\n              <div className=\"col-span-6\">Account</div>\n              <div className=\"col-span-2 text-center\">Type</div>\n              <div className=\"col-span-1 text-center\">Level</div>\n              <div className=\"col-span-2 text-right\">Balance</div>\n              <div className=\"col-span-1\"></div>\n            </div>\n            <div className=\"max-h-[600px] overflow-y-auto\">\n              {rootAccounts.length === 0 ? (\n                <div className=\"p-8 text-center text-muted-foreground\">\n                  No accounts found. Click \"New Account\" to create one.\n                </div>\n              ) : (\n                rootAccounts.map(account => renderAccountRow(account, 0))\n              )}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Dialog open={isFormOpen} onOpenChange={setIsFormOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>{editingAccount ? \"Edit Account\" : \"New Account\"}</DialogTitle>\n          </DialogHeader>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"accountCode\">Account Number *</Label>\n                <Input\n                  id=\"accountCode\"\n                  value={formData.accountCode}\n                  onChange={(e) => setFormData({ ...formData, accountCode: e.target.value })}\n                  disabled={!!editingAccount}\n                  placeholder=\"e.g., 1111\"\n                  required\n                  data-testid=\"input-account-code\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"type\">Account Type *</Label>\n                <Select\n                  value={formData.accountType}\n                  onValueChange={(value) => setFormData({ ...formData, accountType: value as typeof formData.accountType })}\n                >\n                  <SelectTrigger data-testid=\"select-type\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"asset\">Asset</SelectItem>\n                    <SelectItem value=\"liability\">Liability</SelectItem>\n                    <SelectItem value=\"equity\">Equity</SelectItem>\n                    <SelectItem value=\"revenue\">Revenue</SelectItem>\n                    <SelectItem value=\"expense\">Expense</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"name\">Account Name *</Label>\n              <Input\n                id=\"name\"\n                value={formData.name}\n                onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                placeholder=\"e.g., Cash on Hand\"\n                required\n                data-testid=\"input-name\"\n              />\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"level\">Level *</Label>\n                <Select\n                  value={String(formData.level)}\n                  onValueChange={(value) => setFormData({ ...formData, level: parseInt(value) as 1 | 2 | 3 })}\n                >\n                  <SelectTrigger data-testid=\"select-level\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"1\">Level 1 (Main)</SelectItem>\n                    <SelectItem value=\"2\">Level 2 (Category)</SelectItem>\n                    <SelectItem value=\"3\">Level 3 (Sub-account)</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"parentId\">Parent Account</Label>\n                <Select\n                  value={formData.parentId}\n                  onValueChange={(value) => setFormData({ ...formData, parentId: value })}\n                >\n                  <SelectTrigger data-testid=\"select-parent\">\n                    <SelectValue placeholder=\"Select parent\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"__none__\">None (Root Account)</SelectItem>\n                    {parentAccountOptions.map((account) => (\n                      <SelectItem key={account.id} value={account.id}>\n                        {account.accountCode} - {account.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Checkbox\n                id=\"isPostable\"\n                checked={formData.isPostable}\n                onCheckedChange={(checked) => setFormData({ ...formData, isPostable: checked as boolean })}\n                data-testid=\"checkbox-postable\"\n              />\n              <Label htmlFor=\"isPostable\" className=\"font-normal\">\n                Postable (can receive journal entries)\n              </Label>\n            </div>\n            <div className=\"flex justify-end gap-2 pt-4\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => setIsFormOpen(false)} data-testid=\"button-cancel\">\n                Cancel\n              </Button>\n              <Button \n                type=\"submit\" \n                disabled={createMutation.isPending || updateMutation.isPending}\n                data-testid=\"button-save\"\n              >\n                {(createMutation.isPending || updateMutation.isPending) && (\n                  <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                )}\n                {editingAccount ? \"Update\" : \"Create\"}\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":23624,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":4050,"size_tokens":null},"client/src/components/hr/EmployeeList.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { DataTable, type Column } from \"@/components/layout/DataTable\";\nimport { StatusBadge } from \"@/components/layout/StatusBadge\";\nimport { PageHeader } from \"@/components/layout/PageHeader\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Plus, Download, Eye, Edit, Trash2 } from \"lucide-react\";\nimport { useCompany } from \"@/contexts/CompanyContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { exportToCSV } from \"@/lib/export\";\nimport type { Employee, InsertEmployee } from \"@shared/schema\";\n\nexport function EmployeeList() {\n  const { activeCompany } = useCompany();\n  const { toast } = useToast();\n  const [selectedEmployee, setSelectedEmployee] = useState<Employee | null>(null);\n  const [isFormOpen, setIsFormOpen] = useState(false);\n  const [isDetailOpen, setIsDetailOpen] = useState(false);\n  const [editingEmployee, setEditingEmployee] = useState<Employee | null>(null);\n\n  const [formData, setFormData] = useState({\n    name: \"\",\n    email: \"\",\n    department: \"\",\n    position: \"\",\n    status: \"active\",\n  });\n\n  const { data: employees = [], isLoading } = useQuery<Employee[]>({\n    queryKey: [\"/api/companies\", activeCompany?.id, \"employees\"],\n    enabled: !!activeCompany?.id,\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: Partial<InsertEmployee>) => {\n      const employeeCode = `E${String(Date.now()).slice(-6)}`;\n      return apiRequest(\"POST\", `/api/companies/${activeCompany?.id}/employees`, {\n        ...data,\n        employeeCode,\n        companyId: activeCompany?.id,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"employees\"] });\n      toast({ title: \"Employee created successfully\" });\n      setIsFormOpen(false);\n      resetForm();\n    },\n    onError: () => {\n      toast({ title: \"Failed to create employee\", variant: \"destructive\" });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<Employee> }) => {\n      return apiRequest(\"PATCH\", `/api/companies/${activeCompany?.id}/employees/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"employees\"] });\n      toast({ title: \"Employee updated successfully\" });\n      setIsFormOpen(false);\n      resetForm();\n    },\n    onError: () => {\n      toast({ title: \"Failed to update employee\", variant: \"destructive\" });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest(\"DELETE\", `/api/companies/${activeCompany?.id}/employees/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", activeCompany?.id, \"employees\"] });\n      toast({ title: \"Employee deleted successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to delete employee\", variant: \"destructive\" });\n    },\n  });\n\n  const resetForm = () => {\n    setFormData({\n      name: \"\",\n      email: \"\",\n      department: \"\",\n      position: \"\",\n      status: \"active\",\n    });\n    setEditingEmployee(null);\n  };\n\n  const handleOpenForm = (employee?: Employee) => {\n    if (employee) {\n      setEditingEmployee(employee);\n      setFormData({\n        name: employee.name,\n        email: employee.email || \"\",\n        department: employee.department || \"\",\n        position: employee.position || \"\",\n        status: employee.status || \"active\",\n      });\n    } else {\n      resetForm();\n    }\n    setIsFormOpen(true);\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (editingEmployee) {\n      updateMutation.mutate({ id: editingEmployee.id, data: formData });\n    } else {\n      createMutation.mutate(formData);\n    }\n  };\n\n  const handleViewEmployee = (employee: Employee) => {\n    setSelectedEmployee(employee);\n    setIsDetailOpen(true);\n  };\n\n  const handleDeleteEmployee = (employeeId: string) => {\n    deleteMutation.mutate(employeeId);\n  };\n\n  \n  const getInitials = (name: string) => {\n    return name.split(\" \").map(n => n[0]).join(\"\").toUpperCase().slice(0, 2);\n  };\n\n  const columns: Column<Employee>[] = [\n    { \n      key: \"name\", \n      header: \"Employee\", \n      sortable: true,\n      render: (item) => (\n        <div className=\"flex items-center gap-3\">\n          <Avatar className=\"h-8 w-8\">\n            <AvatarFallback className=\"bg-primary/10 text-primary text-xs\">\n              {getInitials(item.name)}\n            </AvatarFallback>\n          </Avatar>\n          <div>\n            <p className=\"font-medium\">{item.name}</p>\n            <p className=\"text-sm text-muted-foreground\">{item.email}</p>\n          </div>\n        </div>\n      )\n    },\n    { key: \"department\", header: \"Department\", sortable: true },\n    { key: \"position\", header: \"Position\", sortable: true },\n    { \n      key: \"status\", \n      header: \"Status\",\n      render: (item) => <StatusBadge status={item.status as \"active\" | \"on-leave\" | \"inactive\"} />\n    },\n    { \n      key: \"hireDate\", \n      header: \"Hire Date\", \n      sortable: true,\n      render: (item) => item.hireDate ? new Date(item.hireDate).toLocaleDateString() : \"-\"\n    },\n    {\n      key: \"actions\",\n      header: \"\",\n      className: \"text-right\",\n      render: (item) => (\n        <div className=\"flex justify-end gap-1\" onClick={(e) => e.stopPropagation()}>\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => handleViewEmployee(item)} data-testid={`button-view-${item.id}`}>\n            <Eye className=\"h-4 w-4\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => handleOpenForm(item)} data-testid={`button-edit-${item.id}`}>\n            <Edit className=\"h-4 w-4\" />\n          </Button>\n          <Button \n            variant=\"ghost\" \n            size=\"icon\" \n            onClick={() => handleDeleteEmployee(item.id)} \n            disabled={deleteMutation.isPending}\n            data-testid={`button-delete-${item.id}`}\n          >\n            <Trash2 className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      ),\n    },\n  ];\n\n  const handleExport = () => {\n    if (employees.length === 0) {\n      toast({ title: \"No data to export\", variant: \"destructive\" });\n      return;\n    }\n    exportToCSV(\n      employees.map(e => ({\n        code: e.employeeCode,\n        name: e.name,\n        email: e.email || \"\",\n        department: e.department || \"\",\n        position: e.position || \"\",\n        hireDate: e.hireDate ? new Date(e.hireDate).toLocaleDateString(\"id-ID\") : \"\",\n        salary: e.salary,\n        status: e.status\n      })),\n      [\n        { key: \"code\", label: \"Employee Code\" },\n        { key: \"name\", label: \"Name\" },\n        { key: \"email\", label: \"Email\" },\n        { key: \"department\", label: \"Department\" },\n        { key: \"position\", label: \"Position\" },\n        { key: \"hireDate\", label: \"Hire Date\" },\n        { key: \"salary\", label: \"Base Salary (IDR)\" },\n        { key: \"status\", label: \"Status\" }\n      ],\n      \"employees\"\n    );\n    toast({ title: \"Employees exported successfully\" });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-4\">\n        <PageHeader title=\"Employees\" description=\"Manage employee directory\" />\n        <div className=\"space-y-2\">\n          {[1, 2, 3].map((i) => (\n            <Skeleton key={i} className=\"h-12 w-full\" />\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <PageHeader\n        title=\"Employees\"\n        description=\"Manage employee directory\"\n        actions={\n          <>\n            <Button variant=\"outline\" onClick={handleExport} data-testid=\"button-export\">\n              <Download className=\"h-4 w-4 mr-2\" />\n              Export\n            </Button>\n            <Button onClick={() => handleOpenForm()} data-testid=\"button-new-employee\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Employee\n            </Button>\n          </>\n        }\n      />\n\n      <DataTable\n        data={employees}\n        columns={columns}\n        searchKey=\"name\"\n        searchPlaceholder=\"Search employees...\"\n        onRowClick={handleViewEmployee}\n      />\n\n      <Dialog open={isFormOpen} onOpenChange={setIsFormOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>{editingEmployee ? \"Edit Employee\" : \"New Employee\"}</DialogTitle>\n            <DialogDescription>\n              {editingEmployee ? \"Update the employee details below.\" : \"Add a new employee to the directory.\"}\n            </DialogDescription>\n          </DialogHeader>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"name\">Full Name *</Label>\n              <Input\n                id=\"name\"\n                value={formData.name}\n                onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                required\n                data-testid=\"input-employee-name\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\">Email</Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                value={formData.email}\n                onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n                data-testid=\"input-employee-email\"\n              />\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"department\">Department</Label>\n                <Input\n                  id=\"department\"\n                  value={formData.department}\n                  onChange={(e) => setFormData({ ...formData, department: e.target.value })}\n                  data-testid=\"input-employee-department\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"position\">Position</Label>\n                <Input\n                  id=\"position\"\n                  value={formData.position}\n                  onChange={(e) => setFormData({ ...formData, position: e.target.value })}\n                  data-testid=\"input-employee-position\"\n                />\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"status\">Status</Label>\n              <Select\n                value={formData.status}\n                onValueChange={(value) => setFormData({ ...formData, status: value })}\n              >\n                <SelectTrigger data-testid=\"select-employee-status\">\n                  <SelectValue placeholder=\"Select status\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"active\">Active</SelectItem>\n                  <SelectItem value=\"on-leave\">On Leave</SelectItem>\n                  <SelectItem value=\"inactive\">Inactive</SelectItem>\n                  <SelectItem value=\"terminated\">Terminated</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"flex justify-end gap-2 pt-4\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => setIsFormOpen(false)} data-testid=\"button-cancel\">\n                Cancel\n              </Button>\n              <Button \n                type=\"submit\" \n                disabled={!formData.name || createMutation.isPending || updateMutation.isPending}\n                data-testid=\"button-save-employee\"\n              >\n                {(createMutation.isPending || updateMutation.isPending) ? \"Saving...\" : (editingEmployee ? \"Update\" : \"Create\")}\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isDetailOpen} onOpenChange={setIsDetailOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>Employee Details</DialogTitle>\n            <DialogDescription>\n              View employee information for {selectedEmployee?.name}\n            </DialogDescription>\n          </DialogHeader>\n          {selectedEmployee && (\n            <div className=\"space-y-6\">\n              <div className=\"flex items-center gap-4\">\n                <Avatar className=\"h-16 w-16\">\n                  <AvatarFallback className=\"bg-primary/10 text-primary text-xl\">\n                    {getInitials(selectedEmployee.name)}\n                  </AvatarFallback>\n                </Avatar>\n                <div>\n                  <h3 className=\"text-lg font-semibold\" data-testid=\"text-employee-name\">{selectedEmployee.name}</h3>\n                  <p className=\"text-muted-foreground\">{selectedEmployee.position || \"No position\"}</p>\n                  <StatusBadge status={selectedEmployee.status as \"active\" | \"on-leave\" | \"inactive\"} />\n                </div>\n              </div>\n\n              <Card>\n                <CardHeader className=\"pb-3\">\n                  <CardTitle className=\"text-base\">Contact Information</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-2 text-sm\">\n                  <div className=\"flex justify-between gap-2\">\n                    <span className=\"text-muted-foreground\">Email</span>\n                    <span data-testid=\"text-employee-email\">{selectedEmployee.email || \"-\"}</span>\n                  </div>\n                  <div className=\"flex justify-between gap-2\">\n                    <span className=\"text-muted-foreground\">Phone</span>\n                    <span>{selectedEmployee.phone || \"-\"}</span>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"pb-3\">\n                  <CardTitle className=\"text-base\">Employment Details</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-2 text-sm\">\n                  <div className=\"flex justify-between gap-2\">\n                    <span className=\"text-muted-foreground\">Employee Code</span>\n                    <span>{selectedEmployee.employeeCode}</span>\n                  </div>\n                  <div className=\"flex justify-between gap-2\">\n                    <span className=\"text-muted-foreground\">Department</span>\n                    <span>{selectedEmployee.department || \"-\"}</span>\n                  </div>\n                  <div className=\"flex justify-between gap-2\">\n                    <span className=\"text-muted-foreground\">Hire Date</span>\n                    <span data-testid=\"text-employee-hire-date\">\n                      {selectedEmployee.hireDate ? new Date(selectedEmployee.hireDate).toLocaleDateString() : \"-\"}\n                    </span>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <div className=\"flex justify-end gap-2\">\n                <Button variant=\"outline\" onClick={() => setIsDetailOpen(false)} data-testid=\"button-close-detail\">\n                  Close\n                </Button>\n                <Button onClick={() => { setIsDetailOpen(false); handleOpenForm(selectedEmployee); }} data-testid=\"button-edit-from-detail\">\n                  Edit\n                </Button>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":15999,"size_tokens":null},"client/src/components/system/Settings.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { PageHeader } from \"@/components/layout/PageHeader\";\nimport { ThemeToggle } from \"@/components/layout/ThemeToggle\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Settings as SettingsIcon, Users, Shield, Palette, Bell, Save, Loader2 } from \"lucide-react\";\nimport { useCompany } from \"@/contexts/CompanyContext\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nconst mockRoles = [\n  { id: \"admin\", name: \"Administrator\", users: 2, permissions: [\"all\"] },\n  { id: \"manager\", name: \"Manager\", users: 5, permissions: [\"read\", \"write\", \"approve\"] },\n  { id: \"staff\", name: \"Staff\", users: 12, permissions: [\"read\", \"write\"] },\n  { id: \"viewer\", name: \"Viewer\", users: 8, permissions: [\"read\"] },\n];\n\nconst permissionGroups = [\n  { name: \"Sales\", permissions: [\"View Orders\", \"Create Orders\", \"Edit Orders\", \"Delete Orders\", \"Approve Orders\"] },\n  { name: \"Warehouse\", permissions: [\"View Products\", \"Manage Products\", \"View Stock\", \"Adjust Stock\", \"Manage POs\"] },\n  { name: \"Financials\", permissions: [\"View Accounts\", \"Create Entries\", \"Post Entries\", \"View Reports\"] },\n  { name: \"HR\", permissions: [\"View Employees\", \"Manage Employees\", \"Approve Leave\", \"Process Payroll\"] },\n];\n\nconst currencies = [\n  { code: \"IDR\", name: \"Indonesian Rupiah\" },\n  { code: \"USD\", name: \"US Dollar\" },\n  { code: \"EUR\", name: \"Euro\" },\n  { code: \"GBP\", name: \"British Pound\" },\n  { code: \"SGD\", name: \"Singapore Dollar\" },\n  { code: \"JPY\", name: \"Japanese Yen\" },\n  { code: \"CNY\", name: \"Chinese Yuan\" },\n  { code: \"AUD\", name: \"Australian Dollar\" },\n  { code: \"MYR\", name: \"Malaysian Ringgit\" },\n  { code: \"THB\", name: \"Thai Baht\" },\n];\n\nconst timezones = [\n  { value: \"Asia/Jakarta\", label: \"Jakarta (WIB)\" },\n  { value: \"Asia/Makassar\", label: \"Makassar (WITA)\" },\n  { value: \"Asia/Jayapura\", label: \"Jayapura (WIT)\" },\n  { value: \"Asia/Singapore\", label: \"Singapore (SGT)\" },\n  { value: \"America/New_York\", label: \"Eastern Time (ET)\" },\n  { value: \"America/Chicago\", label: \"Central Time (CT)\" },\n  { value: \"America/Denver\", label: \"Mountain Time (MT)\" },\n  { value: \"America/Los_Angeles\", label: \"Pacific Time (PT)\" },\n  { value: \"Europe/London\", label: \"London (GMT/BST)\" },\n  { value: \"Europe/Berlin\", label: \"Berlin (CET)\" },\n  { value: \"UTC\", label: \"UTC\" },\n];\n\nexport function Settings() {\n  const { activeCompany, activeCompanyId, refreshContext } = useCompany();\n  const { toast } = useToast();\n  const queryClientInstance = useQueryClient();\n\n  const [activeTab, setActiveTab] = useState(\"general\");\n  const [companyName, setCompanyName] = useState(\"\");\n  const [currency, setCurrency] = useState(\"IDR\");\n  const [timezone, setTimezone] = useState(\"Asia/Jakarta\");\n  const [locale, setLocale] = useState(\"id-ID\");\n  const [emailNotifications, setEmailNotifications] = useState(true);\n  const [lowStockAlerts, setLowStockAlerts] = useState(true);\n  const [orderNotifications, setOrderNotifications] = useState(true);\n\n  useEffect(() => {\n    if (activeCompany) {\n      setCompanyName(activeCompany.name || \"\");\n      setCurrency(activeCompany.currency || \"IDR\");\n      setTimezone(activeCompany.timezone || \"Asia/Jakarta\");\n      setLocale(activeCompany.locale || \"id-ID\");\n    }\n  }, [activeCompany]);\n\n  const updateCompanyMutation = useMutation({\n    mutationFn: async (updates: { name?: string; currency?: string; timezone?: string; locale?: string }) => {\n      if (!activeCompanyId) throw new Error(\"No active company\");\n      const response = await apiRequest(\"PATCH\", `/api/companies/${activeCompanyId}`, updates);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Settings saved\",\n        description: \"Company settings have been updated successfully.\",\n      });\n      queryClientInstance.invalidateQueries({ queryKey: [\"/api/companies\"] });\n      queryClientInstance.invalidateQueries({ queryKey: [\"/api/session/context\", activeCompanyId] });\n      queryClientInstance.invalidateQueries({ queryKey: [\"/api/companies/hierarchy\"] });\n      refreshContext();\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to save settings\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSave = () => {\n    updateCompanyMutation.mutate({\n      name: companyName,\n      currency,\n      timezone,\n      locale,\n    });\n  };\n\n  const handleSaveNotifications = () => {\n    toast({\n      title: \"Preferences saved\",\n      description: \"Notification preferences have been updated.\",\n    });\n  };\n\n  return (\n    <div>\n      <PageHeader\n        title=\"Settings\"\n        description={`Manage settings for ${activeCompany?.name || \"your company\"}`}\n      />\n\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList className=\"mb-6\">\n          <TabsTrigger value=\"general\" data-testid=\"tab-general\">\n            <SettingsIcon className=\"h-4 w-4 mr-2\" />\n            General\n          </TabsTrigger>\n          <TabsTrigger value=\"roles\" data-testid=\"tab-roles\">\n            <Shield className=\"h-4 w-4 mr-2\" />\n            Roles & Permissions\n          </TabsTrigger>\n          <TabsTrigger value=\"notifications\" data-testid=\"tab-notifications\">\n            <Bell className=\"h-4 w-4 mr-2\" />\n            Notifications\n          </TabsTrigger>\n          <TabsTrigger value=\"appearance\" data-testid=\"tab-appearance\">\n            <Palette className=\"h-4 w-4 mr-2\" />\n            Appearance\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"general\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Company Settings</CardTitle>\n              <CardDescription>\n                Configure settings for {activeCompany?.name || \"your company\"}\n                {activeCompany?.companyType && (\n                  <span className=\"ml-2 text-xs uppercase text-muted-foreground\">\n                    ({activeCompany.companyType})\n                  </span>\n                )}\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <div className=\"grid md:grid-cols-2 gap-6\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"companyName\">Company Name</Label>\n                  <Input\n                    id=\"companyName\"\n                    value={companyName}\n                    onChange={(e) => setCompanyName(e.target.value)}\n                    data-testid=\"input-company-name\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"currency\">Default Currency</Label>\n                  <Select value={currency} onValueChange={setCurrency}>\n                    <SelectTrigger data-testid=\"select-currency\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {currencies.map((c) => (\n                        <SelectItem key={c.code} value={c.code}>\n                          {c.code} - {c.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"timezone\">Timezone</Label>\n                  <Select value={timezone} onValueChange={setTimezone}>\n                    <SelectTrigger data-testid=\"select-timezone\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {timezones.map((tz) => (\n                        <SelectItem key={tz.value} value={tz.value}>\n                          {tz.label}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>Company Code</Label>\n                  <Input\n                    value={activeCompany?.code || \"\"}\n                    disabled\n                    className=\"bg-muted\"\n                    data-testid=\"input-company-code\"\n                  />\n                  <p className=\"text-xs text-muted-foreground\">Company code cannot be changed</p>\n                </div>\n              </div>\n              <div className=\"flex justify-end\">\n                <Button \n                  onClick={handleSave} \n                  disabled={updateCompanyMutation.isPending}\n                  data-testid=\"button-save-general\"\n                >\n                  {updateCompanyMutation.isPending ? (\n                    <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                  ) : (\n                    <Save className=\"h-4 w-4 mr-2\" />\n                  )}\n                  Save Changes\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"roles\">\n          <div className=\"grid md:grid-cols-2 gap-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle>User Roles</CardTitle>\n                <CardDescription>Manage user roles and their members</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  {mockRoles.map((role) => (\n                    <div key={role.id} className=\"flex items-center justify-between p-3 border rounded-md hover-elevate\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"flex items-center justify-center w-8 h-8 rounded-md bg-primary/10\">\n                          <Users className=\"h-4 w-4 text-primary\" />\n                        </div>\n                        <div>\n                          <p className=\"font-medium\">{role.name}</p>\n                          <p className=\"text-sm text-muted-foreground\">{role.users} users</p>\n                        </div>\n                      </div>\n                      <Button variant=\"outline\" size=\"sm\" data-testid={`button-edit-role-${role.id}`}>\n                        Edit\n                      </Button>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Permissions Matrix</CardTitle>\n                <CardDescription>Configure role permissions</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  {permissionGroups.map((group) => (\n                    <div key={group.name} className=\"space-y-2\">\n                      <h4 className=\"font-medium text-sm\">{group.name}</h4>\n                      <div className=\"grid grid-cols-2 gap-2\">\n                        {group.permissions.map((perm) => (\n                          <div key={perm} className=\"flex items-center gap-2\">\n                            <Checkbox id={perm} defaultChecked={Math.random() > 0.3} />\n                            <Label htmlFor={perm} className=\"text-sm font-normal\">\n                              {perm}\n                            </Label>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"notifications\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Notification Preferences</CardTitle>\n              <CardDescription>Configure how you receive notifications</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"font-medium\">Email Notifications</p>\n                  <p className=\"text-sm text-muted-foreground\">Receive email notifications for important events</p>\n                </div>\n                <Switch\n                  checked={emailNotifications}\n                  onCheckedChange={setEmailNotifications}\n                  data-testid=\"switch-email-notifications\"\n                />\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"font-medium\">Low Stock Alerts</p>\n                  <p className=\"text-sm text-muted-foreground\">Get notified when products fall below minimum stock</p>\n                </div>\n                <Switch\n                  checked={lowStockAlerts}\n                  onCheckedChange={setLowStockAlerts}\n                  data-testid=\"switch-low-stock\"\n                />\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"font-medium\">Order Notifications</p>\n                  <p className=\"text-sm text-muted-foreground\">Receive alerts for new orders and status changes</p>\n                </div>\n                <Switch\n                  checked={orderNotifications}\n                  onCheckedChange={setOrderNotifications}\n                  data-testid=\"switch-order-notifications\"\n                />\n              </div>\n              <div className=\"flex justify-end pt-4\">\n                <Button onClick={handleSaveNotifications} data-testid=\"button-save-notifications\">\n                  <Save className=\"h-4 w-4 mr-2\" />\n                  Save Preferences\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"appearance\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Appearance Settings</CardTitle>\n              <CardDescription>Customize the look and feel of the application</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"font-medium\">Theme</p>\n                  <p className=\"text-sm text-muted-foreground\">Switch between light and dark mode</p>\n                </div>\n                <ThemeToggle />\n              </div>\n              <div className=\"p-4 border rounded-md bg-muted/30\">\n                <p className=\"text-sm text-muted-foreground\">\n                  The theme will be applied across all pages and saved to your preferences.\n                </p>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":15310,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"client/src/components/hr/AttendanceList.tsx":{"content":"import { useState } from \"react\";\nimport { DataTable, type Column } from \"@/components/layout/DataTable\";\nimport { StatusBadge } from \"@/components/layout/StatusBadge\";\nimport { PageHeader } from \"@/components/layout/PageHeader\";\nimport { StatCard } from \"@/components/layout/StatCard\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Download, Clock, Users, UserCheck, UserX } from \"lucide-react\";\nimport { mockAttendance } from \"@/lib/mockData\";\nimport { exportToCSV } from \"@/lib/export\";\n\ntype Attendance = typeof mockAttendance[0];\n\nexport function AttendanceList() {\n  const [attendance, setAttendance] = useState(mockAttendance);\n  const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split(\"T\")[0]);\n\n  const presentCount = attendance.filter(a => a.status === \"present\").length;\n  const onLeaveCount = attendance.filter(a => a.status === \"on-leave\").length;\n  const totalHours = attendance.reduce((sum, a) => sum + a.hours, 0);\n\n  const handleCheckIn = (attendanceId: string) => {\n    const now = new Date();\n    const time = `${String(now.getHours()).padStart(2, \"0\")}:${String(now.getMinutes()).padStart(2, \"0\")}`;\n    setAttendance(attendance.map(a => \n      a.id === attendanceId ? { ...a, checkIn: time, status: \"present\" } : a\n    ));\n    console.log(\"Checked in:\", attendanceId, time);\n  };\n\n  const handleCheckOut = (attendanceId: string) => {\n    const now = new Date();\n    const time = `${String(now.getHours()).padStart(2, \"0\")}:${String(now.getMinutes()).padStart(2, \"0\")}`;\n    const record = attendance.find(a => a.id === attendanceId);\n    if (record?.checkIn) {\n      const checkInParts = record.checkIn.split(\":\");\n      const checkInHour = parseInt(checkInParts[0]);\n      const checkInMin = parseInt(checkInParts[1]);\n      const hours = (now.getHours() - checkInHour) + (now.getMinutes() - checkInMin) / 60;\n      setAttendance(attendance.map(a => \n        a.id === attendanceId ? { ...a, checkOut: time, hours: Math.round(hours * 100) / 100 } : a\n      ));\n      console.log(\"Checked out:\", attendanceId, time);\n    }\n  };\n\n  const columns: Column<Attendance>[] = [\n    { key: \"employeeName\", header: \"Employee\", sortable: true },\n    { key: \"date\", header: \"Date\", sortable: true },\n    { \n      key: \"checkIn\", \n      header: \"Check In\",\n      render: (item) => item.checkIn || \"-\"\n    },\n    { \n      key: \"checkOut\", \n      header: \"Check Out\",\n      render: (item) => item.checkOut || \"-\"\n    },\n    { \n      key: \"hours\", \n      header: \"Hours\", \n      sortable: true,\n      className: \"text-right\",\n      render: (item) => item.hours > 0 ? `${item.hours}h` : \"-\"\n    },\n    { \n      key: \"status\", \n      header: \"Status\",\n      render: (item) => <StatusBadge status={item.status as \"present\" | \"on-leave\" | \"absent\"} />\n    },\n    {\n      key: \"actions\",\n      header: \"\",\n      className: \"text-right\",\n      render: (item) => (\n        <div className=\"flex justify-end gap-1\" onClick={(e) => e.stopPropagation()}>\n          {!item.checkIn && item.status !== \"on-leave\" && (\n            <Button \n              size=\"sm\" \n              onClick={() => handleCheckIn(item.id)}\n              data-testid={`button-checkin-${item.id}`}\n            >\n              Check In\n            </Button>\n          )}\n          {item.checkIn && !item.checkOut && (\n            <Button \n              size=\"sm\" \n              variant=\"outline\"\n              onClick={() => handleCheckOut(item.id)}\n              data-testid={`button-checkout-${item.id}`}\n            >\n              Check Out\n            </Button>\n          )}\n        </div>\n      ),\n    },\n  ];\n\n  const handleExport = () => {\n    if (attendance.length === 0) return;\n    exportToCSV(\n      attendance.map(a => ({\n        employee: a.employeeName,\n        date: a.date,\n        checkIn: a.checkIn || \"\",\n        checkOut: a.checkOut || \"\",\n        hours: a.hours,\n        status: a.status\n      })),\n      [\n        { key: \"employee\", label: \"Employee\" },\n        { key: \"date\", label: \"Date\" },\n        { key: \"checkIn\", label: \"Check In\" },\n        { key: \"checkOut\", label: \"Check Out\" },\n        { key: \"hours\", label: \"Hours\" },\n        { key: \"status\", label: \"Status\" }\n      ],\n      \"attendance\"\n    );\n  };\n\n  return (\n    <div>\n      <PageHeader\n        title=\"Attendance\"\n        description=\"Track daily attendance\"\n        actions={\n          <Button variant=\"outline\" onClick={handleExport} data-testid=\"button-export\">\n            <Download className=\"h-4 w-4 mr-2\" />\n            Export\n          </Button>\n        }\n      />\n\n      <div className=\"grid md:grid-cols-4 gap-4 mb-6\">\n        <StatCard\n          title=\"Total Employees\"\n          value={attendance.length}\n          icon={Users}\n        />\n        <StatCard\n          title=\"Present Today\"\n          value={presentCount}\n          icon={UserCheck}\n        />\n        <StatCard\n          title=\"On Leave\"\n          value={onLeaveCount}\n          icon={UserX}\n        />\n        <StatCard\n          title=\"Total Hours\"\n          value={`${totalHours.toFixed(1)}h`}\n          icon={Clock}\n        />\n      </div>\n\n      <div className=\"flex flex-wrap items-center gap-4 mb-4\">\n        <div className=\"space-y-1\">\n          <Label htmlFor=\"date\">Date</Label>\n          <Input\n            id=\"date\"\n            type=\"date\"\n            value={selectedDate}\n            onChange={(e) => setSelectedDate(e.target.value)}\n            className=\"w-40\"\n            data-testid=\"input-date\"\n          />\n        </div>\n      </div>\n\n      <DataTable\n        data={attendance}\n        columns={columns}\n        searchKey=\"employeeName\"\n        searchPlaceholder=\"Search employees...\"\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":5795,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/components/financials/JournalEntries.tsx":{"content":"import { useState } from \"react\";\nimport { DataTable, type Column } from \"@/components/layout/DataTable\";\nimport { StatusBadge } from \"@/components/layout/StatusBadge\";\nimport { PageHeader } from \"@/components/layout/PageHeader\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Plus, Download, CheckCircle } from \"lucide-react\";\nimport { mockJournalEntries, mockAccounts, type ChartOfAccountsEntry } from \"@/lib/mockData\";\n\ntype JournalEntry = typeof mockJournalEntries[0];\n\nexport function JournalEntries() {\n  const [entries, setEntries] = useState(mockJournalEntries);\n  const [isFormOpen, setIsFormOpen] = useState(false);\n\n  const [formData, setFormData] = useState({\n    description: \"\",\n    debitAccount: \"\",\n    creditAccount: \"\",\n    amount: 0,\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    // todo: remove mock functionality\n    const newEntry: JournalEntry = {\n      id: `JE-${String(entries.length + 1).padStart(3, \"0\")}`,\n      date: new Date().toISOString().split(\"T\")[0],\n      status: \"draft\",\n      ...formData,\n    };\n    setEntries([newEntry, ...entries]);\n    console.log(\"Created journal entry:\", newEntry);\n    setIsFormOpen(false);\n    setFormData({ description: \"\", debitAccount: \"\", creditAccount: \"\", amount: 0 });\n  };\n\n  const handlePost = (entryId: string) => {\n    setEntries(entries.map(e => \n      e.id === entryId ? { ...e, status: \"posted\" } : e\n    ));\n    console.log(\"Posted journal entry:\", entryId);\n  };\n\n  const postableAccounts = mockAccounts.filter(a => a.isPostable);\n\n  const getAccountName = (accountId: string) => {\n    return mockAccounts.find(a => a.id === accountId)?.name || accountId;\n  };\n\n  const columns: Column<JournalEntry>[] = [\n    { key: \"id\", header: \"Entry #\", sortable: true },\n    { key: \"date\", header: \"Date\", sortable: true },\n    { key: \"description\", header: \"Description\", sortable: true },\n    { \n      key: \"debitAccount\", \n      header: \"Debit\", \n      render: (item) => getAccountName(item.debitAccount)\n    },\n    { \n      key: \"creditAccount\", \n      header: \"Credit\", \n      render: (item) => getAccountName(item.creditAccount)\n    },\n    { \n      key: \"amount\", \n      header: \"Amount\", \n      sortable: true,\n      className: \"text-right\",\n      render: (item) => `$${item.amount.toLocaleString(undefined, { minimumFractionDigits: 2 })}`\n    },\n    { \n      key: \"status\", \n      header: \"Status\",\n      render: (item) => <StatusBadge status={item.status as \"posted\" | \"draft\"} />\n    },\n    {\n      key: \"actions\",\n      header: \"\",\n      className: \"text-right\",\n      render: (item) => (\n        <div className=\"flex justify-end gap-1\" onClick={(e) => e.stopPropagation()}>\n          {item.status === \"draft\" && (\n            <Button \n              variant=\"ghost\" \n              size=\"sm\" \n              onClick={() => handlePost(item.id)}\n              data-testid={`button-post-${item.id}`}\n            >\n              <CheckCircle className=\"h-4 w-4 mr-1\" />\n              Post\n            </Button>\n          )}\n        </div>\n      ),\n    },\n  ];\n\n  const isValid = formData.description && formData.debitAccount && formData.creditAccount && formData.amount > 0;\n\n  return (\n    <div>\n      <PageHeader\n        title=\"Journal Entries\"\n        description=\"Record and manage accounting entries\"\n        actions={\n          <>\n            <Button variant=\"outline\" data-testid=\"button-export\">\n              <Download className=\"h-4 w-4 mr-2\" />\n              Export\n            </Button>\n            <Button onClick={() => setIsFormOpen(true)} data-testid=\"button-new-entry\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Entry\n            </Button>\n          </>\n        }\n      />\n\n      <DataTable\n        data={entries}\n        columns={columns}\n        searchKey=\"description\"\n        searchPlaceholder=\"Search entries...\"\n      />\n\n      <Dialog open={isFormOpen} onOpenChange={setIsFormOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>New Journal Entry</DialogTitle>\n          </DialogHeader>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"description\">Description *</Label>\n              <Textarea\n                id=\"description\"\n                value={formData.description}\n                onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                rows={2}\n                required\n                data-testid=\"textarea-description\"\n              />\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"debitAccount\">Debit Account *</Label>\n                <Select\n                  value={formData.debitAccount}\n                  onValueChange={(value) => setFormData({ ...formData, debitAccount: value })}\n                >\n                  <SelectTrigger data-testid=\"select-debit\">\n                    <SelectValue placeholder=\"Select account\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {postableAccounts.map((account) => (\n                      <SelectItem key={account.id} value={account.id}>\n                        {account.id} - {account.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"creditAccount\">Credit Account *</Label>\n                <Select\n                  value={formData.creditAccount}\n                  onValueChange={(value) => setFormData({ ...formData, creditAccount: value })}\n                >\n                  <SelectTrigger data-testid=\"select-credit\">\n                    <SelectValue placeholder=\"Select account\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {postableAccounts.map((account) => (\n                      <SelectItem key={account.id} value={account.id}>\n                        {account.id} - {account.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"amount\">Amount *</Label>\n              <Input\n                id=\"amount\"\n                type=\"number\"\n                step=\"0.01\"\n                min=\"0.01\"\n                value={formData.amount || \"\"}\n                onChange={(e) => setFormData({ ...formData, amount: parseFloat(e.target.value) || 0 })}\n                required\n                data-testid=\"input-amount\"\n              />\n            </div>\n            <div className=\"p-3 bg-muted/50 rounded-md text-sm\">\n              <p className=\"text-muted-foreground\">\n                Debits must equal credits for the entry to be valid.\n              </p>\n            </div>\n            <div className=\"flex justify-end gap-2 pt-4\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => setIsFormOpen(false)} data-testid=\"button-cancel\">\n                Cancel\n              </Button>\n              <Button type=\"submit\" disabled={!isValid} data-testid=\"button-save\">\n                Create Entry\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":7841,"size_tokens":null},"client/src/components/layout/WorkflowStepper.tsx":{"content":"import { Check } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface Step {\n  id: string;\n  label: string;\n}\n\ninterface WorkflowStepperProps {\n  steps: Step[];\n  currentStep: string;\n  className?: string;\n}\n\nexport function WorkflowStepper({ steps, currentStep, className }: WorkflowStepperProps) {\n  const currentIndex = steps.findIndex((step) => step.id === currentStep);\n\n  return (\n    <div className={cn(\"flex items-center\", className)}>\n      {steps.map((step, index) => {\n        const isCompleted = index < currentIndex;\n        const isCurrent = index === currentIndex;\n        const isPending = index > currentIndex;\n\n        return (\n          <div key={step.id} className=\"flex items-center\">\n            <div className=\"flex flex-col items-center\">\n              <div\n                className={cn(\n                  \"flex items-center justify-center w-8 h-8 rounded-full border-2 text-sm font-medium transition-colors\",\n                  isCompleted && \"bg-primary border-primary text-primary-foreground\",\n                  isCurrent && \"border-primary text-primary bg-primary/10\",\n                  isPending && \"border-muted-foreground/30 text-muted-foreground/50\"\n                )}\n              >\n                {isCompleted ? (\n                  <Check className=\"h-4 w-4\" />\n                ) : (\n                  <span>{index + 1}</span>\n                )}\n              </div>\n              <span\n                className={cn(\n                  \"mt-2 text-xs font-medium whitespace-nowrap\",\n                  isCompleted && \"text-primary\",\n                  isCurrent && \"text-foreground\",\n                  isPending && \"text-muted-foreground/50\"\n                )}\n              >\n                {step.label}\n              </span>\n            </div>\n            {index < steps.length - 1 && (\n              <div\n                className={cn(\n                  \"w-12 sm:w-16 h-0.5 mx-2 mt-[-1rem]\",\n                  index < currentIndex ? \"bg-primary\" : \"bg-muted\"\n                )}\n              />\n            )}\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n","path":null,"size_bytes":2116,"size_tokens":null},"client/src/pages/setup/SetupCompany.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Building2, Mail, Globe, Phone, AlertCircle, CheckCircle2, ArrowRight, Loader2 } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface CompanySetupData {\n  code: string;\n  name: string;\n  legalName?: string;\n  taxId?: string;\n  companyType: \"holding\" | \"subsidiary\" | \"branch\";\n  currency: string;\n  timezone: string;\n  locale: string;\n  address?: string;\n  city?: string;\n  state?: string;\n  country?: string;\n  postalCode?: string;\n  phone?: string;\n  email?: string;\n  website?: string;\n}\n\nconst timezones = [\n  { value: \"UTC\", label: \"UTC\" },\n  { value: \"America/New_York\", label: \"Eastern Time (US)\" },\n  { value: \"America/Chicago\", label: \"Central Time (US)\" },\n  { value: \"America/Denver\", label: \"Mountain Time (US)\" },\n  { value: \"America/Los_Angeles\", label: \"Pacific Time (US)\" },\n  { value: \"Europe/London\", label: \"London (UK)\" },\n  { value: \"Europe/Paris\", label: \"Paris (France)\" },\n  { value: \"Europe/Berlin\", label: \"Berlin (Germany)\" },\n  { value: \"Asia/Tokyo\", label: \"Tokyo (Japan)\" },\n  { value: \"Asia/Singapore\", label: \"Singapore\" },\n  { value: \"Asia/Shanghai\", label: \"Shanghai (China)\" },\n  { value: \"Australia/Sydney\", label: \"Sydney (Australia)\" },\n];\n\nconst currencies = [\n  { value: \"USD\", label: \"USD - US Dollar\" },\n  { value: \"EUR\", label: \"EUR - Euro\" },\n  { value: \"GBP\", label: \"GBP - British Pound\" },\n  { value: \"JPY\", label: \"JPY - Japanese Yen\" },\n  { value: \"CNY\", label: \"CNY - Chinese Yuan\" },\n  { value: \"SGD\", label: \"SGD - Singapore Dollar\" },\n  { value: \"AUD\", label: \"AUD - Australian Dollar\" },\n  { value: \"CAD\", label: \"CAD - Canadian Dollar\" },\n  { value: \"CHF\", label: \"CHF - Swiss Franc\" },\n  { value: \"INR\", label: \"INR - Indian Rupee\" },\n];\n\nexport function SetupCompany() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [error, setError] = useState<string | null>(null);\n\n  const [companyData, setCompanyData] = useState<CompanySetupData>({\n    code: \"\",\n    name: \"\",\n    legalName: \"\",\n    taxId: \"\",\n    companyType: \"holding\",\n    currency: \"USD\",\n    timezone: \"UTC\",\n    locale: \"en-US\",\n    address: \"\",\n    city: \"\",\n    state: \"\",\n    country: \"\",\n    postalCode: \"\",\n    phone: \"\",\n    email: \"\",\n    website: \"\",\n  });\n\n  const companyMutation = useMutation({\n    mutationFn: async (data: CompanySetupData) => {\n      const response = await apiRequest(\"POST\", \"/api/setup/company\", data);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/setup/status\"] });\n      sessionStorage.setItem(\"setup_company_id\", data.company.id);\n      sessionStorage.setItem(\"setup_company_name\", data.company.name);\n      toast({\n        title: \"Company Created\",\n        description: `${data.company.name} has been set up successfully.`,\n      });\n      setLocation(\"/setup/admin-user\");\n    },\n    onError: (err: any) => {\n      const message = err?.message || \"Failed to create company\";\n      setError(message);\n      toast({\n        variant: \"destructive\",\n        title: \"Setup Failed\",\n        description: message,\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(null);\n\n    if (!companyData.code.match(/^[A-Z0-9-]+$/)) {\n      setError(\"Company code must be uppercase letters, numbers, and dashes only\");\n      return;\n    }\n\n    companyMutation.mutate(companyData);\n  };\n\n  return (\n    <div className=\"flex items-center justify-center min-h-screen bg-background p-4\">\n      <div className=\"w-full max-w-2xl\">\n        <div className=\"text-center mb-8\">\n          <div className=\"flex items-center justify-center gap-2 mb-4\">\n            <Building2 className=\"w-10 h-10 text-primary\" />\n            <h1 className=\"text-3xl font-bold\">Unanza Setup</h1>\n          </div>\n          <p className=\"text-muted-foreground\">Welcome! Let's get your ERP system configured.</p>\n        </div>\n\n        <div className=\"flex items-center justify-center gap-4 mb-8\">\n          <div className=\"flex items-center gap-2 text-primary\">\n            <div className=\"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium bg-primary text-primary-foreground\">\n              1\n            </div>\n            <span className=\"font-medium\">Company</span>\n          </div>\n          <div className=\"w-12 h-0.5 bg-border\" />\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium bg-muted\">\n              2\n            </div>\n            <span className=\"font-medium text-muted-foreground\">Admin Account</span>\n          </div>\n          <div className=\"w-12 h-0.5 bg-border\" />\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium bg-muted\">\n              3\n            </div>\n            <span className=\"font-medium text-muted-foreground\">Complete</span>\n          </div>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Register Your Company</CardTitle>\n            <CardDescription>\n              Set up your holding company. This will be the top level of your organization hierarchy.\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <form onSubmit={handleSubmit} className=\"space-y-6\">\n              {error && (\n                <div className=\"flex items-center gap-2 p-3 rounded-md bg-destructive/10 text-destructive text-sm\" data-testid=\"error-setup\">\n                  <AlertCircle className=\"w-4 h-4 shrink-0\" />\n                  <span>{error}</span>\n                </div>\n              )}\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"code\">Company Code *</Label>\n                  <Input\n                    id=\"code\"\n                    placeholder=\"ACME-HQ\"\n                    value={companyData.code}\n                    onChange={(e) => setCompanyData({ ...companyData, code: e.target.value.toUpperCase() })}\n                    required\n                    disabled={companyMutation.isPending}\n                    data-testid=\"input-company-code\"\n                  />\n                  <p className=\"text-xs text-muted-foreground\">Uppercase, numbers, dashes only</p>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"name\">Company Name *</Label>\n                  <Input\n                    id=\"name\"\n                    placeholder=\"Acme Corporation\"\n                    value={companyData.name}\n                    onChange={(e) => setCompanyData({ ...companyData, name: e.target.value })}\n                    required\n                    disabled={companyMutation.isPending}\n                    data-testid=\"input-company-name\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"legalName\">Legal Name</Label>\n                  <Input\n                    id=\"legalName\"\n                    placeholder=\"Acme Corporation Ltd.\"\n                    value={companyData.legalName}\n                    onChange={(e) => setCompanyData({ ...companyData, legalName: e.target.value })}\n                    disabled={companyMutation.isPending}\n                    data-testid=\"input-legal-name\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"taxId\">Tax ID</Label>\n                  <Input\n                    id=\"taxId\"\n                    placeholder=\"12-3456789\"\n                    value={companyData.taxId}\n                    onChange={(e) => setCompanyData({ ...companyData, taxId: e.target.value })}\n                    disabled={companyMutation.isPending}\n                    data-testid=\"input-tax-id\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-3 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"currency\">Currency *</Label>\n                  <Select\n                    value={companyData.currency}\n                    onValueChange={(v) => setCompanyData({ ...companyData, currency: v })}\n                    disabled={companyMutation.isPending}\n                  >\n                    <SelectTrigger data-testid=\"select-currency\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {currencies.map((c) => (\n                        <SelectItem key={c.value} value={c.value}>{c.label}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"timezone\">Timezone *</Label>\n                  <Select\n                    value={companyData.timezone}\n                    onValueChange={(v) => setCompanyData({ ...companyData, timezone: v })}\n                    disabled={companyMutation.isPending}\n                  >\n                    <SelectTrigger data-testid=\"select-timezone\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {timezones.map((tz) => (\n                        <SelectItem key={tz.value} value={tz.value}>{tz.label}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"country\">Country</Label>\n                  <Input\n                    id=\"country\"\n                    placeholder=\"US\"\n                    maxLength={2}\n                    value={companyData.country}\n                    onChange={(e) => setCompanyData({ ...companyData, country: e.target.value.toUpperCase() })}\n                    disabled={companyMutation.isPending}\n                    data-testid=\"input-country\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"address\">Address</Label>\n                <Input\n                  id=\"address\"\n                  placeholder=\"123 Business Ave\"\n                  value={companyData.address}\n                  onChange={(e) => setCompanyData({ ...companyData, address: e.target.value })}\n                  disabled={companyMutation.isPending}\n                  data-testid=\"input-address\"\n                />\n              </div>\n\n              <div className=\"grid grid-cols-3 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"city\">City</Label>\n                  <Input\n                    id=\"city\"\n                    placeholder=\"New York\"\n                    value={companyData.city}\n                    onChange={(e) => setCompanyData({ ...companyData, city: e.target.value })}\n                    disabled={companyMutation.isPending}\n                    data-testid=\"input-city\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"state\">State/Province</Label>\n                  <Input\n                    id=\"state\"\n                    placeholder=\"NY\"\n                    value={companyData.state}\n                    onChange={(e) => setCompanyData({ ...companyData, state: e.target.value })}\n                    disabled={companyMutation.isPending}\n                    data-testid=\"input-state\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"postalCode\">Postal Code</Label>\n                  <Input\n                    id=\"postalCode\"\n                    placeholder=\"10001\"\n                    value={companyData.postalCode}\n                    onChange={(e) => setCompanyData({ ...companyData, postalCode: e.target.value })}\n                    disabled={companyMutation.isPending}\n                    data-testid=\"input-postal-code\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"phone\">Phone</Label>\n                  <div className=\"relative\">\n                    <Phone className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n                    <Input\n                      id=\"phone\"\n                      placeholder=\"+1-555-000-0000\"\n                      value={companyData.phone}\n                      onChange={(e) => setCompanyData({ ...companyData, phone: e.target.value })}\n                      className=\"pl-10\"\n                      disabled={companyMutation.isPending}\n                      data-testid=\"input-phone\"\n                    />\n                  </div>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"companyEmail\">Email</Label>\n                  <div className=\"relative\">\n                    <Mail className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n                    <Input\n                      id=\"companyEmail\"\n                      type=\"email\"\n                      placeholder=\"contact@company.com\"\n                      value={companyData.email}\n                      onChange={(e) => setCompanyData({ ...companyData, email: e.target.value })}\n                      className=\"pl-10\"\n                      disabled={companyMutation.isPending}\n                      data-testid=\"input-company-email\"\n                    />\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"website\">Website</Label>\n                <div className=\"relative\">\n                  <Globe className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n                  <Input\n                    id=\"website\"\n                    type=\"url\"\n                    placeholder=\"https://www.company.com\"\n                    value={companyData.website}\n                    onChange={(e) => setCompanyData({ ...companyData, website: e.target.value })}\n                    className=\"pl-10\"\n                    disabled={companyMutation.isPending}\n                    data-testid=\"input-website\"\n                  />\n                </div>\n              </div>\n\n              <Button\n                type=\"submit\"\n                className=\"w-full\"\n                disabled={companyMutation.isPending || !companyData.code || !companyData.name}\n                data-testid=\"button-create-company\"\n              >\n                {companyMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                    Creating Company...\n                  </>\n                ) : (\n                  <>\n                    Continue to Admin Setup\n                    <ArrowRight className=\"w-4 h-4 ml-2\" />\n                  </>\n                )}\n              </Button>\n            </form>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":15976,"size_tokens":null},"client/src/components/warehouse/ProductList.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { DataTable, type Column } from \"@/components/layout/DataTable\";\nimport { StatusBadge } from \"@/components/layout/StatusBadge\";\nimport { PageHeader } from \"@/components/layout/PageHeader\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Plus, Download, Eye, Edit, Trash2, Package, Loader2 } from \"lucide-react\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { exportToCSV } from \"@/lib/export\";\nimport type { Product } from \"@shared/schema\";\n\nexport function ProductList() {\n  const { activeCompany } = useAuth();\n  const { toast } = useToast();\n  const companyId = activeCompany?.id;\n\n  const [isFormOpen, setIsFormOpen] = useState(false);\n  const [isDetailOpen, setIsDetailOpen] = useState(false);\n  const [editingProduct, setEditingProduct] = useState<Product | null>(null);\n  const [selectedProduct, setSelectedProduct] = useState<Product | null>(null);\n\n  const [formData, setFormData] = useState({\n    sku: \"\",\n    name: \"\",\n    description: \"\",\n    category: \"\",\n    uom: \"EA\",\n    price: \"0\",\n    cost: \"0\",\n    minStockLevel: 0,\n    maxStockLevel: 0,\n    reorderPoint: 0,\n    isSellable: true,\n    isPurchasable: true,\n  });\n\n  const { data: products = [], isLoading } = useQuery<Product[]>({\n    queryKey: [\"/api/companies\", companyId, \"products\"],\n    enabled: !!companyId,\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const response = await apiRequest(\"POST\", `/api/companies/${companyId}/products`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", companyId, \"products\"] });\n      toast({ title: \"Product created successfully\" });\n      setIsFormOpen(false);\n    },\n    onError: () => {\n      toast({ title: \"Failed to create product\", variant: \"destructive\" });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<Product> }) => {\n      const response = await apiRequest(\"PATCH\", `/api/companies/${companyId}/products/${id}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", companyId, \"products\"] });\n      toast({ title: \"Product updated successfully\" });\n      setIsFormOpen(false);\n    },\n    onError: () => {\n      toast({ title: \"Failed to update product\", variant: \"destructive\" });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(\"DELETE\", `/api/companies/${companyId}/products/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", companyId, \"products\"] });\n      toast({ title: \"Product deleted successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to delete product\", variant: \"destructive\" });\n    },\n  });\n\n  const handleOpenForm = (product?: Product) => {\n    if (product) {\n      setEditingProduct(product);\n      setFormData({\n        sku: product.sku,\n        name: product.name,\n        description: product.description || \"\",\n        category: product.category || \"\",\n        uom: product.uom || \"EA\",\n        price: product.price || \"0\",\n        cost: product.cost || \"0\",\n        minStockLevel: product.minStockLevel || 0,\n        maxStockLevel: product.maxStockLevel || 0,\n        reorderPoint: product.reorderPoint || 0,\n        isSellable: product.isSellable ?? true,\n        isPurchasable: product.isPurchasable ?? true,\n      });\n    } else {\n      setEditingProduct(null);\n      setFormData({\n        sku: \"\",\n        name: \"\",\n        description: \"\",\n        category: \"\",\n        uom: \"EA\",\n        price: \"0\",\n        cost: \"0\",\n        minStockLevel: 0,\n        maxStockLevel: 0,\n        reorderPoint: 0,\n        isSellable: true,\n        isPurchasable: true,\n      });\n    }\n    setIsFormOpen(true);\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (editingProduct) {\n      updateMutation.mutate({ id: editingProduct.id, data: formData });\n    } else {\n      createMutation.mutate(formData);\n    }\n  };\n\n  const handleViewProduct = (product: Product) => {\n    setSelectedProduct(product);\n    setIsDetailOpen(true);\n  };\n\n  const handleDelete = (productId: string) => {\n    if (confirm(\"Are you sure you want to delete this product?\")) {\n      deleteMutation.mutate(productId);\n    }\n  };\n\n  const columns: Column<Product>[] = [\n    { key: \"sku\", header: \"SKU\", sortable: true },\n    { key: \"name\", header: \"Name\", sortable: true },\n    { key: \"category\", header: \"Category\", sortable: true },\n    { key: \"uom\", header: \"UOM\" },\n    { \n      key: \"price\", \n      header: \"Price\", \n      sortable: true,\n      className: \"text-right\",\n      render: (item) => `$${parseFloat(item.price || \"0\").toFixed(2)}`\n    },\n    { \n      key: \"cost\", \n      header: \"Cost\", \n      sortable: true,\n      className: \"text-right\",\n      render: (item) => `$${parseFloat(item.cost || \"0\").toFixed(2)}`\n    },\n    {\n      key: \"isActive\",\n      header: \"Status\",\n      render: (item) => (\n        <StatusBadge status={item.isActive ? \"active\" : \"inactive\"} />\n      ),\n    },\n    {\n      key: \"actions\",\n      header: \"\",\n      className: \"text-right\",\n      render: (item) => (\n        <div className=\"flex justify-end gap-1\" onClick={(e) => e.stopPropagation()}>\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => handleViewProduct(item)} data-testid={`button-view-${item.id}`}>\n            <Eye className=\"h-4 w-4\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => handleOpenForm(item)} data-testid={`button-edit-${item.id}`}>\n            <Edit className=\"h-4 w-4\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => handleDelete(item.id)} data-testid={`button-delete-${item.id}`}>\n            <Trash2 className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      ),\n    },\n  ];\n\n  const handleExport = () => {\n    if (products.length === 0) {\n      toast({ title: \"No data to export\", variant: \"destructive\" });\n      return;\n    }\n    exportToCSV(\n      products.map(p => ({\n        sku: p.sku,\n        name: p.name,\n        category: p.category || \"\",\n        uom: p.uom,\n        price: p.price,\n        cost: p.cost,\n        minStock: p.minStockLevel,\n        reorderPoint: p.reorderPoint,\n        status: p.isActive ? \"Active\" : \"Inactive\"\n      })),\n      [\n        { key: \"sku\", label: \"SKU\" },\n        { key: \"name\", label: \"Name\" },\n        { key: \"category\", label: \"Category\" },\n        { key: \"uom\", label: \"UOM\" },\n        { key: \"price\", label: \"Price (IDR)\" },\n        { key: \"cost\", label: \"Cost (IDR)\" },\n        { key: \"minStock\", label: \"Min Stock\" },\n        { key: \"reorderPoint\", label: \"Reorder Point\" },\n        { key: \"status\", label: \"Status\" }\n      ],\n      \"products\"\n    );\n    toast({ title: \"Products exported successfully\" });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <PageHeader\n        title=\"Products\"\n        description={`${products.length} product${products.length !== 1 ? \"s\" : \"\"}`}\n        actions={\n          <>\n            <Button variant=\"outline\" onClick={handleExport} data-testid=\"button-export\">\n              <Download className=\"h-4 w-4 mr-2\" />\n              Export\n            </Button>\n            <Button onClick={() => handleOpenForm()} data-testid=\"button-new-product\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Product\n            </Button>\n          </>\n        }\n      />\n\n      {products.length === 0 ? (\n        <div className=\"flex flex-col items-center justify-center py-16 text-center\">\n          <Package className=\"h-12 w-12 text-muted-foreground mb-4\" />\n          <h3 className=\"text-lg font-medium mb-2\">No products yet</h3>\n          <p className=\"text-muted-foreground mb-4\">Create your first product to start managing inventory.</p>\n          <Button onClick={() => handleOpenForm()} data-testid=\"button-create-first-product\">\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Create Product\n          </Button>\n        </div>\n      ) : (\n        <DataTable\n          data={products}\n          columns={columns}\n          searchKey=\"name\"\n          searchPlaceholder=\"Search products...\"\n          onRowClick={handleViewProduct}\n        />\n      )}\n\n      <Dialog open={isFormOpen} onOpenChange={setIsFormOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>{editingProduct ? \"Edit Product\" : \"New Product\"}</DialogTitle>\n          </DialogHeader>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"sku\">SKU</Label>\n                <Input\n                  id=\"sku\"\n                  value={formData.sku}\n                  onChange={(e) => setFormData({ ...formData, sku: e.target.value })}\n                  placeholder=\"PROD-001\"\n                  required\n                  data-testid=\"input-product-sku\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"category\">Category</Label>\n                <Select\n                  value={formData.category || \"__none__\"}\n                  onValueChange={(value) => setFormData({ ...formData, category: value === \"__none__\" ? \"\" : value })}\n                >\n                  <SelectTrigger data-testid=\"select-product-category\">\n                    <SelectValue placeholder=\"Select category\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"__none__\">No Category</SelectItem>\n                    <SelectItem value=\"Widgets\">Widgets</SelectItem>\n                    <SelectItem value=\"Components\">Components</SelectItem>\n                    <SelectItem value=\"Materials\">Materials</SelectItem>\n                    <SelectItem value=\"Assemblies\">Assemblies</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"name\">Product Name</Label>\n              <Input\n                id=\"name\"\n                value={formData.name}\n                onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                placeholder=\"Product name\"\n                required\n                data-testid=\"input-product-name\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"description\">Description</Label>\n              <Input\n                id=\"description\"\n                value={formData.description}\n                onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                placeholder=\"Optional description\"\n                data-testid=\"input-product-description\"\n              />\n            </div>\n            <div className=\"grid grid-cols-3 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"uom\">Unit of Measure</Label>\n                <Select\n                  value={formData.uom}\n                  onValueChange={(value) => setFormData({ ...formData, uom: value })}\n                >\n                  <SelectTrigger data-testid=\"select-product-uom\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"EA\">Each (EA)</SelectItem>\n                    <SelectItem value=\"BOX\">Box (BOX)</SelectItem>\n                    <SelectItem value=\"KG\">Kilogram (KG)</SelectItem>\n                    <SelectItem value=\"LB\">Pound (LB)</SelectItem>\n                    <SelectItem value=\"KIT\">Kit (KIT)</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"price\">Price</Label>\n                <Input\n                  id=\"price\"\n                  type=\"number\"\n                  step=\"0.01\"\n                  min=\"0\"\n                  value={formData.price}\n                  onChange={(e) => setFormData({ ...formData, price: e.target.value })}\n                  data-testid=\"input-product-price\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"cost\">Cost</Label>\n                <Input\n                  id=\"cost\"\n                  type=\"number\"\n                  step=\"0.01\"\n                  min=\"0\"\n                  value={formData.cost}\n                  onChange={(e) => setFormData({ ...formData, cost: e.target.value })}\n                  data-testid=\"input-product-cost\"\n                />\n              </div>\n            </div>\n            <div className=\"grid grid-cols-3 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"minStockLevel\">Min Stock</Label>\n                <Input\n                  id=\"minStockLevel\"\n                  type=\"number\"\n                  min=\"0\"\n                  value={formData.minStockLevel}\n                  onChange={(e) => setFormData({ ...formData, minStockLevel: parseInt(e.target.value) || 0 })}\n                  data-testid=\"input-product-min-stock\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"maxStockLevel\">Max Stock</Label>\n                <Input\n                  id=\"maxStockLevel\"\n                  type=\"number\"\n                  min=\"0\"\n                  value={formData.maxStockLevel}\n                  onChange={(e) => setFormData({ ...formData, maxStockLevel: parseInt(e.target.value) || 0 })}\n                  data-testid=\"input-product-max-stock\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"reorderPoint\">Reorder Point</Label>\n                <Input\n                  id=\"reorderPoint\"\n                  type=\"number\"\n                  min=\"0\"\n                  value={formData.reorderPoint}\n                  onChange={(e) => setFormData({ ...formData, reorderPoint: parseInt(e.target.value) || 0 })}\n                  data-testid=\"input-product-reorder-point\"\n                />\n              </div>\n            </div>\n            <div className=\"flex gap-4\">\n              <div className=\"flex items-center gap-2\">\n                <Checkbox\n                  id=\"isSellable\"\n                  checked={formData.isSellable}\n                  onCheckedChange={(checked) => setFormData({ ...formData, isSellable: checked as boolean })}\n                  data-testid=\"checkbox-is-sellable\"\n                />\n                <Label htmlFor=\"isSellable\" className=\"cursor-pointer\">Sellable</Label>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Checkbox\n                  id=\"isPurchasable\"\n                  checked={formData.isPurchasable}\n                  onCheckedChange={(checked) => setFormData({ ...formData, isPurchasable: checked as boolean })}\n                  data-testid=\"checkbox-is-purchasable\"\n                />\n                <Label htmlFor=\"isPurchasable\" className=\"cursor-pointer\">Purchasable</Label>\n              </div>\n            </div>\n            <div className=\"flex justify-end gap-2 pt-4\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => setIsFormOpen(false)} data-testid=\"button-cancel\">\n                Cancel\n              </Button>\n              <Button \n                type=\"submit\" \n                disabled={createMutation.isPending || updateMutation.isPending}\n                data-testid=\"button-save-product\"\n              >\n                {(createMutation.isPending || updateMutation.isPending) && (\n                  <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                )}\n                {editingProduct ? \"Update\" : \"Create\"}\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isDetailOpen} onOpenChange={setIsDetailOpen}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Product Details</DialogTitle>\n          </DialogHeader>\n          {selectedProduct && (\n            <div className=\"space-y-4\">\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-lg\">{selectedProduct.name}</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-2\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">SKU</span>\n                    <span className=\"font-medium\">{selectedProduct.sku}</span>\n                  </div>\n                  {selectedProduct.category && (\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Category</span>\n                      <span className=\"font-medium\">{selectedProduct.category}</span>\n                    </div>\n                  )}\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Unit</span>\n                    <span className=\"font-medium\">{selectedProduct.uom}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Price</span>\n                    <span className=\"font-medium\">${parseFloat(selectedProduct.price || \"0\").toFixed(2)}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Cost</span>\n                    <span className=\"font-medium\">${parseFloat(selectedProduct.cost || \"0\").toFixed(2)}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Status</span>\n                    <StatusBadge status={selectedProduct.isActive ? \"active\" : \"inactive\"} />\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":19162,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/components/examples/EmployeeList.tsx":{"content":"import { EmployeeList } from \"../hr/EmployeeList\";\n\nexport default function EmployeeListExample() {\n  return <EmployeeList />;\n}\n","path":null,"size_bytes":129,"size_tokens":null},"client/src/components/examples/AccountsReceivable.tsx":{"content":"import { AccountsReceivable } from \"../financials/AccountsReceivable\";\n\nexport default function AccountsReceivableExample() {\n  return <AccountsReceivable />;\n}\n","path":null,"size_bytes":161,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/examples/CustomerList.tsx":{"content":"import { CustomerList } from \"../sales/CustomerList\";\n\nexport default function CustomerListExample() {\n  return <CustomerList />;\n}\n","path":null,"size_bytes":132,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/components/examples/Settings.tsx":{"content":"import { ThemeProvider } from \"@/contexts/ThemeContext\";\nimport { Settings } from \"../system/Settings\";\n\nexport default function SettingsExample() {\n  return (\n    <ThemeProvider>\n      <Settings />\n    </ThemeProvider>\n  );\n}\n","path":null,"size_bytes":227,"size_tokens":null},"client/src/components/examples/DataTable.tsx":{"content":"import { DataTable, type Column } from \"../layout/DataTable\";\nimport { StatusBadge } from \"../layout/StatusBadge\";\nimport { mockSalesOrders } from \"@/lib/mockData\";\n\ntype SalesOrder = typeof mockSalesOrders[0];\n\nconst columns: Column<SalesOrder>[] = [\n  { key: \"id\", header: \"Order ID\", sortable: true },\n  { key: \"customerName\", header: \"Customer\", sortable: true },\n  { key: \"date\", header: \"Date\", sortable: true },\n  { \n    key: \"status\", \n    header: \"Status\",\n    render: (item) => <StatusBadge status={item.status as \"draft\" | \"confirmed\" | \"delivered\" | \"invoiced\"} />\n  },\n  { \n    key: \"total\", \n    header: \"Total\", \n    sortable: true,\n    className: \"text-right\",\n    render: (item) => `$${item.total.toLocaleString()}`\n  },\n];\n\nexport default function DataTableExample() {\n  return (\n    <DataTable\n      data={mockSalesOrders}\n      columns={columns}\n      searchKey=\"customerName\"\n      searchPlaceholder=\"Search orders...\"\n      selectable\n      onRowClick={(item) => console.log(\"Clicked:\", item.id)}\n    />\n  );\n}\n","path":null,"size_bytes":1033,"size_tokens":null},"client/src/components/warehouse/WarehouseList.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { DataTable, type Column } from \"@/components/layout/DataTable\";\nimport { StatusBadge } from \"@/components/layout/StatusBadge\";\nimport { PageHeader } from \"@/components/layout/PageHeader\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Plus, Download, Edit, Trash2, Warehouse, Loader2 } from \"lucide-react\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { exportToCSV } from \"@/lib/export\";\nimport type { Warehouse as WarehouseType } from \"@shared/schema\";\n\nexport function WarehouseList() {\n  const { activeCompany } = useAuth();\n  const { toast } = useToast();\n  const companyId = activeCompany?.id;\n\n  const [isFormOpen, setIsFormOpen] = useState(false);\n  const [editingWarehouse, setEditingWarehouse] = useState<WarehouseType | null>(null);\n\n  const [formData, setFormData] = useState({\n    code: \"\",\n    name: \"\",\n    warehouseType: \"standard\" as \"standard\" | \"transit\" | \"virtual\",\n    address: \"\",\n    city: \"\",\n    state: \"\",\n    country: \"\",\n    allowNegativeStock: false,\n  });\n\n  const { data: warehouses = [], isLoading } = useQuery<WarehouseType[]>({\n    queryKey: [\"/api/companies\", companyId, \"warehouses\"],\n    enabled: !!companyId,\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const response = await apiRequest(\"POST\", `/api/companies/${companyId}/warehouses`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", companyId, \"warehouses\"] });\n      toast({ title: \"Warehouse created successfully\" });\n      setIsFormOpen(false);\n    },\n    onError: () => {\n      toast({ title: \"Failed to create warehouse\", variant: \"destructive\" });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<WarehouseType> }) => {\n      const response = await apiRequest(\"PATCH\", `/api/companies/${companyId}/warehouses/${id}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", companyId, \"warehouses\"] });\n      toast({ title: \"Warehouse updated successfully\" });\n      setIsFormOpen(false);\n    },\n    onError: () => {\n      toast({ title: \"Failed to update warehouse\", variant: \"destructive\" });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(\"DELETE\", `/api/companies/${companyId}/warehouses/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", companyId, \"warehouses\"] });\n      toast({ title: \"Warehouse deleted successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to delete warehouse\", variant: \"destructive\" });\n    },\n  });\n\n  const handleOpenForm = (warehouse?: WarehouseType) => {\n    if (warehouse) {\n      setEditingWarehouse(warehouse);\n      setFormData({\n        code: warehouse.code,\n        name: warehouse.name,\n        warehouseType: (warehouse.warehouseType as \"standard\" | \"transit\" | \"virtual\") || \"standard\",\n        address: warehouse.address || \"\",\n        city: warehouse.city || \"\",\n        state: warehouse.state || \"\",\n        country: warehouse.country || \"\",\n        allowNegativeStock: warehouse.allowNegativeStock || false,\n      });\n    } else {\n      setEditingWarehouse(null);\n      setFormData({\n        code: \"\",\n        name: \"\",\n        warehouseType: \"standard\",\n        address: \"\",\n        city: \"\",\n        state: \"\",\n        country: \"\",\n        allowNegativeStock: false,\n      });\n    }\n    setIsFormOpen(true);\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (editingWarehouse) {\n      updateMutation.mutate({ id: editingWarehouse.id, data: formData });\n    } else {\n      createMutation.mutate(formData);\n    }\n  };\n\n  const handleDelete = (warehouseId: string) => {\n    if (confirm(\"Are you sure you want to delete this warehouse?\")) {\n      deleteMutation.mutate(warehouseId);\n    }\n  };\n\n  const columns: Column<WarehouseType>[] = [\n    { key: \"code\", header: \"Code\", sortable: true },\n    { key: \"name\", header: \"Name\", sortable: true },\n    { \n      key: \"warehouseType\", \n      header: \"Type\", \n      sortable: true,\n      render: (item) => (\n        <StatusBadge \n          status={(item.warehouseType || \"standard\") as \"standard\" | \"transit\" | \"virtual\"} \n        />\n      ),\n    },\n    { key: \"city\", header: \"City\", sortable: true },\n    { key: \"state\", header: \"State\" },\n    { key: \"country\", header: \"Country\" },\n    {\n      key: \"isActive\",\n      header: \"Status\",\n      render: (item) => (\n        <StatusBadge status={item.isActive ? \"active\" : \"inactive\"} />\n      ),\n    },\n    {\n      key: \"actions\",\n      header: \"\",\n      className: \"text-right\",\n      render: (item) => (\n        <div className=\"flex justify-end gap-1\" onClick={(e) => e.stopPropagation()}>\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => handleOpenForm(item)} data-testid={`button-edit-${item.id}`}>\n            <Edit className=\"h-4 w-4\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => handleDelete(item.id)} data-testid={`button-delete-${item.id}`}>\n            <Trash2 className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      ),\n    },\n  ];\n\n  const handleExport = () => {\n    if (warehouses.length === 0) {\n      toast({ title: \"No data to export\", variant: \"destructive\" });\n      return;\n    }\n    exportToCSV(\n      warehouses.map(w => ({\n        code: w.code,\n        name: w.name,\n        type: w.warehouseType,\n        city: w.city || \"\",\n        state: w.state || \"\",\n        country: w.country || \"\",\n        status: w.isActive ? \"Active\" : \"Inactive\"\n      })),\n      [\n        { key: \"code\", label: \"Code\" },\n        { key: \"name\", label: \"Name\" },\n        { key: \"type\", label: \"Type\" },\n        { key: \"city\", label: \"City\" },\n        { key: \"state\", label: \"State\" },\n        { key: \"country\", label: \"Country\" },\n        { key: \"status\", label: \"Status\" }\n      ],\n      \"warehouses\"\n    );\n    toast({ title: \"Warehouses exported successfully\" });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <PageHeader\n        title=\"Warehouses\"\n        description={`${warehouses.length} warehouse${warehouses.length !== 1 ? \"s\" : \"\"}`}\n        actions={\n          <>\n            <Button variant=\"outline\" onClick={handleExport} data-testid=\"button-export\">\n              <Download className=\"h-4 w-4 mr-2\" />\n              Export\n            </Button>\n            <Button onClick={() => handleOpenForm()} data-testid=\"button-new-warehouse\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Warehouse\n            </Button>\n          </>\n        }\n      />\n\n      {warehouses.length === 0 ? (\n        <div className=\"flex flex-col items-center justify-center py-16 text-center\">\n          <Warehouse className=\"h-12 w-12 text-muted-foreground mb-4\" />\n          <h3 className=\"text-lg font-medium mb-2\">No warehouses yet</h3>\n          <p className=\"text-muted-foreground mb-4\">Create your first warehouse to start managing inventory.</p>\n          <Button onClick={() => handleOpenForm()} data-testid=\"button-create-first-warehouse\">\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Create Warehouse\n          </Button>\n        </div>\n      ) : (\n        <DataTable\n          data={warehouses}\n          columns={columns}\n          searchKey=\"name\"\n          searchPlaceholder=\"Search warehouses...\"\n        />\n      )}\n\n      <Dialog open={isFormOpen} onOpenChange={setIsFormOpen}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>{editingWarehouse ? \"Edit Warehouse\" : \"New Warehouse\"}</DialogTitle>\n          </DialogHeader>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"code\">Code</Label>\n                <Input\n                  id=\"code\"\n                  value={formData.code}\n                  onChange={(e) => setFormData({ ...formData, code: e.target.value })}\n                  placeholder=\"WH-001\"\n                  required\n                  data-testid=\"input-warehouse-code\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"warehouseType\">Type</Label>\n                <Select\n                  value={formData.warehouseType}\n                  onValueChange={(value) => setFormData({ ...formData, warehouseType: value as \"standard\" | \"transit\" | \"virtual\" })}\n                >\n                  <SelectTrigger data-testid=\"select-warehouse-type\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"standard\">Standard</SelectItem>\n                    <SelectItem value=\"transit\">Transit</SelectItem>\n                    <SelectItem value=\"virtual\">Virtual</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"name\">Name</Label>\n              <Input\n                id=\"name\"\n                value={formData.name}\n                onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                placeholder=\"Main Warehouse\"\n                required\n                data-testid=\"input-warehouse-name\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"address\">Address</Label>\n              <Input\n                id=\"address\"\n                value={formData.address}\n                onChange={(e) => setFormData({ ...formData, address: e.target.value })}\n                placeholder=\"123 Main Street\"\n                data-testid=\"input-warehouse-address\"\n              />\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"city\">City</Label>\n                <Input\n                  id=\"city\"\n                  value={formData.city}\n                  onChange={(e) => setFormData({ ...formData, city: e.target.value })}\n                  placeholder=\"New York\"\n                  data-testid=\"input-warehouse-city\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"state\">State</Label>\n                <Input\n                  id=\"state\"\n                  value={formData.state}\n                  onChange={(e) => setFormData({ ...formData, state: e.target.value })}\n                  placeholder=\"NY\"\n                  data-testid=\"input-warehouse-state\"\n                />\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"country\">Country</Label>\n              <Input\n                id=\"country\"\n                value={formData.country}\n                onChange={(e) => setFormData({ ...formData, country: e.target.value })}\n                placeholder=\"US\"\n                maxLength={2}\n                data-testid=\"input-warehouse-country\"\n              />\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Checkbox\n                id=\"allowNegativeStock\"\n                checked={formData.allowNegativeStock}\n                onCheckedChange={(checked) => setFormData({ ...formData, allowNegativeStock: checked as boolean })}\n                data-testid=\"checkbox-allow-negative-stock\"\n              />\n              <Label htmlFor=\"allowNegativeStock\" className=\"cursor-pointer\">Allow negative stock</Label>\n            </div>\n            <div className=\"flex justify-end gap-2 pt-4\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => setIsFormOpen(false)} data-testid=\"button-cancel\">\n                Cancel\n              </Button>\n              <Button \n                type=\"submit\" \n                disabled={createMutation.isPending || updateMutation.isPending}\n                data-testid=\"button-save-warehouse\"\n              >\n                {(createMutation.isPending || updateMutation.isPending) && (\n                  <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                )}\n                {editingWarehouse ? \"Update\" : \"Create\"}\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":13298,"size_tokens":null},"client/src/components/warehouse/VendorList.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { DataTable, type Column } from \"@/components/layout/DataTable\";\nimport { StatusBadge } from \"@/components/layout/StatusBadge\";\nimport { PageHeader } from \"@/components/layout/PageHeader\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Plus, Download, Eye, Edit, Trash2, Building2, Loader2 } from \"lucide-react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { exportToCSV } from \"@/lib/export\";\nimport type { Vendor } from \"@shared/schema\";\n\nexport function VendorList() {\n  const { activeCompany } = useAuth();\n  const { toast } = useToast();\n  const companyId = activeCompany?.id;\n\n  const [isFormOpen, setIsFormOpen] = useState(false);\n  const [isDetailOpen, setIsDetailOpen] = useState(false);\n  const [editingVendor, setEditingVendor] = useState<Vendor | null>(null);\n  const [selectedVendor, setSelectedVendor] = useState<Vendor | null>(null);\n\n  const [formData, setFormData] = useState({\n    code: \"\",\n    name: \"\",\n    legalName: \"\",\n    email: \"\",\n    phone: \"\",\n    taxId: \"\",\n    address: \"\",\n    city: \"\",\n    state: \"\",\n    country: \"\",\n    postalCode: \"\",\n    paymentTerms: 30,\n    vendorType: \"regular\",\n  });\n\n  const { data: vendors = [], isLoading } = useQuery<Vendor[]>({\n    queryKey: [\"/api/companies\", companyId, \"vendors\"],\n    enabled: !!companyId,\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const response = await apiRequest(\"POST\", `/api/companies/${companyId}/vendors`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", companyId, \"vendors\"] });\n      toast({ title: \"Vendor created successfully\" });\n      setIsFormOpen(false);\n    },\n    onError: () => {\n      toast({ title: \"Failed to create vendor\", variant: \"destructive\" });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<Vendor> }) => {\n      const response = await apiRequest(\"PATCH\", `/api/companies/${companyId}/vendors/${id}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", companyId, \"vendors\"] });\n      toast({ title: \"Vendor updated successfully\" });\n      setIsFormOpen(false);\n    },\n    onError: () => {\n      toast({ title: \"Failed to update vendor\", variant: \"destructive\" });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(\"DELETE\", `/api/companies/${companyId}/vendors/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/companies\", companyId, \"vendors\"] });\n      toast({ title: \"Vendor deleted successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to delete vendor\", variant: \"destructive\" });\n    },\n  });\n\n  const handleOpenForm = (vendor?: Vendor) => {\n    if (vendor) {\n      setEditingVendor(vendor);\n      setFormData({\n        code: vendor.code,\n        name: vendor.name,\n        legalName: vendor.legalName || \"\",\n        email: vendor.email || \"\",\n        phone: vendor.phone || \"\",\n        taxId: vendor.taxId || \"\",\n        address: vendor.address || \"\",\n        city: vendor.city || \"\",\n        state: vendor.state || \"\",\n        country: vendor.country || \"\",\n        postalCode: vendor.postalCode || \"\",\n        paymentTerms: vendor.paymentTerms || 30,\n        vendorType: vendor.vendorType || \"regular\",\n      });\n    } else {\n      setEditingVendor(null);\n      setFormData({\n        code: \"\",\n        name: \"\",\n        legalName: \"\",\n        email: \"\",\n        phone: \"\",\n        taxId: \"\",\n        address: \"\",\n        city: \"\",\n        state: \"\",\n        country: \"\",\n        postalCode: \"\",\n        paymentTerms: 30,\n        vendorType: \"regular\",\n      });\n    }\n    setIsFormOpen(true);\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (editingVendor) {\n      updateMutation.mutate({ id: editingVendor.id, data: formData });\n    } else {\n      createMutation.mutate(formData);\n    }\n  };\n\n  const handleViewVendor = (vendor: Vendor) => {\n    setSelectedVendor(vendor);\n    setIsDetailOpen(true);\n  };\n\n  const handleDelete = (vendorId: string) => {\n    if (confirm(\"Are you sure you want to delete this vendor?\")) {\n      deleteMutation.mutate(vendorId);\n    }\n  };\n\n  const columns: Column<Vendor>[] = [\n    { key: \"code\", header: \"Code\", sortable: true },\n    { key: \"name\", header: \"Name\", sortable: true },\n    { key: \"email\", header: \"Email\", sortable: true },\n    { key: \"phone\", header: \"Phone\" },\n    { key: \"city\", header: \"City\" },\n    { key: \"country\", header: \"Country\" },\n    {\n      key: \"vendorType\",\n      header: \"Type\",\n      render: (item) => (\n        <span className=\"capitalize\">{item.vendorType || \"regular\"}</span>\n      ),\n    },\n    {\n      key: \"isActive\",\n      header: \"Status\",\n      render: (item) => (\n        <StatusBadge status={item.isActive ? \"active\" : \"inactive\"} />\n      ),\n    },\n    {\n      key: \"actions\",\n      header: \"\",\n      className: \"text-right\",\n      render: (item) => (\n        <div className=\"flex justify-end gap-1\" onClick={(e) => e.stopPropagation()}>\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => handleViewVendor(item)} data-testid={`button-view-${item.id}`}>\n            <Eye className=\"h-4 w-4\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => handleOpenForm(item)} data-testid={`button-edit-${item.id}`}>\n            <Edit className=\"h-4 w-4\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => handleDelete(item.id)} data-testid={`button-delete-${item.id}`}>\n            <Trash2 className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      ),\n    },\n  ];\n\n  const handleExport = () => {\n    if (vendors.length === 0) {\n      toast({ title: \"No data to export\", variant: \"destructive\" });\n      return;\n    }\n    exportToCSV(\n      vendors.map(v => ({\n        code: v.code,\n        name: v.name,\n        email: v.email || \"\",\n        phone: v.phone || \"\",\n        city: v.city || \"\",\n        country: v.country || \"\",\n        type: v.vendorType,\n        paymentTerms: v.paymentTerms,\n        status: v.isActive ? \"Active\" : \"Inactive\"\n      })),\n      [\n        { key: \"code\", label: \"Code\" },\n        { key: \"name\", label: \"Name\" },\n        { key: \"email\", label: \"Email\" },\n        { key: \"phone\", label: \"Phone\" },\n        { key: \"city\", label: \"City\" },\n        { key: \"country\", label: \"Country\" },\n        { key: \"type\", label: \"Type\" },\n        { key: \"paymentTerms\", label: \"Payment Terms\" },\n        { key: \"status\", label: \"Status\" }\n      ],\n      \"vendors\"\n    );\n    toast({ title: \"Vendors exported successfully\" });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <PageHeader\n        title=\"Vendors\"\n        description={`${vendors.length} vendor${vendors.length !== 1 ? \"s\" : \"\"}`}\n        actions={\n          <>\n            <Button variant=\"outline\" onClick={handleExport} data-testid=\"button-export\">\n              <Download className=\"h-4 w-4 mr-2\" />\n              Export\n            </Button>\n            <Button onClick={() => handleOpenForm()} data-testid=\"button-new-vendor\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Vendor\n            </Button>\n          </>\n        }\n      />\n\n      {vendors.length === 0 ? (\n        <div className=\"flex flex-col items-center justify-center py-16 text-center\">\n          <Building2 className=\"h-12 w-12 text-muted-foreground mb-4\" />\n          <h3 className=\"text-lg font-medium mb-2\">No vendors yet</h3>\n          <p className=\"text-muted-foreground mb-4\">Create your first vendor to start managing suppliers.</p>\n          <Button onClick={() => handleOpenForm()} data-testid=\"button-create-first-vendor\">\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Create Vendor\n          </Button>\n        </div>\n      ) : (\n        <DataTable\n          data={vendors}\n          columns={columns}\n          searchKey=\"name\"\n          searchPlaceholder=\"Search vendors...\"\n          onRowClick={handleViewVendor}\n        />\n      )}\n\n      <Dialog open={isFormOpen} onOpenChange={setIsFormOpen}>\n        <DialogContent className=\"max-w-lg max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>{editingVendor ? \"Edit Vendor\" : \"New Vendor\"}</DialogTitle>\n          </DialogHeader>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"code\">Vendor Code</Label>\n                <Input\n                  id=\"code\"\n                  value={formData.code}\n                  onChange={(e) => setFormData({ ...formData, code: e.target.value })}\n                  placeholder=\"VEND-001\"\n                  required\n                  data-testid=\"input-vendor-code\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"vendorType\">Type</Label>\n                <Select\n                  value={formData.vendorType}\n                  onValueChange={(value) => setFormData({ ...formData, vendorType: value })}\n                >\n                  <SelectTrigger data-testid=\"select-vendor-type\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"regular\">Regular</SelectItem>\n                    <SelectItem value=\"manufacturer\">Manufacturer</SelectItem>\n                    <SelectItem value=\"distributor\">Distributor</SelectItem>\n                    <SelectItem value=\"service\">Service Provider</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"name\">Vendor Name</Label>\n              <Input\n                id=\"name\"\n                value={formData.name}\n                onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                placeholder=\"Vendor name\"\n                required\n                data-testid=\"input-vendor-name\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"legalName\">Legal Name</Label>\n              <Input\n                id=\"legalName\"\n                value={formData.legalName}\n                onChange={(e) => setFormData({ ...formData, legalName: e.target.value })}\n                placeholder=\"Legal entity name (optional)\"\n                data-testid=\"input-vendor-legal-name\"\n              />\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"email\">Email</Label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  value={formData.email}\n                  onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n                  placeholder=\"email@example.com\"\n                  data-testid=\"input-vendor-email\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"phone\">Phone</Label>\n                <Input\n                  id=\"phone\"\n                  value={formData.phone}\n                  onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\n                  placeholder=\"+1 (555) 000-0000\"\n                  data-testid=\"input-vendor-phone\"\n                />\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"taxId\">Tax ID</Label>\n              <Input\n                id=\"taxId\"\n                value={formData.taxId}\n                onChange={(e) => setFormData({ ...formData, taxId: e.target.value })}\n                placeholder=\"Tax identification number\"\n                data-testid=\"input-vendor-tax-id\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"address\">Address</Label>\n              <Textarea\n                id=\"address\"\n                value={formData.address}\n                onChange={(e) => setFormData({ ...formData, address: e.target.value })}\n                placeholder=\"Street address\"\n                rows={2}\n                data-testid=\"input-vendor-address\"\n              />\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"city\">City</Label>\n                <Input\n                  id=\"city\"\n                  value={formData.city}\n                  onChange={(e) => setFormData({ ...formData, city: e.target.value })}\n                  placeholder=\"City\"\n                  data-testid=\"input-vendor-city\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"state\">State/Province</Label>\n                <Input\n                  id=\"state\"\n                  value={formData.state}\n                  onChange={(e) => setFormData({ ...formData, state: e.target.value })}\n                  placeholder=\"State\"\n                  data-testid=\"input-vendor-state\"\n                />\n              </div>\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"country\">Country</Label>\n                <Input\n                  id=\"country\"\n                  value={formData.country}\n                  onChange={(e) => setFormData({ ...formData, country: e.target.value })}\n                  placeholder=\"US\"\n                  maxLength={2}\n                  data-testid=\"input-vendor-country\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"postalCode\">Postal Code</Label>\n                <Input\n                  id=\"postalCode\"\n                  value={formData.postalCode}\n                  onChange={(e) => setFormData({ ...formData, postalCode: e.target.value })}\n                  placeholder=\"12345\"\n                  data-testid=\"input-vendor-postal-code\"\n                />\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"paymentTerms\">Payment Terms (days)</Label>\n              <Input\n                id=\"paymentTerms\"\n                type=\"number\"\n                min=\"0\"\n                value={formData.paymentTerms}\n                onChange={(e) => setFormData({ ...formData, paymentTerms: parseInt(e.target.value) || 0 })}\n                data-testid=\"input-vendor-payment-terms\"\n              />\n            </div>\n            <div className=\"flex justify-end gap-2 pt-4\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => setIsFormOpen(false)} data-testid=\"button-cancel\">\n                Cancel\n              </Button>\n              <Button \n                type=\"submit\" \n                disabled={createMutation.isPending || updateMutation.isPending}\n                data-testid=\"button-save-vendor\"\n              >\n                {(createMutation.isPending || updateMutation.isPending) && (\n                  <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                )}\n                {editingVendor ? \"Update\" : \"Create\"}\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isDetailOpen} onOpenChange={setIsDetailOpen}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Vendor Details</DialogTitle>\n          </DialogHeader>\n          {selectedVendor && (\n            <div className=\"space-y-4\">\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-lg\">{selectedVendor.name}</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-2\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Code</span>\n                    <span className=\"font-medium\">{selectedVendor.code}</span>\n                  </div>\n                  {selectedVendor.legalName && (\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Legal Name</span>\n                      <span className=\"font-medium\">{selectedVendor.legalName}</span>\n                    </div>\n                  )}\n                  {selectedVendor.email && (\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Email</span>\n                      <span className=\"font-medium\">{selectedVendor.email}</span>\n                    </div>\n                  )}\n                  {selectedVendor.phone && (\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Phone</span>\n                      <span className=\"font-medium\">{selectedVendor.phone}</span>\n                    </div>\n                  )}\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Type</span>\n                    <span className=\"font-medium capitalize\">{selectedVendor.vendorType || \"regular\"}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Payment Terms</span>\n                    <span className=\"font-medium\">{selectedVendor.paymentTerms || 30} days</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Status</span>\n                    <StatusBadge status={selectedVendor.isActive ? \"active\" : \"inactive\"} />\n                  </div>\n                </CardContent>\n              </Card>\n              {(selectedVendor.address || selectedVendor.city) && (\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm\">Address</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"text-sm text-muted-foreground\">\n                    {selectedVendor.address && <div>{selectedVendor.address}</div>}\n                    <div>\n                      {[selectedVendor.city, selectedVendor.state, selectedVendor.postalCode]\n                        .filter(Boolean)\n                        .join(\", \")}\n                    </div>\n                    {selectedVendor.country && <div>{selectedVendor.country}</div>}\n                  </CardContent>\n                </Card>\n              )}\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":19777,"size_tokens":null},"server/database-storage.ts":{"content":"import { eq, and, desc, sql, inArray, like, isNull, gt, lt } from \"drizzle-orm\";\nimport { db } from \"./db\";\nimport { \n  companies, users, companySettings, companyFiscalPeriods, roles, userCompanyRoles,\n  chartOfAccounts, warehouses, products, customers, vendors, taxes, employees,\n  journalEntries, salesOrders, salesOrderLines, purchaseOrders, purchaseOrderLines,\n  intercompanyTransfers, sharedAccess, refreshTokens, authAuditLog,\n  stockLevels, stockMovements, deliveries, goodsReceipts, invoices, payments, arApLedger,\n  type User, type InsertUser,\n  type Company, type InsertCompany,\n  type CompanySettings, type InsertCompanySettings,\n  type FiscalPeriod, type InsertFiscalPeriod,\n  type Role, type InsertRole,\n  type UserCompanyRole, type InsertUserCompanyRole,\n  type Account, type InsertAccount,\n  type Warehouse, type InsertWarehouse,\n  type Product, type InsertProduct,\n  type Customer, type InsertCustomer,\n  type Vendor, type InsertVendor,\n  type Tax, type InsertTax,\n  type Employee, type InsertEmployee,\n  type SalesOrder, type InsertSalesOrder,\n  type SalesOrderLine,\n  type PurchaseOrder, type InsertPurchaseOrder,\n  type PurchaseOrderLine,\n  type IntercompanyTransfer, type InsertIntercompanyTransfer,\n  type JournalEntry, type InsertJournalEntry,\n  type SharedAccess, type InsertSharedAccess,\n  type RefreshToken, type InsertRefreshToken,\n  type AuthAuditLog, type InsertAuthAuditLog,\n  type CompanyContext, type CompanyHierarchyNode,\n  type StockLevel, type StockMovement,\n  type Delivery, type GoodsReceipt,\n  type Invoice, type Payment, type ArApLedger\n} from \"@shared/schema\";\nimport type { IStorage } from \"./storage\";\nimport bcrypt from \"bcryptjs\";\nimport { randomUUID } from \"crypto\";\n\nexport class DatabaseStorage implements IStorage {\n  \n  private initialized = false;\n  \n  private async ensureSystemRoles(): Promise<void> {\n    if (this.initialized) return;\n    \n    const systemRolesData = [\n      {\n        id: \"role-admin\",\n        code: \"ADMIN\",\n        name: \"Administrator\",\n        description: \"Full system access\",\n        isSystemRole: true,\n        permissions: [\"*\"],\n        createdAt: new Date(),\n      },\n      {\n        id: \"role-manager\",\n        code: \"MANAGER\",\n        name: \"Manager\",\n        description: \"Department manager access\",\n        isSystemRole: true,\n        permissions: [\"read:*\", \"write:*\", \"delete:own\"],\n        createdAt: new Date(),\n      },\n      {\n        id: \"role-user\",\n        code: \"USER\",\n        name: \"User\",\n        description: \"Standard user access\",\n        isSystemRole: true,\n        permissions: [\"read:*\", \"write:own\"],\n        createdAt: new Date(),\n      },\n    ];\n    \n    for (const roleData of systemRolesData) {\n      const existing = await db.select().from(roles).where(eq(roles.code, roleData.code)).limit(1);\n      if (existing.length === 0) {\n        await db.insert(roles).values(roleData);\n      }\n    }\n    \n    this.initialized = true;\n  }\n  \n  // ===================== USERS =====================\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user || undefined;\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.username, username));\n    return user || undefined;\n  }\n\n  async createUser(insertUser: InsertUser & { defaultCompanyId?: string }): Promise<User> {\n    const id = randomUUID();\n    const hashedPassword = bcrypt.hashSync(insertUser.password, 10);\n    const [user] = await db.insert(users).values({\n      id,\n      username: insertUser.username,\n      password: hashedPassword,\n      email: insertUser.email ?? null,\n      fullName: insertUser.fullName ?? null,\n      avatarUrl: null,\n      defaultCompanyId: insertUser.defaultCompanyId ?? null,\n      isActive: true,\n      lastLoginAt: null,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    }).returning();\n    return user;\n  }\n\n  async updateUser(id: string, updates: Partial<User>): Promise<User | undefined> {\n    const [user] = await db.update(users)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(users.id, id))\n      .returning();\n    return user || undefined;\n  }\n\n  // ===================== COMPANIES =====================\n  async getCompany(id: string): Promise<Company | undefined> {\n    const [company] = await db.select().from(companies).where(eq(companies.id, id));\n    return company || undefined;\n  }\n\n  async getCompanyByCode(code: string): Promise<Company | undefined> {\n    const [company] = await db.select().from(companies).where(eq(companies.code, code));\n    return company || undefined;\n  }\n\n  async getCompanies(): Promise<Company[]> {\n    return db.select().from(companies).orderBy(companies.path);\n  }\n\n  async getAllCompanies(): Promise<Company[]> {\n    return this.getCompanies();\n  }\n\n  async getChildCompanies(parentId: string): Promise<Company[]> {\n    return db.select().from(companies).where(eq(companies.parentId, parentId));\n  }\n\n  async getCompanyHierarchy(rootId?: string): Promise<CompanyHierarchyNode[]> {\n    const allCompanies = await this.getCompanies();\n    \n    const buildHierarchy = (parentId: string | null, level: number): CompanyHierarchyNode[] => {\n      return allCompanies\n        .filter(c => c.parentId === parentId)\n        .map(company => ({\n          company,\n          children: buildHierarchy(company.id, level + 1),\n          level,\n        }));\n    };\n\n    if (rootId) {\n      const rootCompany = allCompanies.find(c => c.id === rootId);\n      if (!rootCompany) return [];\n      return [{\n        company: rootCompany,\n        children: buildHierarchy(rootId, rootCompany.level + 1),\n        level: rootCompany.level,\n      }];\n    }\n\n    return buildHierarchy(null, 1);\n  }\n\n  async createCompany(company: InsertCompany): Promise<Company> {\n    const id = randomUUID();\n    \n    let level = 1;\n    let path = company.code;\n    \n    if (company.parentId) {\n      const parentCompany = await this.getCompany(company.parentId);\n      if (parentCompany) {\n        level = parentCompany.level + 1;\n        path = `${parentCompany.path}/${company.code}`;\n      }\n    }\n    \n    const [created] = await db.insert(companies).values({\n      id,\n      code: company.code,\n      name: company.name,\n      legalName: company.legalName,\n      taxId: company.taxId,\n      parentId: company.parentId,\n      path,\n      level,\n      companyType: company.companyType,\n      currency: company.currency ?? \"IDR\",\n      locale: company.locale ?? \"id-ID\",\n      timezone: company.timezone ?? \"Asia/Jakarta\",\n      address: company.address,\n      city: company.city,\n      state: company.state,\n      country: company.country,\n      postalCode: company.postalCode,\n      phone: company.phone,\n      email: company.email,\n      website: company.website,\n      logoUrl: company.logoUrl,\n      consolidationEnabled: company.consolidationEnabled ?? false,\n      isActive: company.isActive ?? true,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    }).returning();\n    return created;\n  }\n\n  async updateCompany(id: string, updates: Partial<Company>): Promise<Company | undefined> {\n    const { path, level, ...safeUpdates } = updates;\n    const [updated] = await db.update(companies)\n      .set({ ...safeUpdates, updatedAt: new Date() })\n      .where(eq(companies.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  // ===================== COMPANY SETTINGS =====================\n  async getCompanySettings(companyId: string): Promise<CompanySettings | undefined> {\n    const [settings] = await db.select().from(companySettings)\n      .where(eq(companySettings.companyId, companyId));\n    return settings || undefined;\n  }\n\n  async createCompanySettings(settings: InsertCompanySettings): Promise<CompanySettings> {\n    const id = randomUUID();\n    const [created] = await db.insert(companySettings).values({\n      id,\n      ...settings,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    }).returning();\n    return created;\n  }\n\n  async updateCompanySettings(companyId: string, updates: Partial<CompanySettings>): Promise<CompanySettings | undefined> {\n    const [updated] = await db.update(companySettings)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(companySettings.companyId, companyId))\n      .returning();\n    return updated || undefined;\n  }\n\n  // ===================== FISCAL PERIODS =====================\n  async getFiscalPeriods(companyId: string): Promise<FiscalPeriod[]> {\n    return db.select().from(companyFiscalPeriods)\n      .where(eq(companyFiscalPeriods.companyId, companyId))\n      .orderBy(desc(companyFiscalPeriods.startDate));\n  }\n\n  async getFiscalPeriod(id: string): Promise<FiscalPeriod | undefined> {\n    const [period] = await db.select().from(companyFiscalPeriods)\n      .where(eq(companyFiscalPeriods.id, id));\n    return period || undefined;\n  }\n\n  async getCurrentFiscalPeriod(companyId: string): Promise<FiscalPeriod | undefined> {\n    const now = new Date();\n    const [period] = await db.select().from(companyFiscalPeriods)\n      .where(and(\n        eq(companyFiscalPeriods.companyId, companyId),\n        lt(companyFiscalPeriods.startDate, now),\n        gt(companyFiscalPeriods.endDate, now),\n        eq(companyFiscalPeriods.isClosed, false)\n      ));\n    return period || undefined;\n  }\n\n  async createFiscalPeriod(period: InsertFiscalPeriod): Promise<FiscalPeriod> {\n    const id = randomUUID();\n    const [created] = await db.insert(companyFiscalPeriods).values({\n      id,\n      ...period,\n      createdAt: new Date(),\n    }).returning();\n    return created;\n  }\n\n  async closeFiscalPeriod(id: string, closedBy: string): Promise<FiscalPeriod | undefined> {\n    const [updated] = await db.update(companyFiscalPeriods)\n      .set({ isClosed: true, closedAt: new Date(), closedBy, status: \"closed\" })\n      .where(eq(companyFiscalPeriods.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  // ===================== ROLES =====================\n  async getRole(id: string): Promise<Role | undefined> {\n    const [role] = await db.select().from(roles).where(eq(roles.id, id));\n    return role || undefined;\n  }\n\n  async getRoleByCode(code: string): Promise<Role | undefined> {\n    await this.ensureSystemRoles();\n    const [role] = await db.select().from(roles).where(eq(roles.code, code));\n    return role || undefined;\n  }\n\n  async getRoles(): Promise<Role[]> {\n    return db.select().from(roles);\n  }\n\n  async createRole(role: InsertRole): Promise<Role> {\n    const id = randomUUID();\n    const [created] = await db.insert(roles).values({\n      id,\n      ...role,\n      createdAt: new Date(),\n    }).returning();\n    return created;\n  }\n\n  // ===================== USER COMPANY ROLES =====================\n  async getUserCompanyRoles(userId: string): Promise<UserCompanyRole[]> {\n    return db.select().from(userCompanyRoles)\n      .where(and(eq(userCompanyRoles.userId, userId), eq(userCompanyRoles.isActive, true)));\n  }\n\n  async getUserCompanies(userId: string): Promise<Company[]> {\n    const assignments = await this.getUserCompanyRoles(userId);\n    if (assignments.length === 0) return [];\n    \n    const companyIds = assignments.map(a => a.companyId);\n    return db.select().from(companies).where(inArray(companies.id, companyIds));\n  }\n\n  async getUserRole(userId: string, companyId: string): Promise<Role | undefined> {\n    const [assignment] = await db.select().from(userCompanyRoles)\n      .where(and(\n        eq(userCompanyRoles.userId, userId),\n        eq(userCompanyRoles.companyId, companyId),\n        eq(userCompanyRoles.isActive, true)\n      ));\n    if (!assignment) return undefined;\n    return this.getRole(assignment.roleId);\n  }\n\n  async getUserCompanyRole(userId: string, companyId: string): Promise<UserCompanyRole | undefined> {\n    const [assignment] = await db.select().from(userCompanyRoles)\n      .where(and(\n        eq(userCompanyRoles.userId, userId),\n        eq(userCompanyRoles.companyId, companyId),\n        eq(userCompanyRoles.isActive, true)\n      ));\n    return assignment || undefined;\n  }\n\n  async assignUserToCompany(assignment: InsertUserCompanyRole): Promise<UserCompanyRole> {\n    const id = randomUUID();\n    const [created] = await db.insert(userCompanyRoles).values({\n      id,\n      ...assignment,\n      grantedAt: new Date(),\n      isActive: true,\n    }).returning();\n    return created;\n  }\n\n  async removeUserFromCompany(userId: string, companyId: string): Promise<void> {\n    await db.update(userCompanyRoles)\n      .set({ isActive: false })\n      .where(and(\n        eq(userCompanyRoles.userId, userId),\n        eq(userCompanyRoles.companyId, companyId)\n      ));\n  }\n\n  // ===================== COMPANY CONTEXT =====================\n  async getCompanyContext(userId: string, companyId: string): Promise<CompanyContext | undefined> {\n    const company = await this.getCompany(companyId);\n    if (!company) return undefined;\n\n    const userCompanyList = await this.getUserCompanies(userId);\n    const role = await this.getUserRole(userId, companyId);\n    \n    const allCompanies = await this.getCompanies();\n    const childCompanies = allCompanies.filter(c => c.parentId === companyId);\n    const parentCompany = company.parentId ? allCompanies.find(c => c.id === company.parentId) || null : null;\n\n    const getDescendantIds = (parentId: string): string[] => {\n      const children = allCompanies.filter(c => c.parentId === parentId);\n      return children.reduce((acc, child) => {\n        return [...acc, child.id, ...getDescendantIds(child.id)];\n      }, [] as string[]);\n    };\n    const accessibleCompanyIds = [companyId, ...getDescendantIds(companyId)];\n\n    return {\n      activeCompanyId: companyId,\n      activeCompany: company,\n      userCompanies: userCompanyList,\n      permissions: role?.permissions as string[] || [],\n      role: role || null,\n      companyLevel: company.level as 1 | 2 | 3,\n      accessibleCompanyIds,\n      canConsolidate: company.consolidationEnabled || company.level < 3,\n      parentCompany,\n      childCompanies,\n    };\n  }\n\n  // ===================== CHART OF ACCOUNTS =====================\n  async getAccounts(companyId: string): Promise<Account[]> {\n    return db.select().from(chartOfAccounts)\n      .where(eq(chartOfAccounts.companyId, companyId))\n      .orderBy(chartOfAccounts.accountCode);\n  }\n\n  async getAccount(id: string): Promise<Account | undefined> {\n    const [account] = await db.select().from(chartOfAccounts)\n      .where(eq(chartOfAccounts.id, id));\n    return account || undefined;\n  }\n\n  async getAccountByCode(companyId: string, accountCode: string): Promise<Account | undefined> {\n    const [account] = await db.select().from(chartOfAccounts)\n      .where(and(\n        eq(chartOfAccounts.companyId, companyId),\n        eq(chartOfAccounts.accountCode, accountCode)\n      ));\n    return account || undefined;\n  }\n\n  async createAccount(account: InsertAccount): Promise<Account> {\n    const id = randomUUID();\n    const [created] = await db.insert(chartOfAccounts).values({\n      id,\n      ...account,\n      createdAt: new Date(),\n    }).returning();\n    return created;\n  }\n\n  async updateAccount(id: string, updates: Partial<Account>): Promise<Account | undefined> {\n    const [updated] = await db.update(chartOfAccounts)\n      .set(updates)\n      .where(eq(chartOfAccounts.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async deleteAccount(id: string): Promise<boolean> {\n    const result = await db.delete(chartOfAccounts).where(eq(chartOfAccounts.id, id));\n    return true;\n  }\n\n  // ===================== WAREHOUSES =====================\n  async getWarehouses(companyId: string): Promise<Warehouse[]> {\n    return db.select().from(warehouses)\n      .where(eq(warehouses.companyId, companyId))\n      .orderBy(warehouses.name);\n  }\n\n  async getWarehouse(id: string): Promise<Warehouse | undefined> {\n    const [warehouse] = await db.select().from(warehouses)\n      .where(eq(warehouses.id, id));\n    return warehouse || undefined;\n  }\n\n  async createWarehouse(warehouse: InsertWarehouse): Promise<Warehouse> {\n    const id = randomUUID();\n    const [created] = await db.insert(warehouses).values({\n      id,\n      ...warehouse,\n      createdAt: new Date(),\n    }).returning();\n    return created;\n  }\n\n  async updateWarehouse(id: string, updates: Partial<Warehouse>): Promise<Warehouse | undefined> {\n    const [updated] = await db.update(warehouses)\n      .set(updates)\n      .where(eq(warehouses.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async deleteWarehouse(id: string): Promise<boolean> {\n    await db.delete(warehouses).where(eq(warehouses.id, id));\n    return true;\n  }\n\n  // ===================== PRODUCTS =====================\n  async getProducts(companyId: string): Promise<Product[]> {\n    return db.select().from(products)\n      .where(eq(products.companyId, companyId))\n      .orderBy(products.name);\n  }\n\n  async getProduct(id: string): Promise<Product | undefined> {\n    const [product] = await db.select().from(products)\n      .where(eq(products.id, id));\n    return product || undefined;\n  }\n\n  async getProductBySku(companyId: string, sku: string): Promise<Product | undefined> {\n    const [product] = await db.select().from(products)\n      .where(and(\n        eq(products.companyId, companyId),\n        eq(products.sku, sku)\n      ));\n    return product || undefined;\n  }\n\n  async createProduct(product: InsertProduct): Promise<Product> {\n    const id = randomUUID();\n    const [created] = await db.insert(products).values({\n      id,\n      ...product,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    }).returning();\n    return created;\n  }\n\n  async updateProduct(id: string, updates: Partial<Product>): Promise<Product | undefined> {\n    const [updated] = await db.update(products)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(products.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async deleteProduct(id: string): Promise<boolean> {\n    await db.delete(products).where(eq(products.id, id));\n    return true;\n  }\n\n  // ===================== CUSTOMERS =====================\n  async getCustomers(companyId: string): Promise<Customer[]> {\n    return db.select().from(customers)\n      .where(eq(customers.companyId, companyId))\n      .orderBy(customers.name);\n  }\n\n  async getCustomer(id: string): Promise<Customer | undefined> {\n    const [customer] = await db.select().from(customers)\n      .where(eq(customers.id, id));\n    return customer || undefined;\n  }\n\n  async createCustomer(customer: InsertCustomer): Promise<Customer> {\n    const id = randomUUID();\n    const [created] = await db.insert(customers).values({\n      id,\n      ...customer,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    }).returning();\n    return created;\n  }\n\n  async updateCustomer(id: string, updates: Partial<Customer>): Promise<Customer | undefined> {\n    const [updated] = await db.update(customers)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(customers.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async deleteCustomer(id: string): Promise<boolean> {\n    await db.delete(customers).where(eq(customers.id, id));\n    return true;\n  }\n\n  // ===================== VENDORS =====================\n  async getVendors(companyId: string): Promise<Vendor[]> {\n    return db.select().from(vendors)\n      .where(eq(vendors.companyId, companyId))\n      .orderBy(vendors.name);\n  }\n\n  async getVendor(id: string): Promise<Vendor | undefined> {\n    const [vendor] = await db.select().from(vendors)\n      .where(eq(vendors.id, id));\n    return vendor || undefined;\n  }\n\n  async createVendor(vendor: InsertVendor): Promise<Vendor> {\n    const id = randomUUID();\n    const [created] = await db.insert(vendors).values({\n      id,\n      ...vendor,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    }).returning();\n    return created;\n  }\n\n  async updateVendor(id: string, updates: Partial<Vendor>): Promise<Vendor | undefined> {\n    const [updated] = await db.update(vendors)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(vendors.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async deleteVendor(id: string): Promise<boolean> {\n    await db.delete(vendors).where(eq(vendors.id, id));\n    return true;\n  }\n\n  // ===================== TAXES =====================\n  async getTaxes(companyId: string): Promise<Tax[]> {\n    return db.select().from(taxes)\n      .where(eq(taxes.companyId, companyId))\n      .orderBy(taxes.name);\n  }\n\n  async getTax(id: string): Promise<Tax | undefined> {\n    const [tax] = await db.select().from(taxes)\n      .where(eq(taxes.id, id));\n    return tax || undefined;\n  }\n\n  async createTax(tax: InsertTax): Promise<Tax> {\n    const id = randomUUID();\n    const [created] = await db.insert(taxes).values({\n      id,\n      ...tax,\n      createdAt: new Date(),\n    }).returning();\n    return created;\n  }\n\n  async updateTax(id: string, updates: Partial<Tax>): Promise<Tax | undefined> {\n    const [updated] = await db.update(taxes)\n      .set(updates)\n      .where(eq(taxes.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async deleteTax(id: string): Promise<boolean> {\n    await db.delete(taxes).where(eq(taxes.id, id));\n    return true;\n  }\n\n  // ===================== EMPLOYEES =====================\n  async getEmployees(companyId: string): Promise<Employee[]> {\n    return db.select().from(employees)\n      .where(eq(employees.companyId, companyId))\n      .orderBy(employees.name);\n  }\n\n  async getEmployee(id: string): Promise<Employee | undefined> {\n    const [employee] = await db.select().from(employees)\n      .where(eq(employees.id, id));\n    return employee || undefined;\n  }\n\n  async createEmployee(employee: InsertEmployee): Promise<Employee> {\n    const id = randomUUID();\n    const companyEmployees = await this.getEmployees(employee.companyId);\n    const employeeNumber = `EMP-${String(companyEmployees.length + 1).padStart(4, '0')}`;\n    \n    const [created] = await db.insert(employees).values({\n      id,\n      ...employee,\n      employeeCode: employee.employeeCode || employeeNumber,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    }).returning();\n    return created;\n  }\n\n  async updateEmployee(id: string, updates: Partial<Employee>): Promise<Employee | undefined> {\n    const { employeeCode, ...safeUpdates } = updates;\n    const [updated] = await db.update(employees)\n      .set({ ...safeUpdates, updatedAt: new Date() })\n      .where(eq(employees.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async deleteEmployee(id: string): Promise<boolean> {\n    await db.delete(employees).where(eq(employees.id, id));\n    return true;\n  }\n\n  // ===================== JOURNAL ENTRIES =====================\n  async getJournalEntries(companyId: string): Promise<JournalEntry[]> {\n    return db.select().from(journalEntries)\n      .where(eq(journalEntries.companyId, companyId))\n      .orderBy(desc(journalEntries.entryDate));\n  }\n\n  async getJournalEntry(id: string): Promise<JournalEntry | undefined> {\n    const [entry] = await db.select().from(journalEntries)\n      .where(eq(journalEntries.id, id));\n    return entry || undefined;\n  }\n\n  async createJournalEntry(entry: InsertJournalEntry): Promise<JournalEntry> {\n    const id = randomUUID();\n    const companyEntries = await this.getJournalEntries(entry.companyId);\n    const entryNumber = entry.entryNumber || `JE-${String(companyEntries.length + 1).padStart(6, '0')}`;\n    \n    const [created] = await db.insert(journalEntries).values({\n      id,\n      companyId: entry.companyId,\n      entryNumber,\n      entryDate: entry.entryDate ?? new Date(),\n      fiscalPeriodId: entry.fiscalPeriodId,\n      description: entry.description,\n      reference: entry.reference,\n      sourceDocument: entry.sourceDocument,\n      sourceDocumentId: entry.sourceDocumentId,\n      status: entry.status ?? \"draft\",\n      totalDebit: entry.totalDebit ?? \"0\",\n      totalCredit: entry.totalCredit ?? \"0\",\n      isIntercompany: entry.isIntercompany ?? false,\n      counterpartyCompanyId: entry.counterpartyCompanyId,\n      eliminationGroupId: entry.eliminationGroupId,\n      postedBy: entry.postedBy,\n      postedAt: entry.postedAt,\n      createdBy: entry.createdBy,\n      createdAt: new Date(),\n    }).returning();\n    return created;\n  }\n\n  async updateJournalEntry(id: string, updates: Partial<JournalEntry>): Promise<JournalEntry | undefined> {\n    const { createdAt, ...safeUpdates } = updates;\n    const [updated] = await db.update(journalEntries)\n      .set(safeUpdates)\n      .where(eq(journalEntries.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async deleteJournalEntry(id: string): Promise<boolean> {\n    await db.delete(journalEntries).where(eq(journalEntries.id, id));\n    return true;\n  }\n\n  // ===================== SALES ORDERS =====================\n  async getSalesOrders(companyId: string): Promise<SalesOrder[]> {\n    return db.select().from(salesOrders)\n      .where(eq(salesOrders.companyId, companyId))\n      .orderBy(desc(salesOrders.orderDate));\n  }\n\n  async getSalesOrder(id: string): Promise<SalesOrder | undefined> {\n    const [order] = await db.select().from(salesOrders)\n      .where(eq(salesOrders.id, id));\n    return order || undefined;\n  }\n\n  async createSalesOrder(order: InsertSalesOrder): Promise<SalesOrder> {\n    const id = randomUUID();\n    const companyOrders = await this.getSalesOrders(order.companyId);\n    const orderNumber = `SO-${String(companyOrders.length + 1).padStart(6, '0')}`;\n    \n    const [created] = await db.insert(salesOrders).values({\n      id,\n      ...order,\n      orderNumber: order.orderNumber || orderNumber,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    }).returning();\n    return created;\n  }\n\n  async updateSalesOrder(id: string, updates: Partial<SalesOrder>): Promise<SalesOrder | undefined> {\n    const { orderNumber, ...safeUpdates } = updates;\n    const [updated] = await db.update(salesOrders)\n      .set({ ...safeUpdates, updatedAt: new Date() })\n      .where(eq(salesOrders.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async deleteSalesOrder(id: string): Promise<boolean> {\n    await db.delete(salesOrders).where(eq(salesOrders.id, id));\n    return true;\n  }\n\n  async getSalesOrderLines(salesOrderId: string): Promise<SalesOrderLine[]> {\n    return db.select().from(salesOrderLines)\n      .where(eq(salesOrderLines.salesOrderId, salesOrderId))\n      .orderBy(salesOrderLines.lineNumber);\n  }\n\n  // ===================== PURCHASE ORDERS =====================\n  async getPurchaseOrders(companyId: string): Promise<PurchaseOrder[]> {\n    return db.select().from(purchaseOrders)\n      .where(eq(purchaseOrders.companyId, companyId))\n      .orderBy(desc(purchaseOrders.orderDate));\n  }\n\n  async getPurchaseOrder(id: string): Promise<PurchaseOrder | undefined> {\n    const [order] = await db.select().from(purchaseOrders)\n      .where(eq(purchaseOrders.id, id));\n    return order || undefined;\n  }\n\n  async createPurchaseOrder(order: InsertPurchaseOrder): Promise<PurchaseOrder> {\n    const id = randomUUID();\n    const companyOrders = await this.getPurchaseOrders(order.companyId);\n    const orderNumber = `PO-${String(companyOrders.length + 1).padStart(6, '0')}`;\n    \n    const [created] = await db.insert(purchaseOrders).values({\n      id,\n      ...order,\n      orderNumber: order.orderNumber || orderNumber,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    }).returning();\n    return created;\n  }\n\n  async updatePurchaseOrder(id: string, updates: Partial<PurchaseOrder>): Promise<PurchaseOrder | undefined> {\n    const { orderNumber, ...safeUpdates } = updates;\n    const [updated] = await db.update(purchaseOrders)\n      .set({ ...safeUpdates, updatedAt: new Date() })\n      .where(eq(purchaseOrders.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async deletePurchaseOrder(id: string): Promise<boolean> {\n    await db.delete(purchaseOrders).where(eq(purchaseOrders.id, id));\n    return true;\n  }\n\n  async getPurchaseOrderLines(purchaseOrderId: string): Promise<PurchaseOrderLine[]> {\n    return db.select().from(purchaseOrderLines)\n      .where(eq(purchaseOrderLines.purchaseOrderId, purchaseOrderId))\n      .orderBy(purchaseOrderLines.lineNumber);\n  }\n\n  // ===================== INTERCOMPANY TRANSFERS =====================\n  async getIntercompanyTransfers(companyId: string): Promise<IntercompanyTransfer[]> {\n    return db.select().from(intercompanyTransfers)\n      .where(eq(intercompanyTransfers.sourceCompanyId, companyId))\n      .orderBy(desc(intercompanyTransfers.transferDate));\n  }\n\n  async getIntercompanyTransfer(id: string): Promise<IntercompanyTransfer | undefined> {\n    const [transfer] = await db.select().from(intercompanyTransfers)\n      .where(eq(intercompanyTransfers.id, id));\n    return transfer || undefined;\n  }\n\n  async createIntercompanyTransfer(transfer: InsertIntercompanyTransfer): Promise<IntercompanyTransfer> {\n    const id = randomUUID();\n    const allTransfers = await db.select().from(intercompanyTransfers);\n    const transferNumber = `ICT-${String(allTransfers.length + 1).padStart(6, '0')}`;\n    \n    const [created] = await db.insert(intercompanyTransfers).values({\n      id,\n      ...transfer,\n      transferNumber: transfer.transferNumber || transferNumber,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    }).returning();\n    return created;\n  }\n\n  async updateIntercompanyTransfer(id: string, updates: Partial<IntercompanyTransfer>): Promise<IntercompanyTransfer | undefined> {\n    const [updated] = await db.update(intercompanyTransfers)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(intercompanyTransfers.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  // ===================== SHARED ACCESS =====================\n  async getSharedAccess(granteeCompanyId: string, entityType: string): Promise<SharedAccess[]> {\n    return db.select().from(sharedAccess)\n      .where(and(\n        eq(sharedAccess.granteeCompanyId, granteeCompanyId),\n        eq(sharedAccess.entityType, entityType),\n        eq(sharedAccess.isActive, true)\n      ));\n  }\n\n  async grantSharedAccess(access: InsertSharedAccess): Promise<SharedAccess> {\n    const id = randomUUID();\n    const [created] = await db.insert(sharedAccess).values({\n      id,\n      ...access,\n      grantedAt: new Date(),\n      isActive: true,\n    }).returning();\n    return created;\n  }\n\n  async revokeSharedAccess(id: string): Promise<void> {\n    await db.update(sharedAccess)\n      .set({ isActive: false })\n      .where(eq(sharedAccess.id, id));\n  }\n\n  // ===================== REFRESH TOKENS =====================\n  async createRefreshToken(token: InsertRefreshToken): Promise<RefreshToken> {\n    const id = randomUUID();\n    const [created] = await db.insert(refreshTokens).values({\n      id,\n      ...token,\n      issuedAt: new Date(),\n    }).returning();\n    return created;\n  }\n\n  async getRefreshTokenByHash(tokenHash: string): Promise<RefreshToken | undefined> {\n    const [token] = await db.select().from(refreshTokens)\n      .where(and(\n        eq(refreshTokens.tokenHash, tokenHash),\n        isNull(refreshTokens.revokedAt)\n      ));\n    return token || undefined;\n  }\n\n  async revokeRefreshToken(id: string, reason: string): Promise<void> {\n    await db.update(refreshTokens)\n      .set({ revokedAt: new Date(), revokedReason: reason })\n      .where(eq(refreshTokens.id, id));\n  }\n\n  async revokeAllUserRefreshTokens(userId: string, reason: string): Promise<void> {\n    await db.update(refreshTokens)\n      .set({ revokedAt: new Date(), revokedReason: reason })\n      .where(and(\n        eq(refreshTokens.userId, userId),\n        isNull(refreshTokens.revokedAt)\n      ));\n  }\n\n  // ===================== AUTH AUDIT LOG =====================\n  async createAuthAuditLog(log: InsertAuthAuditLog): Promise<AuthAuditLog> {\n    const id = randomUUID();\n    const [created] = await db.insert(authAuditLog).values({\n      id,\n      ...log,\n      createdAt: new Date(),\n    }).returning();\n    return created;\n  }\n\n  async getAuthAuditLogs(userId: string, limit: number = 50): Promise<AuthAuditLog[]> {\n    return db.select().from(authAuditLog)\n      .where(eq(authAuditLog.userId, userId))\n      .orderBy(desc(authAuditLog.createdAt))\n      .limit(limit);\n  }\n\n  // ===================== SYSTEM =====================\n  async isSystemInitialized(): Promise<boolean> {\n    await this.ensureSystemRoles();\n    const companyList = await db.select().from(companies).limit(1);\n    const userList = await db.select().from(users).limit(1);\n    return companyList.length > 0 && userList.length > 0;\n  }\n\n  async getSystemStats(): Promise<{ companyCount: number; userCount: number }> {\n    await this.ensureSystemRoles();\n    const [companyResult] = await db.select({ count: sql<number>`count(*)` }).from(companies);\n    const [userResult] = await db.select({ count: sql<number>`count(*)` }).from(users);\n    return {\n      companyCount: Number(companyResult?.count || 0),\n      userCount: Number(userResult?.count || 0),\n    };\n  }\n\n  // ===================== STOCK LEVELS =====================\n  async getStockLevels(companyId: string): Promise<StockLevel[]> {\n    return db.select().from(stockLevels)\n      .where(eq(stockLevels.companyId, companyId))\n      .orderBy(desc(stockLevels.updatedAt));\n  }\n\n  async getStockLevel(companyId: string, productId: string, warehouseId: string): Promise<StockLevel | undefined> {\n    const [level] = await db.select().from(stockLevels)\n      .where(and(\n        eq(stockLevels.companyId, companyId),\n        eq(stockLevels.productId, productId),\n        eq(stockLevels.warehouseId, warehouseId)\n      ));\n    return level || undefined;\n  }\n\n  // ===================== STOCK MOVEMENTS =====================\n  async getStockMovements(companyId: string): Promise<StockMovement[]> {\n    return db.select().from(stockMovements)\n      .where(eq(stockMovements.companyId, companyId))\n      .orderBy(desc(stockMovements.movementDate));\n  }\n\n  // ===================== DELIVERIES =====================\n  async getDeliveries(companyId: string): Promise<Delivery[]> {\n    return db.select().from(deliveries)\n      .where(eq(deliveries.companyId, companyId))\n      .orderBy(desc(deliveries.deliveryDate));\n  }\n\n  async getDelivery(id: string): Promise<Delivery | undefined> {\n    const [delivery] = await db.select().from(deliveries).where(eq(deliveries.id, id));\n    return delivery || undefined;\n  }\n\n  // ===================== GOODS RECEIPTS =====================\n  async getGoodsReceipts(companyId: string): Promise<GoodsReceipt[]> {\n    return db.select().from(goodsReceipts)\n      .where(eq(goodsReceipts.companyId, companyId))\n      .orderBy(desc(goodsReceipts.receiptDate));\n  }\n\n  async getGoodsReceipt(id: string): Promise<GoodsReceipt | undefined> {\n    const [receipt] = await db.select().from(goodsReceipts).where(eq(goodsReceipts.id, id));\n    return receipt || undefined;\n  }\n\n  // ===================== INVOICES =====================\n  async getInvoices(companyId: string): Promise<Invoice[]> {\n    return db.select().from(invoices)\n      .where(eq(invoices.companyId, companyId))\n      .orderBy(desc(invoices.invoiceDate));\n  }\n\n  async getInvoice(id: string): Promise<Invoice | undefined> {\n    const [invoice] = await db.select().from(invoices).where(eq(invoices.id, id));\n    return invoice || undefined;\n  }\n\n  // ===================== PAYMENTS =====================\n  async getPayments(companyId: string): Promise<Payment[]> {\n    return db.select().from(payments)\n      .where(eq(payments.companyId, companyId))\n      .orderBy(desc(payments.paymentDate));\n  }\n\n  async getPayment(id: string): Promise<Payment | undefined> {\n    const [payment] = await db.select().from(payments).where(eq(payments.id, id));\n    return payment || undefined;\n  }\n\n  // ===================== AR/AP LEDGER =====================\n  async getArApLedger(companyId: string, ledgerType: string): Promise<ArApLedger[]> {\n    return db.select().from(arApLedger)\n      .where(and(\n        eq(arApLedger.companyId, companyId),\n        eq(arApLedger.ledgerType, ledgerType)\n      ))\n      .orderBy(desc(arApLedger.transactionDate));\n  }\n}\n","path":null,"size_bytes":36437,"size_tokens":null},"server/db.ts":{"content":"import { drizzle } from \"drizzle-orm/node-postgres\";\nimport pg from \"pg\";\nimport * as schema from \"@shared/schema\";\n\nconst { Pool } = pg;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle(pool, { schema });\n","path":null,"size_bytes":395,"size_tokens":null},"server/services/workflow-service.ts":{"content":"import { db } from \"../db\";\nimport { randomUUID } from \"crypto\";\nimport { eq, and, sql, inArray } from \"drizzle-orm\";\nimport {\n  salesOrders, salesOrderLines, purchaseOrders, purchaseOrderLines, \n  products, warehouses, customers, vendors,\n  stockLevels, stockMovements, stockReservations,\n  deliveries, deliveryLines, goodsReceipts, goodsReceiptLines,\n  invoices, invoiceLines, payments, paymentApplications,\n  journalEntries, journalEntryLines, arApLedger, documentSequences,\n  chartOfAccounts,\n  type SalesOrder, type PurchaseOrder, type Product, type Warehouse,\n  type StockLevel, type StockMovement, type StockReservation,\n  type Delivery, type DeliveryLine, type GoodsReceipt, type GoodsReceiptLine,\n  type Invoice, type InvoiceLine, type Payment, type PaymentApplication,\n  type JournalEntry, type JournalEntryLine, type ArApLedger\n} from \"@shared/schema\";\n\ntype TxClient = Parameters<Parameters<typeof db.transaction>[0]>[0];\n\nexport class WorkflowService {\n  \n  private async getNextDocumentNumberTx(tx: TxClient, companyId: string, documentType: string): Promise<string> {\n    const [sequence] = await tx.select().from(documentSequences)\n      .where(and(\n        eq(documentSequences.companyId, companyId),\n        eq(documentSequences.documentType, documentType)\n      ))\n      .for('update');\n\n    if (!sequence) {\n      const prefix = this.getDefaultPrefix(documentType);\n      await tx.insert(documentSequences).values({\n        id: randomUUID(),\n        companyId,\n        documentType,\n        prefix,\n        currentNumber: 1,\n        numberLength: 6,\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      });\n      return `${prefix}000001`;\n    }\n\n    const nextNumber = (sequence.currentNumber || 0) + 1;\n    const paddedNumber = String(nextNumber).padStart(sequence.numberLength || 6, '0');\n    \n    await tx.update(documentSequences)\n      .set({ currentNumber: nextNumber, updatedAt: new Date() })\n      .where(eq(documentSequences.id, sequence.id));\n\n    return `${sequence.prefix || ''}${paddedNumber}${sequence.suffix || ''}`;\n  }\n\n  async getNextDocumentNumber(companyId: string, documentType: string): Promise<string> {\n    return await db.transaction(async (tx) => {\n      return this.getNextDocumentNumberTx(tx, companyId, documentType);\n    });\n  }\n\n  private getDefaultPrefix(documentType: string): string {\n    const prefixes: Record<string, string> = {\n      'SO': 'SO-', 'PO': 'PO-', 'INV': 'INV-', 'PAY': 'PAY-',\n      'DEL': 'DEL-', 'GR': 'GR-', 'JE': 'JE-', 'SM': 'SM-'\n    };\n    return prefixes[documentType] || `${documentType}-`;\n  }\n\n  async confirmSalesOrder(salesOrderId: string, userId: string): Promise<{\n    salesOrder: SalesOrder;\n    reservations: StockReservation[];\n  }> {\n    return await db.transaction(async (tx) => {\n      const [salesOrder] = await tx.select().from(salesOrders)\n        .where(eq(salesOrders.id, salesOrderId))\n        .for('update');\n\n      if (!salesOrder) throw new Error(\"Sales order not found\");\n      if (salesOrder.status !== \"draft\") throw new Error(\"Sales order must be in draft status to confirm\");\n\n      const salesOrderLines = await this.getSalesOrderLinesTx(tx, salesOrderId);\n      const reservations: StockReservation[] = [];\n\n      for (const line of salesOrderLines) {\n        const stockLevel = await this.getOrCreateStockLevelTx(\n          tx,\n          salesOrder.companyId,\n          line.productId,\n          salesOrder.warehouseId || ''\n        );\n\n        const availableQty = parseFloat(stockLevel.quantityAvailable || \"0\");\n        const requestedQty = parseFloat(line.quantity || \"0\");\n\n        if (availableQty < requestedQty) {\n          throw new Error(`Insufficient stock for product. Available: ${availableQty}, Requested: ${requestedQty}`);\n        }\n\n        const reservationId = randomUUID();\n        const [reservation] = await tx.insert(stockReservations).values({\n          id: reservationId,\n          companyId: salesOrder.companyId,\n          salesOrderId: salesOrderId,\n          salesOrderLineId: line.id,\n          productId: line.productId,\n          warehouseId: salesOrder.warehouseId || '',\n          quantityReserved: String(requestedQty),\n          quantityFulfilled: \"0\",\n          status: \"active\",\n          reservedAt: new Date(),\n          createdBy: userId,\n        }).returning();\n\n        await tx.update(stockLevels)\n          .set({\n            quantityReserved: String(parseFloat(stockLevel.quantityReserved || \"0\") + requestedQty),\n            quantityAvailable: String(availableQty - requestedQty),\n            updatedAt: new Date(),\n          })\n          .where(eq(stockLevels.id, stockLevel.id));\n\n        reservations.push(reservation);\n      }\n\n      const [updatedSalesOrder] = await tx.update(salesOrders)\n        .set({ status: \"confirmed\", updatedAt: new Date() })\n        .where(eq(salesOrders.id, salesOrderId))\n        .returning();\n\n      return { salesOrder: updatedSalesOrder, reservations };\n    });\n  }\n\n  async createDeliveryFromSalesOrder(salesOrderId: string, userId: string): Promise<{\n    delivery: Delivery;\n    deliveryLines: DeliveryLine[];\n    stockMovements: StockMovement[];\n    journalEntry: JournalEntry | null;\n  }> {\n    return await db.transaction(async (tx) => {\n      const [salesOrder] = await tx.select().from(salesOrders)\n        .where(eq(salesOrders.id, salesOrderId))\n        .for('update');\n\n      if (!salesOrder) throw new Error(\"Sales order not found\");\n      if (salesOrder.status !== \"confirmed\") throw new Error(\"Sales order must be confirmed before delivery\");\n\n      const salesOrderLines = await this.getSalesOrderLinesTx(tx, salesOrderId);\n      const deliveryNumber = await this.getNextDocumentNumberTx(tx, salesOrder.companyId, 'DEL');\n\n      const [customer] = await tx.select().from(customers)\n        .where(eq(customers.id, salesOrder.customerId));\n\n      const deliveryId = randomUUID();\n      const [delivery] = await tx.insert(deliveries).values({\n        id: deliveryId,\n        companyId: salesOrder.companyId,\n        deliveryNumber,\n        salesOrderId,\n        customerId: salesOrder.customerId,\n        warehouseId: salesOrder.warehouseId || '',\n        deliveryDate: new Date(),\n        status: \"shipped\",\n        shippingAddress: customer?.address || '',\n        createdBy: userId,\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      }).returning();\n\n      const createdDeliveryLines: DeliveryLine[] = [];\n      const createdStockMovements: StockMovement[] = [];\n      let totalCOGS = 0;\n\n      for (let i = 0; i < salesOrderLines.length; i++) {\n        const line = salesOrderLines[i];\n        const stockLevel = await this.getOrCreateStockLevelTx(\n          tx,\n          salesOrder.companyId,\n          line.productId,\n          salesOrder.warehouseId || ''\n        );\n\n        const quantity = parseFloat(line.quantity || \"0\");\n        const unitCost = parseFloat(stockLevel.averageCost || \"0\");\n        const totalCost = quantity * unitCost;\n        totalCOGS += totalCost;\n\n        const movementNumber = await this.getNextDocumentNumberTx(tx, salesOrder.companyId, 'SM');\n        const movementId = randomUUID();\n        const [stockMovement] = await tx.insert(stockMovements).values({\n          id: movementId,\n          companyId: salesOrder.companyId,\n          movementNumber,\n          productId: line.productId,\n          warehouseId: salesOrder.warehouseId || '',\n          movementType: \"issue\",\n          movementDate: new Date(),\n          quantity: String(-quantity),\n          unitCost: String(unitCost),\n          totalCost: String(totalCost),\n          sourceDocument: \"delivery\",\n          sourceDocumentId: deliveryId,\n          sourceDocumentNumber: deliveryNumber,\n          createdBy: userId,\n          createdAt: new Date(),\n        }).returning();\n\n        createdStockMovements.push(stockMovement);\n\n        await tx.update(stockLevels)\n          .set({\n            quantityOnHand: String(parseFloat(stockLevel.quantityOnHand || \"0\") - quantity),\n            quantityReserved: String(Math.max(0, parseFloat(stockLevel.quantityReserved || \"0\") - quantity)),\n            lastMovementDate: new Date(),\n            updatedAt: new Date(),\n          })\n          .where(eq(stockLevels.id, stockLevel.id));\n\n        const deliveryLineId = randomUUID();\n        const [deliveryLine] = await tx.insert(deliveryLines).values({\n          id: deliveryLineId,\n          deliveryId,\n          lineNumber: i + 1,\n          productId: line.productId,\n          description: line.description,\n          quantityOrdered: line.quantity,\n          quantityDelivered: line.quantity,\n          unitCost: String(unitCost),\n          totalCost: String(totalCost),\n          stockMovementId: movementId,\n          createdAt: new Date(),\n        }).returning();\n\n        createdDeliveryLines.push(deliveryLine);\n\n        const activeReservations = await tx.select().from(stockReservations)\n          .where(and(\n            eq(stockReservations.salesOrderId, salesOrderId),\n            eq(stockReservations.salesOrderLineId, line.id),\n            eq(stockReservations.status, \"active\")\n          ))\n          .for('update');\n\n        let remainingToFulfill = quantity;\n        for (const reservation of activeReservations) {\n          if (remainingToFulfill <= 0) break;\n\n          const reservedQty = parseFloat(reservation.quantityReserved || \"0\");\n          const alreadyFulfilled = parseFloat(reservation.quantityFulfilled || \"0\");\n          const availableToFulfill = reservedQty - alreadyFulfilled;\n\n          if (availableToFulfill <= 0) continue;\n\n          const fulfillAmount = Math.min(remainingToFulfill, availableToFulfill);\n          const newFulfilledQty = alreadyFulfilled + fulfillAmount;\n          const isFullyFulfilled = newFulfilledQty >= reservedQty;\n\n          await tx.update(stockReservations)\n            .set({\n              quantityFulfilled: String(newFulfilledQty),\n              status: isFullyFulfilled ? \"fulfilled\" : \"active\",\n              fulfilledAt: isFullyFulfilled ? new Date() : null,\n            })\n            .where(eq(stockReservations.id, reservation.id));\n\n          remainingToFulfill -= fulfillAmount;\n        }\n      }\n\n      let journalEntry: JournalEntry | null = null;\n      if (totalCOGS > 0) {\n        journalEntry = await this.createCOGSJournalEntryTx(\n          tx,\n          salesOrder.companyId,\n          deliveryId,\n          deliveryNumber,\n          totalCOGS,\n          userId\n        );\n\n        await tx.update(deliveries)\n          .set({ journalEntryId: journalEntry.id })\n          .where(eq(deliveries.id, deliveryId));\n      }\n\n      await tx.update(salesOrders)\n        .set({ status: \"delivered\", updatedAt: new Date() })\n        .where(eq(salesOrders.id, salesOrderId));\n\n      return { delivery, deliveryLines: createdDeliveryLines, stockMovements: createdStockMovements, journalEntry };\n    });\n  }\n\n  async createInvoiceFromSalesOrder(salesOrderId: string, userId: string): Promise<{\n    invoice: Invoice;\n    invoiceLines: InvoiceLine[];\n    journalEntry: JournalEntry;\n    arLedgerEntry: ArApLedger;\n  }> {\n    return await db.transaction(async (tx) => {\n      const [salesOrder] = await tx.select().from(salesOrders)\n        .where(eq(salesOrders.id, salesOrderId))\n        .for('update');\n\n      if (!salesOrder) throw new Error(\"Sales order not found\");\n      if (salesOrder.status !== \"delivered\") throw new Error(\"Sales order must be delivered before invoicing\");\n\n      const [delivery] = await tx.select().from(deliveries)\n        .where(eq(deliveries.salesOrderId, salesOrderId));\n\n      const salesOrderLines = await this.getSalesOrderLinesTx(tx, salesOrderId);\n      const invoiceNumber = await this.getNextDocumentNumberTx(tx, salesOrder.companyId, 'INV');\n\n      const subtotal = parseFloat(salesOrder.subtotal || \"0\");\n      const taxAmount = parseFloat(salesOrder.taxAmount || \"0\");\n      const total = parseFloat(salesOrder.total || \"0\");\n\n      const invoiceId = randomUUID();\n      const [invoice] = await tx.insert(invoices).values({\n        id: invoiceId,\n        companyId: salesOrder.companyId,\n        invoiceNumber,\n        invoiceType: \"customer\",\n        customerId: salesOrder.customerId,\n        salesOrderId,\n        deliveryId: delivery?.id,\n        invoiceDate: new Date(),\n        dueDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000),\n        fiscalPeriodId: salesOrder.fiscalPeriodId,\n        status: \"posted\",\n        subtotal: String(subtotal),\n        taxAmount: String(taxAmount),\n        total: String(total),\n        amountPaid: \"0\",\n        amountDue: String(total),\n        currency: \"IDR\",\n        createdBy: userId,\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      }).returning();\n\n      const createdInvoiceLines: InvoiceLine[] = [];\n      for (let i = 0; i < salesOrderLines.length; i++) {\n        const line = salesOrderLines[i];\n        const invoiceLineId = randomUUID();\n        const [invoiceLine] = await tx.insert(invoiceLines).values({\n          id: invoiceLineId,\n          invoiceId,\n          lineNumber: i + 1,\n          productId: line.productId,\n          description: line.description,\n          quantity: line.quantity,\n          unitPrice: line.unitPrice,\n          lineTotal: line.lineTotal,\n          createdAt: new Date(),\n        }).returning();\n        createdInvoiceLines.push(invoiceLine);\n      }\n\n      const journalEntry = await this.createARInvoiceJournalEntryTx(\n        tx,\n        salesOrder.companyId,\n        invoiceId,\n        invoiceNumber,\n        total,\n        taxAmount,\n        userId\n      );\n\n      await tx.update(invoices)\n        .set({ journalEntryId: journalEntry.id })\n        .where(eq(invoices.id, invoiceId));\n\n      const arLedgerEntry = await this.createARLedgerEntryTx(\n        tx,\n        salesOrder.companyId,\n        salesOrder.customerId,\n        invoiceId,\n        invoiceNumber,\n        total,\n        journalEntry.id\n      );\n\n      await tx.update(salesOrders)\n        .set({ status: \"invoiced\", updatedAt: new Date() })\n        .where(eq(salesOrders.id, salesOrderId));\n\n      return { invoice, invoiceLines: createdInvoiceLines, journalEntry, arLedgerEntry };\n    });\n  }\n\n  async receivePayment(\n    companyId: string,\n    customerId: string,\n    invoiceIds: string[],\n    amount: number,\n    paymentMethod: string,\n    bankAccountId: string,\n    userId: string\n  ): Promise<{\n    payment: Payment;\n    applications: PaymentApplication[];\n    journalEntry: JournalEntry;\n    arLedgerEntry: ArApLedger;\n  }> {\n    return await db.transaction(async (tx) => {\n      const paymentNumber = await this.getNextDocumentNumberTx(tx, companyId, 'PAY');\n      const paymentId = randomUUID();\n\n      const [payment] = await tx.insert(payments).values({\n        id: paymentId,\n        companyId,\n        paymentNumber,\n        paymentType: \"receipt\",\n        customerId,\n        paymentDate: new Date(),\n        paymentMethod,\n        bankAccountId,\n        amount: String(amount),\n        currency: \"IDR\",\n        status: \"posted\",\n        createdBy: userId,\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      }).returning();\n\n      const applications: PaymentApplication[] = [];\n      let remainingAmount = amount;\n\n      for (const invoiceId of invoiceIds) {\n        if (remainingAmount <= 0) break;\n\n        const [invoice] = await tx.select().from(invoices)\n          .where(eq(invoices.id, invoiceId))\n          .for('update');\n\n        if (!invoice || invoice.companyId !== companyId) continue;\n\n        const amountDue = parseFloat(invoice.amountDue || \"0\");\n        const amountToApply = Math.min(remainingAmount, amountDue);\n\n        if (amountToApply > 0) {\n          const applicationId = randomUUID();\n          const [application] = await tx.insert(paymentApplications).values({\n            id: applicationId,\n            paymentId,\n            invoiceId,\n            amountApplied: String(amountToApply),\n            createdAt: new Date(),\n          }).returning();\n          applications.push(application);\n\n          const newAmountPaid = parseFloat(invoice.amountPaid || \"0\") + amountToApply;\n          const newAmountDue = amountDue - amountToApply;\n          const newStatus = newAmountDue <= 0 ? \"paid\" : \"partially_paid\";\n\n          await tx.update(invoices)\n            .set({\n              amountPaid: String(newAmountPaid),\n              amountDue: String(newAmountDue),\n              status: newStatus,\n              updatedAt: new Date(),\n            })\n            .where(eq(invoices.id, invoiceId));\n\n          remainingAmount -= amountToApply;\n        }\n      }\n\n      const journalEntry = await this.createPaymentReceiptJournalEntryTx(\n        tx,\n        companyId,\n        paymentId,\n        paymentNumber,\n        amount,\n        bankAccountId,\n        userId\n      );\n\n      await tx.update(payments)\n        .set({ journalEntryId: journalEntry.id })\n        .where(eq(payments.id, paymentId));\n\n      const arLedgerEntry = await this.createARPaymentLedgerEntryTx(\n        tx,\n        companyId,\n        customerId,\n        paymentId,\n        paymentNumber,\n        amount,\n        journalEntry.id\n      );\n\n      return { payment, applications, journalEntry, arLedgerEntry };\n    });\n  }\n\n  async confirmPurchaseOrder(purchaseOrderId: string, userId: string): Promise<PurchaseOrder> {\n    return await db.transaction(async (tx) => {\n      const [purchaseOrder] = await tx.select().from(purchaseOrders)\n        .where(eq(purchaseOrders.id, purchaseOrderId))\n        .for('update');\n\n      if (!purchaseOrder) throw new Error(\"Purchase order not found\");\n      if (purchaseOrder.status !== \"draft\") throw new Error(\"Purchase order must be in draft status to confirm\");\n\n      const purchaseOrderLines = await this.getPurchaseOrderLinesTx(tx, purchaseOrderId);\n\n      for (const line of purchaseOrderLines) {\n        const stockLevel = await this.getOrCreateStockLevelTx(\n          tx,\n          purchaseOrder.companyId,\n          line.productId,\n          purchaseOrder.warehouseId || ''\n        );\n\n        const quantity = parseFloat(line.quantity || \"0\");\n        await tx.update(stockLevels)\n          .set({\n            quantityOnOrder: String(parseFloat(stockLevel.quantityOnOrder || \"0\") + quantity),\n            updatedAt: new Date(),\n          })\n          .where(eq(stockLevels.id, stockLevel.id));\n      }\n\n      const [updatedPurchaseOrder] = await tx.update(purchaseOrders)\n        .set({ status: \"ordered\", updatedAt: new Date() })\n        .where(eq(purchaseOrders.id, purchaseOrderId))\n        .returning();\n\n      return updatedPurchaseOrder;\n    });\n  }\n\n  async receiveGoodsFromPurchaseOrder(purchaseOrderId: string, userId: string): Promise<{\n    goodsReceipt: GoodsReceipt;\n    goodsReceiptLines: GoodsReceiptLine[];\n    stockMovements: StockMovement[];\n    journalEntry: JournalEntry;\n  }> {\n    return await db.transaction(async (tx) => {\n      const [purchaseOrder] = await tx.select().from(purchaseOrders)\n        .where(eq(purchaseOrders.id, purchaseOrderId))\n        .for('update');\n\n      if (!purchaseOrder) throw new Error(\"Purchase order not found\");\n      if (purchaseOrder.status !== \"ordered\") throw new Error(\"Purchase order must be in ordered status to receive\");\n\n      const purchaseOrderLines = await this.getPurchaseOrderLinesTx(tx, purchaseOrderId);\n      const receiptNumber = await this.getNextDocumentNumberTx(tx, purchaseOrder.companyId, 'GR');\n\n      const receiptId = randomUUID();\n      const [goodsReceipt] = await tx.insert(goodsReceipts).values({\n        id: receiptId,\n        companyId: purchaseOrder.companyId,\n        receiptNumber,\n        purchaseOrderId,\n        vendorId: purchaseOrder.vendorId,\n        warehouseId: purchaseOrder.warehouseId || '',\n        receiptDate: new Date(),\n        status: \"received\",\n        createdBy: userId,\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      }).returning();\n\n      const createdReceiptLines: GoodsReceiptLine[] = [];\n      const createdStockMovements: StockMovement[] = [];\n      let totalCost = 0;\n\n      for (let i = 0; i < purchaseOrderLines.length; i++) {\n        const line = purchaseOrderLines[i];\n        const stockLevel = await this.getOrCreateStockLevelTx(\n          tx,\n          purchaseOrder.companyId,\n          line.productId,\n          purchaseOrder.warehouseId || ''\n        );\n\n        const quantity = parseFloat(line.quantity || \"0\");\n        const unitCost = parseFloat(line.unitPrice || \"0\");\n        const lineTotalCost = quantity * unitCost;\n        totalCost += lineTotalCost;\n\n        const currentQty = parseFloat(stockLevel.quantityOnHand || \"0\");\n        const currentCost = parseFloat(stockLevel.averageCost || \"0\");\n        const newTotalQty = currentQty + quantity;\n        const newAvgCost = newTotalQty > 0 \n          ? ((currentQty * currentCost) + lineTotalCost) / newTotalQty \n          : unitCost;\n\n        const movementNumber = await this.getNextDocumentNumberTx(tx, purchaseOrder.companyId, 'SM');\n        const movementId = randomUUID();\n        const [stockMovement] = await tx.insert(stockMovements).values({\n          id: movementId,\n          companyId: purchaseOrder.companyId,\n          movementNumber,\n          productId: line.productId,\n          warehouseId: purchaseOrder.warehouseId || '',\n          movementType: \"receipt\",\n          movementDate: new Date(),\n          quantity: String(quantity),\n          unitCost: String(unitCost),\n          totalCost: String(lineTotalCost),\n          sourceDocument: \"goods_receipt\",\n          sourceDocumentId: receiptId,\n          sourceDocumentNumber: receiptNumber,\n          createdBy: userId,\n          createdAt: new Date(),\n        }).returning();\n\n        createdStockMovements.push(stockMovement);\n\n        await tx.update(stockLevels)\n          .set({\n            quantityOnHand: String(newTotalQty),\n            quantityAvailable: String(newTotalQty - parseFloat(stockLevel.quantityReserved || \"0\")),\n            quantityOnOrder: String(Math.max(0, parseFloat(stockLevel.quantityOnOrder || \"0\") - quantity)),\n            averageCost: String(newAvgCost),\n            lastMovementDate: new Date(),\n            updatedAt: new Date(),\n          })\n          .where(eq(stockLevels.id, stockLevel.id));\n\n        const receiptLineId = randomUUID();\n        const [receiptLine] = await tx.insert(goodsReceiptLines).values({\n          id: receiptLineId,\n          goodsReceiptId: receiptId,\n          lineNumber: i + 1,\n          productId: line.productId,\n          description: line.description,\n          quantityOrdered: line.quantity,\n          quantityReceived: line.quantity,\n          unitCost: String(unitCost),\n          totalCost: String(lineTotalCost),\n          stockMovementId: movementId,\n          createdAt: new Date(),\n        }).returning();\n\n        createdReceiptLines.push(receiptLine);\n      }\n\n      const journalEntry = await this.createGoodsReceiptJournalEntryTx(\n        tx,\n        purchaseOrder.companyId,\n        receiptId,\n        receiptNumber,\n        totalCost,\n        userId\n      );\n\n      await tx.update(goodsReceipts)\n        .set({ journalEntryId: journalEntry.id })\n        .where(eq(goodsReceipts.id, receiptId));\n\n      await tx.update(purchaseOrders)\n        .set({ status: \"received\", updatedAt: new Date() })\n        .where(eq(purchaseOrders.id, purchaseOrderId));\n\n      return { goodsReceipt, goodsReceiptLines: createdReceiptLines, stockMovements: createdStockMovements, journalEntry };\n    });\n  }\n\n  async createVendorInvoice(purchaseOrderId: string, userId: string): Promise<{\n    invoice: Invoice;\n    invoiceLines: InvoiceLine[];\n    journalEntry: JournalEntry;\n    apLedgerEntry: ArApLedger;\n  }> {\n    return await db.transaction(async (tx) => {\n      const [purchaseOrder] = await tx.select().from(purchaseOrders)\n        .where(eq(purchaseOrders.id, purchaseOrderId))\n        .for('update');\n\n      if (!purchaseOrder) throw new Error(\"Purchase order not found\");\n      if (purchaseOrder.status !== \"received\") throw new Error(\"Purchase order must be received before billing\");\n\n      const [goodsReceipt] = await tx.select().from(goodsReceipts)\n        .where(eq(goodsReceipts.purchaseOrderId, purchaseOrderId));\n\n      const purchaseOrderLines = await this.getPurchaseOrderLinesTx(tx, purchaseOrderId);\n      const invoiceNumber = await this.getNextDocumentNumberTx(tx, purchaseOrder.companyId, 'INV');\n\n      const subtotal = parseFloat(purchaseOrder.subtotal || \"0\");\n      const taxAmount = parseFloat(purchaseOrder.taxAmount || \"0\");\n      const total = parseFloat(purchaseOrder.total || \"0\");\n\n      const invoiceId = randomUUID();\n      const [invoice] = await tx.insert(invoices).values({\n        id: invoiceId,\n        companyId: purchaseOrder.companyId,\n        invoiceNumber,\n        invoiceType: \"vendor\",\n        vendorId: purchaseOrder.vendorId,\n        purchaseOrderId,\n        goodsReceiptId: goodsReceipt?.id,\n        invoiceDate: new Date(),\n        dueDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000),\n        fiscalPeriodId: purchaseOrder.fiscalPeriodId,\n        status: \"posted\",\n        subtotal: String(subtotal),\n        taxAmount: String(taxAmount),\n        total: String(total),\n        amountPaid: \"0\",\n        amountDue: String(total),\n        currency: \"IDR\",\n        createdBy: userId,\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      }).returning();\n\n      const createdInvoiceLines: InvoiceLine[] = [];\n      for (let i = 0; i < purchaseOrderLines.length; i++) {\n        const line = purchaseOrderLines[i];\n        const invoiceLineId = randomUUID();\n        const [invoiceLine] = await tx.insert(invoiceLines).values({\n          id: invoiceLineId,\n          invoiceId,\n          lineNumber: i + 1,\n          productId: line.productId,\n          description: line.description,\n          quantity: line.quantity,\n          unitPrice: line.unitPrice,\n          lineTotal: line.lineTotal,\n          createdAt: new Date(),\n        }).returning();\n        createdInvoiceLines.push(invoiceLine);\n      }\n\n      const journalEntry = await this.createAPInvoiceJournalEntryTx(\n        tx,\n        purchaseOrder.companyId,\n        invoiceId,\n        invoiceNumber,\n        total,\n        taxAmount,\n        userId\n      );\n\n      await tx.update(invoices)\n        .set({ journalEntryId: journalEntry.id })\n        .where(eq(invoices.id, invoiceId));\n\n      const apLedgerEntry = await this.createAPLedgerEntryTx(\n        tx,\n        purchaseOrder.companyId,\n        purchaseOrder.vendorId,\n        invoiceId,\n        invoiceNumber,\n        total,\n        journalEntry.id\n      );\n\n      await tx.update(purchaseOrders)\n        .set({ status: \"billed\", updatedAt: new Date() })\n        .where(eq(purchaseOrders.id, purchaseOrderId));\n\n      return { invoice, invoiceLines: createdInvoiceLines, journalEntry, apLedgerEntry };\n    });\n  }\n\n  async makeVendorPayment(\n    companyId: string,\n    vendorId: string,\n    invoiceIds: string[],\n    amount: number,\n    paymentMethod: string,\n    bankAccountId: string,\n    userId: string\n  ): Promise<{\n    payment: Payment;\n    applications: PaymentApplication[];\n    journalEntry: JournalEntry;\n    apLedgerEntry: ArApLedger;\n  }> {\n    return await db.transaction(async (tx) => {\n      const paymentNumber = await this.getNextDocumentNumberTx(tx, companyId, 'PAY');\n      const paymentId = randomUUID();\n\n      const [payment] = await tx.insert(payments).values({\n        id: paymentId,\n        companyId,\n        paymentNumber,\n        paymentType: \"payment\",\n        vendorId,\n        paymentDate: new Date(),\n        paymentMethod,\n        bankAccountId,\n        amount: String(amount),\n        currency: \"IDR\",\n        status: \"posted\",\n        createdBy: userId,\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      }).returning();\n\n      const applications: PaymentApplication[] = [];\n      let remainingAmount = amount;\n\n      for (const invoiceId of invoiceIds) {\n        if (remainingAmount <= 0) break;\n\n        const [invoice] = await tx.select().from(invoices)\n          .where(eq(invoices.id, invoiceId))\n          .for('update');\n\n        if (!invoice || invoice.companyId !== companyId) continue;\n\n        const amountDue = parseFloat(invoice.amountDue || \"0\");\n        const amountToApply = Math.min(remainingAmount, amountDue);\n\n        if (amountToApply > 0) {\n          const applicationId = randomUUID();\n          const [application] = await tx.insert(paymentApplications).values({\n            id: applicationId,\n            paymentId,\n            invoiceId,\n            amountApplied: String(amountToApply),\n            createdAt: new Date(),\n          }).returning();\n          applications.push(application);\n\n          const newAmountPaid = parseFloat(invoice.amountPaid || \"0\") + amountToApply;\n          const newAmountDue = amountDue - amountToApply;\n          const newStatus = newAmountDue <= 0 ? \"paid\" : \"partially_paid\";\n\n          await tx.update(invoices)\n            .set({\n              amountPaid: String(newAmountPaid),\n              amountDue: String(newAmountDue),\n              status: newStatus,\n              updatedAt: new Date(),\n            })\n            .where(eq(invoices.id, invoiceId));\n\n          remainingAmount -= amountToApply;\n        }\n      }\n\n      const journalEntry = await this.createVendorPaymentJournalEntryTx(\n        tx,\n        companyId,\n        paymentId,\n        paymentNumber,\n        amount,\n        bankAccountId,\n        userId\n      );\n\n      await tx.update(payments)\n        .set({ journalEntryId: journalEntry.id })\n        .where(eq(payments.id, paymentId));\n\n      const apLedgerEntry = await this.createAPPaymentLedgerEntryTx(\n        tx,\n        companyId,\n        vendorId,\n        paymentId,\n        paymentNumber,\n        amount,\n        journalEntry.id\n      );\n\n      return { payment, applications, journalEntry, apLedgerEntry };\n    });\n  }\n\n  private async getSalesOrderLines(salesOrderId: string): Promise<any[]> {\n    return [];\n  }\n\n  private async getPurchaseOrderLines(purchaseOrderId: string): Promise<any[]> {\n    return [];\n  }\n\n  private async getOrCreateStockLevel(companyId: string, productId: string, warehouseId: string): Promise<StockLevel> {\n    const [existing] = await db.select().from(stockLevels)\n      .where(and(\n        eq(stockLevels.companyId, companyId),\n        eq(stockLevels.productId, productId),\n        eq(stockLevels.warehouseId, warehouseId)\n      ));\n\n    if (existing) return existing;\n\n    const [created] = await db.insert(stockLevels).values({\n      id: randomUUID(),\n      companyId,\n      productId,\n      warehouseId,\n      quantityOnHand: \"0\",\n      quantityReserved: \"0\",\n      quantityAvailable: \"0\",\n      quantityOnOrder: \"0\",\n      averageCost: \"0\",\n      updatedAt: new Date(),\n    }).returning();\n\n    return created;\n  }\n\n  private async getAccountByCode(companyId: string, accountCode: string): Promise<string | null> {\n    const [account] = await db.select().from(chartOfAccounts)\n      .where(and(\n        eq(chartOfAccounts.companyId, companyId),\n        eq(chartOfAccounts.accountCode, accountCode)\n      ));\n    return account?.id || null;\n  }\n\n  private async createCOGSJournalEntry(\n    companyId: string,\n    deliveryId: string,\n    deliveryNumber: string,\n    totalCOGS: number,\n    userId: string\n  ): Promise<JournalEntry> {\n    const entryNumber = await this.getNextDocumentNumber(companyId, 'JE');\n    const entryId = randomUUID();\n\n    const [entry] = await db.insert(journalEntries).values({\n      id: entryId,\n      companyId,\n      entryNumber,\n      entryDate: new Date(),\n      description: `COGS for delivery ${deliveryNumber}`,\n      reference: deliveryNumber,\n      sourceDocument: \"delivery\",\n      sourceDocumentId: deliveryId,\n      status: \"posted\",\n      totalDebit: String(totalCOGS),\n      totalCredit: String(totalCOGS),\n      postedBy: userId,\n      postedAt: new Date(),\n      createdBy: userId,\n      createdAt: new Date(),\n    }).returning();\n\n    const cogsAccountId = await this.getAccountByCode(companyId, \"5100\") || \"\";\n    const inventoryAccountId = await this.getAccountByCode(companyId, \"1200\") || \"\";\n\n    await db.insert(journalEntryLines).values([\n      {\n        id: randomUUID(),\n        journalEntryId: entryId,\n        lineNumber: 1,\n        accountId: cogsAccountId,\n        description: \"Cost of goods sold\",\n        debit: String(totalCOGS),\n        credit: \"0\",\n        createdAt: new Date(),\n      },\n      {\n        id: randomUUID(),\n        journalEntryId: entryId,\n        lineNumber: 2,\n        accountId: inventoryAccountId,\n        description: \"Inventory reduction\",\n        debit: \"0\",\n        credit: String(totalCOGS),\n        createdAt: new Date(),\n      }\n    ]);\n\n    return entry;\n  }\n\n  private async createARInvoiceJournalEntry(\n    companyId: string,\n    invoiceId: string,\n    invoiceNumber: string,\n    total: number,\n    taxAmount: number,\n    userId: string\n  ): Promise<JournalEntry> {\n    const entryNumber = await this.getNextDocumentNumber(companyId, 'JE');\n    const entryId = randomUUID();\n    const netAmount = total - taxAmount;\n\n    const [entry] = await db.insert(journalEntries).values({\n      id: entryId,\n      companyId,\n      entryNumber,\n      entryDate: new Date(),\n      description: `Customer invoice ${invoiceNumber}`,\n      reference: invoiceNumber,\n      sourceDocument: \"invoice\",\n      sourceDocumentId: invoiceId,\n      status: \"posted\",\n      totalDebit: String(total),\n      totalCredit: String(total),\n      postedBy: userId,\n      postedAt: new Date(),\n      createdBy: userId,\n      createdAt: new Date(),\n    }).returning();\n\n    const arAccountId = await this.getAccountByCode(companyId, \"1200\") || \"\";\n    const revenueAccountId = await this.getAccountByCode(companyId, \"4100\") || \"\";\n\n    await db.insert(journalEntryLines).values([\n      {\n        id: randomUUID(),\n        journalEntryId: entryId,\n        lineNumber: 1,\n        accountId: arAccountId,\n        description: \"Accounts Receivable\",\n        debit: String(total),\n        credit: \"0\",\n        createdAt: new Date(),\n      },\n      {\n        id: randomUUID(),\n        journalEntryId: entryId,\n        lineNumber: 2,\n        accountId: revenueAccountId,\n        description: \"Sales Revenue\",\n        debit: \"0\",\n        credit: String(netAmount),\n        createdAt: new Date(),\n      }\n    ]);\n\n    return entry;\n  }\n\n  private async createPaymentReceiptJournalEntry(\n    companyId: string,\n    paymentId: string,\n    paymentNumber: string,\n    amount: number,\n    bankAccountId: string,\n    userId: string\n  ): Promise<JournalEntry> {\n    const entryNumber = await this.getNextDocumentNumber(companyId, 'JE');\n    const entryId = randomUUID();\n\n    const [entry] = await db.insert(journalEntries).values({\n      id: entryId,\n      companyId,\n      entryNumber,\n      entryDate: new Date(),\n      description: `Payment receipt ${paymentNumber}`,\n      reference: paymentNumber,\n      sourceDocument: \"payment\",\n      sourceDocumentId: paymentId,\n      status: \"posted\",\n      totalDebit: String(amount),\n      totalCredit: String(amount),\n      postedBy: userId,\n      postedAt: new Date(),\n      createdBy: userId,\n      createdAt: new Date(),\n    }).returning();\n\n    const cashAccountId = bankAccountId || await this.getAccountByCode(companyId, \"1100\") || \"\";\n    const arAccountId = await this.getAccountByCode(companyId, \"1200\") || \"\";\n\n    await db.insert(journalEntryLines).values([\n      {\n        id: randomUUID(),\n        journalEntryId: entryId,\n        lineNumber: 1,\n        accountId: cashAccountId,\n        description: \"Cash/Bank\",\n        debit: String(amount),\n        credit: \"0\",\n        createdAt: new Date(),\n      },\n      {\n        id: randomUUID(),\n        journalEntryId: entryId,\n        lineNumber: 2,\n        accountId: arAccountId,\n        description: \"Accounts Receivable\",\n        debit: \"0\",\n        credit: String(amount),\n        createdAt: new Date(),\n      }\n    ]);\n\n    return entry;\n  }\n\n  private async createGoodsReceiptJournalEntry(\n    companyId: string,\n    receiptId: string,\n    receiptNumber: string,\n    totalCost: number,\n    userId: string\n  ): Promise<JournalEntry> {\n    const entryNumber = await this.getNextDocumentNumber(companyId, 'JE');\n    const entryId = randomUUID();\n\n    const [entry] = await db.insert(journalEntries).values({\n      id: entryId,\n      companyId,\n      entryNumber,\n      entryDate: new Date(),\n      description: `Goods receipt ${receiptNumber}`,\n      reference: receiptNumber,\n      sourceDocument: \"goods_receipt\",\n      sourceDocumentId: receiptId,\n      status: \"posted\",\n      totalDebit: String(totalCost),\n      totalCredit: String(totalCost),\n      postedBy: userId,\n      postedAt: new Date(),\n      createdBy: userId,\n      createdAt: new Date(),\n    }).returning();\n\n    const inventoryAccountId = await this.getAccountByCode(companyId, \"1200\") || \"\";\n    const grniAccountId = await this.getAccountByCode(companyId, \"2100\") || \"\";\n\n    await db.insert(journalEntryLines).values([\n      {\n        id: randomUUID(),\n        journalEntryId: entryId,\n        lineNumber: 1,\n        accountId: inventoryAccountId,\n        description: \"Inventory\",\n        debit: String(totalCost),\n        credit: \"0\",\n        createdAt: new Date(),\n      },\n      {\n        id: randomUUID(),\n        journalEntryId: entryId,\n        lineNumber: 2,\n        accountId: grniAccountId,\n        description: \"GRNI - Goods Received Not Invoiced\",\n        debit: \"0\",\n        credit: String(totalCost),\n        createdAt: new Date(),\n      }\n    ]);\n\n    return entry;\n  }\n\n  private async createAPInvoiceJournalEntry(\n    companyId: string,\n    invoiceId: string,\n    invoiceNumber: string,\n    total: number,\n    taxAmount: number,\n    userId: string\n  ): Promise<JournalEntry> {\n    const entryNumber = await this.getNextDocumentNumber(companyId, 'JE');\n    const entryId = randomUUID();\n\n    const [entry] = await db.insert(journalEntries).values({\n      id: entryId,\n      companyId,\n      entryNumber,\n      entryDate: new Date(),\n      description: `Vendor invoice ${invoiceNumber}`,\n      reference: invoiceNumber,\n      sourceDocument: \"invoice\",\n      sourceDocumentId: invoiceId,\n      status: \"posted\",\n      totalDebit: String(total),\n      totalCredit: String(total),\n      postedBy: userId,\n      postedAt: new Date(),\n      createdBy: userId,\n      createdAt: new Date(),\n    }).returning();\n\n    const grniAccountId = await this.getAccountByCode(companyId, \"2100\") || \"\";\n    const apAccountId = await this.getAccountByCode(companyId, \"2100\") || \"\";\n\n    await db.insert(journalEntryLines).values([\n      {\n        id: randomUUID(),\n        journalEntryId: entryId,\n        lineNumber: 1,\n        accountId: grniAccountId,\n        description: \"GRNI - Clear accrual\",\n        debit: String(total),\n        credit: \"0\",\n        createdAt: new Date(),\n      },\n      {\n        id: randomUUID(),\n        journalEntryId: entryId,\n        lineNumber: 2,\n        accountId: apAccountId,\n        description: \"Accounts Payable\",\n        debit: \"0\",\n        credit: String(total),\n        createdAt: new Date(),\n      }\n    ]);\n\n    return entry;\n  }\n\n  private async createVendorPaymentJournalEntry(\n    companyId: string,\n    paymentId: string,\n    paymentNumber: string,\n    amount: number,\n    bankAccountId: string,\n    userId: string\n  ): Promise<JournalEntry> {\n    const entryNumber = await this.getNextDocumentNumber(companyId, 'JE');\n    const entryId = randomUUID();\n\n    const [entry] = await db.insert(journalEntries).values({\n      id: entryId,\n      companyId,\n      entryNumber,\n      entryDate: new Date(),\n      description: `Vendor payment ${paymentNumber}`,\n      reference: paymentNumber,\n      sourceDocument: \"payment\",\n      sourceDocumentId: paymentId,\n      status: \"posted\",\n      totalDebit: String(amount),\n      totalCredit: String(amount),\n      postedBy: userId,\n      postedAt: new Date(),\n      createdBy: userId,\n      createdAt: new Date(),\n    }).returning();\n\n    const apAccountId = await this.getAccountByCode(companyId, \"2100\") || \"\";\n    const cashAccountId = bankAccountId || await this.getAccountByCode(companyId, \"1100\") || \"\";\n\n    await db.insert(journalEntryLines).values([\n      {\n        id: randomUUID(),\n        journalEntryId: entryId,\n        lineNumber: 1,\n        accountId: apAccountId,\n        description: \"Accounts Payable\",\n        debit: String(amount),\n        credit: \"0\",\n        createdAt: new Date(),\n      },\n      {\n        id: randomUUID(),\n        journalEntryId: entryId,\n        lineNumber: 2,\n        accountId: cashAccountId,\n        description: \"Cash/Bank\",\n        debit: \"0\",\n        credit: String(amount),\n        createdAt: new Date(),\n      }\n    ]);\n\n    return entry;\n  }\n\n  private async createARLedgerEntry(\n    companyId: string,\n    customerId: string,\n    invoiceId: string,\n    invoiceNumber: string,\n    amount: number,\n    journalEntryId: string\n  ): Promise<ArApLedger> {\n    const [entry] = await db.insert(arApLedger).values({\n      id: randomUUID(),\n      companyId,\n      ledgerType: \"AR\",\n      customerId,\n      transactionDate: new Date(),\n      transactionType: \"invoice\",\n      documentId: invoiceId,\n      documentNumber: invoiceNumber,\n      description: `Customer invoice ${invoiceNumber}`,\n      debitAmount: String(amount),\n      creditAmount: \"0\",\n      runningBalance: String(amount),\n      currency: \"IDR\",\n      journalEntryId,\n      createdAt: new Date(),\n    }).returning();\n\n    return entry;\n  }\n\n  private async createARPaymentLedgerEntry(\n    companyId: string,\n    customerId: string,\n    paymentId: string,\n    paymentNumber: string,\n    amount: number,\n    journalEntryId: string\n  ): Promise<ArApLedger> {\n    const [entry] = await db.insert(arApLedger).values({\n      id: randomUUID(),\n      companyId,\n      ledgerType: \"AR\",\n      customerId,\n      transactionDate: new Date(),\n      transactionType: \"payment\",\n      documentId: paymentId,\n      documentNumber: paymentNumber,\n      description: `Payment receipt ${paymentNumber}`,\n      debitAmount: \"0\",\n      creditAmount: String(amount),\n      runningBalance: String(-amount),\n      currency: \"IDR\",\n      journalEntryId,\n      createdAt: new Date(),\n    }).returning();\n\n    return entry;\n  }\n\n  private async createAPLedgerEntry(\n    companyId: string,\n    vendorId: string,\n    invoiceId: string,\n    invoiceNumber: string,\n    amount: number,\n    journalEntryId: string\n  ): Promise<ArApLedger> {\n    const [entry] = await db.insert(arApLedger).values({\n      id: randomUUID(),\n      companyId,\n      ledgerType: \"AP\",\n      vendorId,\n      transactionDate: new Date(),\n      transactionType: \"invoice\",\n      documentId: invoiceId,\n      documentNumber: invoiceNumber,\n      description: `Vendor invoice ${invoiceNumber}`,\n      debitAmount: \"0\",\n      creditAmount: String(amount),\n      runningBalance: String(amount),\n      currency: \"IDR\",\n      journalEntryId,\n      createdAt: new Date(),\n    }).returning();\n\n    return entry;\n  }\n\n  private async createAPPaymentLedgerEntry(\n    companyId: string,\n    vendorId: string,\n    paymentId: string,\n    paymentNumber: string,\n    amount: number,\n    journalEntryId: string\n  ): Promise<ArApLedger> {\n    const [entry] = await db.insert(arApLedger).values({\n      id: randomUUID(),\n      companyId,\n      ledgerType: \"AP\",\n      vendorId,\n      transactionDate: new Date(),\n      transactionType: \"payment\",\n      documentId: paymentId,\n      documentNumber: paymentNumber,\n      description: `Vendor payment ${paymentNumber}`,\n      debitAmount: String(amount),\n      creditAmount: \"0\",\n      runningBalance: String(-amount),\n      currency: \"IDR\",\n      journalEntryId,\n      createdAt: new Date(),\n    }).returning();\n\n    return entry;\n  }\n\n  private async getSalesOrderLinesTx(tx: TxClient, salesOrderId: string): Promise<typeof salesOrderLines.$inferSelect[]> {\n    return await tx.select().from(salesOrderLines)\n      .where(eq(salesOrderLines.salesOrderId, salesOrderId))\n      .for('update');\n  }\n\n  private async getPurchaseOrderLinesTx(tx: TxClient, purchaseOrderId: string): Promise<typeof purchaseOrderLines.$inferSelect[]> {\n    return await tx.select().from(purchaseOrderLines)\n      .where(eq(purchaseOrderLines.purchaseOrderId, purchaseOrderId))\n      .for('update');\n  }\n\n  private async getOrCreateStockLevelTx(tx: TxClient, companyId: string, productId: string, warehouseId: string): Promise<StockLevel> {\n    const [existing] = await tx.select().from(stockLevels)\n      .where(and(\n        eq(stockLevels.companyId, companyId),\n        eq(stockLevels.productId, productId),\n        eq(stockLevels.warehouseId, warehouseId)\n      ))\n      .for('update');\n\n    if (existing) return existing;\n\n    const [created] = await tx.insert(stockLevels).values({\n      id: randomUUID(),\n      companyId,\n      productId,\n      warehouseId,\n      quantityOnHand: \"0\",\n      quantityReserved: \"0\",\n      quantityAvailable: \"0\",\n      quantityOnOrder: \"0\",\n      averageCost: \"0\",\n      updatedAt: new Date(),\n    }).returning();\n\n    return created;\n  }\n\n  private async getAccountByCodeTx(tx: TxClient, companyId: string, accountCode: string): Promise<string | null> {\n    const [account] = await tx.select().from(chartOfAccounts)\n      .where(and(\n        eq(chartOfAccounts.companyId, companyId),\n        eq(chartOfAccounts.accountCode, accountCode)\n      ));\n    return account?.id || null;\n  }\n\n  private async createCOGSJournalEntryTx(\n    tx: TxClient,\n    companyId: string,\n    deliveryId: string,\n    deliveryNumber: string,\n    totalCOGS: number,\n    userId: string\n  ): Promise<JournalEntry> {\n    const entryNumber = await this.getNextDocumentNumberTx(tx, companyId, 'JE');\n    const entryId = randomUUID();\n\n    const [entry] = await tx.insert(journalEntries).values({\n      id: entryId,\n      companyId,\n      entryNumber,\n      entryDate: new Date(),\n      description: `COGS for delivery ${deliveryNumber}`,\n      reference: deliveryNumber,\n      sourceDocument: \"delivery\",\n      sourceDocumentId: deliveryId,\n      status: \"posted\",\n      totalDebit: String(totalCOGS),\n      totalCredit: String(totalCOGS),\n      postedBy: userId,\n      postedAt: new Date(),\n      createdBy: userId,\n      createdAt: new Date(),\n    }).returning();\n\n    const cogsAccountId = await this.getAccountByCodeTx(tx, companyId, \"5100\") || \"\";\n    const inventoryAccountId = await this.getAccountByCodeTx(tx, companyId, \"1200\") || \"\";\n\n    await tx.insert(journalEntryLines).values([\n      {\n        id: randomUUID(),\n        journalEntryId: entryId,\n        lineNumber: 1,\n        accountId: cogsAccountId,\n        description: \"Cost of goods sold\",\n        debit: String(totalCOGS),\n        credit: \"0\",\n        createdAt: new Date(),\n      },\n      {\n        id: randomUUID(),\n        journalEntryId: entryId,\n        lineNumber: 2,\n        accountId: inventoryAccountId,\n        description: \"Inventory reduction\",\n        debit: \"0\",\n        credit: String(totalCOGS),\n        createdAt: new Date(),\n      }\n    ]);\n\n    return entry;\n  }\n\n  private async createARInvoiceJournalEntryTx(\n    tx: TxClient,\n    companyId: string,\n    invoiceId: string,\n    invoiceNumber: string,\n    total: number,\n    taxAmount: number,\n    userId: string\n  ): Promise<JournalEntry> {\n    const entryNumber = await this.getNextDocumentNumberTx(tx, companyId, 'JE');\n    const entryId = randomUUID();\n    const netAmount = total - taxAmount;\n\n    const [entry] = await tx.insert(journalEntries).values({\n      id: entryId,\n      companyId,\n      entryNumber,\n      entryDate: new Date(),\n      description: `Customer invoice ${invoiceNumber}`,\n      reference: invoiceNumber,\n      sourceDocument: \"invoice\",\n      sourceDocumentId: invoiceId,\n      status: \"posted\",\n      totalDebit: String(total),\n      totalCredit: String(total),\n      postedBy: userId,\n      postedAt: new Date(),\n      createdBy: userId,\n      createdAt: new Date(),\n    }).returning();\n\n    const arAccountId = await this.getAccountByCodeTx(tx, companyId, \"1200\") || \"\";\n    const revenueAccountId = await this.getAccountByCodeTx(tx, companyId, \"4100\") || \"\";\n\n    await tx.insert(journalEntryLines).values([\n      {\n        id: randomUUID(),\n        journalEntryId: entryId,\n        lineNumber: 1,\n        accountId: arAccountId,\n        description: \"Accounts Receivable\",\n        debit: String(total),\n        credit: \"0\",\n        createdAt: new Date(),\n      },\n      {\n        id: randomUUID(),\n        journalEntryId: entryId,\n        lineNumber: 2,\n        accountId: revenueAccountId,\n        description: \"Sales Revenue\",\n        debit: \"0\",\n        credit: String(netAmount),\n        createdAt: new Date(),\n      }\n    ]);\n\n    return entry;\n  }\n\n  private async createARLedgerEntryTx(\n    tx: TxClient,\n    companyId: string,\n    customerId: string,\n    invoiceId: string,\n    invoiceNumber: string,\n    amount: number,\n    journalEntryId: string\n  ): Promise<ArApLedger> {\n    const [entry] = await tx.insert(arApLedger).values({\n      id: randomUUID(),\n      companyId,\n      ledgerType: \"AR\",\n      customerId,\n      transactionDate: new Date(),\n      transactionType: \"invoice\",\n      documentId: invoiceId,\n      documentNumber: invoiceNumber,\n      description: `Customer invoice ${invoiceNumber}`,\n      debitAmount: String(amount),\n      creditAmount: \"0\",\n      runningBalance: String(amount),\n      currency: \"IDR\",\n      journalEntryId,\n      createdAt: new Date(),\n    }).returning();\n\n    return entry;\n  }\n\n  private async createPaymentReceiptJournalEntryTx(\n    tx: TxClient,\n    companyId: string,\n    paymentId: string,\n    paymentNumber: string,\n    amount: number,\n    bankAccountId: string,\n    userId: string\n  ): Promise<JournalEntry> {\n    const entryNumber = await this.getNextDocumentNumberTx(tx, companyId, 'JE');\n    const entryId = randomUUID();\n\n    const [entry] = await tx.insert(journalEntries).values({\n      id: entryId,\n      companyId,\n      entryNumber,\n      entryDate: new Date(),\n      description: `Payment receipt ${paymentNumber}`,\n      reference: paymentNumber,\n      sourceDocument: \"payment\",\n      sourceDocumentId: paymentId,\n      status: \"posted\",\n      totalDebit: String(amount),\n      totalCredit: String(amount),\n      postedBy: userId,\n      postedAt: new Date(),\n      createdBy: userId,\n      createdAt: new Date(),\n    }).returning();\n\n    const cashAccountId = bankAccountId || await this.getAccountByCodeTx(tx, companyId, \"1100\") || \"\";\n    const arAccountId = await this.getAccountByCodeTx(tx, companyId, \"1200\") || \"\";\n\n    await tx.insert(journalEntryLines).values([\n      {\n        id: randomUUID(),\n        journalEntryId: entryId,\n        lineNumber: 1,\n        accountId: cashAccountId,\n        description: \"Cash/Bank\",\n        debit: String(amount),\n        credit: \"0\",\n        createdAt: new Date(),\n      },\n      {\n        id: randomUUID(),\n        journalEntryId: entryId,\n        lineNumber: 2,\n        accountId: arAccountId,\n        description: \"Accounts Receivable\",\n        debit: \"0\",\n        credit: String(amount),\n        createdAt: new Date(),\n      }\n    ]);\n\n    return entry;\n  }\n\n  private async createARPaymentLedgerEntryTx(\n    tx: TxClient,\n    companyId: string,\n    customerId: string,\n    paymentId: string,\n    paymentNumber: string,\n    amount: number,\n    journalEntryId: string\n  ): Promise<ArApLedger> {\n    const [entry] = await tx.insert(arApLedger).values({\n      id: randomUUID(),\n      companyId,\n      ledgerType: \"AR\",\n      customerId,\n      transactionDate: new Date(),\n      transactionType: \"payment\",\n      documentId: paymentId,\n      documentNumber: paymentNumber,\n      description: `Payment receipt ${paymentNumber}`,\n      debitAmount: \"0\",\n      creditAmount: String(amount),\n      runningBalance: String(-amount),\n      currency: \"IDR\",\n      journalEntryId,\n      createdAt: new Date(),\n    }).returning();\n\n    return entry;\n  }\n\n  private async createGoodsReceiptJournalEntryTx(\n    tx: TxClient,\n    companyId: string,\n    receiptId: string,\n    receiptNumber: string,\n    totalCost: number,\n    userId: string\n  ): Promise<JournalEntry> {\n    const entryNumber = await this.getNextDocumentNumberTx(tx, companyId, 'JE');\n    const entryId = randomUUID();\n\n    const [entry] = await tx.insert(journalEntries).values({\n      id: entryId,\n      companyId,\n      entryNumber,\n      entryDate: new Date(),\n      description: `Goods receipt ${receiptNumber}`,\n      reference: receiptNumber,\n      sourceDocument: \"goods_receipt\",\n      sourceDocumentId: receiptId,\n      status: \"posted\",\n      totalDebit: String(totalCost),\n      totalCredit: String(totalCost),\n      postedBy: userId,\n      postedAt: new Date(),\n      createdBy: userId,\n      createdAt: new Date(),\n    }).returning();\n\n    const inventoryAccountId = await this.getAccountByCodeTx(tx, companyId, \"1200\") || \"\";\n    const grniAccountId = await this.getAccountByCodeTx(tx, companyId, \"2100\") || \"\";\n\n    await tx.insert(journalEntryLines).values([\n      {\n        id: randomUUID(),\n        journalEntryId: entryId,\n        lineNumber: 1,\n        accountId: inventoryAccountId,\n        description: \"Inventory\",\n        debit: String(totalCost),\n        credit: \"0\",\n        createdAt: new Date(),\n      },\n      {\n        id: randomUUID(),\n        journalEntryId: entryId,\n        lineNumber: 2,\n        accountId: grniAccountId,\n        description: \"GRNI - Goods Received Not Invoiced\",\n        debit: \"0\",\n        credit: String(totalCost),\n        createdAt: new Date(),\n      }\n    ]);\n\n    return entry;\n  }\n\n  private async createAPInvoiceJournalEntryTx(\n    tx: TxClient,\n    companyId: string,\n    invoiceId: string,\n    invoiceNumber: string,\n    total: number,\n    taxAmount: number,\n    userId: string\n  ): Promise<JournalEntry> {\n    const entryNumber = await this.getNextDocumentNumberTx(tx, companyId, 'JE');\n    const entryId = randomUUID();\n\n    const [entry] = await tx.insert(journalEntries).values({\n      id: entryId,\n      companyId,\n      entryNumber,\n      entryDate: new Date(),\n      description: `Vendor invoice ${invoiceNumber}`,\n      reference: invoiceNumber,\n      sourceDocument: \"invoice\",\n      sourceDocumentId: invoiceId,\n      status: \"posted\",\n      totalDebit: String(total),\n      totalCredit: String(total),\n      postedBy: userId,\n      postedAt: new Date(),\n      createdBy: userId,\n      createdAt: new Date(),\n    }).returning();\n\n    const grniAccountId = await this.getAccountByCodeTx(tx, companyId, \"2100\") || \"\";\n    const apAccountId = await this.getAccountByCodeTx(tx, companyId, \"2100\") || \"\";\n\n    await tx.insert(journalEntryLines).values([\n      {\n        id: randomUUID(),\n        journalEntryId: entryId,\n        lineNumber: 1,\n        accountId: grniAccountId,\n        description: \"GRNI - Clear accrual\",\n        debit: String(total),\n        credit: \"0\",\n        createdAt: new Date(),\n      },\n      {\n        id: randomUUID(),\n        journalEntryId: entryId,\n        lineNumber: 2,\n        accountId: apAccountId,\n        description: \"Accounts Payable\",\n        debit: \"0\",\n        credit: String(total),\n        createdAt: new Date(),\n      }\n    ]);\n\n    return entry;\n  }\n\n  private async createAPLedgerEntryTx(\n    tx: TxClient,\n    companyId: string,\n    vendorId: string,\n    invoiceId: string,\n    invoiceNumber: string,\n    amount: number,\n    journalEntryId: string\n  ): Promise<ArApLedger> {\n    const [entry] = await tx.insert(arApLedger).values({\n      id: randomUUID(),\n      companyId,\n      ledgerType: \"AP\",\n      vendorId,\n      transactionDate: new Date(),\n      transactionType: \"invoice\",\n      documentId: invoiceId,\n      documentNumber: invoiceNumber,\n      description: `Vendor invoice ${invoiceNumber}`,\n      debitAmount: \"0\",\n      creditAmount: String(amount),\n      runningBalance: String(amount),\n      currency: \"IDR\",\n      journalEntryId,\n      createdAt: new Date(),\n    }).returning();\n\n    return entry;\n  }\n\n  private async createVendorPaymentJournalEntryTx(\n    tx: TxClient,\n    companyId: string,\n    paymentId: string,\n    paymentNumber: string,\n    amount: number,\n    bankAccountId: string,\n    userId: string\n  ): Promise<JournalEntry> {\n    const entryNumber = await this.getNextDocumentNumberTx(tx, companyId, 'JE');\n    const entryId = randomUUID();\n\n    const [entry] = await tx.insert(journalEntries).values({\n      id: entryId,\n      companyId,\n      entryNumber,\n      entryDate: new Date(),\n      description: `Vendor payment ${paymentNumber}`,\n      reference: paymentNumber,\n      sourceDocument: \"payment\",\n      sourceDocumentId: paymentId,\n      status: \"posted\",\n      totalDebit: String(amount),\n      totalCredit: String(amount),\n      postedBy: userId,\n      postedAt: new Date(),\n      createdBy: userId,\n      createdAt: new Date(),\n    }).returning();\n\n    const apAccountId = await this.getAccountByCodeTx(tx, companyId, \"2100\") || \"\";\n    const cashAccountId = bankAccountId || await this.getAccountByCodeTx(tx, companyId, \"1100\") || \"\";\n\n    await tx.insert(journalEntryLines).values([\n      {\n        id: randomUUID(),\n        journalEntryId: entryId,\n        lineNumber: 1,\n        accountId: apAccountId,\n        description: \"Accounts Payable\",\n        debit: String(amount),\n        credit: \"0\",\n        createdAt: new Date(),\n      },\n      {\n        id: randomUUID(),\n        journalEntryId: entryId,\n        lineNumber: 2,\n        accountId: cashAccountId,\n        description: \"Cash/Bank\",\n        debit: \"0\",\n        credit: String(amount),\n        createdAt: new Date(),\n      }\n    ]);\n\n    return entry;\n  }\n\n  private async createAPPaymentLedgerEntryTx(\n    tx: TxClient,\n    companyId: string,\n    vendorId: string,\n    paymentId: string,\n    paymentNumber: string,\n    amount: number,\n    journalEntryId: string\n  ): Promise<ArApLedger> {\n    const [entry] = await tx.insert(arApLedger).values({\n      id: randomUUID(),\n      companyId,\n      ledgerType: \"AP\",\n      vendorId,\n      transactionDate: new Date(),\n      transactionType: \"payment\",\n      documentId: paymentId,\n      documentNumber: paymentNumber,\n      description: `Vendor payment ${paymentNumber}`,\n      debitAmount: String(amount),\n      creditAmount: \"0\",\n      runningBalance: String(-amount),\n      currency: \"IDR\",\n      journalEntryId,\n      createdAt: new Date(),\n    }).returning();\n\n    return entry;\n  }\n}\n\nexport const workflowService = new WorkflowService();\n","path":null,"size_bytes":58650,"size_tokens":null},"client/src/lib/export.ts":{"content":"export function exportToCSV(\n  data: Record<string, unknown>[],\n  headers: { key: string; label: string }[],\n  filename: string\n) {\n  if (data.length === 0) return;\n\n  const headerRow = headers.map(h => h.label).join(\",\");\n  const rows = data.map(row =>\n    headers.map(h => {\n      const value = row[h.key];\n      if (value === null || value === undefined) return \"\";\n      const stringValue = String(value);\n      if (stringValue.includes(\",\") || stringValue.includes('\"') || stringValue.includes(\"\\n\")) {\n        return `\"${stringValue.replace(/\"/g, '\"\"')}\"`;\n      }\n      return stringValue;\n    }).join(\",\")\n  );\n\n  const csv = [headerRow, ...rows].join(\"\\n\");\n  const blob = new Blob([csv], { type: \"text/csv;charset=utf-8;\" });\n  const url = URL.createObjectURL(blob);\n  const link = document.createElement(\"a\");\n  link.href = url;\n  link.download = `${filename}_${new Date().toISOString().split(\"T\")[0]}.csv`;\n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n  URL.revokeObjectURL(url);\n}\n\nexport function formatCurrency(value: string | number | null | undefined): string {\n  const num = typeof value === \"string\" ? parseFloat(value) : value;\n  if (num === null || num === undefined || isNaN(num)) return \"0\";\n  return num.toLocaleString(\"id-ID\");\n}\n\nexport function formatDate(date: string | Date | null | undefined): string {\n  if (!date) return \"\";\n  return new Date(date).toLocaleDateString(\"id-ID\");\n}\n","path":null,"size_bytes":1453,"size_tokens":null}},"version":2}